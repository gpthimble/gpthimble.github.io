<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Thimble&#39;s Blog</title>
  
  
  <link href="https://gpthimble.github.io/atom.xml" rel="self"/>
  
  <link href="https://gpthimble.github.io/"/>
  <updated>2021-01-30T03:01:52.162Z</updated>
  <id>https://gpthimble.github.io/</id>
  
  <author>
    <name>Thimble</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>控制单元的设计与实现</title>
    <link href="https://gpthimble.github.io/%E6%8E%A7%E5%88%B6%E5%8D%95%E5%85%83%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/"/>
    <id>https://gpthimble.github.io/%E6%8E%A7%E5%88%B6%E5%8D%95%E5%85%83%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/</id>
    <published>2021-01-24T12:16:38.000Z</published>
    <updated>2021-01-30T03:01:52.162Z</updated>
    
    <content type="html"><![CDATA[<p>&#x63A7;&#x5236;&#x5355;&#x5143;&#x662F;&#x6574;&#x4E2A;CPU&#x7684;&#x6838;&#x5FC3;&#xFF0C;&#x4ED6;&#x63A7;&#x5236;&#x7740;CPU&#x5185;&#x5404;&#x4E2A;&#x529F;&#x80FD;&#x90E8;&#x4EF6;&#x4EE5;&#x53CA;&#x6D41;&#x6C34;&#x7EBF;&#x7684;&#x8FD0;&#x4F5C;&#x3002;<br>&#x672C;&#x7CFB;&#x7EDF;&#x4E2D;&#x63A7;&#x5236;&#x5355;&#x5143;&#x7684;&#x529F;&#x80FD;&#x9700;&#x6C42;&#x4E5F;&#x662F;&#x968F;&#x7740;&#x8BBE;&#x8BA1;&#x5B9E;&#x73B0;&#x5DE5;&#x4F5C;&#x7684;&#x8FDB;&#x5C55;&#x4E00;&#x70B9;&#x4E00;&#x70B9;&#x589E;&#x52A0;&#x7684;&#xFF0C;&#x6211;&#x5148;&#x540E;&#x5728;&#x63A7;&#x5236;&#x5355;&#x5143;&#x4E2D;&#x6DFB;&#x52A0;&#x4E86;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x3001;&#x591A;&#x5468;&#x671F;&#x6307;&#x4EE4;&#x3001;cache&#x540C;&#x6B65;&#x548C;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x3001;&#x7CBE;&#x786E;&#x4E2D;&#x65AD;&#x548C;&#x5F02;&#x5E38;&#x7B49;&#x590D;&#x6742;&#x7684;&#x63A7;&#x5236;&#x529F;&#x80FD;,&#x5E0C;&#x671B;&#x5728;&#x4FDD;&#x6301;&#x8BBE;&#x8BA1;&#x7B80;&#x6D01;&#x7684;&#x540C;&#x65F6;&#x80FD;&#x591F;&#x7ED9;&#x7A0B;&#x5E8F;&#x5458;&#x5E26;&#x6765;&#x66F4;&#x591A;&#x4FBF;&#x5229;&#xFF0C;&#x6700;&#x5927;&#x9650;&#x5EA6;&#x7684;&#x5C4F;&#x853D;&#x5FAE;&#x67B6;&#x6784;&#x5728;&#x7A0B;&#x5E8F;&#x5C42;&#x9762;&#x7684;&#x5F71;&#x54CD;&#x3002;<br>&#x7ECF;&#x8FC7;&#x4E00;&#x4E2A;&#x591A;&#x6708;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x6211;&#x6240;&#x8BBE;&#x8BA1;&#x7684;&#x63A7;&#x5236;&#x5355;&#x5143;&#x521D;&#x7248;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;(control_unit.v)&#xFF0C;&#x6211;&#x5C06;&#x5728;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#x8BE6;&#x7EC6;&#x8BB0;&#x8FF0;&#x6211;&#x7684;&#x8BBE;&#x8BA1;&#x51B3;&#x7B56;&#x3002;</p><p>&#x8BBE;&#x8BA1;&#x4E2D;&#x6700;&#x590D;&#x6742;&#x7684;&#x90E8;&#x5206;&#x662F;&#x5B9E;&#x73B0;&#x5BF9;&#x6D41;&#x6C34;&#x7EBF;&#x6B63;&#x786E;&#x5730;&#x63A7;&#x5236;&#x3002;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5931;&#x8D25;&#x3001;&#x591A;&#x5468;&#x671F;&#x6307;&#x4EE4;&#x3001;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x3001;&#x5F02;&#x5E38;&#x4E2D;&#x65AD;&#x548C;&#x6D41;&#x6C34;&#x7EBF;&#x51B2;&#x7A81;&#x5F88;&#x591A;&#x662F;&#x53EF;&#x80FD;&#x540C;&#x65F6;&#x53D1;&#x751F;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x8981;&#x60F3;&#x5B9E;&#x73B0;&#x5BF9;&#x6D41;&#x6C34;&#x7EBF;&#x7684;&#x6B63;&#x786E;&#x63A7;&#x5236;&#xFF0C;&#x5FC5;&#x987B;&#x4ED4;&#x7EC6;&#x5206;&#x6790;&#x8FD9;&#x5176;&#x4E2D;&#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x4EE5;&#x786E;&#x5B9A;&#x5F53;&#x4ED6;&#x4EEC;&#x540C;&#x65F6;&#x53D1;&#x751F;&#x65F6;&#x5904;&#x7406;&#x5668;&#x7684;&#x884C;&#x4E3A;&#x3002;&#x8FD9;&#x9879;&#x5206;&#x6790;&#x5DE5;&#x4F5C;&#x5360;&#x636E;&#x4E86;&#x6211;&#x8FD9;&#x4E2A;&#x6708;&#x5927;&#x90E8;&#x5206;&#x65F6;&#x95F4;&#xFF0C;&#x6700;&#x7EC8;&#x6211;&#x5F97;&#x4EE5;&#x627E;&#x5230;&#x4E00;&#x5957;&#x5408;&#x7406;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;&#x6765;&#x89E3;&#x51B3;&#x6D41;&#x6C34;&#x7EBF;&#x7684;&#x63A7;&#x5236;&#xFF0C;&#x8FD9;&#x4E5F;&#x5C06;&#x662F;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x7684;&#x91CD;&#x70B9;&#x5185;&#x5BB9;&#x3002;</p><h2 id="&#x8BBE;&#x8BA1;&#x76EE;&#x6807;"><a href="#&#x8BBE;&#x8BA1;&#x76EE;&#x6807;" class="headerlink" title="&#x8BBE;&#x8BA1;&#x76EE;&#x6807;"></a>&#x8BBE;&#x8BA1;&#x76EE;&#x6807;</h2><ul><li>&#x786C;&#x7EBF;&#x903B;&#x8F91;&#x5B9E;&#x73B0;</li><li>&#x5206;&#x652F;&#x9884;&#x6D4B;&#x652F;&#x6301;</li><li>&#x591A;&#x5468;&#x671F;&#x6307;&#x4EE4;&#x652F;&#x6301;&#xFF08;&#x6309;&#x5B57;&#x8282;&#xFF0C;&#x6309;&#x534A;&#x5B57;&#x5199;&#x5165;&#x5185;&#x5B58;&#xFF09;</li><li>cache&#x540C;&#x6B65;&#x548C;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x652F;&#x6301;</li><li>&#x7CBE;&#x786E;&#x4E2D;&#x65AD;&#x548C;&#x5F02;&#x5E38;&#x652F;&#x6301;</li><li>&#x6B63;&#x786E;&#x9AD8;&#x6548;&#x5904;&#x7406;&#x6D41;&#x6C34;&#x7EBF;&#x51B2;&#x7A81;&#xFF08;&#x6D41;&#x6C34;&#x7EBF;&#x6682;&#x505C;&#x548C;&#x6570;&#x636E;&#x65C1;&#x8DEF;&#xFF0C;&#x672A;&#x6765;&#x8003;&#x8651;&#x589E;&#x52A0;&#x5BF9;&#x4E71;&#x5E8F;&#x6307;&#x4EE4;&#x7684;&#x652F;&#x6301;&#xFF08;&#x521D;&#x6B65;&#x7684;&#x8D85;&#x6807;&#x91CF;&#xFF09;&#xFF09;</li><li>&#x9884;&#x7559;&#x6027;&#x80FD;&#x68C0;&#x6D4B;&#x6A21;&#x5757;&#x652F;&#x6301;</li></ul><h2 id="&#x5B9E;&#x73B0;"><a href="#&#x5B9E;&#x73B0;" class="headerlink" title="&#x5B9E;&#x73B0;"></a>&#x5B9E;&#x73B0;</h2><h3 id="&#x63A5;&#x53E3;&#x5B9A;&#x4E49;"><a href="#&#x63A5;&#x53E3;&#x5B9A;&#x4E49;" class="headerlink" title="&#x63A5;&#x53E3;&#x5B9A;&#x4E49;"></a>&#x63A5;&#x53E3;&#x5B9A;&#x4E49;</h3><p>&#x4F9D;&#x7167;&#x60EF;&#x4F8B;&#xFF0C;&#x5148;&#x63CF;&#x8FF0;&#x63A7;&#x5236;&#x5355;&#x5143;&#x4E0E;&#x5176;&#x4ED6;&#x90E8;&#x4EF6;&#x7684;&#x63A5;&#x53E3;&#x3002;</p><h4 id="&#x4E0E;IR&#xFF08;&#x6307;&#x4EE4;&#x5BC4;&#x5B58;&#x5668;&#xFF09;&#x7684;&#x8FDE;&#x63A5;"><a href="#&#x4E0E;IR&#xFF08;&#x6307;&#x4EE4;&#x5BC4;&#x5B58;&#x5668;&#xFF09;&#x7684;&#x8FDE;&#x63A5;" class="headerlink" title="&#x4E0E;IR&#xFF08;&#x6307;&#x4EE4;&#x5BC4;&#x5B58;&#x5668;&#xFF09;&#x7684;&#x8FDE;&#x63A5;"></a>&#x4E0E;IR&#xFF08;&#x6307;&#x4EE4;&#x5BC4;&#x5B58;&#x5668;&#xFF09;&#x7684;&#x8FDE;&#x63A5;</h4><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">input</span> canceled;</span><br><span class="line"><span class="hljs-keyword">input</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] instruction;</span><br></pre></td></tr></table></figure><p>IR&#x662F;IF&#x7EA7;&#x4E0E;ID&#x7EA7;&#x4E4B;&#x95F4;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x5982;&#x679C;&#x8BE5;&#x6307;&#x4EE4;&#x5728;&#x9884;&#x53D6;&#x9636;&#x6BB5;&#xFF08;IF&#xFF09;&#x5C31;&#x88AB;&#x64A4;&#x9500;&#xFF0C;canceled&#x4F4D;&#x4F1A;&#x88AB;&#x8BBE;&#x7F6E;&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#x3002;<br>instruction&#x4F1A;&#x88AB;&#x62C6;&#x5206;&#x6210;&#x51E0;&#x6BB5;&#x4F9B;&#x8BD1;&#x7801;&#x5668;&#x4F7F;&#x7528;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">wire</span> [<span class="hljs-number">5</span>:<span class="hljs-number">0</span>] op = canceled ? <span class="hljs-number">6&apos;b0</span> : instruction [<span class="hljs-number">31</span>:<span class="hljs-number">26</span>];</span><br><span class="line"><span class="hljs-keyword">output</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] rs ;</span><br><span class="line"><span class="hljs-keyword">assign</span> rs = canceled ? <span class="hljs-number">5&apos;b0</span> : instruction [<span class="hljs-number">25</span>:<span class="hljs-number">21</span>];</span><br><span class="line"><span class="hljs-keyword">output</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] rt ;</span><br><span class="line"><span class="hljs-keyword">assign</span> rt = canceled ? <span class="hljs-number">5&apos;b0</span> : instruction [<span class="hljs-number">20</span>:<span class="hljs-number">16</span>];</span><br><span class="line"><span class="hljs-keyword">wire</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] rd = canceled ? <span class="hljs-number">5&apos;b0</span> : instruction [<span class="hljs-number">15</span>:<span class="hljs-number">11</span>];</span><br><span class="line"><span class="hljs-keyword">wire</span> [<span class="hljs-number">5</span>:<span class="hljs-number">0</span>] func = canceled ? <span class="hljs-number">6&apos;b0</span> : instruction [<span class="hljs-number">5</span>:<span class="hljs-number">0</span>];</span><br></pre></td></tr></table></figure><p>&#x5176;&#x4E2D;rs&#x3001;rt&#x7528;&#x4F5C;&#x4E24;&#x4E2A;&#x5BC4;&#x5B58;&#x5668;&#x53F7;&#x8F93;&#x51FA;&#x7ED9;&#x5BC4;&#x5B58;&#x5668;&#x5806;&#x505A;&#x7D22;&#x5F15;&#x3002;</p><h4 id="&#x4E0E;&#x5BC4;&#x5B58;&#x5668;&#x5806;&#x7684;&#x8FDE;&#x63A5;"><a href="#&#x4E0E;&#x5BC4;&#x5B58;&#x5668;&#x5806;&#x7684;&#x8FDE;&#x63A5;" class="headerlink" title="&#x4E0E;&#x5BC4;&#x5B58;&#x5668;&#x5806;&#x7684;&#x8FDE;&#x63A5;"></a>&#x4E0E;&#x5BC4;&#x5B58;&#x5668;&#x5806;&#x7684;&#x8FDE;&#x63A5;</h4><p>&#x9664;rs&#x3001;rt&#x8F93;&#x51FA;&#x7ED9;&#x5BC4;&#x5B58;&#x5668;&#x5806;&#x505A;&#x7D22;&#x5F15;&#x5916;&#xFF0C;CU&#x8FD8;&#x9700;&#x8981;&#x5C06;&#x5BC4;&#x5B58;&#x5668;&#x5806;&#x7684;&#x4E24;&#x4E2A;&#x6570;&#x636E;&#x8F93;&#x51FA;&#x4F5C;&#x4E3A;&#x8F93;&#x5165;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">output</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] rs ;</span><br><span class="line"><span class="hljs-keyword">output</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] rt ;</span><br><span class="line"><span class="hljs-keyword">input</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] qa,qb;</span><br></pre></td></tr></table></figure><h4 id="&#x5411;&#x4E0B;&#x4E00;&#x7EA7;&#x6D41;&#x6C34;&#x7EBF;&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x4FE1;&#x53F7;&#x8F93;&#x51FA;"><a href="#&#x5411;&#x4E0B;&#x4E00;&#x7EA7;&#x6D41;&#x6C34;&#x7EBF;&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x4FE1;&#x53F7;&#x8F93;&#x51FA;" class="headerlink" title="&#x5411;&#x4E0B;&#x4E00;&#x7EA7;&#x6D41;&#x6C34;&#x7EBF;&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x4FE1;&#x53F7;&#x8F93;&#x51FA;"></a>&#x5411;&#x4E0B;&#x4E00;&#x7EA7;&#x6D41;&#x6C34;&#x7EBF;&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x4FE1;&#x53F7;&#x8F93;&#x51FA;</h4><h5 id="&#x6570;&#x636E;&#x8F93;&#x51FA;"><a href="#&#x6570;&#x636E;&#x8F93;&#x51FA;" class="headerlink" title="&#x6570;&#x636E;&#x8F93;&#x51FA;"></a>&#x6570;&#x636E;&#x8F93;&#x51FA;</h5><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] da,db,imm;</span><br><span class="line"><span class="hljs-keyword">output</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] TargetReg;</span><br></pre></td></tr></table></figure><p>da&#xFF0C;db&#x548C;imm&#x662F;&#x4E09;&#x4E2A;&#x64CD;&#x4F5C;&#x6570;&#xFF0C;&#x5176;&#x4E2D;imm&#x6839;&#x636E;sign&#x4FE1;&#x53F7;&#x8FDB;&#x884C;&#x4E86;&#x7B26;&#x53F7;&#x6269;&#x5C55;&#x3002;<br>TargetReg&#x662F;&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x7684;&#x76EE;&#x6807;&#x5BC4;&#x5B58;&#x5668;&#x53F7;&#x3002;</p><h5 id="&#x63A7;&#x5236;&#x4FE1;&#x53F7;"><a href="#&#x63A7;&#x5236;&#x4FE1;&#x53F7;" class="headerlink" title="&#x63A7;&#x5236;&#x4FE1;&#x53F7;"></a>&#x63A7;&#x5236;&#x4FE1;&#x53F7;</h5><p>&#x8FD9;&#x4E9B;&#x4FE1;&#x53F7;&#x63A7;&#x5236;&#x7740;ID&#x7EA7;&#x540E;&#x7684;&#x529F;&#x80FD;&#x90E8;&#x4EF6;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">output</span> RegWrite,M2Reg,MemReq,MemWrite,AluImm,ShiftImm,link,slt;</span><br><span class="line"><span class="hljs-keyword">output</span> sign;</span><br><span class="line"><span class="hljs-keyword">output</span> StoreMask,LoadMask,B_HW,LoadSign;</span><br><span class="line"><span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span> [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] AluFunc;</span><br></pre></td></tr></table></figure><p>RegWrite&#xFF1A;&#x5F53;&#x6307;&#x4EE4;&#x9700;&#x8981;&#x5199;&#x5165;&#x5BC4;&#x5B58;&#x5668;&#x5806;&#x65F6;&#xFF0C;&#x8BE5;&#x4FE1;&#x53F7;&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#x3002;<br>M2Reg&#xFF1A;&#x5F53;&#x6307;&#x4EE4;&#x9700;&#x8981;&#x4ECE;&#x5185;&#x5B58;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x5E76;&#x5199;&#x5165;&#x5BC4;&#x5B58;&#x5668;&#x5806;&#x65F6;&#xFF08;load&#x6307;&#x4EE4;&#xFF09;&#xFF0C;&#x8BE5;&#x4FE1;&#x53F7;&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#x3002;<br>MemReq&#xFF1A;&#x5F53;&#x6307;&#x4EE4;&#x9700;&#x8981;&#x8BF7;&#x6C42;&#x5185;&#x5B58;&#x65F6;&#xFF0C;&#x8BE5;&#x4FE1;&#x53F7;&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#xFF0C;&#x8FD9;&#x4E2A;&#x4FE1;&#x53F7;&#x5728;MEM&#x7EA7;&#x4E0E;Dcache&#x7684;&#x8BF7;&#x6C42;&#x4FE1;&#x53F7;&#x76F8;&#x8FDE;&#x3002;<br>MemWrite&#xFF1A;&#x5F53;&#x6307;&#x4EE4;&#x9700;&#x8981;&#x5199;&#x5165;&#x5185;&#x5B58;&#x65F6;&#xFF08;store&#x6307;&#x4EE4;&#xFF09;&#xFF0C;&#x8BE5;&#x4FE1;&#x53F7;&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#x3002;<br>AluImm&#xFF1A;&#x8BE5;&#x4FE1;&#x53F7;&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#x8868;&#x793A;&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x5728;&#x4F7F;&#x7528;ALU&#x65F6;&#xFF0C;&#x5176;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x6570;&#x65F6;&#x7ACB;&#x5373;&#x6570;&#x3002;&#x8BE5;&#x4FE1;&#x53F7;&#x63A7;&#x5236;ALU&#x6570;&#x636E;&#x8F93;&#x5165;&#x63A5;&#x53E3;B&#x524D;&#x7684;&#x591A;&#x8DEF;&#x5668;&#x3002;<br>ShiftImm&#xFF1A;&#x8BE5;&#x4FE1;&#x53F7;&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#x8868;&#x793A;&#x5F53;&#x524D;&#x7684;&#x4F4D;&#x79FB;&#x6307;&#x4EE4;&#x7684;&#x4F4D;&#x79FB;&#x91CF;&#x662F;&#x7ACB;&#x5373;&#x6570;&#x3002;&#x8BE5;&#x4FE1;&#x53F7;&#x63A7;&#x5236;ALU&#x6570;&#x636E;&#x8F93;&#x5165;&#x63A5;&#x53E3;A&#x524D;&#x7684;&#x591A;&#x8DEF;&#x5668;&#x3002;<br>link&#xFF1A;&#x8BE5;&#x4FE1;&#x53F7;&#x8868;&#x793A;&#x5F53;&#x524D;&#x4FE1;&#x53F7;&#x662F;&#x4E00;&#x4E2A;jump and link&#x6307;&#x4EE4;&#xFF0C;&#x4ED6;&#x5C06;&#x4FEE;&#x6539;EXE&#x7EA7;&#x7684;&#x8F93;&#x51FA;&#xFF1A;&#x5C06;ALU&#x7684;&#x8F93;&#x51FA;&#x8BBE;&#x5B9A;&#x4E3A;PC+4&#xFF0C;&#x5E76;&#x5C06;&#x76EE;&#x6807;&#x5BC4;&#x5B58;&#x5668;&#x53F7;&#x8BBE;&#x5B9A;&#x4E3A;31.<br>slt: &#x8BE5;&#x4FE1;&#x53F7;&#x4E3A;&#x9AD8;&#x70B9;&#x5E76;&#x8868;&#x793A;&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x662F;&#x4E00;&#x4E2A;&#x6761;&#x4EF6;&#x6D4B;&#x8BD5;&#x6307;&#x4EE4;&#xFF08;stl&#x7B49;&#xFF09;&#x3002;</p><p>sign&#xFF1A;&#x8BE5;&#x4FE1;&#x53F7;&#x7528;&#x4E8E;&#x6307;&#x793A;EXE&#x7EA7;&#x8BA1;&#x7B97;&#x662F;&#x5426;&#x6709;&#x6EA2;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x5E76;&#x4E14;&#x7528;&#x4E8E;CU&#x5185;&#x90E8;&#x63A7;&#x5236;&#x7ACB;&#x5373;&#x6570;&#x7684;&#x7B26;&#x53F7;&#x6269;&#x5C55;&#x3002;</p><p>StoreMask,LoadMask,B_HW,LoadSign&#x56DB;&#x4E2A;&#x4FE1;&#x53F7;&#x7528;&#x4E8E;&#x5B9E;&#x73B0;&#x6309;&#x534A;&#x5B57;&#x3001;&#x6309;&#x5B57;&#x8282;&#x5B58;&#x53D6;&#xFF1A;<br>StoreMask&#xFF1A;&#x8BE5;&#x4FE1;&#x53F7;&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#x8868;&#x793A;&#x9700;&#x8981;MEM&#x7EA7;&#x5728;&#x5199;&#x5165;&#x524D;&#x4F7F;&#x7528;mask&#x3002;<br>LoadMask&#xFF1A;&#x8BE5;&#x4FE1;&#x53F7;&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#x8868;&#x793A;&#x9700;&#x8981;MEM&#x7EA7;&#x5728;&#x8BFB;&#x51FA;&#x540E;&#x4F7F;&#x7528;mask&#x3002;<br>B_HW&#xFF1A;&#x8BE5;&#x4FE1;&#x53F7;&#x63A7;&#x5236;mask&#x7684;&#x957F;&#x5EA6;&#x662F;8&#x4F4D;&#x8FD8;&#x662F;16&#x4F4D;&#xFF08;&#x5B57;&#x8282;&#x6216;&#x8005;&#x534A;&#x5B57;&#xFF09;&#x3002;<br>LoadSign&#xFF1A;&#x8BE5;&#x4FE1;&#x53F7;&#x63A7;&#x5236;&#x6309;&#x5B57;&#x8282;&#x6216;&#x6309;&#x534A;&#x5B57;&#x8BFB;&#x53D6;&#x65F6;&#x7684;&#x7B26;&#x53F7;&#x6269;&#x5C55;&#x3002;</p><p>AluFunc&#xFF1A;AluFunc&#x662F;&#x6839;&#x636E;&#x6307;&#x4EE4;&#x751F;&#x6210;&#x7684;ALU function code&#xFF0C;&#x7F16;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p><table><thead><tr><th>code</th><th>func</th><th>code</th><th>func</th><th>code</th><th>func</th><th>code</th><th>func</th></tr></thead><tbody><tr><td>0000</td><td>ADD</td><td>0100</td><td>AND</td><td>1000</td><td>SLL</td><td>1100</td><td>MULT</td></tr><tr><td>0001</td><td>SUB</td><td>0101</td><td>XOR</td><td>1001</td><td>LUI</td><td>1101</td><td>MULTU</td></tr><tr><td>0010</td><td>CLZ</td><td>0110</td><td>OR</td><td>1010</td><td>SRL</td><td>1110</td><td>DIV</td></tr><tr><td>0011</td><td>CLO</td><td>0111</td><td>NOR</td><td>1011</td><td>SRA</td><td>1111</td><td>DIVU</td></tr></tbody></table><h4 id="&#x6D41;&#x6C34;&#x7EBF;&#x63A7;&#x5236;"><a href="#&#x6D41;&#x6C34;&#x7EBF;&#x63A7;&#x5236;" class="headerlink" title="&#x6D41;&#x6C34;&#x7EBF;&#x63A7;&#x5236;"></a>&#x6D41;&#x6C34;&#x7EBF;&#x63A7;&#x5236;</h4><p>&#x4E24;&#x4E2A;<strong>cache</strong>&#x7684;ready&#x4FE1;&#x53F7;&#x8F93;&#x5165;&#xFF0C;&#x6807;&#x5FD7;&#x7740;&#x5904;&#x7406;&#x5668;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x4E0B;&#x4E00;&#x6761;&#x6307;&#x4EE4;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">input</span> I_cache_R, D_cache_R;</span><br></pre></td></tr></table></figure><p>&#x6839;&#x636E;&#x8FD9;&#x4E24;&#x4E2A;ready&#x4FE1;&#x53F7;&#x8F93;&#x5165;&#xFF0C;&#x53EF;&#x4EE5;&#x751F;&#x6210;<strong>CPU_stall</strong>&#x4FE1;&#x53F7;&#xFF0C;&#x5B83;&#x65E2;&#x53C2;&#x4E0E;ID&#x7EA7;&#x5185;&#x90E8;&#x7684;&#x63A7;&#x5236;&#xFF0C;&#x4E5F;&#x4F5C;&#x4E3A;&#x63A7;&#x5236;&#x4FE1;&#x53F7;&#x8F93;&#x51FA;&#x7ED9;&#x5176;&#x4ED6;&#x5404;&#x7EA7;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">output</span> CPU_stall;</span><br><span class="line"><span class="hljs-keyword">assign</span> CPU_stall = ~(I_cache_R &amp; D_cache_R);</span><br></pre></td></tr></table></figure><p>&#x5BF9;&#x4E8E;IF&#x548C;ID&#x7EA7;&#xFF0C;&#x591A;&#x5468;&#x671F;&#x6307;&#x4EE4;&#x548C;&#x6D41;&#x6C34;&#x7EBF;&#x6570;&#x636E;&#x76F8;&#x5173;&#x51B2;&#x7A81;&#x4F1A;&#x5F15;&#x8D77;<strong>&#x989D;&#x5916;&#x7684;&#x6682;&#x505C;</strong>,Stall_IF_ID&#x4E0E;CPU_stall&#x4E00;&#x8D77;&#x63A7;&#x5236;IF&#x548C;ID&#x7EA7;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x5199;&#x5165;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">output</span> Stall_IF_ID;</span><br></pre></td></tr></table></figure><p>&#x63A7;&#x5236;&#x5355;&#x5143;&#x4E0E;<strong>&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5668;</strong>&#x7684;&#x63A5;&#x53E3;&#x5982;&#x4E0B;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">output</span> BP_miss;</span><br><span class="line"><span class="hljs-keyword">output</span> is_branch,do_branch, V_target;</span><br><span class="line"><span class="hljs-keyword">input</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] BP_target;</span><br></pre></td></tr></table></figure><p>BP_miss&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#x6807;&#x5FD7;&#x5F53;&#x524D;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x7ED3;&#x679C;&#x9519;&#x8BEF;&#xFF0C;&#x6D41;&#x6C34;&#x7EBF;&#x9700;&#x8981;&#x9000;&#x56DE;&#x3002;<br>is_branch&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#x8868;&#x793A;&#x5F53;&#x524D;ID&#x7EA7;&#x7684;&#x6709;&#x6548;&#x6307;&#x4EE4;&#x662F;&#x4E00;&#x4E2A;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x3002;<br>do_branch&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#x8868;&#x793A;&#x82E5;&#x5F53;&#x524D;ID&#x7EA7;&#x7684;&#x6709;&#x6548;&#x6307;&#x4EE4;&#x662F;&#x4E00;&#x4E2A;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#xFF0C;&#x5219;&#x5F53;&#x524D;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x7684;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;&#x662F;&#x8DF3;&#x8F6C;&#x53D1;&#x751F;&#x3002;<br>V_target&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#x8868;&#x793A;&#x82E5;&#x5F53;&#x524D;ID&#x7EA7;&#x7684;&#x6709;&#x6548;&#x6307;&#x4EE4;&#x662F;&#x4E00;&#x4E2A;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#xFF0C;&#x5219;&#x5F53;&#x524D;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x7684;&#x8DF3;&#x8F6C;&#x76EE;&#x6807;&#x662F;&#x53EF;&#x53D8;&#x7684;&#xFF08;&#x7531;&#x5BC4;&#x5B58;&#x5668;&#x8BFB;&#x51FA;&#xFF09;&#x3002;<br>&#x4E0A;&#x8FF0;&#x56DB;&#x4E2A;&#x6307;&#x4EE4;&#x5C06;&#x6307;&#x5BFC;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5668;&#x66F4;&#x65B0;&#x7EF4;&#x62A4;&#x5176;&#x8DF3;&#x8F6C;&#x5386;&#x53F2;&#x8868;&#x3002;<br>BP_target&#x4E3A;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5668;&#x7684;&#x8F93;&#x51FA;&#xFF0C;&#x662F;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5668;&#x7684;&#x9884;&#x6D4B;&#x7ED3;&#x679C;&#xFF0C;&#x8BE5;&#x6570;&#x636E;&#x7528;&#x4E8E;&#x8BA1;&#x7B97;next PC&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] next_PC;</span><br></pre></td></tr></table></figure><p>PC&#x5BC4;&#x5B58;&#x5668;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x5728;&#x6BCF;&#x4E00;&#x7EA7;&#x6D41;&#x6C34;&#x7EBF;&#x5BC4;&#x5B58;&#x5668;&#x4E2D;&#x90FD;&#x8981;&#x5BC4;&#x5B58;&#xFF0C;&#x7528;&#x4E8E;&#x8FFD;&#x8E2A;&#x5F53;&#x524D;&#x7EA7;&#x6267;&#x884C;&#x7684;&#x6307;&#x4EE4;&#x5730;&#x5740;&#xFF0C;&#x4EE5;&#x5B9E;&#x73B0;&#x590D;&#x6742;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x63A7;&#x5236;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">input</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] PC, ID_PC, EXE_PC, MEM_PC;</span><br></pre></td></tr></table></figure><p>&#x9664;ID&#x7EA7;<strong>&#x5F02;&#x5E38;</strong>&#x548C;<strong>&#x5F02;&#x5E38;&#x53F7;</strong>&#x7531;CU&#x751F;&#x6210;&#x5916;&#xFF0C;&#x5176;&#x4F59;&#x5404;&#x7EA7;&#x7684;&#x5F02;&#x5E38;&#x548C;&#x5F02;&#x5E38;&#x53F7;&#x5747;&#x7531;&#x5404;&#x7EA7;&#x76F4;&#x63A5;&#x8F93;&#x5165;&#x7ED9;CU&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">input</span> exc_IF, exc_EXE,exc_MEM;</span><br><span class="line"><span class="hljs-keyword">input</span> [<span class="hljs-number">2</span>:<span class="hljs-number">0</span>] IF_cause,EXE_cause,MEM_cause;</span><br></pre></td></tr></table></figure><p>&#x6BCF;&#x7EA7;&#x5F02;&#x5E38;&#x53F7;&#x5747;&#x6709;3&#x4F4D;&#xFF0C;&#x5373;&#x6BCF;&#x7EA7;&#x652F;&#x6301;7&#x79CD;&#x5F02;&#x5E38;&#x3002;</p><p>&#x7531;CU&#x4EA7;&#x751F;&#x5404;&#x7EA7;&#x7684;<strong>&#x5E9F;&#x5F03;&#x4FE1;&#x53F7;</strong>&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span> ban_IF,ban_EXE,ban_MEM;</span><br><span class="line"><span class="hljs-keyword">output</span> ban_ID;</span><br></pre></td></tr></table></figure><p>&#x4E0E;<strong>&#x4E2D;&#x65AD;&#x63A7;&#x5236;&#x5668;</strong>&#x7684;&#x8FDE;&#x63A5;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">input</span> int_in;</span><br><span class="line"><span class="hljs-keyword">output</span> int_ack;</span><br><span class="line"><span class="hljs-keyword">input</span> [<span class="hljs-number">19</span>:<span class="hljs-number">0</span>] int_num;</span><br></pre></td></tr></table></figure><p>SOC&#x4E2D;&#xFF0C;&#x4E2D;&#x65AD;&#x63A7;&#x5236;&#x5668;&#x8D1F;&#x8D23;&#x63A7;&#x5236;&#x5916;&#x90E8;&#x4E2D;&#x65AD;&#x7684;&#x6392;&#x961F;&#x3002;&#x5B83;&#x5C06;&#x6392;&#x961F;&#x6210;&#x529F;&#x7684;&#x8BF7;&#x6C42;&#x7F16;&#x7801;&#x6210;20&#x4F4D;&#x7684;&#x4E2D;&#x65AD;&#x5411;&#x91CF;&#x901A;&#x8FC7;int_num&#x9001;&#x7ED9;CU&#xFF0C;&#x5E76;&#x5C06;&#x5916;&#x90E8;&#x4E2D;&#x65AD;&#x4FE1;&#x53F7;int_in&#x7F6E;&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#xFF0C;&#x7B49;&#x5F85;CU&#x51B3;&#x5B9A;&#x63A5;&#x53D7;&#x4E2D;&#x65AD;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;CU&#x4F1A;&#x5C06;int_ack&#x7F6E;&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#x4E00;&#x4E2A;&#x5468;&#x671F;&#xFF0C;&#x4E2D;&#x65AD;&#x63A7;&#x5236;&#x5668;&#x5728;&#x6536;&#x5230;int_ack&#x540E;&#x5E94;&#x7ACB;&#x5373;&#x64A4;&#x6389;&#x5F53;&#x524D;&#x4E2D;&#x65AD;&#x8BF7;&#x6C42;&#x3002;</p><p>&#x6BCF;&#x7EA7;&#x7684;3&#x4F4D;&#x5F02;&#x5E38;&#x53F7;&#x548C;20&#x4F4D;&#x7684;&#x4E2D;&#x65AD;&#x5411;&#x91CF;&#x4E00;&#x8D77;&#x7F16;&#x7801;&#xFF0C;&#x5728;&#x54CD;&#x5E94;&#x5F02;&#x5E38;&#x6216;&#x4E2D;&#x65AD;&#x65F6;&#x5B58;&#x50A8;&#x5728;CAUSE&#x5BC4;&#x5B58;&#x5668;&#x4E2D;&#xFF0C;&#x7F16;&#x7801;&#x683C;&#x5F0F;&#x5982;&#x4E0B;&#xFF1A;</p><table><thead><tr><th>31-29</th><th>28-26</th><th>25 -23</th><th>22-20</th><th>19      &#x2014;       0</th></tr></thead><tbody><tr><td>IF</td><td>ID</td><td>EXE</td><td>MEM</td><td>interrupt</td></tr></tbody></table><p>&#x5904;&#x7406;<strong>&#x6D41;&#x6C34;&#x7EBF;&#x6570;&#x636E;&#x76F8;&#x5173;</strong>&#x7684;&#x6682;&#x505C;&#x548C;<strong>&#x6570;&#x636E;&#x65C1;&#x8DEF;</strong>&#x9700;&#x8981;EXE&#x7EA7;&#x548C;MEM&#x7EA7;&#x7684;&#x63A7;&#x5236;&#x4FE1;&#x53F7;&#xFF0C;&#x56E0;&#x6B64;&#x8981;&#x5C06;&#x4E0B;&#x5217;&#x4FE1;&#x53F7;&#x4ECE;EXE&#x7EA7;&#x548C;MEM&#x7EA7;&#x62BD;&#x51FA;&#xFF0C;&#x8F93;&#x5165;CU:</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">input</span>  M_m2reg,M_RegWrite,E_m2reg,E_RegWrite;</span><br><span class="line"><span class="hljs-keyword">input</span>  [ <span class="hljs-number">4</span>:<span class="hljs-number">0</span>] M_TargetReg,E_TargetReg;</span><br><span class="line"><span class="hljs-keyword">input</span>  [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] E_AluOut,M_AluOut,M_MemOut;</span><br></pre></td></tr></table></figure><p>M_m2reg,M_RegWrite,E_m2reg,E_RegWrite&#x5BF9;&#x5E94;MEM&#x7EA7;&#x548C;EXE&#x7EA7;&#x7684;m2reg&#x548C;RegWrite&#x4FE1;&#x53F7;&#x3002;<br>M_TargetReg&#x548C;E_TargetReg&#x7528;&#x4E8E;&#x548C;&#x5F53;&#x524D;ID&#x7EA7;&#x6307;&#x4EE4;&#x7684;&#x6E90;&#x5BC4;&#x5B58;&#x5668;&#x53F7;&#x6BD4;&#x8F83;&#xFF0C;&#x4EE5;&#x53D1;&#x73B0;&#x6570;&#x636E;&#x76F8;&#x5173;&#x5192;&#x9669;&#x3002;<br>E_AluOut,M_AluOut,M_MemOut&#x7528;&#x4F5C;&#x6570;&#x636E;&#x65C1;&#x8DEF;&#xFF0C;&#x5C06;&#x8FD9;&#x4E9B;&#x672A;&#x6267;&#x884C;&#x5B8C;&#x7684;&#x6307;&#x4EE4;&#x7684;&#x4E2D;&#x95F4;&#x7ED3;&#x679C;&#x76F4;&#x63A5;&#x62FF;&#x5230;ID&#x7EA7;&#x4F7F;&#x7528;&#x3002;</p><p>CU&#x8FD8;&#x652F;&#x6301;&#x5BF9;<strong>&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;</strong>&#x7684;&#x540C;&#x6B65;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x5F53;&#x524D;MEM&#x7EA7;&#x6B63;&#x51C6;&#x5907;&#x4FEE;&#x6539;&#x7684;&#x5185;&#x5B58;&#x5730;&#x5740;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">input</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] M_MemAddr;</span><br><span class="line"><span class="hljs-keyword">input</span> M_MemWrite;</span><br></pre></td></tr></table></figure><h4 id="&#x65F6;&#x949F;&#x548C;&#x6E05;&#x96F6;&#x4FE1;&#x53F7;"><a href="#&#x65F6;&#x949F;&#x548C;&#x6E05;&#x96F6;&#x4FE1;&#x53F7;" class="headerlink" title="&#x65F6;&#x949F;&#x548C;&#x6E05;&#x96F6;&#x4FE1;&#x53F7;"></a>&#x65F6;&#x949F;&#x548C;&#x6E05;&#x96F6;&#x4FE1;&#x53F7;</h4><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">input</span> clk,clr;</span><br></pre></td></tr></table></figure><h3 id="&#x529F;&#x80FD;&#x5B9E;&#x73B0;"><a href="#&#x529F;&#x80FD;&#x5B9E;&#x73B0;" class="headerlink" title="&#x529F;&#x80FD;&#x5B9E;&#x73B0;"></a>&#x529F;&#x80FD;&#x5B9E;&#x73B0;</h3><p>&#x5BF9;&#x4E8E;CU&#x5B9E;&#x73B0;&#x7684;&#x63CF;&#x8FF0;&#x6211;&#x5C06;&#x6309;&#x7167;&#x5148;&#x7B80;&#x5355;&#x540E;&#x590D;&#x6742;&#xFF0C;&#x5148;&#x4E2A;&#x4F53;&#x518D;&#x6574;&#x4F53;&#x7684;&#x987A;&#x5E8F;&#x63CF;&#x8FF0;&#xFF0C;&#x5148;&#x8BF4;&#x4E00;&#x8BF4;&#x6BCF;&#x4E2A;&#x529F;&#x80FD;&#x5355;&#x5143;&#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x8BF4;&#x5173;&#x4E8E;&#x4ED6;&#x4EEC;&#x534F;&#x540C;&#x5DE5;&#x4F5C;&#x7684;&#x8BBE;&#x8BA1;&#x3002;</p><h4 id="&#x6307;&#x4EE4;&#x8BD1;&#x7801;"><a href="#&#x6307;&#x4EE4;&#x8BD1;&#x7801;" class="headerlink" title="&#x6307;&#x4EE4;&#x8BD1;&#x7801;"></a>&#x6307;&#x4EE4;&#x8BD1;&#x7801;</h4><p>&#x6307;&#x4EE4;&#x8BD1;&#x7801;&#x662F;CU&#x4E2D;&#x6700;&#x5BB9;&#x6613;&#x5B9E;&#x73B0;&#x7684;&#x90E8;&#x5206;&#xFF0C;&#x5B83;&#x76F4;&#x63A5;&#x5C06;&#x5206;&#x7247;&#x8FC7;&#x7684;&#x6307;&#x4EE4;&#x4E0E;&#x6307;&#x4EE4;&#x6A21;&#x677F;&#x8FDB;&#x884C;&#x6BD4;&#x5BF9;&#x3002;&#x5982;&#x679C;&#x672A;&#x6765;&#x8981;&#x652F;&#x6301;&#x5176;&#x4ED6;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x76F4;&#x63A5;&#x4FEE;&#x6539;&#x8FD9;&#x90E8;&#x5206;&#x8BBE;&#x8BA1;&#x3002;<br>&#x9996;&#x5148;&#x5C06;Register&#x7C7B;&#x578B;&#x7684;&#x6307;&#x4EE4;&#x6311;&#x51FA;&#x6765;,&#x4FBF;&#x4E8E;&#x540E;&#x7EED;&#x6307;&#x4EE4;&#x8BD1;&#x7801;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//the instruction is R-type if the op code is 000000(SPECIAL), 011100(SPECIAL2)</span></span><br><span class="line"><span class="hljs-comment">//or 010000(CP0). </span></span><br><span class="line"><span class="hljs-keyword">wire</span> r_type  = ((op == <span class="hljs-number">6&apos;b000000</span>)? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>);</span><br><span class="line"><span class="hljs-keyword">wire</span> r_type_2 = ((op == <span class="hljs-number">6&apos;b011100</span>)? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>);</span><br><span class="line"><span class="hljs-keyword">wire</span> r_type_cp0 = ((op == <span class="hljs-number">6&apos;b010000</span>)? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>);</span><br></pre></td></tr></table></figure><p>&#x8BD1;&#x7801;&#x76F8;&#x5173;&#x6307;&#x4EE4;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x3002;R type&#x6307;&#x4EE4;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//R_type</span></span><br><span class="line"><span class="hljs-keyword">wire</span> i_eret = (r_type_cp0 &amp;&amp; rs==<span class="hljs-number">5&apos;b10000</span> &amp;&amp; func==<span class="hljs-number">6&apos;b011000</span>)?<span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_mfc0 = (r_type_cp0 &amp;&amp; rs==<span class="hljs-number">5&apos;b00000</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_mtc0 = (r_type_cp0 &amp;&amp; rs==<span class="hljs-number">5&apos;b00100</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">wire</span> i_syscall = (r_type &amp;&amp; func ==<span class="hljs-number">6&apos;b001100</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">wire</span> i_sll  = (r_type &amp;&amp; func==<span class="hljs-number">6&apos;b000000</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_srl  = (r_type &amp;&amp; func==<span class="hljs-number">6&apos;b000010</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_sra  = (r_type &amp;&amp; func==<span class="hljs-number">6&apos;b000011</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_sllv = (r_type &amp;&amp; func==<span class="hljs-number">6&apos;b000100</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_srlv = (r_type &amp;&amp; func==<span class="hljs-number">6&apos;b000110</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_srav = (r_type &amp;&amp; func==<span class="hljs-number">6&apos;b000111</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_jr   = (r_type &amp;&amp; func==<span class="hljs-number">6&apos;b001000</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_jalr = (r_type &amp;&amp; func==<span class="hljs-number">6&apos;b001001</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_add  = (r_type &amp;&amp; func==<span class="hljs-number">6&apos;b100000</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_addu = (r_type &amp;&amp; func==<span class="hljs-number">6&apos;b100001</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_sub  = (r_type &amp;&amp; func==<span class="hljs-number">6&apos;b100010</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_subu = (r_type &amp;&amp; func==<span class="hljs-number">6&apos;b100011</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_and  = (r_type &amp;&amp; func==<span class="hljs-number">6&apos;b100100</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_or   = (r_type &amp;&amp; func==<span class="hljs-number">6&apos;b100101</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_xor  = (r_type &amp;&amp; func==<span class="hljs-number">6&apos;b100110</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_nor  = (r_type &amp;&amp; func==<span class="hljs-number">6&apos;b100111</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_slt  = (r_type &amp;&amp; func==<span class="hljs-number">6&apos;b101010</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_sltu = (r_type &amp;&amp; func==<span class="hljs-number">6&apos;b101011</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">wire</span> i_clz  = (r_type_2 &amp;&amp; func==<span class="hljs-number">6&apos;b100000</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_clo  = (r_type_2 &amp;&amp; func==<span class="hljs-number">6&apos;b100001</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br></pre></td></tr></table></figure><p>I type&#x6307;&#x4EE4;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//I_type</span></span><br><span class="line"><span class="hljs-keyword">wire</span> i_bgez   = (op==<span class="hljs-number">6&apos;b000001</span> &amp;&amp; rt==<span class="hljs-number">5&apos;b00001</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_bgezal = (op==<span class="hljs-number">6&apos;b000001</span> &amp;&amp; rt==<span class="hljs-number">5&apos;b10001</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_bltz   = (op==<span class="hljs-number">6&apos;b000001</span> &amp;&amp; rt==<span class="hljs-number">5&apos;b00000</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_bltzal = (op==<span class="hljs-number">6&apos;b000001</span> &amp;&amp; rt==<span class="hljs-number">5&apos;b10000</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_beq    = (op==<span class="hljs-number">6&apos;b000100</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_bne    = (op==<span class="hljs-number">6&apos;b000101</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>; </span><br><span class="line"><span class="hljs-keyword">wire</span> i_blez   = (op==<span class="hljs-number">6&apos;b000110</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_bgtz   = (op==<span class="hljs-number">6&apos;b000111</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_addi   = (op==<span class="hljs-number">6&apos;b001000</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_addiu  = (op==<span class="hljs-number">6&apos;b001001</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_slti   = (op==<span class="hljs-number">6&apos;b001010</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_sltiu  = (op==<span class="hljs-number">6&apos;b001011</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_andi   = (op==<span class="hljs-number">6&apos;b001100</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_ori    = (op==<span class="hljs-number">6&apos;b001101</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_xori   = (op==<span class="hljs-number">6&apos;b001110</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_lui    = (op==<span class="hljs-number">6&apos;b001111</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_lb     = (op==<span class="hljs-number">6&apos;b100000</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_lh     = (op==<span class="hljs-number">6&apos;b100001</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_lw     = (op==<span class="hljs-number">6&apos;b100011</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_lbu    = (op==<span class="hljs-number">6&apos;b100100</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_lhu    = (op==<span class="hljs-number">6&apos;b100101</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_sb     = (op==<span class="hljs-number">6&apos;b101000</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_sh     = (op==<span class="hljs-number">6&apos;b101001</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_sw     = (op==<span class="hljs-number">6&apos;b101011</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br></pre></td></tr></table></figure><p>J type&#x6307;&#x4EE4;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//J_type</span></span><br><span class="line"><span class="hljs-keyword">wire</span> i_j   = (op==<span class="hljs-number">6&apos;b000010</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">wire</span> i_jal = (op==<span class="hljs-number">6&apos;b000011</span>) ? <span class="hljs-number">1&apos;b1</span>:<span class="hljs-number">1&apos;b0</span>;</span><br></pre></td></tr></table></figure><p>&#x6BCF;&#x4E2A;&#x652F;&#x6301;&#x7684;&#x6307;&#x4EE4;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;i_xxx&#x4FE1;&#x53F7;&#xFF0C;&#x8FD9;&#x4E9B;&#x4FE1;&#x53F7;&#x540C;&#x4E00;&#x65F6;&#x95F4;&#x53EA;&#x6709;&#x53EF;&#x80FD;&#x6709;&#x4E00;&#x4E2A;&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#x3002;&#x82E5;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x4FE1;&#x53F7;&#x5747;&#x4E3A;&#x4F4E;&#x7535;&#x5E73;&#x5219;&#x8BF4;&#x660E;&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x672A;&#x5C1A;&#x4E0D;&#x652F;&#x6301;&#x7684;&#x6307;&#x4EE4;&#xFF0C;CU&#x4F1A;&#x4EA7;&#x751F;ID&#x7EA7;&#x5F02;&#x5E38;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//for instructions which are not implemented. </span></span><br><span class="line"><span class="hljs-keyword">wire</span> i_unimp =~(i_xxx|i_xxx......);</span><br></pre></td></tr></table></figure><h4 id="&#x591A;&#x5468;&#x671F;&#x6307;&#x4EE4;&#x652F;&#x6301;"><a href="#&#x591A;&#x5468;&#x671F;&#x6307;&#x4EE4;&#x652F;&#x6301;" class="headerlink" title="&#x591A;&#x5468;&#x671F;&#x6307;&#x4EE4;&#x652F;&#x6301;"></a>&#x591A;&#x5468;&#x671F;&#x6307;&#x4EE4;&#x652F;&#x6301;</h4><p>&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x652F;&#x6301;&#x591A;&#x5468;&#x671F;&#x6307;&#x4EE4;&#xFF1F;&#x6709;&#x4E9B;&#x6307;&#x4EE4;&#x662F;&#x65E0;&#x6CD5;&#x5728;&#x4E00;&#x4E2A;&#x5468;&#x671F;&#x5185;&#x6267;&#x884C;&#x5B8C;&#x7684;&#xFF0C;&#x6BD4;&#x5982;store byte&#x548C;store half-word&#x3002;&#x6211;&#x6240;&#x8BBE;&#x8BA1;&#x7684;&#x8FD9;&#x4E2A;&#x8BA1;&#x7B97;&#x673A;&#x7CFB;&#x7EDF;&#x5185;&#x5B58;&#x662F;&#x6309;&#x5B57;&#xFF08;4&#x5B57;&#x8282;&#xFF09;&#x7D22;&#x5F15;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x8981;&#x60F3;&#x5B9E;&#x73B0;SB&#x548C;SHW&#x6307;&#x4EE4;&#xFF0C;&#x81F3;&#x5C11;&#x9700;&#x8981;&#x4E24;&#x4E2A;&#x5468;&#x671F;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x5468;&#x671F;&#x8BFB;&#x53D6;&#x8981;&#x5199;&#x5165;&#x7684;&#x5B57;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x5468;&#x671F;&#x4FEE;&#x6539;&#x8981;&#x4FEE;&#x6539;&#x7684;&#x5B57;&#x8282;&#x6216;&#x534A;&#x5B57;&#x5E76;&#x5199;&#x5165;&#x5185;&#x5B58;&#x3002;&#x5982;&#x679C;&#x5904;&#x7406;&#x5668;&#x4E0D;&#x76F4;&#x63A5;&#x63D0;&#x4F9B;&#x8FD9;&#x79CD;&#x6309;&#x5B57;&#x8282;&#x6216;&#x6309;&#x534A;&#x5B57;&#x5B58;&#x53D6;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x5C31;&#x8981;&#x4F7F;&#x7528;&#x6C47;&#x7F16;&#x5668;&#x4EA7;&#x751F;&#x7684;&#x4F2A;&#x6307;&#x4EE4;&#xFF0C;&#x8FD9;&#x6837;&#x5F88;&#x96BE;&#x4FDD;&#x8BC1;&#x4E24;&#x6761;&#x4F2A;&#x6307;&#x4EE4;&#x4E4B;&#x95F4;&#x7684;&#x539F;&#x5B50;&#x6027;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x51B3;&#x5B9A;&#x5728;CU&#x4E2D;&#x589E;&#x52A0;&#x5BF9;&#x591A;&#x5468;&#x671F;&#x6307;&#x4EE4;&#x7684;&#x652F;&#x6301;&#x3002;&#x5177;&#x4F53;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x5FAE;&#x7A0B;&#x5E8F;&#x8BA1;&#x6570;&#x5668;&#xFF08;microprogram counter uPC&#xFF09;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x8BD1;&#x7801;&#x5355;&#x5143;&#x4E2D;&#x5BF9;&#x6BCF;&#x6761;&#x6307;&#x4EE4;&#x6240;&#x9700;&#x8981;&#x7684;&#x5468;&#x671F;&#x6570;&#x8FDB;&#x884C;&#x8BB0;&#x5F55;&#xFF08;cycle&#xFF09;&#xFF0C;&#x5F53;upc&#x5C0F;&#x4E8E;cycle&#x65F6;&#xFF0C;&#x8BF4;&#x660E;&#x6307;&#x4EE4;&#x5C1A;&#x672A;&#x6267;&#x884C;&#x5B8C;&#xFF0C;ID&#x7EA7;&#x548C;IF&#x7EA7;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x5BC4;&#x5B58;&#x5668;&#x4F1A;&#x6682;&#x505C;&#xFF0C;&#x800C;CU&#x5185;&#x90E8;&#x6839;&#x636E;&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x548C;upc&#x7684;&#x503C;&#x751F;&#x6210;&#x5BF9;&#x5E94;&#x591A;&#x5468;&#x671F;&#x6307;&#x4EE4;&#x67D0;&#x4E00;&#x5468;&#x671F;&#x6240;&#x9700;&#x8981;&#x7684;&#x63A7;&#x5236;&#x4FE1;&#x53F7;&#x3002;&#x8FD9;&#x4E2A;&#x505A;&#x6CD5;&#x4E0E;&#x4F20;&#x7EDF;&#x7684;&#x4F7F;&#x7528;&#x5FAE;&#x7A0B;&#x5E8F;&#x7684;&#x63A7;&#x5236;&#x5355;&#x5143;&#x6709;&#x4E00;&#x5B9A;&#x7684;&#x4E0D;&#x540C;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//cycle implies number of cycles for a instruction</span></span><br><span class="line"><span class="hljs-comment">//The width of this signal is variable. For now the maximum is 2 clock cycles,</span></span><br><span class="line"><span class="hljs-comment">//so the cycle is 1 bit long.</span></span><br><span class="line"><span class="hljs-keyword">wire</span> cycle = (i_sb|i_sh) ? <span class="hljs-number">1&apos;b1</span> : <span class="hljs-number">1&apos;b0</span>;</span><br><span class="line"><span class="hljs-comment">//upc is the micro program counter for multi-cycle instructions.</span></span><br><span class="line"><span class="hljs-comment">//upc is cleared when a instruction is done.</span></span><br><span class="line"><span class="hljs-comment">//As mentioned above the width of this counter is variable.</span></span><br><span class="line"><span class="hljs-keyword">reg</span> upc;</span><br><span class="line"><span class="hljs-comment">//New instruction is fetched only when last instruction is done.</span></span><br><span class="line"><span class="hljs-keyword">wire</span> ins_done = (canceled | ban_ID_EXC) ? <span class="hljs-number">1&apos;b1</span> : upc == cycle;</span><br></pre></td></tr></table></figure><p>&#x5FAE;&#x7A0B;&#x5E8F;&#x8BA1;&#x6570;&#x5668;&#x5728;&#x6307;&#x4EE4;&#x5B8C;&#x6210;&#x540E;&#x6E05;&#x96F6;&#xFF0C;&#x5728;CPU stall&#x6216;&#x7531;&#x4E8E;&#x6570;&#x636E;&#x76F8;&#x5173;&#x5F15;&#x8D77;&#x7684;IFID&#x7EA7;&#x6682;&#x505C;&#x65F6;&#x6682;&#x505C;&#x66F4;&#x65B0;&#xFF0C;&#x5176;&#x4ED6;&#x60C5;&#x51B5;&#x5FAE;&#x7A0B;&#x5E8F;&#x8BA1;&#x6570;&#x5668;&#x52A0;&#x4E00;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk)</span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (clr)</span><br><span class="line">        upc &lt;=<span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (ins_done) upc &lt;= <span class="hljs-number">0</span>;</span><br><span class="line">        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (~Stall_RAW &amp; ~CPU_stall) upc &lt;= upc +<span class="hljs-number">1&apos;b1</span>;</span><br><span class="line">    <span class="hljs-keyword">end</span></span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><p>CU&#x4E2D;&#x6709;&#x591A;&#x4E2A;stall&#x4FE1;&#x53F7;&#xFF0C;&#x4ED6;&#x4EEC;&#x662F;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#x53EF;&#x4EE5;&#x534F;&#x540C;&#x5DE5;&#x4F5C;&#x7684;&#x5173;&#x952E;&#x3002;&#x6211;&#x4E3A;&#x6570;&#x636E;&#x76F8;&#x5173;&#x5F15;&#x8D77;&#x7684;IF&#x548C;ID&#x7EA7;&#x6682;&#x505C;&#x5F15;&#x5165;&#x4E86;&#x5355;&#x72EC;&#x7684;stall&#x4FE1;&#x53F7;(stall_RAW)&#xFF0C;&#x4E3A;&#x5C1A;&#x672A;&#x5B8C;&#x6210;&#x7684;&#x591A;&#x5468;&#x671F;&#x6307;&#x4EE4;&#x5F15;&#x5165;&#x4E86;&#x5355;&#x72EC;&#x7684;stall&#x4FE1;&#x53F7;&#xFF08;ins_done&#xFF09;,&#x4E3A;&#x7531;&#x4E8E;cache&#x672A;&#x51C6;&#x5907;&#x597D;&#x5F15;&#x8D77;&#x7684;&#x6574;&#x4E2A;CPU&#x6682;&#x505C;&#x5F15;&#x5165;&#x4FE1;&#x53F7;CPU_stall&#x3002;<br>IF&#x548C;ID&#x7EA7;&#x7684;&#x6682;&#x505C;&#x4FE1;&#x53F7;Stall_IF_ID&#x7531;stall_raw&#x548C;is_done&#x5171;&#x540C;&#x4EA7;&#x751F;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">assign</span> Stall_IF_ID = ~ins_done | Stall_RAW;</span><br></pre></td></tr></table></figure><p>&#x5173;&#x4E8E;upc&#x7684;&#x66F4;&#x65B0;&#x7684;&#x6761;&#x4EF6;&#x9700;&#x8981;&#x7279;&#x522B;&#x5730;&#x8BF4;&#x660E;&#x3002;&#x6570;&#x636E;&#x76F8;&#x5173;&#x6709;&#x53EF;&#x80FD;&#x662F;&#x67D0;&#x4E00;&#x4E2A;&#x5FAE;&#x6307;&#x4EE4;&#x5F15;&#x8D77;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5F53;&#x53D1;&#x751F;&#x6570;&#x636E;&#x76F8;&#x5173;&#x6D41;&#x6C34;&#x7EBF;&#x9700;&#x8981;&#x6682;&#x505C;&#x65F6;&#xFF0C;&#x5F53;&#x524D;&#x7684;&#x5FAE;&#x6307;&#x4EE4;&#xFF08;&#x6216;&#x6307;&#x4EE4;&#xFF09;&#x4E5F;&#x88AB;&#x6682;&#x505C;&#xFF0C;&#x56E0;&#x6B64;&#x6B64;&#x65F6;&#x4E0D;&#x5E94;&#x66F4;&#x65B0;upc&#x3002;&#x5F53;Cache&#x5C1A;&#x672A;&#x51C6;&#x5907;&#x597D;&#x65F6;&#xFF0C;&#x6574;&#x4E2A;CPU&#x7684;&#x72B6;&#x6001;&#x4E0D;&#x53D1;&#x751F;&#x53D8;&#x5316;&#xFF0C;&#x56E0;&#x6B64;CU&#x5185;&#x90E8;&#x7684;&#x6240;&#x6709;&#x5BC4;&#x5B58;&#x5668;&#x5728;CPU_stall&#x65F6;&#x5747;&#x4E0D;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x3002;</p><h4 id="&#x529F;&#x80FD;&#x90E8;&#x4EF6;&#x63A7;&#x5236;&#x4FE1;&#x53F7;&#x751F;&#x6210;"><a href="#&#x529F;&#x80FD;&#x90E8;&#x4EF6;&#x63A7;&#x5236;&#x4FE1;&#x53F7;&#x751F;&#x6210;" class="headerlink" title="&#x529F;&#x80FD;&#x90E8;&#x4EF6;&#x63A7;&#x5236;&#x4FE1;&#x53F7;&#x751F;&#x6210;"></a>&#x529F;&#x80FD;&#x90E8;&#x4EF6;&#x63A7;&#x5236;&#x4FE1;&#x53F7;&#x751F;&#x6210;</h4><p>CU&#x5C06;&#x6240;&#x6709;&#x9700;&#x8981;&#x7684;&#x63A7;&#x5236;&#x4FE1;&#x53F7;&#x76F4;&#x63A5;&#x751F;&#x6210;&#xFF0C;&#x5404;&#x7EA7;&#x7684;&#x529F;&#x80FD;&#x6A21;&#x5757;&#x7684;&#x63A7;&#x5236;&#x4FE1;&#x53F7;&#x901A;&#x8FC7;&#x5404;&#x7EA7;&#x6D41;&#x6C34;&#x7EBF;&#x5BC4;&#x5B58;&#x5668;&#x5C06;&#x540E;&#x7EED;&#x5404;&#x7EA7;&#x9700;&#x8981;&#x7684;&#x4FE1;&#x53F7;&#x5411;&#x540E;&#x4F20;&#x9012;&#x3002;<br>&#x5BF9;&#x4E8E;&#x5728;WB&#x7EA7;&#x9700;&#x8981;&#x5199;&#x5165;&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x6307;&#x4EE4;&#xFF0C;RegWrite&#x4FE1;&#x53F7;&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//RegWrite is High when instruction needs to write registers.</span></span><br><span class="line"><span class="hljs-comment">//This signal is used as write enable signal of the register file at WB stage.</span></span><br><span class="line"><span class="hljs-keyword">assign</span> RegWrite = (i_mfc0|(i_bgezal &amp; (~rs_less_than_0))|(i_bltzal &amp; rs_less_than_0)</span><br><span class="line">                |i_addi|i_addiu|i_slti|i_sltiu|i_andi|i_ori|i_xori|i_lui|i_lb|i_lh</span><br><span class="line">                |i_lw|i_lbu|i_lhu|i_jal|i_sll|i_srl|i_sra|i_sllv|i_srlv|i_srav|i_jalr</span><br><span class="line">                |i_add|i_addu|i_sub|i_subu|i_and|i_or|i_xor|i_nor|i_slt|i_sltu|i_clz</span><br><span class="line">                |i_clo) &amp; ~ban_ID;</span><br></pre></td></tr></table></figure><p>&#x5BF9;&#x4E8E;&#x6240;&#x6709;&#x9700;&#x8981;&#x8BF7;&#x6C42;D cache&#xFF08;&#x5185;&#x5B58;&#xFF09;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x65E0;&#x8BBA;&#x8BFB;&#x5199;&#xFF0C;MemReq&#x4FE1;&#x53F7;&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#xFF0C;&#x82E5;&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x4E0D;&#x9700;&#x8981;&#x8BFB;&#x5199;D cache&#xFF0C;MemReq&#x4E3A;&#x4F4E;&#x7535;&#x5E73;&#xFF0C;D cache&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x8BE5;&#x4FE1;&#x53F7;&#x76F4;&#x63A5;&#x751F;&#x6210;ready&#x4FE1;&#x53F7;&#x8DF3;&#x8FC7;&#x5BF9;&#x5185;&#x5B58;&#x7684;&#x8BBF;&#x95EE;&#x3002;&#x5BF9;&#x4E8E;SB&#x548C;SHW&#x6307;&#x4EE4;&#xFF0C;&#x4ED6;&#x4EEC;&#x7684;&#x4E24;&#x4E2A;&#x5468;&#x671F;&#x90FD;&#x9700;&#x8981;&#x8BBF;&#x5B58;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//Memory request signal is active when the instruction needs to access the memory,</span></span><br><span class="line"><span class="hljs-comment">//This signal is used at MEM stage. If accessing the memory is not needed, MEM can</span></span><br><span class="line"><span class="hljs-comment">//be skipped based on this signal. </span></span><br><span class="line"><span class="hljs-comment">//Store byte and Store half-word request memory access at both two cycle.</span></span><br><span class="line"><span class="hljs-keyword">assign</span> MemReq = (i_lb|i_lh|i_lw|i_lbu|i_lhu|i_sb|i_sh|i_sw) &amp; ~ban_ID;</span><br></pre></td></tr></table></figure><p>MemWrite&#x6307;&#x793A;&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x662F;&#x5426;&#x9700;&#x8981;&#x5199;&#x5165;&#x5185;&#x5B58;&#x3002;&#x5BF9;&#x4E8E;SW&#x6307;&#x4EE4;&#x548C;SB&#x3001;SHW&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x5468;&#x671F;(&#x6309;&#x5B57;&#x8282;&#x3001;&#x534A;&#x5B57;&#x5199;&#x5165;&#x7B2C;&#x4E00;&#x4E2A;&#x5468;&#x671F;&#x8BFB;&#x53D6;&#x76F8;&#x5E94;&#x7684;&#x5B58;&#x50A8;&#x5B57;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x5468;&#x671F;&#x5728;mask&#x540E;&#x5199;&#x5165;&#x50CF;&#x4E00;&#x4E2A;&#x7684;&#x5B58;&#x50A8;&#x5B57;)&#xFF0C;&#x8BE5;&#x4FE1;&#x53F7;&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//Memory Write is active when the instruction is a store operate.</span></span><br><span class="line"><span class="hljs-comment">//Store byte and Store half-word need two cycle, second cycle of these two instruction</span></span><br><span class="line"><span class="hljs-comment">//need to write the memory</span></span><br><span class="line"><span class="hljs-keyword">assign</span> MemWrite = (i_sb &amp; (upc == <span class="hljs-number">1</span>)|i_sh &amp; (upc ==<span class="hljs-number">1</span>)|i_sw) &amp; ~ban_ID;</span><br></pre></td></tr></table></figure><p>AluImm&#x63A7;&#x5236;ALU&#x6570;&#x636E;&#x8F93;&#x5165;&#x7AEF;&#x53E3;B&#x524D;&#x7684;&#x591A;&#x8DEF;&#x5668;&#xFF0C;&#x5F53;AluImm&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#x65F6;&#xFF0C;&#x7AEF;&#x53E3;B&#x9009;&#x62E9;&#x7ECF;ID&#x7EA7;&#x7B26;&#x53F7;&#x6269;&#x5C55;&#x540E;&#x7684;&#x7ACB;&#x5373;&#x6570;&#x4F5C;&#x4E3A;ALU&#x7AEF;&#x53E3;B&#x7684;&#x8F93;&#x5165;&#x3002;&#x5BF9;&#x4E8E;&#x6240;&#x6709;&#x4F7F;&#x7528;&#x7ACB;&#x5373;&#x6570;&#x7684;&#x7B97;&#x672F;&#x6307;&#x4EE4;&#xFF0C;&#x8BE5;&#x4FE1;&#x53F7;&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//AluImm indicates that operand B of ALU is an immediate operand, it is used at EXE </span></span><br><span class="line"><span class="hljs-comment">//stage.</span></span><br><span class="line"><span class="hljs-comment">//For load and store instructions, memory address is calculated by alu with an </span></span><br><span class="line"><span class="hljs-comment">//16-bit immediate offset and rs.</span></span><br><span class="line"><span class="hljs-comment">//Branch instructions have 16-bit immediate offset, but the target address is </span></span><br><span class="line"><span class="hljs-comment">//calculated at ID stage, so AluImm signal is zero for branch instructions.</span></span><br><span class="line"><span class="hljs-keyword">assign</span> AluImm = i_addi|i_addiu|i_slti|i_sltiu|i_andi|i_ori|i_xori|i_lui|i_lb|i_lh</span><br><span class="line">                |i_lw|i_lbu|i_lhu|i_sb|i_sh|i_sw;</span><br></pre></td></tr></table></figure><p>ShiftImm&#x63A7;&#x5236;ALU&#x6570;&#x636E;&#x8F93;&#x5165;&#x7AEF;&#x53E3;A&#x524D;&#x7684;&#x591A;&#x8DEF;&#x5668;&#x3002;&#x5BF9;&#x4E8E;&#x4F4D;&#x79FB;&#x6307;&#x4EE4;&#xFF0C;&#x4F4D;&#x79FB;&#x91CF;&#x7684;&#x8F93;&#x5165;&#x5728;ALU&#x7684;&#x7AEF;&#x53E3;A&#xFF0C;&#x88AB;&#x4F4D;&#x79FB;&#x7684;&#x64CD;&#x4F5C;&#x6570;&#x8F93;&#x5165;&#x4E8E;ALU&#x7AEF;&#x53E3;B&#xFF0C;&#x56E0;&#x6B64;&#x5BF9;&#x4E8E;&#x4F7F;&#x7528;&#x7ACB;&#x5373;&#x6570;&#x7684;&#x4F4D;&#x79FB;&#x6307;&#x4EE4;&#x8BE5;&#x4FE1;&#x53F7;&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//ShiftImm is used at EXE stage. For shift word operations, rs is 5-bit zeros, and</span></span><br><span class="line"><span class="hljs-comment">//the shift amount is after rd, ShiftImm selected the correct sa into operand A of </span></span><br><span class="line"><span class="hljs-comment">//ALU. For shift word variable operations, This signal is low, since the shift amount </span></span><br><span class="line"><span class="hljs-comment">//is rs, like a normal R type instruction.</span></span><br><span class="line"><span class="hljs-keyword">assign</span> ShiftImm = i_sll|i_srl|i_sra;</span><br></pre></td></tr></table></figure><p>link&#x4FE1;&#x53F7;&#x7528;&#x4E8E;&#x8DF3;&#x8F6C;&#x5E76;&#x8FDE;&#x63A5;&#x6307;&#x4EE4;&#xFF0C;&#x4ED6;&#x4F5C;&#x7528;&#x4E0E;EXE&#x7EA7;ALU&#x8F93;&#x51FA;&#x7AEF;&#x53E3;&#x540E;&#x7684;&#x591A;&#x8DEF;&#x5668;&#x3002;&#x5F53;&#x4ED6;&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#x65F6;&#xFF0C;ALU&#x7684;&#x8F93;&#x51FA;&#x88AB;&#x7ED5;&#x8FC7;&#xFF0C;&#x53D6;&#x800C;&#x4EE3;&#x4E4B;&#x7684;&#x662F;EXE_PC+4,&#x5E76;&#x628A;&#x76EE;&#x6807;&#x5BC4;&#x5B58;&#x5668;&#x53F7;&#x8986;&#x76D6;&#x4E3A;31&#xFF0C;&#x5728;MEM&#x548C;WB&#x7EA7;&#x5B8C;&#x6210;&#x8FDE;&#x63A5;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x5C06;&#x5F53;&#x524D;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x7684;&#x4E0B;&#x4E00;&#x8DF3;&#x6307;&#x4EE4;&#x5730;&#x5740;&#xFF08;&#x8FD4;&#x56DE;&#x5730;&#x5740;&#xFF09;&#x653E;&#x5165;&#x7EA6;&#x5B9A;&#x597D;&#x7684;&#x5BC4;&#x5B58;&#x5668;31&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//link signal is for branch and link operations. This signal is used at EXE stage,</span></span><br><span class="line"><span class="hljs-comment">//link means that save corresponding pc into register 31, so when this signal is </span></span><br><span class="line"><span class="hljs-comment">//active, EXE stage will override the output of ALU with corresponding PC and select</span></span><br><span class="line"><span class="hljs-comment">//31 as the target register number.</span></span><br><span class="line"><span class="hljs-keyword">assign</span> link = i_bgezal|i_bltzal|i_jalr|i_jal;</span><br></pre></td></tr></table></figure><p>slt&#x4FE1;&#x53F7;&#x7528;&#x4E8E;set less than&#x6307;&#x4EE4;&#xFF0C;ALU&#x4E2D;&#x6CA1;&#x6709;&#x5B9E;&#x73B0;&#x6BD4;&#x8F83;&#x529F;&#x80FD;&#xFF0C;&#x56E0;&#x6B64;EXE&#x7EA7;&#x5F15;&#x5165;&#x4E86;&#x4E00;&#x4E2A;&#x989D;&#x5916;&#x7684;&#x6BD4;&#x8F83;&#x5668;&#x3002;&#x5F53;slt&#x4FE1;&#x53F7;&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#x65F6;&#xFF0C;EXE&#x7EA7;&#x7684;&#x8F93;&#x51FA;&#x9009;&#x62E9;&#x6BD4;&#x8F83;&#x5668;&#x7684;&#x8F93;&#x51FA;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//slt is for set less than operations. When this signal is HIGH, the corresponding</span></span><br><span class="line"><span class="hljs-comment">//comparator in EXE stage is active, and the output of EXE stage will be selected </span></span><br><span class="line"><span class="hljs-comment">//as the output of these comparators.</span></span><br><span class="line"><span class="hljs-keyword">assign</span> slt =  i_slt|i_sltu|i_slti|i_sltiu;</span><br></pre></td></tr></table></figure><p>sing&#x4FE1;&#x53F7;&#x63A7;&#x5236;&#x6307;&#x4EE4;&#x4E2D;&#x7684;&#x7ACB;&#x5373;&#x6570;&#x662F;&#x5426;&#x9700;&#x8981;&#x7B26;&#x53F7;&#x6269;&#x5C55;&#x3002;&#x5B83;&#x4E0D;&#x5149;&#x5728;ID&#x7EA7;&#x7528;&#x6765;&#x8BA1;&#x7B97;&#x8DF3;&#x8F6C;&#x7684;&#x76EE;&#x6807;&#x5730;&#x5740;&#xFF0C;&#x4E5F;&#x7528;&#x5728;EXE&#x7EA7;&#x63A7;&#x5236;&#x662F;&#x5426;&#x4EA7;&#x751F;&#x6EA2;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x4E3A;set less than&#x6307;&#x4EE4;&#x9009;&#x62E9;&#x6B63;&#x786E;&#x7684;&#x6BD4;&#x8F83;&#x5668;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">assign</span> sign = i_bgez|i_bgezal|i_bltz|i_bltzal|i_beq|i_bne|i_blez|i_bgtz|i_addi|i_slti</span><br><span class="line">                |i_lb|i_lh|i_lw|i_lbu|i_lhu|i_sb|i_sh|i_sw|i_add|i_sub|i_slt;</span><br></pre></td></tr></table></figure><p>&#x4E0B;&#x9762;&#x8FD9;&#x7EC4;&#x4FE1;&#x53F7;&#x7528;&#x4E8E;&#x63A7;&#x5236;&#x6309;&#x5B57;&#x8282;&#x3001;&#x534A;&#x5B57;&#x8BFB;&#x5199;&#x3002;<br>StoreMask&#x901A;&#x77E5;MEM&#x7EA7;&#x4F7F;&#x7528;mask&#x5904;&#x7406;&#x5C06;&#x8981;&#x5199;&#x5165;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x56E0;&#x6B64;&#x5F53;store byte/half-word&#x5904;&#x4E8E;&#x7B2C;&#x4E8C;&#x5468;&#x671F;&#x65F6;&#xFF0C;StoreMask&#x4E3A;&#x9AD8;&#x7535;&#x5E73;:</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//StoreMask select the masked value as the input of memory. This signal is active</span></span><br><span class="line"><span class="hljs-comment">//at the second cycle of store byte and store half word. </span></span><br><span class="line"><span class="hljs-keyword">assign</span> StoreMask = (i_sb &amp; upc==<span class="hljs-number">1</span>) | (i_sh &amp; upc==<span class="hljs-number">1</span>);</span><br></pre></td></tr></table></figure><p>LoadMask&#x901A;&#x77E5;MEM&#x7EA7;&#x5728;&#x8BFB;&#x51FA;&#x6570;&#x636E;&#x65F6;&#x4F7F;&#x7528;mask&#xFF0C;load byte/half-word&#x6307;&#x4EE4;&#x4E0D;&#x9700;&#x8981;&#x7B2C;&#x4E8C;&#x4E2A;&#x5468;&#x671F;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//LoadMask select the masked value as the output of MEM stage. This signal is active</span></span><br><span class="line"><span class="hljs-comment">//for Load byte and Load half word instruction.</span></span><br><span class="line"><span class="hljs-keyword">assign</span> LoadMask = i_lb|i_lbu|i_lh|i_lhu;</span><br></pre></td></tr></table></figure><p>B_HW&#x7528;&#x4E8E;&#x4E3A;load/store byte/half-word&#x8FD9;&#x4E9B;&#x6307;&#x4EE4;&#x9009;&#x62E9;&#x6B63;&#x786E;&#x7684;mask&#x957F;&#x5EA6;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//for load/store byte/half word, B_HW is HIGH for load/store half word, and LOW for</span></span><br><span class="line"><span class="hljs-comment">//load/store byte. </span></span><br><span class="line"><span class="hljs-keyword">assign</span> B_HW = i_lh|i_lhu|i_sh;</span><br></pre></td></tr></table></figure><p>LoadSign&#x4E3A;&#x5355;&#x72EC;&#x4E3A;load byte/half-word&#x5F15;&#x5165;&#x7684;&#x7B26;&#x53F7;&#x6269;&#x5C55;&#x6807;&#x5FD7;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//This is for load byte/half word signed instructions.</span></span><br><span class="line"><span class="hljs-keyword">assign</span> LoadSign = i_lh|i_lb;</span><br></pre></td></tr></table></figure><p>CU&#x4F1A;&#x6839;&#x636E;&#x8BD1;&#x7801;&#x7ED3;&#x679C;&#x9009;&#x62E9;&#x6B63;&#x786E;&#x7684;&#x76EE;&#x6807;&#x5BC4;&#x5B58;&#x5668;&#x53F7;&#x3002;&#x5927;&#x90E8;&#x5206;&#x6307;&#x4EE4;&#x4F7F;&#x7528;rd&#x4F5C;&#x4E3A;&#x76EE;&#x6807;&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x6709;&#x4E9B;&#x6307;&#x4EE4;&#x5219;&#x4F7F;&#x7528;rt&#x4F5C;&#x4E3A;&#x76EE;&#x6807;&#x5BC4;&#x5B58;&#x5668;&#x53F7;&#xFF0C;&#x5BF9;&#x4E8E;&#x8FD9;&#x4E9B;&#x6307;&#x4EE4;TargetRegSel&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#xFF0C;&#x8FD9;&#x4E2A;&#x4FE1;&#x53F7;&#x4F5C;&#x7528;&#x4E8E;CU&#x5185;&#x90E8;&#x5E76;&#x63A7;&#x5236;&#x4E00;&#x4E2A;&#x591A;&#x8DEF;&#x5668;&#x5C06;&#x7ED3;&#x679C;&#x7528;TargetReg&#x8F93;&#x51FA;:</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//Most instructions use rd as target register, but some use rt as target. </span></span><br><span class="line"><span class="hljs-comment">//TargetRegSel is active when a instruction uses rt as target register.</span></span><br><span class="line"><span class="hljs-comment">//This signal is used in ID stage. </span></span><br><span class="line"><span class="hljs-keyword">wire</span> TargetRegSelect = i_mfc0|i_addi|i_addiu|i_slti|i_sltiu|i_andi|i_ori|i_xori</span><br><span class="line">                |i_lui|i_lb|i_lh|i_lw|i_lbu|i_lhu;</span><br><span class="line"><span class="hljs-keyword">assign</span> TargetReg = TargetRegSelect ? rt : rd;</span><br></pre></td></tr></table></figure><p>&#x6700;&#x540E;&#xFF0C;CU&#x8FD8;&#x9700;&#x8981;&#x751F;&#x6210;&#x5408;&#x9002;&#x7684;ALU&#x63A7;&#x5236;&#x7801;AluFunc:</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">always</span> @ (*) <span class="hljs-keyword">begin</span></span><br><span class="line">  <span class="hljs-keyword">if</span> (i_subu|i_sub)                 AluFunc = <span class="hljs-number">4&apos;b0001</span>;</span><br><span class="line">  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i_clz)                   AluFunc = <span class="hljs-number">4&apos;b0010</span>;</span><br><span class="line">  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i_clo)                   AluFunc = <span class="hljs-number">4&apos;b0011</span>;</span><br><span class="line">  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i_and|i_andi)            AluFunc = <span class="hljs-number">4&apos;b0100</span>;</span><br><span class="line">  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i_xor|i_xori)            AluFunc = <span class="hljs-number">4&apos;b0101</span>;</span><br><span class="line">  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i_or|i_ori)              AluFunc = <span class="hljs-number">4&apos;b0110</span>;</span><br><span class="line">  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i_nor)                   AluFunc = <span class="hljs-number">4&apos;b0111</span>;</span><br><span class="line">  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i_sll|i_sllv)            AluFunc = <span class="hljs-number">4&apos;b1000</span>;</span><br><span class="line">  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i_lui)                   AluFunc = <span class="hljs-number">4&apos;b1001</span>;</span><br><span class="line">  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i_srl|i_srlv)            AluFunc = <span class="hljs-number">4&apos;b1010</span>;</span><br><span class="line">  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i_sra|i_srav)            AluFunc = <span class="hljs-number">4&apos;b1011</span>;</span><br><span class="line">  <span class="hljs-comment">//for all other situations alu performs add operation.</span></span><br><span class="line">  <span class="hljs-keyword">else</span>                              AluFunc = <span class="hljs-number">4&apos;b0000</span>;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><h4 id="&#x64CD;&#x4F5C;&#x6570;"><a href="#&#x64CD;&#x4F5C;&#x6570;" class="headerlink" title="&#x64CD;&#x4F5C;&#x6570;"></a>&#x64CD;&#x4F5C;&#x6570;</h4><h5 id="&#x7ACB;&#x5373;&#x6570;&#x622A;&#x53D6;"><a href="#&#x7ACB;&#x5373;&#x6570;&#x622A;&#x53D6;" class="headerlink" title="&#x7ACB;&#x5373;&#x6570;&#x622A;&#x53D6;"></a>&#x7ACB;&#x5373;&#x6570;&#x622A;&#x53D6;</h5><p>&#x4ECE;IR&#x4E2D;&#x83B7;&#x53D6;&#x7684;&#x7ACB;&#x5373;&#x6570;&#x8981;&#x6839;&#x636E;&#x6307;&#x4EE4;&#x7684;&#x4E0D;&#x540C;&#x8FDB;&#x884C;&#x7B26;&#x53F7;&#x6269;&#x5C55;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//sign extension controlled by sign signal. </span></span><br><span class="line"><span class="hljs-keyword">wire</span> e = sign &amp; instruction[<span class="hljs-number">15</span>];</span><br><span class="line"><span class="hljs-keyword">wire</span> [<span class="hljs-number">15</span>:<span class="hljs-number">0</span>] ext16 = {<span class="hljs-number">16</span>{e}};</span><br><span class="line"><span class="hljs-keyword">assign</span> imm = canceled ? <span class="hljs-number">32&apos;b0</span> : { ext16, instruction[<span class="hljs-number">15</span>:<span class="hljs-number">0</span>] };</span><br></pre></td></tr></table></figure><h5 id="&#x6570;&#x636E;&#x65C1;&#x8DEF;&#x548C;&#x6D41;&#x6C34;&#x7EBF;&#x6682;&#x505C;"><a href="#&#x6570;&#x636E;&#x65C1;&#x8DEF;&#x548C;&#x6D41;&#x6C34;&#x7EBF;&#x6682;&#x505C;" class="headerlink" title="&#x6570;&#x636E;&#x65C1;&#x8DEF;&#x548C;&#x6D41;&#x6C34;&#x7EBF;&#x6682;&#x505C;"></a>&#x6570;&#x636E;&#x65C1;&#x8DEF;&#x548C;&#x6D41;&#x6C34;&#x7EBF;&#x6682;&#x505C;</h5><p>&#x5BC4;&#x5B58;&#x5668;&#x4E2D;&#x5B58;&#x50A8;&#x7684;&#x64CD;&#x4F5C;&#x6570;&#x53EF;&#x80FD;&#x4F1A;&#x53D7;&#x5230;&#x6570;&#x636E;&#x76F8;&#x5173;&#x5192;&#x9669;&#x7684;&#x5F71;&#x54CD;&#xFF0C;&#x56E0;&#x6B64;&#x4E3A;&#x5176;&#x8BBE;&#x8BA1;&#x6570;&#x636E;&#x65C1;&#x8DEF;&#x3002;<br>&#x6570;&#x636E;&#x65C1;&#x8DEF;&#x7531;&#x4E09;&#x79CD;&#x60C5;&#x51B5;&#xFF1A;</p><ol><li>&#x82E5;&#x5F53;&#x524D;ID&#x7EA7;&#x7684;&#x6307;&#x4EE4;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x6E90;&#x5BC4;&#x5B58;&#x5668;&#x4E0E;&#x5F53;&#x524D;EXE&#x7EA7;&#x4E2D;&#x7684;&#x76EE;&#x6807;&#x5BC4;&#x5B58;&#x5668;&#x76F8;&#x540C;&#xFF0C;&#x4E14;EXE&#x7EA7;&#x4E0D;&#x662F;load&#x6307;&#x4EE4;&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x5C06;EXE&#x7EA7;&#x7684;&#x7ED3;&#x679C;&#x4F5C;&#x4E3A;&#x5F53;&#x524D;ID&#x7EA7;&#x7684;&#x6E90;&#x64CD;&#x4F5C;&#x6570;&#x3002;</li><li>&#x82E5;&#x5F53;&#x524D;ID&#x7EA7;&#x6307;&#x4EE4;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x6E90;&#x5BC4;&#x5B58;&#x5668;&#x4E0E;MEM&#x7EA7;&#x7684;&#x76EE;&#x6807;&#x5BC4;&#x5B58;&#x5668;&#x76F8;&#x540C;&#xFF0C;&#x4E14;MEM&#x7EA7;&#x4E0D;&#x662F;load&#x6307;&#x4EE4;&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x5C06;&#x4ECE;EXE&#x7EA7;&#x4F20;&#x6765;&#x7684;ALU&#x7684;&#x7ED3;&#x679C;&#x4F5C;&#x4E3A;&#x5F53;&#x524D;ID&#x7EA7;&#x7684;&#x6E90;&#x64CD;&#x4F5C;&#x6570;&#x3002;</li><li>&#x82E5;&#x5F53;&#x524D;ID&#x7EA7;&#x6307;&#x4EE4;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x6E90;&#x5BC4;&#x5B58;&#x5668;&#x4E0E;EXE&#x7EA7;&#x4E2D;&#x7684;&#x76EE;&#x6807;&#x5BC4;&#x5B58;&#x5668;&#x76F8;&#x540C;&#xFF0C;&#x4E14;EXE&#x7EA7;&#x7684;&#x6307;&#x4EE4;&#x662F;&#x4E00;&#x4E2A;load&#x6307;&#x4EE4;&#xFF08;E_m2reg&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#xFF09;,&#x8FD9;&#x610F;&#x5473;&#x7740;IF&#x548C;ID&#x7EA7;&#x5FC5;&#x987B;&#x7B49;&#x5F85;&#x4E00;&#x4E2A;&#x5468;&#x671F;&#xFF0C;&#x5E76;&#x4E14;&#x5F53;&#x524D;&#x7684;ID&#x7EA7;&#x6307;&#x4EE4;&#x5FC5;&#x987B;&#x88AB;&#x5E9F;&#x5F03;&#xFF0C;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x5468;&#x671F;&#x4EE5;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5C06;MEM&#x8BFB;&#x51FA;&#x7684;&#x7ED3;&#x679C;&#x4F5C;&#x4E3A;ID&#x7EA7;&#x6307;&#x4EE4;&#x7684;&#x6E90;&#x64CD;&#x4F5C;&#x6570;&#x3002;</li></ol><p>&#x6570;&#x636E;&#x65C1;&#x8DEF;&#x548C;&#x7531;&#x4E8E;&#x6570;&#x636E;&#x76F8;&#x5173;&#x5F15;&#x8D77;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x6682;&#x505C;&#x7684;&#x76F8;&#x5173;&#x903B;&#x8F91;&#x5982;&#x4E0B;&#xFF1A;<br>&#x6307;&#x4EE4;&#x7684;&#x4E24;&#x4E2A;&#x6E90;&#x5BC4;&#x5B58;&#x5668;&#x5747;&#x6709;&#x53EF;&#x80FD;&#x53D1;&#x751F;&#x6570;&#x636E;&#x76F8;&#x5173;&#x51B2;&#x7A81;&#xFF0C;&#x6240;&#x4EE5;&#x9996;&#x5148;&#x8981;&#x5C06;&#x53EF;&#x80FD;&#x53D7;&#x5F71;&#x54CD;&#x7684;&#x6307;&#x4EE4;&#x5217;&#x51FA;&#x6765;&#x3002;need_rs&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#x8868;&#x793A;&#x5F53;&#x524D;ID&#x7EA7;&#x7684;&#x6307;&#x4EE4;&#x9700;&#x8981;rs&#x4F5C;&#x4E3A;&#x6E90;&#x5BC4;&#x5B58;&#x5668;&#xFF1B;need_rt&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#x8868;&#x793A;&#x5F53;&#x524D;ID&#x7EA7;&#x7684;&#x6307;&#x4EE4;&#x9700;&#x8981;rt&#x4F5C;&#x4E3A;&#x6E90;&#x5BC4;&#x5B58;&#x5668;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//need_rs is active when a instruction needs rs as operand. </span></span><br><span class="line"><span class="hljs-keyword">wire</span> need_rs = ~(i_eret|i_mfc0|i_mtc0|i_syscall|i_lui|i_j|i_jal|i_sll|i_srl|i_sra)</span><br><span class="line">                &amp; ~ban_ID_EXC;</span><br><span class="line"><span class="hljs-comment">//need_rt is active when a instruction needs rt as operand. </span></span><br><span class="line"><span class="hljs-keyword">wire</span> need_rt = ~(i_eret|i_syscall|i_bgez|i_bgezal|i_bltz|i_bltzal|i_blez|i_bgtz|i_j</span><br><span class="line">                |i_jal|i_jr|i_jalr) &amp; ~ban_ID_EXC;</span><br></pre></td></tr></table></figure><p>&#x5982;&#x679C;&#x53D1;&#x751F;&#x7B2C;&#x4E09;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x8981;&#x6682;&#x505C;IF&#x3001;ID&#x7EA7;&#x6D41;&#x6C34;&#x7EBF;&#x4E00;&#x4E2A;&#x5468;&#x671F;&#x3002;&#x4E3A;&#x6B64;&#x5F15;&#x5165;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;stall&#x4FE1;&#x53F7;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">wire</span> Stall_RAW = E_RegWrite &amp; E_m2reg &amp; (E_TargetReg!=<span class="hljs-number">0</span>) </span><br><span class="line">                    &amp;(need_rs &amp; (E_TargetReg==rs)| need_rt &amp; (E_TargetReg==rt));</span><br></pre></td></tr></table></figure><p>&#x5728;&#x6D41;&#x6C34;&#x7EBF;&#x6682;&#x505C;&#x7684;&#x540C;&#x65F6;&#xFF0C;&#x8FD8;&#x8981;&#x5C06;&#x5F53;&#x524D;ID&#x7EA7;&#x7684;&#x6307;&#x4EE4;&#x5E9F;&#x5F03;&#xFF0C;&#x4E3A;&#x6B64;&#x5F15;&#x5165;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x5E9F;&#x5F03;&#x4FE1;&#x53F7;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">wire</span> ban_ID_RAW = Stall_RAW;</span><br></pre></td></tr></table></figure><p>&#x6B63;&#x5982;&#x524D;&#x9762;&#x6240;&#x8BF4;&#xFF0C;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#x5185;&#x6709;&#x591A;&#x4E2A;&#x6682;&#x505C;&#x548C;&#x5E9F;&#x5F03;&#x4FE1;&#x53F7;&#xFF0C;&#x4ED6;&#x4EEC;&#x662F;&#x7CFB;&#x7EDF;&#x5404;&#x4E2A;&#x90E8;&#x4EF6;&#x53EF;&#x4EE5;&#x534F;&#x540C;&#x5DE5;&#x4F5C;&#x7684;&#x5173;&#x952E;&#xFF0C;&#x6211;&#x5C06;&#x5728;&#x6D41;&#x6C34;&#x7EBF;&#x63A7;&#x5236;&#x90E8;&#x5206;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x8FD9;&#x4E9B;&#x4FE1;&#x53F7;&#x7684;&#x5C42;&#x7EA7;&#x548C;&#x4F5C;&#x7528;&#x3002;<br>&#x6570;&#x636E;&#x65C1;&#x8DEF;&#x4E3B;&#x8981;&#x5B9E;&#x73B0;&#x4E86;&#x4E0A;&#x8FF0;&#x4E09;&#x79CD;&#x60C5;&#x51B5;,&#x5728;&#x5BC4;&#x5B58;&#x5668;&#x5806;&#x548C;&#x4E0B;&#x4E00;&#x7EA7;&#x6D41;&#x6C34;&#x7EBF;&#x5BC4;&#x5B58;&#x5668;&#x95F4;&#x589E;&#x52A0;&#x4E00;&#x4E2A;&#x591A;&#x8DEF;&#x5668;,&#x6700;&#x7EC8;&#x7ED3;&#x679C;&#x4E3A;regA&#x3001;regB&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] regA, regB;</span><br><span class="line"><span class="hljs-comment">//data forward for rs</span></span><br><span class="line"><span class="hljs-keyword">always</span> @(*) <span class="hljs-keyword">begin</span></span><br><span class="line">    <span class="hljs-comment">//case 1&#xFF1A;current instruction&apos;s first operand is the same as the target register </span></span><br><span class="line">    <span class="hljs-comment">//of the EXE stage, and the EXE stage is not a load instruction, the pipeline</span></span><br><span class="line">    <span class="hljs-comment">//doesn&apos;t need to stop. </span></span><br><span class="line">    <span class="hljs-keyword">if</span> (need_rs &amp; E_RegWrite &amp; (E_TargetReg!=<span class="hljs-number">0</span>) &amp; (E_TargetReg == rs) &amp; ~E_m2reg)</span><br><span class="line">        regA = E_AluOut;</span><br><span class="line">    <span class="hljs-comment">//case 2: current instruction&apos;s first operand is the same as the target register</span></span><br><span class="line">    <span class="hljs-comment">//of the MEM stage, and the MEM stage is not a load instruction, the pipeline</span></span><br><span class="line">    <span class="hljs-comment">//doesn&apos;t need to stop. </span></span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (need_rs &amp; M_RegWrite &amp; (M_TargetReg !=<span class="hljs-number">0</span>) &amp; (M_TargetReg == rs) &amp; ~M_m2reg)</span><br><span class="line">        regA = M_AluOut;</span><br><span class="line">    <span class="hljs-comment">//case 3: current instruction&apos;s first operand is the same as the target register</span></span><br><span class="line">    <span class="hljs-comment">//of the last instruction, and the last instruction is a load instruction.</span></span><br><span class="line">    <span class="hljs-comment">//As mentioned above, the IF and ID stage have been stopped for one clock cycle,</span></span><br><span class="line">    <span class="hljs-comment">//after the stop, the following if statement can become true, and the the memory</span></span><br><span class="line">    <span class="hljs-comment">//read is done, the data can be cast on the current instruction in ID stage. </span></span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (need_rs &amp; M_RegWrite &amp; (M_TargetReg !=<span class="hljs-number">0</span>) &amp; (M_TargetReg == rs) &amp; M_m2reg)</span><br><span class="line">        regA = M_MemOut;</span><br><span class="line">    <span class="hljs-comment">//case 0: default situation, there&apos;s no data forward. </span></span><br><span class="line">    <span class="hljs-keyword">else</span> regA = qa;</span><br><span class="line"><span class="hljs-keyword">end</span> </span><br></pre></td></tr></table></figure><p>&#x5BF9;&#x4E8E;regB&#x7684;&#x6570;&#x636E;&#x65C1;&#x8DEF;&#x8DDF;regA&#x4E00;&#x6837;&#xFF0C;&#x8FD9;&#x91CC;&#x4E0D;&#x518D;&#x8D58;&#x8FF0;&#x3002;</p><h4 id="&#x6D41;&#x6C34;&#x7EBF;&#x63A7;&#x5236;-1"><a href="#&#x6D41;&#x6C34;&#x7EBF;&#x63A7;&#x5236;-1" class="headerlink" title="&#x6D41;&#x6C34;&#x7EBF;&#x63A7;&#x5236;"></a>&#x6D41;&#x6C34;&#x7EBF;&#x63A7;&#x5236;</h4><p>&#x6D41;&#x6C34;&#x7EBF;&#x7684;&#x63A7;&#x5236;&#x662F;CU&#x8981;&#x5904;&#x7406;&#x7684;&#x6838;&#x5FC3;&#x95EE;&#x9898;&#x3002;&#x56E0;&#x4E3A;&#x5F88;&#x591A;&#x79CD;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#x53EF;&#x80FD;&#x540C;&#x65F6;&#x53D1;&#x751F;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x90E8;&#x5206;&#x7684;&#x63A7;&#x5236;&#x9700;&#x8981;&#x6DF1;&#x5165;&#x7684;&#x5206;&#x6790;&#x3002;<br>&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x9996;&#x5148;&#x5217;&#x4E3E;&#x7CFB;&#x7EDF;&#x4E2D;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x7684;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#xFF1A;</p><ul><li>IF&#x7EA7;&#xFF1A;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5931;&#x8D25;&#x3001;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x540C;&#x6B65;&#x3001;IF&#x7EA7;&#x5F02;&#x5E38;&#xFF08;&#x5730;&#x5740;&#x9519;&#x8BEF;&#x3001;&#x4EE5;&#x53CA;&#x5F15;&#x5165;&#x5206;&#x9875;&#x540E;&#x7684;TLB&#x5F02;&#x5E38;&#x7B49;&#xFF09;</li><li>ID&#x7EA7;&#xFF1A;&#x6570;&#x636E;&#x76F8;&#x5173;&#x51B2;&#x7A81;&#x3001;&#x591A;&#x5468;&#x671F;&#x6307;&#x4EE4;&#x3001;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x540C;&#x6B65;&#x3001;IF&#x7EA7;&#x5F02;&#x5E38;&#xFF08;&#x672A;&#x5B9E;&#x73B0;&#x7684;&#x6307;&#x4EE4;&#x3001;syscall&#xFF09;</li><li>EXE&#x7EA7;&#xFF1A; &#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x540C;&#x6B65;&#x3001;EXE&#x7EA7;&#x5F02;&#x5E38;&#xFF08;&#x6EA2;&#x51FA;&#xFF09;</li><li>MEM&#x7EA7;&#xFF1A; MEM&#x7EA7;&#x5F02;&#x5E38;(&#x5730;&#x5740;&#x9519;&#x8BEF;&#x3001;TLB&#x5F02;&#x5E38;&#x7B49;)</li><li>&#x5916;&#x90E8;&#x4E2D;&#x65AD;</li></ul><p>&#x9488;&#x5BF9;&#x8FD9;&#x4E9B;&#x6D41;&#x6C34;&#x7EBF;&#x7684;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#xFF0C;&#x63A7;&#x5236;&#x903B;&#x8F91;&#x8BBE;&#x8BA1;&#x6709;&#x4E00;&#x4E2A;&#x539F;&#x5219; &#xFF0C;&#x5C31;&#x662F;&#x5C3D;&#x91CF;&#x60F3;&#x529E;&#x6CD5;&#x628A;&#x590D;&#x6742;&#x7684;&#x95EE;&#x9898;&#x7B80;&#x5355;&#x5316;&#xFF0C;&#x5E76;&#x4E14;&#x80FD;&#x591F;&#x5C3D;&#x53EF;&#x80FD;&#x7684;&#x5206;&#x6790;&#x4ED6;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x548C;&#x5F71;&#x54CD;&#xFF0C;&#x7136;&#x540E;&#x786E;&#x5B9A;&#x5904;&#x7406;&#x5668;&#x7684;&#x884C;&#x4E3A;&#x3002;<br>&#x6839;&#x636E;&#x8FD9;&#x4E2A;&#x539F;&#x5219;&#xFF0C;&#x5916;&#x90E8;&#x4E2D;&#x65AD;&#x6765;&#x81EA;&#x5904;&#x7406;&#x5668;&#x5916;&#x90E8;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x5BF9;&#x5916;&#x90E8;&#x4E2D;&#x65AD;&#x7684;&#x54CD;&#x5E94;&#x8BBE;&#x7F6E;&#x6761;&#x4EF6;&#xFF0C;&#x8BA9;&#x5904;&#x7406;&#x5668;&#x5728;&#x5408;&#x9002;&#x7684;&#x65F6;&#x673A;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x5927;&#x5927;&#x7B80;&#x5316;&#x6574;&#x4E2A;&#x6D41;&#x6C34;&#x7EBF;&#x63A7;&#x5236;&#x903B;&#x8F91;&#x3002;&#x56E0;&#x6B64;&#x6211;&#x7684;&#x5904;&#x7406;&#x5668;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#x7684;&#x6761;&#x4EF6;&#x662F;&#x5904;&#x7406;&#x5668;&#x5904;&#x5728;&#x201C;&#x6B63;&#x5E38;&#x201D;&#x72B6;&#x6001;&#x3002;&#x6240;&#x8C13;&#x7684;&#x6B63;&#x5E38;&#x72B6;&#x6001;&#xFF0C;&#x662F;&#x6307;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x5176;&#x4ED6;&#x7684;&#x5F02;&#x5E38;&#x3001;&#x6D41;&#x6C34;&#x7EBF;&#x4E0D;&#x80FD;&#x6709;&#x4EFB;&#x4F55;&#x6682;&#x505C;&#x3001;&#x540C;&#x65F6;ID&#x7EA7;&#x5F53;&#x524D;&#x5904;&#x7406;&#x7684;&#x6307;&#x4EE4;&#x4E0D;&#x80FD;&#x662F;mtc0&#x6307;&#x4EE4;&#x3002;&#x8BBE;&#x7F6E;&#x7B2C;&#x4E00;&#x4E2A;&#x6761;&#x4EF6;&#x662F;&#x56E0;&#x4E3A;&#x5F02;&#x5E38;&#x6765;&#x81EA;&#x4E8E;CPU&#x5185;&#x90E8;&#xFF0C;&#x4E4B;&#x524D;&#x7684;&#x6587;&#x7AE0;&#x4E5F;&#x6709;&#x63D0;&#x5230;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x53CA;&#x65F6;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x6765;&#x81EA;&#x4E8E;&#x5185;&#x90E8;&#x7684;&#x5F02;&#x5E38;&#xFF0C;&#x5904;&#x7406;&#x5668;&#x4F1A;&#x4E22;&#x5931;&#x6B63;&#x786E;&#x7684;&#x987A;&#x5E8F;&#xFF1B;&#x8BBE;&#x7F6E;&#x7B2C;&#x4E8C;&#x4E2A;&#x6761;&#x4EF6;&#x7684;&#x539F;&#x56E0;&#x662F;&#x56E0;&#x4E3A;&#x6211;&#x6240;&#x8BBE;&#x8BA1;&#x7684;&#x4E2D;&#x65AD;&#x63A7;&#x5236;&#x5668;&#x5728;&#x6536;&#x5230;&#x4E2D;&#x65AD;&#x54CD;&#x5E94;&#x4FE1;&#x53F7;&#x540E;&#x7684;&#x4E0B;&#x4E2A;&#x5468;&#x671F;&#x5C31;&#x4F1A;&#x64A4;&#x9500;&#x5F53;&#x524D;&#x4E2D;&#x65AD;&#x8BF7;&#x6C42;&#xFF0C;&#x5982;&#x679C;&#x53D1;&#x751F;&#x4E2D;&#x65AD;&#x54CD;&#x5E94;&#x65F6;&#x5904;&#x7406;&#x5668;&#x6574;&#x4E2A;&#x6216;&#x8005;&#x90E8;&#x5206;&#x5904;&#x4E8E;&#x6682;&#x505C;&#x72B6;&#x6001;&#xFF0C;&#x5728;&#x4E2D;&#x65AD;&#x63A7;&#x5236;&#x5668;&#x6536;&#x5230;&#x4E2D;&#x65AD;&#x54CD;&#x5E94;&#x4FE1;&#x53F7;&#x5E76;&#x5C06;&#x4E2D;&#x65AD;&#x8BF7;&#x6C42;&#x64A4;&#x9500;&#x65F6;&#xFF0C;&#x5904;&#x7406;&#x5668;&#x56E0;&#x4E3A;&#x505C;&#x987F;&#x6CA1;&#x6709;&#x5C06;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x7684;&#x5730;&#x5740;&#x8F7D;&#x5165;PC&#xFF0C;&#x8FD9;&#x5C31;&#x5BFC;&#x81F4;&#x9519;&#x8FC7;&#x4E86;&#x4E2D;&#x65AD;&#x8BF7;&#x6C42;&#xFF1B;&#x8BBE;&#x7F6E;&#x7B2C;&#x4E09;&#x4E2A;&#x6761;&#x4EF6;&#x7684;&#x539F;&#x56E0;&#x662F;&#xFF0C;mtc0&#x53EF;&#x4EE5;&#x4FEE;&#x6539;status&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x800C;status&#x5BC4;&#x5B58;&#x5668;&#x4E2D;&#x6700;&#x4F4E;&#x4F4D;&#x4F5C;&#x4E3A;&#x4E2D;&#x65AD;&#x5C4F;&#x853D;&#x4F7F;&#x7528;&#xFF0C;&#x4E3A;&#x4E86;&#x786E;&#x5B9A;&#x5904;&#x7406;&#x5668;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x6211;&#x8BBE;&#x7F6E;&#x8FD9;&#x4E2A;&#x6761;&#x4EF6;&#xFF0C;&#x53EA;&#x6709;&#x5F53;mtc0&#x6267;&#x884C;&#x7ED3;&#x675F;&#x3001;status&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x503C;&#x7A33;&#x5B9A;&#x540E;&#xFF0C;&#x624D;&#x53EF;&#x4EE5;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//When to response to an interrupt request</span></span><br><span class="line"><span class="hljs-keyword">wire</span> int_mask = CP0_Reg[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>];</span><br><span class="line"><span class="hljs-keyword">wire</span> int_allow =  int_mask &amp;~BP_miss &amp; ~Stall_IF_ID &amp; ~exc_ack &amp; ~SMC_ack</span><br><span class="line">                    &amp;~i_mtc0 &amp;~CPU_stall;</span><br><span class="line">    <span class="hljs-comment">//When there is an external interrupt and the external interrupt is enabled,</span></span><br><span class="line"><span class="hljs-comment">//or a software interrupt </span></span><br><span class="line"><span class="hljs-comment">//or an exception occurs, the processor jumps to the base register</span></span><br><span class="line"><span class="hljs-comment">//int_ack is HIGH to indicate that CPU is going to jump to base register at</span></span><br><span class="line"><span class="hljs-comment">//next clock cycle. </span></span><br><span class="line"><span class="hljs-keyword">assign</span> int_ack = int_allow &amp; int_in;</span><br></pre></td></tr></table></figure><p>&#x4EBA;&#x4E3A;&#x7684;&#x5BF9;&#x5916;&#x90E8;&#x4E2D;&#x65AD;&#x54CD;&#x5E94;&#x52A0;&#x4EE5;&#x9650;&#x5236;&#x4E0D;&#x4F1A;&#x9020;&#x6210;&#x529F;&#x80FD;&#x7684;&#x7F3A;&#x5931;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x6C38;&#x8FDC;&#x65E0;&#x6CD5;&#x9884;&#x6D4B;&#x5916;&#x90E8;&#x4E2D;&#x65AD;&#x5230;&#x6765;&#x7684;&#x65F6;&#x673A;&#xFF0C;&#x65E9;&#x4E00;&#x4F1A;&#x513F;&#x665A;&#x4E00;&#x4F1A;&#x513F;&#x5904;&#x7406;&#x5B83;&#x4E0D;&#x4F1A;&#x5BF9;&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#x4EA7;&#x751F;&#x4EFB;&#x4F55;&#x5F71;&#x54CD;&#xFF0C;&#x4F46;&#x8FD9;&#x6837;&#x505A;&#x53EF;&#x4EE5;&#x7B80;&#x5316;&#x63A7;&#x5236;&#x903B;&#x8F91;&#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x5728;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x5206;&#x6790;&#x4E2D;&#x53EF;&#x4EE5;&#x5B8C;&#x5168;&#x6487;&#x5F00;&#x5916;&#x90E8;&#x4E2D;&#x65AD;&#x5BF9;CPU&#x7684;&#x5F71;&#x54CD;&#x3002;<br>&#x5BF9;&#x4E8E;&#x5176;&#x4ED6;&#x7684;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#x7684;&#x5904;&#x7406;&#x5C31;&#x6CA1;&#x6709;&#x90A3;&#x4E48;&#x5E78;&#x8FD0;&#x4E86;&#xFF0C;&#x4ED6;&#x4EEC;&#x5747;&#x4EA7;&#x751F;&#x4E8E;&#x5904;&#x7406;&#x5668;&#x5185;&#x90E8;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x65E0;&#x6CD5;&#x8BA9;&#x5904;&#x7406;&#x5668;&#x7B49;&#x5F85;&#xFF0C;&#x4E00;&#x65E6;&#x53D1;&#x751F;&#x8FD9;&#x4E9B;&#x60C5;&#x51B5;&#x5FC5;&#x987B;&#x7ACB;&#x5373;&#x5904;&#x7406;&#x3002;&#x95EE;&#x9898;&#x662F;&#x5982;&#x679C;&#x4ED6;&#x4EEC;&#x4E2D;&#x7684;&#x591A;&#x4E2A;&#x540C;&#x65F6;&#x53D1;&#x751F;&#x600E;&#x4E48;&#x529E;&#xFF1F;&#x4ED6;&#x4EEC;&#x53EF;&#x80FD;&#x540C;&#x65F6;&#x53D1;&#x751F;&#x5417;&#xFF1F;&#x4ED6;&#x4EEC;&#x7684;&#x786E;&#x53EF;&#x80FD;&#x540C;&#x65F6;&#x53D1;&#x751F;&#xFF0C;&#x4F8B;&#x5982;&#x6570;&#x636E;&#x76F8;&#x5173;&#x51B2;&#x7A81;&#x5C31;&#x53EF;&#x4EE5;&#x548C;&#x591A;&#x5468;&#x671F;&#x6307;&#x4EE4;&#x540C;&#x65F6;&#x53D1;&#x751F;&#xFF0C;&#x67D0;&#x4E2A;&#x591A;&#x5468;&#x671F;&#x6307;&#x4EE4;&#x7684;&#x67D0;&#x4E00;&#x5468;&#x671F;&#x9700;&#x8981;&#x7684;&#x6E90;&#x5BC4;&#x5B58;&#x5668;&#x662F;&#x4E0A;&#x4E00;&#x6307;&#x4EE4;&#x7684;&#x76EE;&#x6807;&#x5BC4;&#x5B58;&#x5668;&#x3002;&#x518D;&#x4F8B;&#x5982;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5931;&#x8D25;&#x548C;&#x6570;&#x636E;&#x76F8;&#x5173;&#x4E5F;&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x53D1;&#x751F;&#xFF0C;ID&#x7EA7;&#x662F;&#x4E00;&#x4E2A;jump register&#x6307;&#x4EE4;&#xFF0C;&#x800C;&#x8BE5;&#x6307;&#x4EE4;&#x7684;&#x6E90;&#x5BC4;&#x5B58;&#x5668;&#x662F;&#x524D;&#x9762;&#x4EE3;&#x7801;&#x7684;&#x76EE;&#x6807;&#x5BC4;&#x5B58;&#x5668;&#x3002;&#x518D;&#x4F8B;&#x5982;&#x7531;MEM&#x7EA7;&#x7684;&#x5199;&#x5165;&#x8BF7;&#x6C42;&#x4EA7;&#x751F;&#x7684;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x548C;&#x4EFB;&#x4F55;&#x4E00;&#x79CD;&#x5F02;&#x5E38;&#x540C;&#x65F6;&#x53D1;&#x751F;&#x3002;<br>&#x4ECE;&#x5BF9;&#x4E0D;&#x540C;&#x7EA7;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x5F02;&#x5E38;&#x6765;&#x770B;&#xFF0C;MEM&#x7EA7;&#x6700;&#x7B80;&#x5355;&#x800C;IF&#x7EA7;&#x548C;ID&#x7EA7;&#x6700;&#x590D;&#x6742;&#x3002;&#x65E0;&#x8BBA;&#x8FD9;&#x4E9B;&#x5F02;&#x5E38;&#x5982;&#x4F55;&#x540C;&#x65F6;&#x53D1;&#x751F;&#xFF0C;&#x6709;&#x4E00;&#x70B9;&#x662F;&#x9700;&#x8981;&#x660E;&#x786E;&#x7684;&#xFF0C;&#x5C31;&#x662F;&#x4E00;&#x65E6;CPU&#x51B3;&#x5B9A;&#x5904;&#x7406;&#x8FD9;&#x4E2A;&#x5F02;&#x5E38;&#xFF0C;&#x4ED6;&#x6240;&#x5728;&#x7684;&#x7EA7;&#x4EE5;&#x53CA;&#x8FD9;&#x51E0;&#x7EA7;&#x4E4B;&#x524D;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x4E2D;&#x7684;&#x6307;&#x4EE4;&#x90FD;&#x8981;&#x88AB;&#x5E9F;&#x5F03;&#x3002;&#x6BD4;&#x5982;&#x8BF4;&#xFF0C;&#x5982;&#x679C;MEM&#x7EA7;&#x53D1;&#x751F;&#x4E86;&#x5F02;&#x5E38;&#xFF0C;CPU&#x4F1A;&#x5C06;MEM&#x7EA7;&#x4EE5;&#x53CA;MEM&#x7EA7;&#x4EE5;&#x524D;&#x7684;&#x6240;&#x6709;&#x7EA7;&#x7684;&#x6307;&#x4EE4;&#x90FD;&#x5E9F;&#x5F03;&#x6389;&#xFF0C;&#x54EA;&#x6015;&#x8FD9;&#x4E9B;&#x7EA7;&#x4E2D;&#x53EF;&#x80FD;&#x540C;&#x65F6;&#x5B58;&#x5728;&#x5F02;&#x5E38;&#x3002;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x66F4;&#x6DF1;&#x5C42;&#x7EA7;&#x6D41;&#x6C34;&#x7EBF;&#x4EA7;&#x751F;&#x7684;&#x5F02;&#x5E38;&#x4F18;&#x5148;&#x7EA7;&#x66F4;&#x9AD8;&#xFF0C;&#x4F4E;&#x5C42;&#x7EA7;&#x7684;&#x5F02;&#x5E38;&#x53EF;&#x4EE5;&#x88AB;&#x9AD8;&#x5C42;&#x7EA7;&#x7684;&#x5F02;&#x5E38;&#x8986;&#x76D6;&#x3002;&#x8FD9;&#x4E00;&#x539F;&#x5219;&#x7ED9;&#x63A7;&#x5236;&#x903B;&#x8F91;&#x7684;&#x8BBE;&#x8BA1;&#x63D0;&#x4F9B;&#x4E86;&#x601D;&#x8DEF;&#xFF0C;&#x4E00;&#x79CD;&#x5F02;&#x5E38;&#x53EF;&#x4EE5;&#x8986;&#x76D6;&#x53E6;&#x4E00;&#x79CD;&#x5F02;&#x5E38;&#xFF0C;&#x8FD9;&#x79CD;&#x5904;&#x7406;&#x601D;&#x8DEF;&#x4E0D;&#x4F46;&#x53EF;&#x4EE5;&#x7528;&#x5728;&#x4E0D;&#x540C;&#x5C42;&#x7EA7;&#x7684;&#x5F02;&#x5E38;&#x4E2D;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x5728;&#x67D0;&#x4E00;&#x7EA7;&#x53EF;&#x80FD;&#x540C;&#x65F6;&#x53D1;&#x751F;&#x7684;&#x4E0D;&#x540C;&#x5F02;&#x5E38;&#x4E2D;&#x3002;&#x5BF9;&#x4E8E;&#x4E0D;&#x540C;&#x7EA7;&#x53EF;&#x80FD;&#x540C;&#x65F6;&#x53D1;&#x751F;&#x7684;&#x5F02;&#x5E38;&#xFF0C;&#x4E3A;&#x66F4;&#x6DF1;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x7EA7;&#x5F02;&#x5E38;&#x8D4B;&#x4E88;&#x66F4;&#x9AD8;&#x4F18;&#x5148;&#x7EA7;&#x662F;&#x663E;&#x800C;&#x6613;&#x89C1;&#x4E14;&#x6B63;&#x786E;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x6837;&#x505A;&#x4E0D;&#x4F1A;&#x7834;&#x574F;&#x5904;&#x7406;&#x5F02;&#x5E38;&#x7684;&#x4E24;&#x4E2A;&#x539F;&#x5219;&#xFF1A;</p><ol><li>&#x5904;&#x7406;&#x5668;&#x4E0D;&#x80FD;&#x4E22;&#x5931;&#x6B63;&#x786E;&#x7684;&#x5904;&#x7406;&#x987A;&#x5E8F;</li><li>&#x5904;&#x7406;&#x5668;&#x4E0D;&#x80FD;&#x9519;&#x8FC7;&#x5F02;&#x5E38;</li></ol><p>&#x4F18;&#x5148;&#x5904;&#x7406;&#x9AD8;&#x7EA7;&#x522B;&#x5F02;&#x5E38;&#xFF0C;&#x4F1A;&#x5C06;&#x5F53;&#x524D;&#x7EA7;&#x522B;&#x7684;&#x6307;&#x4EE4;&#x6240;&#x5728;&#x5730;&#x5740;&#x4FDD;&#x5B58;&#x5728;EPC&#xFF0C;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x5B8C;&#x6BD5;&#x540E;&#x4F1A;&#x91CD;&#x65B0;&#x4ECE;&#x8FD9;&#x6761;&#x6307;&#x4EE4;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x9AD8;&#x7EA7;&#x522B;&#x5F02;&#x5E38;&#x53D1;&#x751F;&#x7684;&#x540C;&#x65F6;&#x8FD8;&#x6709;&#x5176;&#x4ED6;&#x7684;&#x5F02;&#x5E38;&#xFF0C;&#x5E76;&#x4E14;&#x5F53;&#x5904;&#x7406;&#x5668;&#x4ECE;&#x5F02;&#x5E38;&#x8FD4;&#x56DE;&#x65F6;&#x5F02;&#x5E38;&#x4ECD;&#x7136;&#x5B58;&#x5728;&#xFF0C;&#x90A3;&#x4E48;&#x5728;&#x91CD;&#x65B0;&#x6267;&#x884C;&#x8FD9;&#x4E32;&#x6307;&#x4EE4;&#x7684;&#x65F6;&#x5019;&#x5904;&#x7406;&#x5668;&#x6709;&#x673A;&#x4F1A;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x5F02;&#x5E38;&#x3002;&#x6240;&#x4EE5;&#x4E3A;&#x66F4;&#x6DF1;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x5F02;&#x5E38;&#x8D4B;&#x4E88;&#x66F4;&#x9AD8;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x662F;&#x4E00;&#x79CD;&#x6B63;&#x786E;&#x4E14;&#x9AD8;&#x6548;&#x7684;&#x505A;&#x6CD5;&#x3002;<br>&#x6574;&#x4E2A;&#x6D41;&#x6C34;&#x7EBF;&#x63A7;&#x5236;&#x6A21;&#x5757;&#x5C06;&#x5404;&#x4E2A;&#x63A7;&#x5236;&#x4FE1;&#x53F7;&#x6574;&#x5408;&#x4E8E;&#x4E00;&#x4E2A;always&#x5757;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;IF&#x8BED;&#x53E5;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x5C42;&#x7EA7;&#x4F18;&#x5148;&#x7EA7;&#x5904;&#x7406;&#x5F02;&#x5E38;&#x3002;<br>&#x6B63;&#x5982;&#x4E0A;&#x6587;&#x6240;&#x8BF4;&#xFF0C;MEM&#x7EA7;&#x7684;&#x5F02;&#x5E38;&#x6700;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x6709;&#x4E00;&#x79CD;&#x7C7B;&#x578B;&#xFF0C;&#x800C;MEM&#x7EA7;&#x53C8;&#x662F;&#x53EF;&#x80FD;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#x7684;&#x6700;&#x6DF1;&#x5C42;&#x7EA7;&#xFF0C;&#x56E0;&#x6B64;&#x5176;&#x5F02;&#x5E38;&#x4F18;&#x5148;&#x7EA7;&#x6700;&#x9AD8;&#x3002;&#x5728;&#x5904;&#x7406;&#x5F02;&#x5E38;&#x548C;&#x4E2D;&#x65AD;&#x7684;always block&#x4E2D;&#x5904;&#x7406;MEM&#x7EA7;&#x5F02;&#x5E38;&#x7684;IF&#x8BED;&#x53E5;&#x6700;&#x9760;&#x524D;&#x3002;&#x7136;&#x540E;&#x4F9D;&#x6B21;&#x662F;&#x5904;&#x7406;EXE&#x7EA7;&#x3001;ID&#x7EA7;&#x548C;IF&#x7EA7;&#x5F02;&#x5E38;&#x7684;IF&#x8BED;&#x53E5;&#x3002;&#x6700;&#x540E;&#xFF0C;&#x5916;&#x90E8;&#x4E2D;&#x65AD;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x6700;&#x4F4E;&#xFF0C;&#x56E0;&#x6B64;&#x5904;&#x7406;&#x4ED6;&#x7684;IF&#x8BED;&#x53E5;&#x5728;always&#x5757;&#x7684;&#x6700;&#x540E;&#x3002;&#x4ECE;IF&#x8BED;&#x53E5;&#x7684;&#x6761;&#x4EF6;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x67D0;&#x4E00;&#x5C42;&#x7EA7;&#x53EF;&#x80FD;&#x540C;&#x65F6;&#x51FA;&#x73B0;&#x7684;&#x5F02;&#x5E38;&#x7684;&#x7C7B;&#x578B;&#x3002;&#x5177;&#x4F53;&#x9488;&#x5BF9;&#x5F02;&#x5E38;&#x7684;&#x5904;&#x7406;&#x6211;&#x5C06;&#x5728;&#x540E;&#x9762;&#x7684;&#x5C0F;&#x8282;&#x4E2D;&#x8BE6;&#x7EC6;&#x63CF;&#x8FF0;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">always</span> @(*) <span class="hljs-keyword">begin</span></span><br><span class="line">        ...</span><br><span class="line">        <span class="hljs-comment">//Default values of control signals</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="hljs-keyword">if</span> (exc_MEM) <span class="hljs-keyword">begin</span></span><br><span class="line">        ...</span><br><span class="line">        <span class="hljs-comment">//processing MEM stage exceptions</span></span><br><span class="line">        ...         </span><br><span class="line">    <span class="hljs-keyword">end</span> </span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exc_EXE | EXE_SMC) <span class="hljs-keyword">begin</span></span><br><span class="line">        ...</span><br><span class="line">        <span class="hljs-comment">//processing EXE stage exceptions</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="hljs-keyword">end</span></span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exc_ID | ID_SMC) <span class="hljs-keyword">begin</span></span><br><span class="line">        ...</span><br><span class="line">        <span class="hljs-comment">//processing ID stage exceptions</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="hljs-keyword">end</span></span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exc_IF | IF_SMC | BP_miss)<span class="hljs-keyword">begin</span></span><br><span class="line">        ...</span><br><span class="line">        <span class="hljs-comment">//processing IF stage exceptions</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="hljs-keyword">end</span></span><br><span class="line">    <span class="hljs-comment">//interrupt only answered when the system is ready</span></span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (int_ack) <span class="hljs-keyword">begin</span></span><br><span class="line">        ...</span><br><span class="line">        <span class="hljs-comment">//processing external interrupt</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="hljs-keyword">end</span></span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><h5 id="&#x5F02;&#x5E38;&#x548C;&#x4E2D;&#x65AD;"><a href="#&#x5F02;&#x5E38;&#x548C;&#x4E2D;&#x65AD;" class="headerlink" title="&#x5F02;&#x5E38;&#x548C;&#x4E2D;&#x65AD;"></a>&#x5F02;&#x5E38;&#x548C;&#x4E2D;&#x65AD;</h5><p>&#x5F53;&#x5F02;&#x5E38;&#x548C;&#x4E2D;&#x65AD;&#x53D1;&#x751F;&#x65F6;&#xFF0C;&#x5904;&#x7406;&#x5668;&#x8FDB;&#x884C;&#x7684;&#x64CD;&#x4F5C;&#x6709;&#xFF1A;</p><ul><li>&#x66F4;&#x65B0;STATUS&#x5BC4;&#x5B58;&#x5668;&#x5173;&#x4E2D;&#x65AD;</li><li>&#x66F4;&#x65B0;CAUSE&#x5BC4;&#x5B58;&#x5668;&#x4FDD;&#x5B58;&#x76F8;&#x5E94;&#x7684;&#x5F02;&#x5E38;&#x53F7;&#x6216;&#x4E2D;&#x65AD;&#x53F7;</li><li>&#x66F4;&#x65B0;EPC&#x5BC4;&#x5B58;&#x5668;&#x4FDD;&#x5B58;&#x8FD4;&#x56DE;&#x5730;&#x5740;</li><li>&#x9009;&#x62E9;&#x6B63;&#x786E;&#x7684;next PC&#x5730;&#x5740;</li><li>&#x751F;&#x6210;&#x4F5C;&#x7528;&#x4E8E;&#x4E0D;&#x540C;&#x5C42;&#x7EA7;&#x7684;&#x64A4;&#x9500;&#x4FE1;&#x53F7;</li></ul><p>STATUS&#x3001;CAUSE&#x3001;EPC&#x5BC4;&#x5B58;&#x5668;&#x5C5E;&#x4E8E;CP0&#x5BC4;&#x5B58;&#x5668;&#x7EC4;&#xFF0C;&#x4ED6;&#x4EEC;&#x9664;&#x4E86;&#x53D7;&#x5F02;&#x5E38;&#x4E2D;&#x65AD;&#x7684;&#x63A7;&#x5236;&#x5916;mtc0&#x6307;&#x4EE4;&#x4E5F;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x4ED6;&#x4EEC;&#xFF0C;&#x56E0;&#x6B64;&#x4ED6;&#x4EEC;&#x7684;&#x5199;&#x5165;&#x903B;&#x8F91;&#x9700;&#x8981;&#x5355;&#x72EC;&#x5904;&#x7406;&#xFF0C;&#x5F02;&#x5E38;&#x548C;&#x4E2D;&#x65AD;&#x6A21;&#x5757;&#x53EA;&#x662F;&#x751F;&#x6210;&#x7531;&#x4E8E;&#x5F02;&#x5E38;&#x548C;&#x4E2D;&#x65AD;&#x5F15;&#x8D77;&#x7684;&#x76F8;&#x5E94;CP0&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x66F4;&#x65B0;&#x4FE1;&#x53F7;:</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">reg</span> update_STATUS_exc;</span><br><span class="line"><span class="hljs-keyword">reg</span> update_CAUSE_exc;</span><br><span class="line"><span class="hljs-keyword">reg</span> update_EPC_exc;</span><br></pre></td></tr></table></figure><p>&#x5E76;&#x4E14;&#x4E3A;&#x76F8;&#x5E94;&#x7684;CP0&#x5BC4;&#x5B58;&#x5668;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x591A;&#x8DEF;&#x5668;&#x7528;&#x4E8E;&#x9009;&#x62E9;&#x5F02;&#x5E38;&#x4E2D;&#x65AD;&#x5F15;&#x8D77;&#x7684;&#x8F93;&#x5165;&#x6216;&#x662F;mtc0&#x6307;&#x4EE4;&#x5F15;&#x8D77;&#x7684;&#x8F93;&#x5165;:</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] STATUS_exc_in,STATUS_bak_in;</span><br><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] CAUSE_exc_in;</span><br><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] EPC_exc_in;</span><br></pre></td></tr></table></figure><p>&#x7531;&#x4E8E;ID&#x7EA7;&#x9664;&#x4E86;&#x53EF;&#x80FD;&#x4EA7;&#x751F;&#x5F02;&#x5E38;&#x5916;&#xFF0C;&#x8FD8;&#x80FD;&#x5F15;&#x8D77;&#x6D41;&#x6C34;&#x7EBF;&#x7684;&#x90E8;&#x5206;&#x6682;&#x505C;&#xFF0C;&#x56E0;&#x6B64;ID&#x7EA7;&#x7684;&#x64A4;&#x9500;&#x4FE1;&#x53F7;&#x9700;&#x8981;&#x7279;&#x6B8A;&#x5904;&#x7406;&#x3002;&#x8FD9;&#x90E8;&#x5206;&#x662F;CU&#x8F83;&#x4E3A;&#x590D;&#x6742;&#x7684;&#x903B;&#x8F91;&#x4E4B;&#x4E00;&#x3002;RAW&#x51B2;&#x7A81;&#x548C;&#x591A;&#x5468;&#x671F;&#x6307;&#x4EE4;&#x5747;&#x53EF;&#x80FD;&#x548C;ID&#x7EA7;&#x7684;&#x5F02;&#x5E38;&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x7EA7;&#x7684;&#x5F02;&#x5E38;&#x540C;&#x65F6;&#x53D1;&#x751F;&#xFF0C;RAW&#x51B2;&#x7A81;&#x548C;&#x591A;&#x5468;&#x671F;&#x6307;&#x4EE4;&#x4E5F;&#x53EF;&#x80FD;&#x540C;&#x65F6;&#x53D1;&#x751F;&#x3002;&#x6B63;&#x5982;&#x4E0A;&#x6587;&#x6240;&#x8BF4;&#xFF0C;&#x82E5;&#x4E0D;&#x6B63;&#x786E;&#x5904;&#x7406;&#x6D41;&#x6C34;&#x7EBF;&#x6682;&#x505C;&#xFF0C;&#x4F1A;&#x4F7F;&#x5904;&#x7406;&#x5668;&#x9519;&#x8FC7;&#x5F02;&#x5E38;&#xFF0C;&#x8FD9;&#x8FDD;&#x53CD;&#x4E86;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x7684;&#x539F;&#x5219;&#xFF0C;&#x56E0;&#x6B64;&#x5FC5;&#x987B;&#x6B63;&#x786E;&#x5206;&#x6790;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x3002;&#x6211;&#x4E3A;&#x7531;RAW&#x5F15;&#x8D77;&#x7684;&#x6307;&#x4EE4;&#x64A4;&#x9500;&#x548C;&#x5F02;&#x5E38;&#x5F15;&#x8D77;&#x7684;&#x6307;&#x4EE4;&#x64A4;&#x9500;&#x8BBE;&#x7F6E;&#x4E86;&#x72EC;&#x7ACB;&#x7684;&#x64A4;&#x9500;&#x4FE1;&#x53F7;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//&#x7531;&#x5F02;&#x5E38;&#x5F15;&#x8D77;&#x7684;ID&#x7EA7;&#x64A4;&#x9500;&#x4FE1;&#x53F7;</span></span><br><span class="line"><span class="hljs-keyword">reg</span> ban_ID_EXC;</span><br></pre></td></tr></table></figure><p>ID&#x7EA7;&#x5411;&#x5916;&#x8F93;&#x51FA;&#x7684;&#x64A4;&#x9500;&#x4FE1;&#x53F7;&#x662F;&#x4E24;&#x4E2A;&#x64A4;&#x9500;&#x4FE1;&#x53F7;&#x7684;&#x6216;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//We have two ban signal at ID stage to avoid logic loop, ban_ID_RAW and ban_ID_EXC.</span></span><br><span class="line"><span class="hljs-comment">//ban_ID_RAW has lower priority, it can&apos;t mask out the Stall_RAW but ban_ID_EXC can.</span></span><br><span class="line"><span class="hljs-keyword">assign</span> ban_ID = ban_ID_RAW |ban_ID_EXC;</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x4E24;&#x4E2A;&#x64A4;&#x9500;&#x4FE1;&#x53F7;&#x6709;&#x4F18;&#x5148;&#x7EA7;&#xFF0C;ban_ID_EXC&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x9AD8;&#xFF0C;&#x7531;&#x5F02;&#x5E38;&#x4EA7;&#x751F;&#x7684;&#x64A4;&#x9500;&#x4FE1;&#x53F7;&#x53EF;&#x4EE5;&#x64A4;&#x9500;RAW&#x548C;&#x591A;&#x5468;&#x671F;&#x5F15;&#x8D77;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x6682;&#x505C;&#xFF0C;&#x800C;&#x7531;RAW&#x4EA7;&#x751F;&#x7684;&#x64A4;&#x9500;&#x4E0D;&#x80FD;&#x6D88;&#x9664;RAW&#x548C;&#x591A;&#x5468;&#x671F;&#x5F15;&#x8D77;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x6682;&#x505C;&#x3002;RAW&#x9700;&#x8981;&#x6682;&#x505C;&#x5E76;&#x5E9F;&#x5F03;ID&#x7EA7;&#xFF0C;&#x591A;&#x5468;&#x671F;&#x4EC5;&#x9700;&#x8981;&#x6682;&#x505C;ID&#x7EA7;&#xFF0C;&#x4E8C;&#x8005;&#x540C;&#x65F6;&#x53D1;&#x751F;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x6682;&#x505C;&#x5E76;&#x5E9F;&#x5F03;ID&#x7EA7;&#x3002;RAW&#x548C;&#x591A;&#x5468;&#x671F;&#x5F15;&#x8D77;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x6682;&#x505C;&#x662F;&#x5FC5;&#x8981;&#x7684;&#xFF0C;RAW&#x540C;&#x65F6;&#x4EA7;&#x751F;&#x6682;&#x505C;&#x548C;&#x5E9F;&#x5F03;&#x4FE1;&#x53F7;&#xFF0C;&#x56E0;&#x6B64;&#x7531;RAW&#x4EA7;&#x751F;&#x7684;&#x5E9F;&#x5F03;&#x4FE1;&#x53F7;&#x7EDD;&#x5BF9;&#x4E0D;&#x80FD;&#x64A4;&#x9500;&#x6389;&#x6D41;&#x6C34;&#x7EBF;&#x6682;&#x505C;&#x4FE1;&#x53F7;&#x3002;&#x800C;&#x7531;&#x5F02;&#x5E38;&#x4EA7;&#x751F;&#x7684;&#x64A4;&#x9500;&#x4FE1;&#x53F7;&#x5219;&#x4E0D;&#x540C;&#xFF0C;&#x5F02;&#x5E38;&#x76F4;&#x63A5;&#x5E9F;&#x5F03;&#x6389;ID&#x7EA7;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x4E5F;&#x5E9F;&#x5F03;&#x4E86;&#x53EF;&#x80FD;&#x4EA7;&#x751F;&#x7684;RAW&#x548C;&#x6D41;&#x6C34;&#x7EBF;&#x6682;&#x505C;&#x3002;ban_ID_EXC&#x4F5C;&#x7528;&#x4E8E;need_rs,need_rt&#x548C;ins_done&#x5B9E;&#x73B0;&#x4E0A;&#x8FF0;&#x64A4;&#x9500;&#x529F;&#x80FD;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">wire</span> ins_done = (canceled | ban_ID_EXC) ? <span class="hljs-number">1&apos;b1</span> : upc == cycle;</span><br><span class="line"><span class="hljs-keyword">wire</span> need_rs = ~(i_eret|i_mfc0|i_mtc0|i_syscall|i_lui|i_j|i_jal|i_sll|i_srl|i_sra)</span><br><span class="line">                &amp; ~ban_ID_EXC;</span><br><span class="line"><span class="hljs-keyword">wire</span> need_rt = ~(i_eret|i_syscall|i_bgez|i_bgezal|i_bltz|i_bltzal|i_blez|i_bgtz|i_j</span><br><span class="line">                |i_jal|i_jr|i_jalr) &amp; ~ban_ID_EXC; </span><br></pre></td></tr></table></figure><p>next PC&#x7684;&#x503C;&#x7531;&#x4E00;&#x4E2A;&#x591A;&#x8DEF;&#x5668;&#x63A7;&#x5236;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//select the right npc</span></span><br><span class="line"><span class="hljs-comment">//00 normal  (let the branch predictor decide)</span></span><br><span class="line"><span class="hljs-comment">//01 base    (normal exceptions)</span></span><br><span class="line"><span class="hljs-comment">//10 SMC_nPC (XPC for Self-modify code)</span></span><br><span class="line"><span class="hljs-comment">//11 br_target (active if there&apos;s a BP miss)</span></span><br><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] nPC_sel;</span><br></pre></td></tr></table></figure><p>&#x5728;&#x8BBE;&#x7F6E;&#x6D41;&#x6C34;&#x7EBF;&#x63A7;&#x5236;&#x4FE1;&#x53F7;&#x7684;always&#x5757;&#x91CC;&#x9996;&#x5148;&#x8981;&#x7ED9;&#x8FD9;&#x4E9B;&#x63A7;&#x5236;&#x4FE1;&#x53F7;&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x503C;&#x3002;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6D41;&#x6C34;&#x7EBF;&#x5185;&#x7684;&#x6307;&#x4EE4;&#x987A;&#x5E8F;&#x7684;&#x6267;&#x884C;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//Default values of control signals</span></span><br><span class="line">        <span class="hljs-comment">//no need to update the STATUS register</span></span><br><span class="line">        update_STATUS_exc =<span class="hljs-number">0</span>;</span><br><span class="line">        STATUS_exc_in =<span class="hljs-number">0</span>;</span><br><span class="line">        STATUS_bak_in =<span class="hljs-number">0</span>;</span><br><span class="line">        <span class="hljs-comment">//no need to update the cause register</span></span><br><span class="line">        update_CAUSE_exc =<span class="hljs-number">0</span>;        </span><br><span class="line">        CAUSE_exc_in =<span class="hljs-number">0</span>;</span><br><span class="line">        <span class="hljs-comment">//no need to update the epc register</span></span><br><span class="line">        update_EPC_exc =<span class="hljs-number">0</span>;  </span><br><span class="line">        EPC_exc_in =<span class="hljs-number">0</span>;</span><br><span class="line">        <span class="hljs-comment">//select the next pc as normal (let the branch predictor decide)</span></span><br><span class="line">        nPC_sel =<span class="hljs-number">2&apos;b00</span>;</span><br><span class="line">        SMC_nPC = PC;</span><br><span class="line">        <span class="hljs-comment">//set all cancel signal to zero</span></span><br><span class="line">        ban_IF =<span class="hljs-number">0</span>;</span><br><span class="line">        ban_ID_EXC = <span class="hljs-number">0</span>;</span><br><span class="line">        ban_EXE = <span class="hljs-number">0</span>;</span><br><span class="line">        ban_MEM = <span class="hljs-number">0</span>; </span><br></pre></td></tr></table></figure><p>&#x5F53;MEM&#x7EA7;&#x6709;&#x5F02;&#x5E38;&#x53D1;&#x751F;&#x65F6;&#xFF0C;&#x5C31;&#x8981;&#x4E0A;&#x9762;&#x6240;&#x8BF4;&#x7684;&#x4E00;&#x4E9B;&#x64CD;&#x4F5C;&#x3002;&#x5C06;STATUS&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x503C;&#x4FDD;&#x5B58;&#x5230;STATUS_bak&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x5E76;&#x4FEE;&#x6539;STATUS&#x5BC4;&#x5B58;&#x5668;&#x4E2D;&#x6700;&#x4F4E;&#x4F4D;&#xFF0C;&#x5C4F;&#x853D;&#x4E2D;&#x65AD;&#xFF1B;&#x5C06;MEM&#x7EA7;&#x4F20;&#x6765;&#x7684;&#x5F02;&#x5E38;&#x53F7;&#x7F16;&#x7801;&#x540E;&#x9001;&#x5165;CAUSE&#x5BC4;&#x5B58;&#x5668;&#xFF1B;&#x5C06;&#x5F53;&#x524D;MEM&#x7EA7;&#x6307;&#x4EE4;&#x7684;&#x5730;&#x5740;&#x4FDD;&#x5B58;&#x5728;EPC&#x4F5C;&#x4E3A;&#x8FD4;&#x56DE;&#x5730;&#x5740;&#xFF1B;&#x9009;&#x62E9;BASE&#x5BC4;&#x5B58;&#x5668;&#x4F5C;&#x4E3A;next PC&#xFF1B;&#x5C06;IF&#x3001;ID&#x3001;EXE&#x3001;MEM&#x7EA7;&#x6240;&#x6709;&#x7684;&#x6307;&#x4EE4;&#x5747;&#x5E9F;&#x5F03;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//processing MEM stage exceptions</span></span><br><span class="line">        <span class="hljs-comment">//mask out the STATUS register to disable interrupt. </span></span><br><span class="line">        update_STATUS_exc =<span class="hljs-number">1</span>;</span><br><span class="line">        STATUS_exc_in = CP0_Reg[<span class="hljs-number">1</span>] | <span class="hljs-number">32&apos;b11111111111111111111111111111110</span>;</span><br><span class="line">        STATUS_bak_in = CP0_Reg[<span class="hljs-number">1</span>];</span><br><span class="line">        <span class="hljs-comment">//select the MEM stage&apos;s cause</span></span><br><span class="line">        update_CAUSE_exc =<span class="hljs-number">1</span>;</span><br><span class="line">        CAUSE_exc_in = {<span class="hljs-number">9&apos;b0</span>,MEM_cause,<span class="hljs-number">20&apos;b0</span>};</span><br><span class="line">        <span class="hljs-comment">//save MEM_PC into epc</span></span><br><span class="line">        update_EPC_exc =<span class="hljs-number">1</span>;</span><br><span class="line">        EPC_exc_in = MEM_PC;</span><br><span class="line">        <span class="hljs-comment">//select the next pc as BASE</span></span><br><span class="line">        nPC_sel = <span class="hljs-number">2&apos;b01</span>;</span><br><span class="line">        <span class="hljs-comment">//generate cancel signals</span></span><br><span class="line">        <span class="hljs-comment">//cancel IF ID EXE MEM here</span></span><br><span class="line">        ban_IF = <span class="hljs-number">1</span>;</span><br><span class="line">        ban_ID_EXC = <span class="hljs-number">1</span>;</span><br><span class="line">        ban_EXE =<span class="hljs-number">1</span>;</span><br><span class="line">        ban_MEM=<span class="hljs-number">1</span>;  </span><br></pre></td></tr></table></figure><p>&#x5982;&#x679C;MEM&#x7EA7;&#x6CA1;&#x6709;&#x5F02;&#x5E38;&#xFF0C;&#x624D;&#x8F6E;&#x5230;&#x5904;&#x7406;EXE&#x7EA7;&#x7684;&#x5F02;&#x5E38;&#x3002;&#x4F46;&#x662F;EXE&#x7EA7;&#x8981;&#x6BD4;MEM&#x7EA7;&#x590D;&#x6742;&#x4E00;&#x4E9B;&#x3002;&#x5904;&#x7406;&#x5668;&#x7684;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;&#x4E4B;&#x4E00;&#x662F;&#x5B9E;&#x73B0;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x7684;&#x540C;&#x6B65;&#xFF0C;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x662F;&#x7531;&#x4E8E;MEM&#x7EA7;&#x7684;&#x6307;&#x4EE4;&#x5BF9;&#x67D0;&#x4E00;&#x5185;&#x5B58;&#x5730;&#x5740;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#xFF0C;&#x800C;&#x6070;&#x597D;&#x8BE5;&#x5185;&#x5B58;&#x5730;&#x5740;&#x662F;&#x6D41;&#x6C34;&#x7EBF;&#x4E2D;&#x5DF2;&#x52A0;&#x8F7D;&#x7684;&#x67D0;&#x6761;&#x6307;&#x4EE4;&#x6240;&#x5728;&#x7684;&#x4F4D;&#x7F6E;&#x5F15;&#x8D77;&#x7684;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#x3002;&#x8003;&#x8651;&#x5230;&#x6D41;&#x6C34;&#x7EBF;&#x5185;&#x5DF2;&#x52A0;&#x8F7D;&#x6307;&#x4EE4;&#x7684;&#x5148;&#x540E;&#x987A;&#x5E8F;&#xFF0C;&#x8FD9;&#x79CD;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#x53EA;&#x53EF;&#x80FD;&#x5728;MEM&#x7EA7;&#x524D;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x7EA7;&#x4E2D;&#x53D1;&#x751F;&#xFF0C;&#x56E0;&#x6B64;EXE&#x7EA7;&#x53EF;&#x80FD;&#x51FA;&#x73B0;EXE&#x7EA7;&#x5F02;&#x5E38;&#x548C;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#x3002;EXE&#x7EA7;&#x5F02;&#x5E38;&#x4FE1;&#x53F7;exc_EXE&#x7531;EXE&#x7EA7;&#x6267;&#x884C;&#x5355;&#x5143;&#x8F93;&#x5165;&#xFF0C;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x4FE1;&#x53F7;EXE_SMC&#x7531;CU&#x5185;&#x90E8;&#x5BF9;MEM&#x7EA7;&#x5199;&#x5165;&#x6307;&#x4EE4;&#x7684;&#x76EE;&#x6807;&#x5730;&#x5740;&#x6BD4;&#x5BF9;&#x5F97;&#x51FA;&#x3002;<br>&#x8FD9;&#x4E8C;&#x8005;&#x6709;&#x53EF;&#x80FD;&#x540C;&#x65F6;&#x53D1;&#x751F;&#xFF0C;&#x5F53;&#x4ED6;&#x4EEC;&#x540C;&#x65F6;&#x53D1;&#x751F;&#x65F6;&#x5982;&#x4F55;&#x786E;&#x5B9A;&#x5904;&#x7406;&#x5668;&#x7684;&#x884C;&#x4E3A;&#xFF1F;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x65E0;&#x8BBA;&#x4F18;&#x5148;&#x5904;&#x7406;&#x54EA;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x90FD;&#x4E0D;&#x4F1A;&#x4EA7;&#x751F;&#x9519;&#x8BEF;&#xFF0C;&#x4F46;&#x4E0D;&#x540C;&#x7684;&#x5904;&#x7406;&#x987A;&#x5E8F;&#x5F71;&#x54CD;&#x7CFB;&#x7EDF;&#x7684;&#x6548;&#x7387;&#x3002;&#x5904;&#x7406;SMC&#x9700;&#x8981;&#x5C06;&#x5F53;&#x524D;&#x7EA7;&#x4EE5;&#x53CA;&#x4E4B;&#x524D;&#x7EA7;&#x7684;&#x6240;&#x6709;&#x6307;&#x4EE4;&#x5E9F;&#x5F03;&#xFF0C;&#x5E76;&#x5C06;&#x5F53;&#x524D;&#x5730;&#x5740;&#x4F5C;&#x4E3A;next PC&#xFF0C;&#x91CD;&#x65B0;&#x4ECE;&#x5185;&#x5B58;&#x4E2D;&#x8BFB;&#x53D6;&#x4FEE;&#x6539;&#x540E;&#x7684;&#x65B0;&#x503C;&#x4F5C;&#x4E3A;&#x6307;&#x4EE4;&#xFF0C;&#x540C;&#x65F6;&#x4E0D;&#x9700;&#x8981;&#x4FEE;&#x6539;CP0&#x5BC4;&#x5B58;&#x5668;&#x7EC4;&#xFF1B;&#x800C;&#x5904;&#x7406;EXC&#x9664;&#x9700;&#x8981;&#x5E9F;&#x5F03;&#x6307;&#x4EE4;&#x5916;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x5C06;next PC&#x8BBE;&#x7F6E;&#x4E3A;BASE&#xFF0C;&#x5E76;&#x4FEE;&#x6539;CP0&#x5BC4;&#x5B58;&#x5668;&#x7EC4;&#x3002;&#x5148;&#x5904;&#x7406;SMC&#x4F1A;&#x91CD;&#x65B0;&#x8BFB;&#x53D6;&#x5E76;&#x6267;&#x884C;&#x8BE5;&#x5730;&#x5740;&#x5185;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x82E5;&#x65B0;&#x6307;&#x4EE4;&#x4E0D;&#x4EA7;&#x751F;&#x5F02;&#x5E38;&#xFF0C;&#x5219;&#x5904;&#x7406;SMC&#x540E;&#x5F02;&#x5E38;&#x6D88;&#x5931;&#xFF0C;&#x65E0;&#x9700;&#x518D;&#x505A;&#x5904;&#x7406;&#xFF1B;&#x82E5;&#x65B0;&#x6307;&#x4EE4;&#x4ECD;&#x7136;&#x4EA7;&#x751F;&#x5F02;&#x5E38;&#x5219;&#x6B64;&#x65F6;SMC&#x5DF2;&#x7ECF;&#x5904;&#x7406;&#x5B8C;&#x6BD5;&#xFF0C;&#x5904;&#x7406;&#x5668;&#x76F4;&#x63A5;&#x5904;&#x7406;&#x5BF9;&#x5E94;&#x7684;&#x5F02;&#x5E38;&#x5C31;&#x597D;&#x4E86;&#x3002;&#x4F18;&#x5148;&#x5904;&#x7406;&#x5F02;&#x5E38;&#x4E5F;&#x4E00;&#x6837;&#xFF0C;&#x5F53;&#x5F02;&#x5E38;&#x8FD4;&#x56DE;&#x65F6;&#x4F1A;&#x91CD;&#x65B0;&#x6267;&#x884C;&#x4EA7;&#x751F;&#x5F02;&#x5E38;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x800C;&#x7531;&#x4E8E;cache&#x7684;&#x540C;&#x6B65;&#x673A;&#x5236;&#xFF0C;&#x8FD4;&#x56DE;&#x65F6;&#x4E00;&#x5B9A;&#x4F1A;&#x4ECE;&#x5185;&#x5B58;&#x8BFB;&#x53D6;&#x65B0;&#x503C;&#x3002;&#x56E0;&#x6B64;&#x5F53;EXC&#x548C;SMC&#x540C;&#x65F6;&#x53D1;&#x751F;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x65E0;&#x8BBA;&#x5148;&#x5904;&#x7406;&#x8C01;&#x90FD;&#x4E0D;&#x4F1A;&#x4EA7;&#x751F;&#x9519;&#x8BEF;&#x3002;&#x600E;&#x6837;&#x5904;&#x7406;&#x7CFB;&#x7EDF;&#x7684;&#x6027;&#x80FD;&#x66F4;&#x597D;&#x5462;&#xFF1F;&#x7ECF;&#x8FC7;&#x8003;&#x8651;&#xFF0C;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x4F18;&#x5148;&#x5904;&#x7406;SMC&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x5904;&#x7406;EXC&#xFF0C;&#x800C;&#x5904;&#x7406;&#x4E00;&#x6B21;EXC&#x81F3;&#x5C11;&#x9700;&#x8981;&#x4E24;&#x6B21;&#x8DF3;&#x8F6C;&#xFF1B;&#x800C;&#x4F18;&#x5148;&#x5904;&#x7406;EXC&#x867D;&#x7136;&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x5904;&#x7406;SMC&#xFF0C;&#x800C;&#x5904;&#x7406;&#x4E00;&#x6B21;SMC&#x53EA;&#x9700;&#x8981;&#x4E00;&#x6B21;&#x8DF3;&#x8F6C;&#x3002;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x7684;&#x51B3;&#x7B56;&#x662F;&#x4E3A;SMC&#x8BBE;&#x7F6E;&#x8F83;&#x9AD8;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x3002;&#x6240;&#x4EE5;&#x5728;EXE&#x7EA7;&#xFF0C;&#x6761;&#x4EF6;&#x4E3A;EXE_SMC&#x7684;IF&#x8BED;&#x53E5;&#x5728;&#x524D;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">if</span> (EXE_SMC) <span class="hljs-keyword">begin</span></span><br><span class="line">    <span class="hljs-comment">//no need to update the STATUS register</span></span><br><span class="line">    update_STATUS_exc =<span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-comment">//no need to update the cause register</span></span><br><span class="line">    update_CAUSE_exc =<span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-comment">//no need to update the epc register</span></span><br><span class="line">    update_EPC_exc =<span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-comment">//select the next pc as EXE_PC</span></span><br><span class="line">    nPC_sel = <span class="hljs-number">2&apos;b10</span>;</span><br><span class="line">    SMC_nPC = EXE_PC;</span><br><span class="line">    <span class="hljs-comment">//generate cancel signals</span></span><br><span class="line">    <span class="hljs-comment">//cancel IF ID EXE here</span></span><br><span class="line">    ban_IF =<span class="hljs-number">1</span>;</span><br><span class="line">    ban_ID_EXC =<span class="hljs-number">1</span>;</span><br><span class="line">    ban_EXE =<span class="hljs-number">1</span>;</span><br><span class="line">    ban_MEM = <span class="hljs-number">0</span>;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br><span class="line"><span class="hljs-comment">//only has exc in exe stage</span></span><br><span class="line"><span class="hljs-keyword">else</span>   <span class="hljs-keyword">begin</span></span><br><span class="line">    <span class="hljs-comment">//update the status register</span></span><br><span class="line">    update_STATUS_exc =<span class="hljs-number">1</span>;</span><br><span class="line">    STATUS_exc_in = CP0_Reg[<span class="hljs-number">1</span>] | <span class="hljs-number">32&apos;b11111111111111111111111111111110</span>;</span><br><span class="line">    STATUS_bak_in = CP0_Reg[<span class="hljs-number">1</span>];</span><br><span class="line">    <span class="hljs-comment">//select the EXE stage&apos;s cause</span></span><br><span class="line">    update_CAUSE_exc =<span class="hljs-number">1</span>;</span><br><span class="line">    CAUSE_exc_in = {<span class="hljs-number">6&apos;b0</span>,EXE_cause,<span class="hljs-number">23&apos;b0</span>}; </span><br><span class="line">    <span class="hljs-comment">//save EXE_PC into epc</span></span><br><span class="line">    update_EPC_exc =<span class="hljs-number">1</span>;</span><br><span class="line">    EPC_exc_in = EXE_PC;</span><br><span class="line">    <span class="hljs-comment">//select the next pc as BASE</span></span><br><span class="line">    nPC_sel = <span class="hljs-number">2&apos;b01</span>;</span><br><span class="line">    <span class="hljs-comment">//generate cancel signals</span></span><br><span class="line">    <span class="hljs-comment">//cancel IF ID EXE here</span></span><br><span class="line">    ban_IF =<span class="hljs-number">1</span>;</span><br><span class="line">    ban_ID_EXC =<span class="hljs-number">1</span>;</span><br><span class="line">    ban_EXE =<span class="hljs-number">1</span>;</span><br><span class="line">    ban_MEM = <span class="hljs-number">0</span>;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><p>ID&#x7EA7;&#x7684;&#x5F02;&#x5E38;&#x6BD4;&#x8F83;&#x7279;&#x6B8A;&#xFF0C;&#x63A7;&#x5236;&#x5B83;&#x7684;&#x4FE1;&#x53F7;exc_ID&#x5E76;&#x4E0D;&#x662F;&#x4ECE;&#x5176;&#x5B83;&#x7EA7;&#x8F93;&#x5165;&#x7684;&#xFF0C;&#x800C;&#x662F;&#x4ECE;&#x6307;&#x4EE4;&#x8BD1;&#x7801;&#x7684;&#x7ED3;&#x679C;&#x4EA7;&#x751F;&#x7684;&#x3002;syscall&#x6307;&#x4EE4;&#x548C;&#x672A;&#x5B9E;&#x73B0;&#x7684;&#x6307;&#x4EE4;&#x76F4;&#x63A5;&#x5728;ID&#x7EA7;&#x5F15;&#x53D1;&#x5F02;&#x5E38;&#xFF0C;&#x5E76;&#x8BBE;&#x5B9A;&#x9884;&#x8BBE;&#x7684;&#x5F02;&#x5E38;&#x53F7;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//system call and unimplemented instruction will cause exception in ID stage. </span></span><br><span class="line"><span class="hljs-keyword">wire</span> exc_ID = i_syscall | i_unimp;</span><br><span class="line">    <span class="hljs-keyword">reg</span> [<span class="hljs-number">2</span>:<span class="hljs-number">0</span>] ID_cause;</span><br><span class="line"><span class="hljs-comment">//Cause of exception in ID stage is generated in ID stage itself.  </span></span><br><span class="line"><span class="hljs-keyword">always</span> @(*)</span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    <span class="hljs-keyword">if</span>  (i_syscall)</span><br><span class="line">        ID_cause = <span class="hljs-number">3&apos;b001</span>;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i_unimp)</span><br><span class="line">        ID_cause = <span class="hljs-number">3&apos;b010</span>;</span><br><span class="line">    <span class="hljs-keyword">else</span> </span><br><span class="line">        ID_cause = <span class="hljs-number">3&apos;b000</span>;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><p>&#x7531;&#x4E8E;ID&#x7EA7;&#x8FD8;&#x53EF;&#x80FD;&#x4EA7;&#x751F;&#x591A;&#x5468;&#x671F;&#x6307;&#x4EE4;&#x548C;RAW&#x5199;&#x540E;&#x8BFB;&#x51B2;&#x7A81;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x989D;&#x5916;&#x5206;&#x6790;&#x8FD9;&#x4E24;&#x8005;&#x548C;SMC&#x3001;EXC&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x3002;&#x5E78;&#x8FD0;&#x7684;&#x662F;&#xFF0C;&#x7531;&#x4E8E;syscall&#x4E0D;&#x9700;&#x8981;&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x4E5F;&#x4E0D;&#x662F;&#x591A;&#x5468;&#x671F;&#x6307;&#x4EE4;&#xFF0C;&#x5B83;&#x4E0D;&#x4F1A;&#x5F15;&#x53D1;&#x591A;&#x5468;&#x671F;&#x6307;&#x4EE4;&#x548C;&#x5199;&#x540E;&#x8BFB;&#x51B2;&#x7A81;&#xFF0C;&#x672A;&#x5B9E;&#x73B0;&#x7684;&#x6307;&#x4EE4;&#x4E5F;&#x662F;&#x8FD9;&#x6837;&#x3002;&#x56E0;&#x6B64;&#x5F53;ID&#x7EA7;&#x5F02;&#x5E38;&#x53D1;&#x751F;&#x65F6;&#xFF0C;&#x4E0D;&#x53EF;&#x80FD;&#x7531;&#x591A;&#x5468;&#x671F;&#x6307;&#x4EE4;&#x548C;&#x5199;&#x540E;&#x8BFB;&#x51B2;&#x7A81;&#x3002;&#x9488;&#x5BF9;ID&#x7EA7;&#x5F02;&#x5E38;&#x7684;&#x5904;&#x7406;&#x65B9;&#x5F0F;&#x4E8E;EXE&#x7EA7;&#x5F88;&#x50CF;&#xFF0C;&#x540C;&#x6837;&#x662F;SMC&#x4F18;&#x5148;&#x4E8E;EXC,&#x53EA;&#x4E0D;&#x8FC7;&#x8981;&#x5C06;cause&#x4FEE;&#x6539;&#x4E3A;ID_cause,&#x5C06;ID&#x7EA7;&#x6307;&#x4EE4;&#x7684;&#x5730;&#x5740;&#x4FDD;&#x5B58;&#x5728;EPC&#xFF0C;&#x5E76;&#x4E14;&#x53EA;&#x9700;&#x8981;&#x5E9F;&#x5F03;ID&#x548C;IF&#x7EA7;&#x7684;&#x6307;&#x4EE4;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//processing ID stage exceptions   </span></span><br><span class="line">        <span class="hljs-keyword">if</span> (ID_SMC) <span class="hljs-keyword">begin</span></span><br><span class="line">            <span class="hljs-comment">//no need to update the STATUS register</span></span><br><span class="line">            update_STATUS_exc =<span class="hljs-number">0</span>;</span><br><span class="line">            <span class="hljs-comment">//no need to update the cause register</span></span><br><span class="line">            update_CAUSE_exc =<span class="hljs-number">0</span>;</span><br><span class="line">            <span class="hljs-comment">//no need to update the epc register</span></span><br><span class="line">            update_EPC_exc =<span class="hljs-number">0</span>;</span><br><span class="line">            <span class="hljs-comment">//select the next pc as ID_PC</span></span><br><span class="line">            nPC_sel = <span class="hljs-number">2&apos;b10</span>;</span><br><span class="line">            SMC_nPC = ID_PC;</span><br><span class="line">            <span class="hljs-comment">//generate cancel signals</span></span><br><span class="line">            <span class="hljs-comment">//cancel IF ID here</span></span><br><span class="line">            ban_IF =<span class="hljs-number">1</span>;</span><br><span class="line">            ban_ID_EXC =<span class="hljs-number">1</span>;</span><br><span class="line">            ban_EXE = <span class="hljs-number">0</span>;</span><br><span class="line">            ban_MEM = <span class="hljs-number">0</span>;                   </span><br><span class="line">        <span class="hljs-keyword">end</span></span><br><span class="line">        <span class="hljs-comment">//only has exc in ID stage</span></span><br><span class="line">        <span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span></span><br><span class="line">            <span class="hljs-comment">//update the status register</span></span><br><span class="line">            update_STATUS_exc =<span class="hljs-number">1</span>;</span><br><span class="line">            STATUS_exc_in = CP0_Reg[<span class="hljs-number">1</span>] | <span class="hljs-number">32&apos;b11111111111111111111111111111110</span>;</span><br><span class="line">            STATUS_bak_in = CP0_Reg[<span class="hljs-number">1</span>];</span><br><span class="line">            <span class="hljs-comment">//select the ID stage&apos;s cause</span></span><br><span class="line">            update_CAUSE_exc =<span class="hljs-number">1</span>;</span><br><span class="line">            CAUSE_exc_in = {<span class="hljs-number">3&apos;b0</span>,ID_cause,<span class="hljs-number">26&apos;b0</span>};</span><br><span class="line">            <span class="hljs-comment">//save ID_PC into epc</span></span><br><span class="line">            update_EPC_exc = <span class="hljs-number">1</span>;</span><br><span class="line">            EPC_exc_in = ID_PC;</span><br><span class="line">            <span class="hljs-comment">//select the next pc as BASE</span></span><br><span class="line">            nPC_sel = <span class="hljs-number">2&apos;b01</span>;</span><br><span class="line">            <span class="hljs-comment">//generate cancel signals</span></span><br><span class="line">            <span class="hljs-comment">//cancel IF ID here</span></span><br><span class="line">            ban_IF =<span class="hljs-number">1</span>;</span><br><span class="line">            ban_ID_EXC =<span class="hljs-number">1</span>;</span><br><span class="line">            ban_EXE = <span class="hljs-number">0</span>;</span><br><span class="line">            ban_MEM = <span class="hljs-number">0</span>;   </span><br><span class="line">        <span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><p>IF&#x7EA7;&#x5C31;&#x6CA1;&#x6709;&#x90A3;&#x4E48;&#x5E78;&#x8FD0;&#x4E86;&#x3002;ID&#x7EA7;&#x5F15;&#x53D1;&#x7684;&#x591A;&#x5468;&#x671F;&#x6307;&#x4EE4;&#x548C;&#x5199;&#x540E;&#x8BFB;&#x51B2;&#x7A81;&#x4F1A;&#x5BF9;IF&#x7EA7;&#x7684;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x4EA7;&#x751F;&#x5F71;&#x54CD;&#xFF0C;&#x4E0D;&#x4EC5;&#x5982;&#x6B64;IF&#x7EA7;&#x8FD8;&#x53EF;&#x80FD;&#x4EA7;&#x751F;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5931;&#x8D25;&#x5F02;&#x5E38;BP_miss.<br>&#x9996;&#x5148;&#x5148;&#x5206;&#x6790;BP_miss/SMC/EXC&#x4E09;&#x8005;&#x4E4B;&#x95F4;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x4F18;&#x5148;&#x5904;&#x7406;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5931;&#x8D25;&#xFF0C;&#x800C;&#x5904;&#x7406;&#x5F02;&#x5E38;&#xFF0C;&#x7531;&#x4E8E;&#x5F53;&#x524D;PC&#x5DF2;&#x7ECF;&#x88AB;CU&#x786E;&#x5B9A;&#x4E3A;&#x662F;&#x9519;&#x8BEF;&#x7684;&#x5206;&#x652F;&#xFF0C;&#x56E0;&#x6B64;&#x5904;&#x7406;&#x5F02;&#x5E38;&#x65F6;&#x5411;EPC&#x4E2D;&#x5B58;&#x653E;&#x7684;&#x662F;&#x9519;&#x8BEF;&#x7684;&#x5730;&#x5740;&#x3002;&#x8003;&#x8651;&#x5230;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x7684;&#x539F;&#x5219;&#xFF0C;&#x8FD9;&#x6837;&#x505A;&#x4F1A;&#x4E22;&#x5931;&#x6B63;&#x786E;&#x7684;&#x5904;&#x7406;&#x987A;&#x5E8F;&#xFF0C;&#x56E0;&#x6B64;&#x5FC5;&#x987B;&#x8981;&#x4F18;&#x5148;&#x5904;&#x7406;BP_miss. SMC&#x548C;EXC&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x8BA8;&#x8BBA;&#x8FC7;&#xFF0C;&#x4F18;&#x5148;&#x5904;&#x7406;SMC&#x4F1A;&#x5E26;&#x6765;&#x66F4;&#x597D;&#x7684;&#x6027;&#x80FD;&#x3002;&#x56E0;&#x6B64;IF&#x7EA7;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x5148;&#x786E;&#x5B9A;&#x4E86;&#x4E0B;&#x6765;: BP_miss &gt; SMC &gt; EXC.<br>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x5206;&#x6790;&#x8FD9;&#x4E09;&#x79CD;&#x5F02;&#x5E38;&#x548C;ID&#x7EA7;&#x53EF;&#x80FD;&#x53D1;&#x751F;&#x7684;&#x591A;&#x5468;&#x671F;&#x6307;&#x4EE4;&#x3001;&#x5199;&#x540E;&#x8BFB;&#x51B2;&#x7A81;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#xFF1A;</p><ol><li>&#x5BF9;&#x4E8E;BP_miss<br>BP miss&#x4E0D;&#x4F1A;&#x4E0E;&#x591A;&#x5468;&#x671F;&#x540C;&#x65F6;&#x53D1;&#x751F;&#xFF0C;&#x56E0;&#x4E3A;&#x5F53;&#x524D;&#x7684;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x5747;&#x662F;&#x5355;&#x5468;&#x671F;&#x6307;&#x4EE4;&#x3002;&#x4F46;&#x662F;&#x4ED6;&#x4F1A;&#x548C;&#x5199;&#x540E;&#x8BFB;&#x540C;&#x65F6;&#x53D1;&#x751F;&#xFF0C;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x4E2D;&#x7684;&#x6E90;&#x5BC4;&#x5B58;&#x5668;&#x53EF;&#x80FD;&#x662F;&#x524D;&#x4E00;&#x6761;&#x6307;&#x4EE4;&#x7684;&#x8FD0;&#x7B97;&#x7ED3;&#x679C;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x6B63;&#x786E;&#x5904;&#x7406;&#xFF0C;&#x6B63;&#x786E;&#x7684;&#x8DF3;&#x8F6C;&#x76EE;&#x6807;&#x4F1A;&#x56E0;&#x4E3A;&#x5199;&#x540E;&#x8BFB;&#x5F15;&#x8D77;&#x7684;ID IF&#x7EA7;&#x6682;&#x505C;&#x88AB;&#x9519;&#x8FC7;&#x3002;&#x56E0;&#x6B64;&#x8FD9;&#x91CC;&#x5728;is branch&#x4FE1;&#x53F7;&#x4E2D;&#x52A0;&#x5165;&#x4E86;&amp;~ban_ID&#xFF0C;&#x53EA;&#x6709;&#x5F53;ID&#x7EA7;&#x7684;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x662F;&#x6709;&#x6548;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x5199;&#x540E;&#x8BFB;&#x88AB;&#x6570;&#x636E;&#x65C1;&#x8DEF;&#x548C;&#x6D41;&#x6C34;&#x7EBF;&#x6682;&#x505C;&#x89E3;&#x51B3;&#x540E;&#xFF0C;&#x624D;&#x53EF;&#x80FD;&#x89E6;&#x53D1;BP miss&#xFF0C;&#x8FD9;&#x6837;&#x6709;&#x6548;&#x7684;&#x76EE;&#x6807;&#x5C31;&#x4E0D;&#x4F1A;&#x56E0;&#x4E3A;&#x6D41;&#x6C34;&#x7EBF;&#x90E8;&#x5206;&#x6682;&#x505C;&#x800C;&#x9519;&#x8FC7;&#x3002;</li><li>&#x5BF9;&#x4E8E;SMC<br>SMC&#x4F1A;&#x4E0E;&#x591A;&#x5468;&#x671F;&#x548C;&#x5199;&#x540E;&#x8BFB;&#x540C;&#x65F6;&#x53D1;&#x751F;&#xFF0C;SMC&#x5F02;&#x5E38;&#x56E0;&#x4E3A;MEM&#x7EA7;&#x7684;&#x5199;&#x5165;&#x8BF7;&#x6C42;&#x4EA7;&#x751F;&#xFF0C;&#x800C;&#x591A;&#x5468;&#x671F;&#x548C;&#x5199;&#x540E;&#x8BFB;&#x4EC5;&#x4F1A;&#x6682;&#x505C;IF&#x548C;ID&#x7EA7;&#xFF0C;&#x56E0;&#x6B64;&#x5F53;&#x4ED6;&#x4EEC;&#x540C;&#x65F6;&#x53D1;&#x751F;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x8FDB;&#x884C;&#x7279;&#x6B8A;&#x7684;&#x5904;&#x7406;IF&#x7EA7;&#x5C31;&#x4F1A;&#x9519;&#x8FC7;SMC&#xFF0C;&#x5C06;&#x53D7;MEM&#x7EA7;&#x5199;&#x5165;&#x5F71;&#x54CD;&#x7684;&#x65E7;&#x6307;&#x4EE4;&#x9001;&#x5165;&#x4E0B;&#x4E00;&#x7EA7;&#x6D41;&#x6C34;&#x7EBF;&#x3002;&#x8FD9;&#x91CC;&#x7684;&#x5904;&#x7406;&#x662F;&#x7ED3;&#x5408;cache&#x4E2D;&#x5F15;&#x5165;&#x7684;cancel&#x673A;&#x5236;&#x3002;cache&#x4E2D;&#x5F15;&#x5165;cancel&#x673A;&#x5236;&#x539F;&#x672C;&#x7684;&#x76EE;&#x7684;&#x662F;&#x89C4;&#x907F;&#x603B;&#x7EBF;&#x65E0;&#x6CD5;&#x5904;&#x7406;&#x64A4;&#x9500;&#x8BF7;&#x6C42;&#x7684;&#x7F3A;&#x9677;&#xFF0C;&#x4F46;&#x662F;&#x8003;&#x8651;&#x5230;SMC&#x4FE1;&#x53F7;&#x751F;&#x6210;&#x7684;&#x65F6;&#x673A;&#x6070;&#x597D;&#x662F;&#x65B0;&#x7684;&#x8BF7;&#x6C42;&#x5199;&#x5165;MEM&#x7EA7;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x65F6;&#x523B;&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;CPU&#x662F;&#x6CA1;&#x6709;Stall&#x7684;&#xFF0C;I cache&#x7684;&#x8BF7;&#x6C42;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#xFF0C;&#x6839;&#x636E;cache&#x7684;&#x64A4;&#x9500;&#x673A;&#x5236;&#xFF0C;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x6B64;&#x65F6;req_sent&#x6E05;&#x96F6;&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x65F6;&#x523B;&#xFF0C;cache&#x7684;&#x8BF7;&#x6C42;&#x5C1A;&#x672A;&#x5411;&#x603B;&#x7EBF;&#x53D1;&#x51FA;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x64A4;&#x9500;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x64A4;&#x9500;&#x673A;&#x5236;&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x5728;IF&#x548C;ID&#x7EA7;&#x5BC4;&#x5B58;&#x5668;&#x5199;&#x5165;&#x53D7;&#x963B;&#x65F6;&#xFF0C;&#x4ECD;&#x80FD;&#x64A4;&#x9500;&#x5F53;&#x524D;&#x53D7;&#x5230;SMC&#x5F71;&#x54CD;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x800C;SMC&#x8BF7;&#x6C42;&#x5C06;npc&#x8BBE;&#x7F6E;&#x6210;&#x5F53;&#x524D;pc&#xFF0C;PC&#x7684;&#x503C;&#x4E0D;&#x9700;&#x8981;&#x6539;&#x53D8;&#xFF0C;&#x8FD9;&#x548C;IF&#x7EA7;&#x6682;&#x505C;&#x5E76;&#x4E0D;&#x51B2;&#x7A81;&#x3002;&#x4E4B;&#x524D;&#x5BF9;&#x4E8E;cache&#x540C;&#x6B65;&#x673A;&#x5236;&#x7684;&#x8981;&#x6C42;&#x662F;&#x603B;&#x7EBF;&#x4E8B;&#x52A1;&#x81F3;&#x5C11;&#x9700;&#x8981;&#x4E24;&#x4E2A;&#x5468;&#x671F;&#xFF0C;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x5468;&#x671F;&#x6BD4;&#x5BF9;&#x603B;&#x7EBF;&#x4E0A;&#x7684;&#x8BF7;&#x6C42;&#x662F;&#x5426;&#x5728;cache&#x4E2D;&#xFF0C;&#x4F46;&#x662F;&#x73B0;&#x5728;SMC&#x7531;CU&#x8FDB;&#x884C;&#x68C0;&#x6D4B;&#xFF0C;&#x5F53;MEM&#x7EA7;&#x5B58;&#x5728;&#x4E00;&#x4E2A;&#x4F7F;&#x5F53;&#x524D;IF&#x7EA7;&#x53D7;&#x5F71;&#x54CD;&#x7684;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x4E0B;&#x4E00;&#x4E2A;&#x65F6;&#x949F;&#x4E0A;&#x8DF3;&#x76F4;&#x63A5;&#x5E9F;&#x5F03;&#x6539;&#x6307;&#x4EE4;&#x800C;&#x4E0E;&#x6B64;&#x540C;&#x65F6;cache&#x5185;&#x90E8;&#x4E5F;&#x5C06;&#x76D1;&#x542C;&#x5230;&#x603B;&#x7EBF;&#x7684;&#x8BF7;&#x6C42;&#x5728;&#x4E0B;&#x4E00;&#x4E2A;&#x65F6;&#x949F;&#x4E0A;&#x8DF3;&#x5373;&#x53EF;&#x8FDB;&#x884C;valid bit&#x6E05;&#x96F6;&#x64CD;&#x4F5C;&#x3002;</li><li>&#x5BF9;&#x4E8E;EXC<br>&#x7531;&#x4E8E;EXC&#x53EA;&#x548C;&#x5F53;&#x524D;IF&#x7EA7;&#x6709;&#x5173;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x7531;&#x4E8E;ID&#x7EA7;&#x4EA7;&#x751F;&#x7684;IF&#x548C;ID&#x7EA7;&#x6682;&#x505C;&#x4E0D;&#x4F1A;&#x4FEE;&#x6539;IF&#x7EA7;&#x7684;&#x5185;&#x5BB9;&#xFF0C;EXC&#x4E5F;&#x4E0D;&#x4F1A;&#x56E0;&#x4E3A;&#x591A;&#x5468;&#x671F;&#x548C;RAW&#x88AB;&#x9519;&#x8FC7;&#x3002;</li></ol><p>&#x8FD9;&#x4E9B;&#x5173;&#x7CFB;&#x5206;&#x6790;&#x597D;&#x540E;&#xFF0C;&#x5904;&#x7406;&#x5668;&#x7684;&#x884C;&#x4E3A;&#x5C31;&#x786E;&#x5B9A;&#x4E86;&#x3002;&#x6211;&#x628A;&#x76F8;&#x5E94;&#x7684;&#x5904;&#x7406;&#x52A0;&#x5728;&#x4E86;BP_miss&#x4FE1;&#x53F7;&#x7684;&#x751F;&#x6210;&#x548C;Cache&#x540C;&#x6B65;&#x673A;&#x5236;&#x4E2D;&#xFF0C;CU&#x4E2D;IF&#x7EA7;&#x7684;&#x4EE3;&#x7801;&#x4E0D;&#x9700;&#x8981;&#x7279;&#x6B8A;&#x5904;&#x7406;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;ID&#x548C;EXE&#x7EA7;&#xFF0C;&#x533A;&#x522B;&#x662F;BP_miss&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x9AD8;&#xFF0C;&#x5E76;&#x4E14;CAUSE&#x3001;EPC&#x548C;&#x64A4;&#x9500;&#x4FE1;&#x53F7;&#x4E5F;&#x6709;&#x76F8;&#x5E94;&#x7684;&#x53D8;&#x5316;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//processing IF stage exceptions</span></span><br><span class="line">        <span class="hljs-comment">//If there&apos;s a branch prediction miss, handle it first</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (BP_miss) <span class="hljs-keyword">begin</span></span><br><span class="line">            <span class="hljs-comment">//no need to update the STATUS register</span></span><br><span class="line">            update_STATUS_exc =<span class="hljs-number">0</span>;</span><br><span class="line">            <span class="hljs-comment">//no need to update the cause register</span></span><br><span class="line">            update_CAUSE_exc =<span class="hljs-number">0</span>;             </span><br><span class="line">            <span class="hljs-comment">//no need to update the epc register</span></span><br><span class="line">            update_EPC_exc =<span class="hljs-number">0</span>;</span><br><span class="line">            <span class="hljs-comment">//select the next pc as correct branch target</span></span><br><span class="line">            nPC_sel = <span class="hljs-number">2&apos;b11</span>;</span><br><span class="line">            <span class="hljs-comment">//generate cancel signals</span></span><br><span class="line">            <span class="hljs-comment">//only cancel IF stage</span></span><br><span class="line">            ban_IF =<span class="hljs-number">1</span>;</span><br><span class="line">            ban_ID_EXC =<span class="hljs-number">0</span>;</span><br><span class="line">            ban_EXE = <span class="hljs-number">0</span>;</span><br><span class="line">            ban_MEM = <span class="hljs-number">0</span>;                   </span><br><span class="line">        <span class="hljs-keyword">end</span></span><br><span class="line">        <span class="hljs-comment">//otherwise, if there&apos;s a SMC in IF stage</span></span><br><span class="line">        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (IF_SMC) <span class="hljs-keyword">begin</span></span><br><span class="line">            <span class="hljs-comment">//no need to update the STATUS register</span></span><br><span class="line">            update_STATUS_exc =<span class="hljs-number">0</span>;</span><br><span class="line">            <span class="hljs-comment">//no need to update the cause register</span></span><br><span class="line">            update_CAUSE_exc =<span class="hljs-number">0</span>;               </span><br><span class="line">            <span class="hljs-comment">//no need to update the epc register</span></span><br><span class="line">            update_EPC_exc =<span class="hljs-number">0</span>;  </span><br><span class="line">            <span class="hljs-comment">//select the next pc as PC</span></span><br><span class="line">            nPC_sel = <span class="hljs-number">2&apos;b10</span>;</span><br><span class="line">            SMC_nPC = PC;</span><br><span class="line">            <span class="hljs-comment">//generate cancel signals</span></span><br><span class="line">            <span class="hljs-comment">//only cancel IF stage</span></span><br><span class="line">            <span class="hljs-comment">//ban_IF can work with the cancel mechanism within the cache</span></span><br><span class="line">            ban_IF =<span class="hljs-number">1</span>;</span><br><span class="line">            ban_ID_EXC =<span class="hljs-number">0</span>;</span><br><span class="line">            ban_EXE = <span class="hljs-number">0</span>;</span><br><span class="line">            ban_MEM = <span class="hljs-number">0</span>;                    </span><br><span class="line">        <span class="hljs-keyword">end</span></span><br><span class="line">        <span class="hljs-comment">//only has exc in IF stage</span></span><br><span class="line">        <span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span></span><br><span class="line">            <span class="hljs-comment">//update the status register</span></span><br><span class="line">            update_STATUS_exc =<span class="hljs-number">1</span>;</span><br><span class="line">            STATUS_exc_in = CP0_Reg[<span class="hljs-number">1</span>] | <span class="hljs-number">32&apos;b11111111111111111111111111111110</span>;</span><br><span class="line">            STATUS_bak_in = CP0_Reg[<span class="hljs-number">1</span>];</span><br><span class="line">            <span class="hljs-comment">//select the IF stage&apos;s cause</span></span><br><span class="line">            update_CAUSE_exc =<span class="hljs-number">1</span>;</span><br><span class="line">            CAUSE_exc_in = {IF_cause,<span class="hljs-number">29&apos;b0</span>};</span><br><span class="line">            <span class="hljs-comment">//save PC into epc</span></span><br><span class="line">            update_EPC_exc = <span class="hljs-number">1</span>;</span><br><span class="line">            EPC_exc_in = PC; </span><br><span class="line">            <span class="hljs-comment">//select the next pc as BASE</span></span><br><span class="line">            nPC_sel = <span class="hljs-number">2&apos;b01</span>;</span><br><span class="line">            <span class="hljs-comment">//generate cancel signals</span></span><br><span class="line">            <span class="hljs-comment">//only cancel IF here</span></span><br><span class="line">            ban_IF =<span class="hljs-number">1</span>;</span><br><span class="line">            ban_ID_EXC = <span class="hljs-number">0</span>;</span><br><span class="line">            ban_EXE = <span class="hljs-number">0</span>;</span><br><span class="line">            ban_MEM = <span class="hljs-number">0</span>;</span><br><span class="line">        <span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><p>&#x5F53;&#x4E0A;&#x8FF0;&#x8FD9;&#x4E9B;&#x60C5;&#x51B5;&#x90FD;&#x6CA1;&#x6709;&#x53D1;&#x751F;&#x3001;&#x4E14;&#x5F53;&#x524D;ID&#x7EA7;&#x6307;&#x4EE4;&#x4E0D;&#x662F;mtc0&#x6307;&#x4EE4;&#x65F6;&#xFF08;&#x5373;&#x6240;&#x8C13;&#x7684;&#x6B63;&#x5E38;&#x60C5;&#x51B5;&#xFF09;&#xFF0C;&#x5904;&#x7406;&#x5668;&#x4F1A;&#x76F8;&#x5E94;&#x5916;&#x90E8;&#x4E2D;&#x65AD;&#x3002;&#x5F53;&#x4E2D;&#x65AD;&#x54CD;&#x5E94;&#x53D1;&#x751F;&#x65F6;&#xFF0C;&#x5904;&#x7406;&#x5668;&#x7684;&#x884C;&#x4E3A;&#x4E8E;&#x5904;&#x7406;&#x5F02;&#x5E38;&#x7C7B;&#x4F3C;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x5728;EPC&#x4E2D;&#x4FDD;&#x5B58;&#x88AB;&#x4E2D;&#x65AD;&#x7684;&#x6307;&#x4EE4;&#xFF08;&#x5373;&#x5F53;&#x524D;ID&#x7EA7;&#x6307;&#x4EE4;&#xFF09;&#x7684;&#x4E0B;&#x4E00;&#x884C;&#x7684;&#x5730;&#x5740;&#xFF08;&#x5373;&#x5F53;&#x524D;PC&#xFF09;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//processing external interrupt</span></span><br><span class="line">            <span class="hljs-comment">//update the status register</span></span><br><span class="line">            update_STATUS_exc =<span class="hljs-number">1</span>;</span><br><span class="line">            STATUS_exc_in = CP0_Reg[<span class="hljs-number">1</span>] | <span class="hljs-number">32&apos;b11111111111111111111111111111110</span>;</span><br><span class="line">            STATUS_bak_in = CP0_Reg[<span class="hljs-number">1</span>];</span><br><span class="line">            <span class="hljs-comment">//select interrupt number as cause</span></span><br><span class="line">            update_CAUSE_exc =<span class="hljs-number">1</span>;</span><br><span class="line">            CAUSE_exc_in = {<span class="hljs-number">12&apos;b0</span>,int_num};</span><br><span class="line">            <span class="hljs-comment">//when there&apos;s an external interrupt and the interrupt is allowed</span></span><br><span class="line">            <span class="hljs-comment">//no need to discard instructions in ID stage to handle interrupts  </span></span><br><span class="line">            <span class="hljs-comment">//and when the system returns from interrupt, the difference from </span></span><br><span class="line">            <span class="hljs-comment">//the exception is that the next instruction after the interrupted </span></span><br><span class="line">            <span class="hljs-comment">//instruction is executed. So we save PC into epc and ban IF when</span></span><br><span class="line">            <span class="hljs-comment">//the interrupt is processed. </span></span><br><span class="line">            <span class="hljs-comment">//save PC into epc</span></span><br><span class="line">            update_EPC_exc = <span class="hljs-number">1</span>;</span><br><span class="line">            EPC_exc_in = PC;</span><br><span class="line">            <span class="hljs-comment">//select the next pc as BASE</span></span><br><span class="line">            nPC_sel = <span class="hljs-number">2&apos;b01</span>;</span><br><span class="line">            <span class="hljs-comment">//generate cancel signals</span></span><br><span class="line">            <span class="hljs-comment">//only cancel IF here</span></span><br><span class="line">            ban_IF =<span class="hljs-number">1</span>;</span><br><span class="line">            ban_ID_EXC = <span class="hljs-number">0</span>;</span><br><span class="line">            ban_EXE = <span class="hljs-number">0</span>;</span><br><span class="line">            ban_MEM = <span class="hljs-number">0</span>;     </span><br><span class="line">    <span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><p>&#x6D41;&#x6C34;&#x7EBF;&#x7684;&#x63A7;&#x5236;&#x903B;&#x8F91;&#x662F;CU&#x7684;&#x6838;&#x5FC3;&#xFF0C;&#x6211;&#x82B1;&#x4E86;&#x5F88;&#x957F;&#x65F6;&#x95F4;&#x624D;&#x5C06;&#x5176;&#x4E2D;&#x7684;&#x5404;&#x79CD;&#x60C5;&#x51B5;&#x7406;&#x6E05;&#x3002;</p><h5 id="&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x548C;cache&#x540C;&#x6B65;"><a href="#&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x548C;cache&#x540C;&#x6B65;" class="headerlink" title="&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x548C;cache&#x540C;&#x6B65;"></a>&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x548C;cache&#x540C;&#x6B65;</h5><p>&#x5404;&#x7EA7;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x5F02;&#x5E38;&#x5728;CU&#x5185;&#x90E8;&#x6839;&#x636E;MEM&#x7EA7;&#x5199;&#x8BF7;&#x6C42;&#x548C;&#x5730;&#x5740;&#x4FE1;&#x53F7;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//self modify code  has an impact on IF ID and EXE stage. </span></span><br><span class="line"><span class="hljs-keyword">wire</span> IF_SMC, ID_SMC, EXE_SMC;</span><br><span class="line"><span class="hljs-keyword">assign</span> IF_SMC = (PC == M_MemAddr) &amp; M_MemWrite;</span><br><span class="line"><span class="hljs-keyword">assign</span> ID_SMC = (ID_PC == M_MemAddr) &amp; M_MemWrite;</span><br><span class="line"><span class="hljs-keyword">assign</span> EXE_SMC = (EXE_PC == M_MemAddr) &amp; M_MemWrite;</span><br></pre></td></tr></table></figure><p>&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x591A;&#x8DEF;&#x5668;&#x7528;&#x4E8E;&#x4E3A;&#x4E0D;&#x540C;&#x7684;&#x7EA7;&#x7684;SMC&#x5F02;&#x5E38;&#x4EA7;&#x751F;&#x6B63;&#x786E;&#x7684;next_PC, SMC_nPC&#x7684;&#x503C;&#x5728;&#x6D41;&#x6C34;&#x7EBF;&#x63A7;&#x5236;&#x903B;&#x8F91;&#x7684;always&#x5757;&#x4E2D;&#x88AB;&#x4FEE;&#x6539;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] SMC_nPC;</span><br></pre></td></tr></table></figure><h5 id="&#x8DF3;&#x8F6C;&#x548C;&#x5206;&#x652F;&#x9884;&#x6D4B;"><a href="#&#x8DF3;&#x8F6C;&#x548C;&#x5206;&#x652F;&#x9884;&#x6D4B;" class="headerlink" title="&#x8DF3;&#x8F6C;&#x548C;&#x5206;&#x652F;&#x9884;&#x6D4B;"></a>&#x8DF3;&#x8F6C;&#x548C;&#x5206;&#x652F;&#x9884;&#x6D4B;</h5><p>&#x5206;&#x652F;&#x9884;&#x6D4B;&#x662F;&#x5904;&#x7406;&#x5668;&#x5C06;&#x8981;&#x5B9E;&#x73B0;&#x7684;&#x76EE;&#x6807;&#x4E4B;&#x4E00;&#x3002;CU&#x4E2D;&#x4EC5;&#x4EC5;&#x5B9E;&#x73B0;&#x4E0E;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5668;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x5E76;&#x63D0;&#x4F9B;&#x76F8;&#x5E94;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x63A7;&#x5236;&#x673A;&#x5236;&#x3002;CU&#x4E2D;&#x5173;&#x4E8E;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x7684;&#x90E8;&#x5206;&#x72EC;&#x7ACB;&#x4E8E;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5668;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x672C;&#x7CFB;&#x7EDF;&#x5185;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5668;&#x65F6;&#x4E0D;&#x9700;&#x8981;&#x4FEE;&#x6539;CU&#x7684;&#x5185;&#x5BB9;&#x3002;<br>&#x5173;&#x4E8E;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x7684;&#x63A7;&#x5236;&#x903B;&#x8F91;&#x662F;&#x8FD9;&#x6837;&#x5B9E;&#x73B0;&#x7684;&#xFF1A;&#x5F53;IF&#x7EA7;&#x603B;&#x662F;&#x6309;&#x7167;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x7684;&#x7ED3;&#x679C;&#x8FDB;&#x884C;&#x6307;&#x4EE4;&#x9884;&#x53D6;&#xFF0C;&#x5F53;ID&#x7EA7;&#x6307;&#x4EE4;&#x662F;&#x4E00;&#x4E2A;&#x6709;&#x6548;&#x7684;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x65F6;&#xFF0C;&#x5176;&#x8DF3;&#x8F6C;&#x76EE;&#x6807;&#x5DF2;&#x7ECF;&#x8BA1;&#x7B97;&#x5F97;&#x5230;&#xFF0C;&#x6B64;&#x65F6;&#x6BD4;&#x5BF9;&#x8DF3;&#x8F6C;&#x76EE;&#x6807;&#x548C;&#x5F53;&#x524D;&#x9884;&#x53D6;&#x7684;&#x6307;&#x4EE4;&#x5730;&#x5740;&#x5373;&#x53EF;&#x77E5;&#x9053;&#x6307;&#x4EE4;&#x9884;&#x53D6;&#x662F;&#x5426;&#x6B63;&#x786E;&#x3002;<br>&#x56E0;&#x6B64;&#x8FD9;&#x90E8;&#x5206;&#x903B;&#x8F91;&#x5206;&#x4E3A;&#x4E09;&#x90E8;&#x5206;&#xFF1A;</p><ol><li>&#x786E;&#x5B9A;&#x6709;&#x6548;&#x7684;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;</li></ol><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//These signals are used for the branch predictor. </span></span><br><span class="line"><span class="hljs-comment">//is_branch is HIGH if current instruction in ID stage is a branch instruction. </span></span><br><span class="line"><span class="hljs-comment">//This signal with ID_PC together, can let the branch predictor know that</span></span><br><span class="line"><span class="hljs-comment">//an address holds a branch instruction, then the BP can assign a slot for</span></span><br><span class="line"><span class="hljs-comment">//that address.</span></span><br><span class="line"><span class="hljs-keyword">assign</span> is_branch =(i_j|i_jal|i_jr|i_jalr|i_bgez|i_bgezal|i_bltz|i_bltzal</span><br><span class="line">            |i_blez|i_beq|i_bne|i_eret)&amp;~ban_ID;</span><br></pre></td></tr></table></figure><ol start="2"><li>&#x8BA1;&#x7B97;&#x6B63;&#x786E;&#x7684;&#x8DF3;&#x8F6C;&#x7ED3;&#x679C;</li></ol><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//Jump target for J/Jal instruction. Different with the original MIPS 32 instruction. </span></span><br><span class="line"><span class="hljs-comment">//This CPU don&apos;t have delay slot, so upper bit of the target is the corresponding</span></span><br><span class="line"><span class="hljs-comment">//bits of the address of the branch instruction itself. </span></span><br><span class="line"><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] jpc = {ID_PC[<span class="hljs-number">31</span>:<span class="hljs-number">28</span>],instruction[<span class="hljs-number">25</span>:<span class="hljs-number">0</span>],<span class="hljs-number">2&apos;b00</span>};</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//Branch offset for conditional branch instructions. </span></span><br><span class="line"><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] br_offset = {imm[<span class="hljs-number">29</span>:<span class="hljs-number">0</span>],<span class="hljs-number">2&apos;b00</span>};</span><br><span class="line"><span class="hljs-comment">//Target address for conditional branch instructions. </span></span><br><span class="line"><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] bpc = br_offset + ID_PC;</span><br><span class="line"><span class="hljs-comment">//Target address for jump register instructions</span></span><br><span class="line"><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] rpc = regA;</span><br><span class="line"><span class="hljs-comment">//Target address for eret instruction. </span></span><br><span class="line"><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] epc = CP0_Reg[<span class="hljs-number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//signals for conditional branch. </span></span><br><span class="line"><span class="hljs-keyword">wire</span>   rs_equal_0,rs_rt_equal,rs_less_than_0;</span><br><span class="line"><span class="hljs-keyword">assign</span> rs_equal_0 = (regA ==  <span class="hljs-number">32&apos;b0</span>);</span><br><span class="line"><span class="hljs-keyword">assign</span> rs_rt_equal = (regA == regB);</span><br><span class="line"><span class="hljs-keyword">assign</span> rs_less_than_0 = regA[<span class="hljs-number">31</span>];</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//select the correct branch target</span></span><br><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] br_target;</span><br><span class="line"><span class="hljs-keyword">always</span> @(*) <span class="hljs-keyword">begin</span></span><br><span class="line">     <span class="hljs-comment">//unconditional branch instructions</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (i_j|i_jal)          br_target = jpc;</span><br><span class="line">    <span class="hljs-comment">//unconditional branch register instructions</span></span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i_jr|i_jalr)   br_target = rpc;</span><br><span class="line">    <span class="hljs-comment">//return from exception</span></span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i_eret)        br_target = epc;</span><br><span class="line">    <span class="hljs-comment">//conditional branch instructions</span></span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (((i_bgez|i_bgezal)&amp;(~rs_less_than_0))|((i_bltz|i_bltzal)&amp;rs_less_than_0)</span><br><span class="line">        |(i_blez&amp;(rs_less_than_0|rs_equal_0))|(i_beq&amp;rs_rt_equal)|(i_bne&amp;(~rs_rt_equal)))</span><br><span class="line">                            br_target = bpc;</span><br><span class="line">    <span class="hljs-comment">//normal target</span></span><br><span class="line">    <span class="hljs-keyword">else</span>                    br_target = ID_PC + <span class="hljs-number">4</span>;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><ol><li>&#x5C06;&#x8BA1;&#x7B97;&#x5F97;&#x5230;&#x7684;&#x8DF3;&#x8F6C;&#x7ED3;&#x679C;&#x4E0E;&#x6307;&#x4EE4;&#x9884;&#x53D6;&#x7684;&#x5730;&#x5740;(&#x5373;&#x5F53;&#x524D;PC)&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#x5F97;&#x51FA;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5931;&#x8D25;&#x4FE1;&#x53F7;&#x3002;</li></ol><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//If there&apos;s a branch, compare the branch target with the current PC, if the two</span></span><br><span class="line"><span class="hljs-comment">//are not equal, then there&apos;s a BP miss, pre-fetched instruction should be </span></span><br><span class="line"><span class="hljs-comment">//canceled.  </span></span><br><span class="line"><span class="hljs-keyword">assign</span> BP_miss = is_branch? (PC != br_target) : <span class="hljs-number">1&apos;b0</span>;</span><br></pre></td></tr></table></figure><p>&#x9664;&#x4E86;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x4FE1;&#x53F7;&#x548C;&#x6709;&#x6548;&#x7684;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x4FE1;&#x53F7;&#xFF0C;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5668;&#x8FD8;&#x9700;&#x8981;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x7684;&#x4FE1;&#x606F;&#x624D;&#x80FD;&#x6B63;&#x786E;&#x7EF4;&#x62A4;&#x8DF3;&#x8F6C;&#x5386;&#x53F2;&#x8868;&#xFF0C;&#x6BD4;&#x5982;&#x8DF3;&#x8F6C;&#x8BA1;&#x7B97;&#x7684;&#x7ED3;&#x679C;&#x4EE5;&#x53CA;&#x8DF3;&#x8F6C;&#x7684;&#x76EE;&#x6807;&#x662F;&#x5426;&#x662F;&#x53EF;&#x53D8;&#x7684;&#x76EE;&#x6807;&#x3002;&#x56E0;&#x6B64;&#x4E13;&#x95E8;&#x4E3A;&#x6B64;&#x751F;&#x6210;&#x4E24;&#x4E2A;&#x4FE1;&#x53F7;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//do_branch is HIGH if a branch takes place. </span></span><br><span class="line"><span class="hljs-comment">//This signal together with is_branch and BP_miss, can let the branch predictor </span></span><br><span class="line"><span class="hljs-comment">//know when to update the history table. </span></span><br><span class="line"><span class="hljs-keyword">assign</span> do_branch = (i_j|i_jal|i_jr|i_jalr|((i_bgez|i_bgezal)&amp;(~rs_less_than_0))</span><br><span class="line">            |((i_bltz|i_bltzal)&amp;rs_less_than_0)|(i_blez&amp;(rs_less_than_0|rs_equal_0))</span><br><span class="line">            |(i_beq&amp;rs_rt_equal)|(i_bne&amp;(~rs_rt_equal))|i_eret)&amp;~ban_ID;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//Some of the branch instructions such as j and jal have fixed target, while</span></span><br><span class="line"><span class="hljs-comment">//some branch instructions such as jr and jalr have  variable target. </span></span><br><span class="line"><span class="hljs-comment">//The branch predictor must understand these conditions when making predictions. </span></span><br><span class="line"><span class="hljs-keyword">assign</span> V_target = i_jr | i_jalr | i_eret;</span><br></pre></td></tr></table></figure><h4 id="CP0-&#x5BC4;&#x5B58;&#x5668;&#x7EC4;"><a href="#CP0-&#x5BC4;&#x5B58;&#x5668;&#x7EC4;" class="headerlink" title="CP0 &#x5BC4;&#x5B58;&#x5668;&#x7EC4;"></a>CP0 &#x5BC4;&#x5B58;&#x5668;&#x7EC4;</h4><p>CP0&#x5BC4;&#x5B58;&#x5668;&#x7EC4;&#x662F;CU&#x7684;&#x91CD;&#x8981;&#x90E8;&#x5206;&#xFF0C;&#x4ED6;&#x4EEC;&#x65E2;&#x548C;&#x4E00;&#x4E9B;&#x6307;&#x4EE4;&#x4EA4;&#x4E92;&#xFF08;mfc0&#xFF0C;mtc0, eret&#xFF09;&#x53C8;&#x76F4;&#x63A5;&#x53C2;&#x4E0E;&#x5904;&#x7406;&#x5668;&#x7684;&#x63A7;&#x5236;&#x3002;<br>&#x9996;&#x5148;&#x8003;&#x8651;&#x6709;&#x54EA;&#x4E9B;&#x60C5;&#x51B5;&#x4F1A;&#x5411;CP0&#x5199;&#x5165;&#x6570;&#x636E;&#x3002;mtc0&#x6307;&#x4EE4;&#x3001;&#x5F02;&#x5E38;&#x4E2D;&#x65AD;&#x3001;eret&#x6307;&#x4EE4;&#x4E09;&#x79CD;&#x60C5;&#x51B5;&#x53D1;&#x751F;&#x65F6;&#x4F1A;&#x5199;&#x5165;CP0&#x5BC4;&#x5B58;&#x5668;&#x3002;CP0&#x5BC4;&#x5B58;&#x5668;&#x7EC4;&#x540C;&#x5176;&#x4ED6;&#x5BC4;&#x5B58;&#x5668;&#x7EC4;&#x4E00;&#x6837;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x540C;&#x6B65;&#x7684;&#x6E05;&#x96F6;&#x4FE1;&#x53F7;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] CP0_Reg[<span class="hljs-number">5</span>];</span><br></pre></td></tr></table></figure><p>CP0&#x5BC4;&#x5B58;&#x5668;&#x7EC4;&#x7684;&#x547D;&#x540D;&#x548C;&#x7F16;&#x7801;&#x5982;&#x4E0B;:</p><ul><li>CP0[0]&#x662F;CAUSE&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x7528;&#x4F5C;&#x4E2D;&#x65AD;&#x5411;&#x91CF;&#x3002;&#x5176;&#x7F16;&#x7801;&#x4E3A;</li></ul><table><thead><tr><th>31  -29</th><th>28 -27</th><th>25  -23</th><th>22 -20</th><th>19     -        0</th></tr></thead><tbody><tr><td>IF</td><td>ID</td><td>EXE</td><td>MEM</td><td>interrupt</td></tr></tbody></table><ul><li>CP0[1]&#x662F;STATUS&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x5B83;&#x7684;&#x6700;&#x4F4E;&#x4F4D;&#x7528;&#x4F5C;&#x4E2D;&#x65AD;&#x5C4F;&#x853D;&#x4F4D;&#xFF0C;&#x5176;&#x4ED6;&#x4F4D;&#x4FDD;&#x7559;&#x4EE5;&#x540E;&#x4F7F;&#x7528;&#x3002;</li><li>CP0[2]&#x662F;BASE&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x4ED6;&#x5B58;&#x50A8;&#x4E2D;&#x65AD;&#x670D;&#x52A1;&#x7A0B;&#x5E8F;&#x7684;&#x5165;&#x53E3;&#x3002;</li><li>CP0[3]&#x662F;EPC&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x4ED6;&#x5B58;&#x50A8;&#x4E2D;&#x65AD;&#x6216;&#x5F02;&#x5E38;&#x65F6;&#x7684;&#x8FD4;&#x56DE;&#x5730;&#x5740;&#x3002;</li><li>CP0[4]&#x4F7F;STATUS&#x7684;&#x5907;&#x4EFD;&#xFF0C;&#x5F53;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#x6216;&#x4E2D;&#x65AD;&#x65F6;STATUS&#x7684;&#x503C;&#x4FDD;&#x5B58;&#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x5F53;&#x4ECE;&#x4E2D;&#x65AD;&#x6216;&#x5F02;&#x5E38;&#x8FD4;&#x56DE;&#x65F6;(eret)&#xFF0C;&#x5728;&#x7528;&#x8FD9;&#x4E2A;&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x503C;&#x6062;&#x590D;STATUS&#x5BC4;&#x5B58;&#x5668;&#x3002;</li></ul><p>&#x6E05;&#x96F6;&#x4FE1;&#x53F7;&#x7531;for&#x5FAA;&#x73AF;&#x5B9E;&#x73B0;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk)</span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (clr)</span><br><span class="line">    <span class="hljs-keyword">begin</span></span><br><span class="line">       <span class="hljs-keyword">integer</span> i;</span><br><span class="line">        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i = i + <span class="hljs-number">1</span>)</span><br><span class="line">            CP0_Reg[i] &lt;= <span class="hljs-number">0</span>; </span><br><span class="line">    <span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><p>&#x9488;&#x5BF9;&#x5BC4;&#x5B58;&#x5668;&#x7EC4;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x4F9D;&#x7167;&#x5176;&#x5199;&#x5165;&#x6761;&#x4EF6;&#x548C;&#x5199;&#x5165;&#x7684;&#x503C;&#xFF0C;&#x4EA7;&#x751F;&#x5199;&#x5165;&#x903B;&#x8F91;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span></span><br><span class="line">        <span class="hljs-comment">//write the STATUS register CP0_Reg[1]</span></span><br><span class="line">            <span class="hljs-comment">//when there&apos;s an exception or interrupt</span></span><br><span class="line">            <span class="hljs-comment">//This has a higher priority than mtc0. </span></span><br><span class="line">            <span class="hljs-keyword">if</span> (update_STATUS_exc) <span class="hljs-keyword">begin</span></span><br><span class="line">                CP0_Reg[<span class="hljs-number">1</span>] &lt;= STATUS_exc_in;</span><br><span class="line">            <span class="hljs-keyword">end</span> </span><br><span class="line">            <span class="hljs-comment">//when there&apos;s an eret instruction. </span></span><br><span class="line">            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i_eret &amp; ~ban_ID) <span class="hljs-keyword">begin</span></span><br><span class="line">            <span class="hljs-comment">//when there&apos;s an eret, status register recovers it&apos;s previous value</span></span><br><span class="line">                CP0_Reg[<span class="hljs-number">1</span>] &lt;= CP0_Reg[<span class="hljs-number">4</span>];</span><br><span class="line">            <span class="hljs-keyword">end</span></span><br><span class="line">            <span class="hljs-comment">//when there&apos;s a mtc0 instruction. </span></span><br><span class="line">            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i_mtc0 &amp; ~ban_ID &amp; rd == <span class="hljs-number">1</span>) <span class="hljs-keyword">begin</span></span><br><span class="line">                CP0_Reg[<span class="hljs-number">1</span>] &lt;= regB;</span><br><span class="line">            <span class="hljs-keyword">end</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">//write the CAUSE register CP0_Reg[0]</span></span><br><span class="line">            <span class="hljs-comment">//when there&apos;s an exception or interrupt</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (update_CAUSE_exc) <span class="hljs-keyword">begin</span></span><br><span class="line">                CP0_Reg[<span class="hljs-number">0</span>] &lt;= CAUSE_exc_in;</span><br><span class="line">            <span class="hljs-keyword">end</span></span><br><span class="line">            <span class="hljs-comment">//when there&apos;s an eret instruction. </span></span><br><span class="line">            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i_eret &amp; ~ban_ID) <span class="hljs-keyword">begin</span></span><br><span class="line">            <span class="hljs-comment">//when there&apos;s an eret, cause register is set to zeros. </span></span><br><span class="line">                CP0_Reg[<span class="hljs-number">0</span>] &lt;= <span class="hljs-number">32&apos;b0</span>;</span><br><span class="line">            <span class="hljs-keyword">end</span></span><br><span class="line">            <span class="hljs-comment">//when there&apos;s a mtc0 instruction. </span></span><br><span class="line">            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i_mtc0 &amp; ~ban_ID &amp; rd == <span class="hljs-number">0</span>) <span class="hljs-keyword">begin</span></span><br><span class="line">                CP0_Reg[<span class="hljs-number">0</span>] &lt;= regB;</span><br><span class="line">            <span class="hljs-keyword">end</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">//write the EPC register CP0_Reg[3]</span></span><br><span class="line">            <span class="hljs-comment">//when there&apos;s an exception or interrupt</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (update_EPC_exc) <span class="hljs-keyword">begin</span></span><br><span class="line">                CP0_Reg[<span class="hljs-number">3</span>] &lt;= EPC_exc_in;</span><br><span class="line">            <span class="hljs-keyword">end</span></span><br><span class="line">            <span class="hljs-comment">//when there&apos;s an eret instruction. </span></span><br><span class="line">            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i_eret &amp; ~ban_ID) <span class="hljs-keyword">begin</span></span><br><span class="line">            <span class="hljs-comment">//when there&apos;s an eret, EPC register is set to zeros.</span></span><br><span class="line">                CP0_Reg[<span class="hljs-number">3</span>] &lt;= <span class="hljs-number">32&apos;b0</span>;</span><br><span class="line">            <span class="hljs-keyword">end</span></span><br><span class="line">            <span class="hljs-comment">//when there&apos;s mtc0 instruction. </span></span><br><span class="line">            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i_mtc0 &amp; ~ban_ID &amp; rd == <span class="hljs-number">3</span>) <span class="hljs-keyword">begin</span>  </span><br><span class="line">                CP0_Reg[<span class="hljs-number">3</span>] &lt;= regB;</span><br><span class="line">            <span class="hljs-keyword">end</span></span><br><span class="line">        </span><br><span class="line">        <span class="hljs-comment">//write the BASE register CP0_Reg[2]</span></span><br><span class="line">        <span class="hljs-comment">//BASE register is not changed by exceptions or interrupts</span></span><br><span class="line">        <span class="hljs-comment">//mtc0 instruction can change the value of it. </span></span><br><span class="line">            <span class="hljs-keyword">if</span> (i_mtc0 &amp; ~ban_ID &amp; rd == <span class="hljs-number">2</span>) <span class="hljs-keyword">begin</span></span><br><span class="line">                CP0_Reg[<span class="hljs-number">2</span>] &lt;= regB;</span><br><span class="line">            <span class="hljs-keyword">end</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">//write the STATUS_bak register CP0_Reg[4]</span></span><br><span class="line">            <span class="hljs-comment">//when there&apos;s an exception or interrupt. </span></span><br><span class="line">            <span class="hljs-keyword">if</span> (update_STATUS_exc) <span class="hljs-keyword">begin</span></span><br><span class="line">                CP0_Reg[<span class="hljs-number">4</span>] &lt;= STATUS_bak_in;</span><br><span class="line">            <span class="hljs-keyword">end</span></span><br><span class="line">            <span class="hljs-comment">//when there&apos;s an eret instruction. </span></span><br><span class="line">            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i_eret &amp; ~ban_ID) <span class="hljs-keyword">begin</span></span><br><span class="line">            <span class="hljs-comment">//when there&apos;s an eret, the STATUS_bak register is set to zeros. </span></span><br><span class="line">                CP0_Reg[<span class="hljs-number">4</span>] &lt;= <span class="hljs-number">32&apos;b0</span>;</span><br><span class="line">            <span class="hljs-keyword">end</span></span><br><span class="line">            <span class="hljs-comment">//when there&apos;s mtc0 instruction. </span></span><br><span class="line">            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i_mtc0 &amp; ~ban_ID &amp; rd == <span class="hljs-number">4</span>) <span class="hljs-keyword">begin</span></span><br><span class="line">                CP0_Reg[<span class="hljs-number">4</span>] &lt;= regB;</span><br><span class="line">            <span class="hljs-keyword">end</span></span><br><span class="line">        <span class="hljs-keyword">end</span></span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;mtc0&#x7684;&#x6307;&#x4EE4;&#x6BD4;&#x5F02;&#x5E38;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x4F4E;&#xFF0C;&#x5F53;&#x5F02;&#x5E38;&#x548C;mtc0&#x540C;&#x65F6;&#x53D1;&#x751F;&#x65F6;&#xFF0C;mtc0&#x5411;&#x67D0;&#x4E9B;cp0&#x5BC4;&#x5B58;&#x5668;&#x4E2D;&#x7684;&#x5199;&#x5165;&#x4F1A;&#x88AB;&#x5FFD;&#x7565;&#x3002;&#x56E0;&#x6B64;mtc0&#x6307;&#x4EE4;&#x5728;&#x4F7F;&#x7528;&#x65F6;&#x5FC5;&#x987B;&#x8981;&#x8003;&#x8651;&#x5176;&#x53D1;&#x751F;&#x7684;&#x65F6;&#x673A;&#xFF0C;&#x4EE5;&#x514D;&#x4EA7;&#x751F;&#x65E0;&#x6CD5;&#x9884;&#x6D4B;&#x7684;&#x7ED3;&#x679C;&#x3002;</p><p>mfc0&#x6307;&#x4EE4;&#x662F;&#x901A;&#x8FC7;&#x5BF9;cp0&#x5BC4;&#x5B58;&#x5668;&#x7EC4;&#x7684;&#x8FDE;&#x7EED;&#x8BFB;&#x51FA;&#x548C;ID&#x7EA7;&#x6570;&#x636E;&#x8F93;&#x51FA;&#x524D;&#x7684;&#x591A;&#x8DEF;&#x5668;&#x5B9E;&#x73B0;&#x7684;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] CP0_reg_out = CP0_Reg[rd];</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//implement of mfc0 and mtc0</span></span><br><span class="line"><span class="hljs-comment">//mtc0 is done in ID stage itself, The output of register file feed into </span></span><br><span class="line"><span class="hljs-comment">//CU&apos;s CP0_reg_in, rd field as index, i_mtc0 signal controls the write enable.</span></span><br><span class="line"><span class="hljs-comment">//mfc0 is done at WB stage. rd as index, the output of CP0 register group is</span></span><br><span class="line"><span class="hljs-comment">//selected by the I_MFC0; At EXE stage, the output of CP0 register add </span></span><br><span class="line"><span class="hljs-comment">//rs which is zero, then skip MEM stage, send to target register in WB stage. </span></span><br><span class="line"><span class="hljs-keyword">assign</span> db = i_mfc0 &amp;~ban_ID ? CP0_reg_out : regB;</span><br><span class="line"><span class="hljs-keyword">assign</span> da = regA;</span><br></pre></td></tr></table></figure><h2 id="&#x6D4B;&#x8BD5;"><a href="#&#x6D4B;&#x8BD5;" class="headerlink" title="&#x6D4B;&#x8BD5;"></a>&#x6D4B;&#x8BD5;</h2><p>CU&#x9700;&#x8981;&#x4E0E;&#x5904;&#x7406;&#x5668;&#x5185;&#x90E8;&#x5168;&#x90E8;&#x529F;&#x80FD;&#x90E8;&#x4EF6;&#x914D;&#x5408;&#x624D;&#x80FD;&#x53D1;&#x6325;&#x4F5C;&#x7528;&#xFF0C;&#x56E0;&#x6B64;&#x76EE;&#x524D;&#x6765;&#x770B;&#x6D4B;&#x8BD5;&#x5DE5;&#x4F5C;&#x5728;CPU&#x5185;&#x90E8;&#x529F;&#x80FD;&#x90E8;&#x4EF6;&#x5C1A;&#x672A;&#x5B8C;&#x5168;&#x5B9E;&#x73B0;&#x524D;&#x65E0;&#x6CD5;&#x8FDB;&#x884C;&#x3002;&#x6211;&#x4F1A;&#x5C3D;&#x5FEB;&#x5B9E;&#x73B0;&#x5176;&#x4ED6;&#x7EA7;&#x7684;&#x529F;&#x80FD;&#x90E8;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x7F16;&#x5199;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;&#xFF0C;&#x6765;&#x6D4B;&#x8BD5;CU&#x7684;&#x529F;&#x80FD;&#x662F;&#x5426;&#x8FBE;&#x6210;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;&#x3002;</p><h2 id="&#x5C0F;&#x7ED3;"><a href="#&#x5C0F;&#x7ED3;" class="headerlink" title="&#x5C0F;&#x7ED3;"></a>&#x5C0F;&#x7ED3;</h2><p>&#x5173;&#x4E8E;&#x6D41;&#x6C34;&#x7EBF;&#x7684;&#x63A7;&#x5236;&#x903B;&#x8F91;&#xFF0C;&#x6211;&#x786E;&#x5B9E;&#x82B1;&#x4E86;&#x5F88;&#x957F;&#x65F6;&#x95F4;&#x624D;&#x60F3;&#x901A;&#x3002;&#x8FD9;&#x4E5F;&#x518D;&#x6B21;&#x9A8C;&#x8BC1;&#x4E86;&#x5EF6;&#x65F6;&#x69FD;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x597D;&#x8BBE;&#x8BA1;&#xFF0C;&#x5982;&#x679C;&#x5F15;&#x5165;&#x5EF6;&#x65F6;&#x69FD;&#xFF0C;&#x6D41;&#x6C34;&#x7EBF;&#x7684;&#x63A7;&#x5236;&#x903B;&#x8F91;&#x4F1A;&#x53D8;&#x5F97;&#x66F4;&#x52A0;&#x590D;&#x6742;&#xFF0C;&#x662F;&#x5F15;&#x5165;&#x8D85;&#x6807;&#x91CF;&#x6D41;&#x6C34;&#x7684;&#x5DE8;&#x5927;&#x969C;&#x788D;&#x3002;&#x5728;&#x8BBE;&#x8BA1;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x6211;&#x4E5F;&#x8003;&#x8651;&#x5230;&#x4E86;&#x672A;&#x6765;&#x5BF9;&#x8D85;&#x6807;&#x91CF;&#x6D41;&#x6C34;&#x7EBF;&#x7684;&#x652F;&#x6301;&#x3002;&#x4F46;&#x662F;&#x8DEF;&#x8981;&#x4E00;&#x6B65;&#x4E00;&#x6B65;&#x8D70;&#xFF0C;&#x6211;&#x9700;&#x8981;&#x5148;&#x628A;&#x5F53;&#x524D;&#x7684;&#x76EE;&#x6807;&#x5B9E;&#x73B0;&#xFF0C;&#x79EF;&#x7D2F;&#x4E00;&#x5957;&#x81EA;&#x6D4B;&#x8BD5;&#x6D41;&#x7A0B;&#x548C;&#x65B9;&#x6CD5;&#xFF0C;&#x751A;&#x81F3;&#x5B9E;&#x73B0;&#x5DE5;&#x5177;&#x94FE;&#x7684;&#x79FB;&#x690D;&#xFF0C;&#x80FD;&#x591F;&#x65B9;&#x4FBF;&#x7684;&#x5728;&#x4FEE;&#x6539;&#x8BBE;&#x8BA1;&#x540E;&#x9A8C;&#x8BC1;&#x8BBE;&#x8BA1;&#x7684;&#x6B63;&#x786E;&#x6027;&#xFF0C;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x624D;&#x80FD;&#x53BB;&#x5B9E;&#x73B0;&#x5BC4;&#x5B58;&#x5668;&#x91CD;&#x547D;&#x540D;&#x7B49;&#x8D85;&#x6807;&#x91CF;&#x6D41;&#x6C34;&#x7EBF;&#x6280;&#x672F;&#x3002;</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&amp;#x63A7;&amp;#x5236;&amp;#x5355;&amp;#x5143;&amp;#x662F;&amp;#x6574;&amp;#x4E2A;CPU&amp;#x7684;&amp;#x6838;&amp;#x5FC3;&amp;#xFF0C;&amp;#x4ED6;&amp;#x63A7;&amp;#x5236;&amp;#x7740;CPU&amp;#x5185;&amp;#x</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Cache同步机制的设计实现和测试</title>
    <link href="https://gpthimble.github.io/Cache%E5%90%8C%E6%AD%A5%E6%9C%BA%E5%88%B6%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%AE%9E%E7%8E%B0%E5%92%8C%E6%B5%8B%E8%AF%95/"/>
    <id>https://gpthimble.github.io/Cache%E5%90%8C%E6%AD%A5%E6%9C%BA%E5%88%B6%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%AE%9E%E7%8E%B0%E5%92%8C%E6%B5%8B%E8%AF%95/</id>
    <published>2020-12-29T13:56:46.000Z</published>
    <updated>2020-12-29T16:43:01.744Z</updated>
    
    <content type="html"><![CDATA[<p>&#x4E0A;&#x7BC7;&#x6587;&#x7AE0;&#x8BE6;&#x7EC6;&#x63CF;&#x8FF0;&#x4E86;&#x7EC4;&#x76F8;&#x8054;cache&#x7684;&#x5B9E;&#x73B0;&#x548C;&#x6D4B;&#x8BD5;&#xFF0C;&#x6587;&#x4E2D;&#x5C0F;&#x7ED3;&#x4E5F;&#x63D0;&#x5230;&#x4E86;&#x6D4B;&#x8BD5;&#x6210;&#x529F;&#x540E;&#x7B14;&#x8005;&#x6709;&#x70B9;&#x5C0F;&#x81A8;&#x80C0;&#xFF0C;&#x60F3;&#x5B9E;&#x73B0;&#x66F4;&#x591A;&#x7684;&#x529F;&#x80FD;&#x3002;&#x672C;&#x7CFB;&#x7EDF;&#x5185;&#x4F7F;&#x7528;&#x7684;cache&#x548C;&#x603B;&#x7EBF;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#x6D4B;&#x8BD5;&#x4E00;&#x4E2A;&#x591A;&#x6708;&#xFF0C;&#x8FD9;&#x4E00;&#x4E2A;&#x591A;&#x6708;&#x91CC;&#xFF0C;&#x6211;&#x4E3B;&#x8981;&#x601D;&#x8003;&#x7684;&#x662F;&#x6D41;&#x6C34;&#x7EBF;&#x7684;&#x63A7;&#x5236;&#x95EE;&#x9898;&#x3002;&#x800C;&#x4E14;&#x6211;&#x786E;&#x5B9E;&#x81A8;&#x80C0;&#x4E86;&#xFF0C;&#x6211;&#x51C6;&#x5907;&#x4FEE;&#x6539;&#x6211;&#x7684;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;&#xFF0C;&#x5B9E;&#x73B0;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x548C;&#x786C;&#x4EF6;cache&#x540C;&#x6B65;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;&#x65E0;&#x7591;&#x4F7F;&#x5F97;&#x6D41;&#x6C34;&#x7EBF;&#x7684;&#x63A7;&#x5236;&#x53D8;&#x5F97;&#x590D;&#x6742;&#x3002;&#x56E0;&#x6B64;&#x6211;&#x5728;&#x8FD9;&#x4E00;&#x4E2A;&#x6708;&#x7684;&#x65F6;&#x95F4;&#x91CC;&#xFF0C;&#x8BE6;&#x7EC6;&#x5217;&#x4E3E;&#x4E86;&#x5728;&#x5F15;&#x5165;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x3001;cache&#x540C;&#x6B65;&#x3001;&#x5F02;&#x5E38;&#x548C;&#x4E2D;&#x65AD;&#x4EE5;&#x53CA;&#x591A;&#x5468;&#x671F;&#x6307;&#x4EE4;&#x548C;&#x5199;&#x540E;&#x8BFB;&#x51B2;&#x7A81;&#x540E;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x63A7;&#x5236;&#x95EE;&#x9898;&#xFF0C;&#x4E00;&#x8FB9;&#x601D;&#x8003;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x4E00;&#x8FB9;&#x521D;&#x6B65;&#x641E;&#x5B9A;&#x4E86;cache&#x540C;&#x6B65;&#x673A;&#x5236;&#x7684;&#x8BBE;&#x8BA1;&#x3002;</p><p>&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x4E3B;&#x8981;&#x63CF;&#x8FF0;Cache&#x540C;&#x6B65;&#x673A;&#x5236;&#x7684;&#x8BBE;&#x8BA1;&#x3002;</p><h2 id="&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x5F15;&#x5165;cache&#x540C;&#x6B65;&#x673A;&#x5236;&#xFF1F;"><a href="#&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x5F15;&#x5165;cache&#x540C;&#x6B65;&#x673A;&#x5236;&#xFF1F;" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x5F15;&#x5165;cache&#x540C;&#x6B65;&#x673A;&#x5236;&#xFF1F;"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x5F15;&#x5165;cache&#x540C;&#x6B65;&#x673A;&#x5236;&#xFF1F;</h2><p>&#x5F88;&#x591A;&#x4EBA;&#x8BA4;&#x4E3A;&#x5728;&#x6211;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x5355;&#x6838;&#x5FC3;&#x5355;&#x7EBF;&#x7A0B;&#x7684;&#x5904;&#x7406;&#x5668;&#x5185;&#x90E8;&#x662F;&#x4E0D;&#x9700;&#x8981;&#x5F15;&#x5165;cache&#x540C;&#x6B65;&#x673A;&#x5236;&#x7684;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x8FD9;&#x79CD;&#x8BF4;&#x6CD5;&#x662F;&#x9519;&#x8BEF;&#x7684;&#x3002;&#x6211;&#x5728;&#x4E0A;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#x5DF2;&#x7ECF;&#x63CF;&#x8FF0;&#x4E86;&#x5728;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x5904;&#x7406;&#x5668;&#x5F15;&#x5165;&#x540C;&#x6B65;&#x673A;&#x5236;&#x7684;&#x539F;&#x56E0;&#x4E3B;&#x8981;&#x662F;Memory Mapped IO &#x548C;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#xFF08;self-modified Code)&#x3002;&#x5BF9;&#x4E8E;Memory Mapped IO &#x4E0A;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#x6240;&#x63D0;&#x51FA;&#x7684;&#x7EC4;&#x76F8;&#x8054;Cache&#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x5DF2;&#x7ECF;&#x4F7F;&#x7528;&#x4E86;&#x4E00;&#x6BB5;&#x53EF;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x6765;&#x7ED5;&#x8FC7;Cache&#xFF0C;&#x5C06;&#x8FD9;&#x6BB5;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x7528;&#x4E8E;IO&#x5373;&#x53EF;&#x6EE1;&#x8DB3;IO&#x7684;cache&#x540C;&#x6B65;&#x95EE;&#x9898;&#x3002;&#x800C;&#x5BF9;&#x4E8E;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#xFF0C;&#x4E4B;&#x524D;&#x7684;&#x8BBE;&#x8BA1;&#x662F;&#x51C6;&#x5907;&#x5F15;&#x5165;&#x4E00;&#x4E9B;&#x63A7;&#x5236;cache&#x540C;&#x6B65;&#x548C;&#x6E05;&#x96F6;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x5C06;cache&#x540C;&#x6B65;&#x7684;&#x4EFB;&#x52A1;&#x4EA4;&#x7ED9;&#x7CFB;&#x7EDF;&#x7A0B;&#x5E8F;&#x5458;&#x3002;&#x663E;&#x7136;&#xFF0C;&#x8FD9;&#x79CD;&#x5904;&#x7406;&#x65B9;&#x6CD5;&#x53EA;&#x662F;&#x6743;&#x5B9C;&#x4E4B;&#x8BA1;&#x3002;&#x666E;&#x904D;&#x8BA4;&#x4E3A;&#xFF0C;&#x5C06;&#x7CFB;&#x7EDF;&#x7684;&#x5FAE;&#x67B6;&#x6784;&#x8FC7;&#x591A;&#x7684;&#x66B4;&#x9732;&#x7ED9;&#x7A0B;&#x5E8F;&#x5458;&#x662F;&#x4E00;&#x79CD;&#x5F88;&#x7CDF;&#x7CD5;&#x7684;&#x9009;&#x62E9;&#xFF0C;&#x6211;&#x81EA;&#x7136;&#x503E;&#x5411;&#x4E8E;&#x50CF;X86&#x4E00;&#x6837;&#x8BBE;&#x8BA1;&#x4E00;&#x5957;&#x5BF9;&#x540C;&#x6B65;&#x7684;&#x786C;&#x4EF6;&#x3002;<br>&#x672C;&#x5E73;&#x53F0;&#x4E2D;&#x7684;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x4F1A;&#x5728;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#x53D1;&#x751F;&#xFF1A;</p><ul><li>DMA</li><li>MEM&#x7EA7;&#x7684;store&#x6307;&#x4EE4;</li></ul><p>DMA&#x8BBE;&#x5907;&#x7ED5;&#x8FC7;&#x5904;&#x7406;&#x5668;&#x76F4;&#x63A5;&#x901A;&#x8FC7;&#x7CFB;&#x7EDF;&#x603B;&#x7EBF;&#x4FEE;&#x6539;&#x5185;&#x5B58;&#xFF0C;&#x5982;&#x679C;&#x4FEE;&#x6539;&#x7684;&#x5730;&#x5740;&#x6B63;&#x597D;&#x5728;cache&#x7684;&#x7F13;&#x5B58;&#x4E2D;&#xFF0C;&#x8FD9;&#x5C31;&#x4F1A;&#x5F15;&#x8D77;cache&#x7684;&#x540C;&#x6B65;&#x95EE;&#x9898;&#x3002;&#x53D1;&#x751F;&#x5728;MEM&#x7EA7;&#x7684;store X &#x6307;&#x4EE4;&#x4E5F;&#x662F;&#x5982;&#x6B64;&#xFF0C;&#x7A0B;&#x5E8F;&#x5458;&#x7F16;&#x5199;&#x7684;&#x7A0B;&#x5E8F;&#x6709;&#x53EF;&#x80FD;&#x901A;&#x8FC7;store&#x6307;&#x4EE4;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x6BB5;&#x5185;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x4F1A;&#x5F15;&#x8D77;cache&#x7684;&#x540C;&#x6B65;&#x95EE;&#x9898;&#x3002;</p><h2 id="&#x53D1;&#x751F;cache&#x540C;&#x6B65;&#x4E8B;&#x4EF6;&#x65F6;&#x5404;&#x4E8B;&#x4EF6;&#x7684;&#x987A;&#x5E8F;"><a href="#&#x53D1;&#x751F;cache&#x540C;&#x6B65;&#x4E8B;&#x4EF6;&#x65F6;&#x5404;&#x4E8B;&#x4EF6;&#x7684;&#x987A;&#x5E8F;" class="headerlink" title="&#x53D1;&#x751F;cache&#x540C;&#x6B65;&#x4E8B;&#x4EF6;&#x65F6;&#x5404;&#x4E8B;&#x4EF6;&#x7684;&#x987A;&#x5E8F;"></a>&#x53D1;&#x751F;cache&#x540C;&#x6B65;&#x4E8B;&#x4EF6;&#x65F6;&#x5404;&#x4E8B;&#x4EF6;&#x7684;&#x987A;&#x5E8F;</h2><p>&#x8981;&#x60F3;&#x5F04;&#x6E05;&#x695A;cache&#x7684;&#x540C;&#x6B65;&#x8FC7;&#x7A0B;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x660E;&#x786E;&#x5404;&#x79CD;&#x4E8B;&#x4EF6;&#x8C01;&#x5148;&#x8C01;&#x540E;&#x7684;&#x95EE;&#x9898;&#x3002;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x5341;&#x5206;&#x5173;&#x952E;&#xFF0C;&#x5B83;&#x51B3;&#x5B9A;&#x5904;&#x7406;&#x5668;&#x5728;cache&#x540C;&#x6B65;&#x53D1;&#x751F;&#x65F6;&#x7684;&#x884C;&#x4E3A;&#x3002;<br>&#x9996;&#x5148;&#x660E;&#x786E;&#x4E24;&#x79CD;&#x987A;&#x5E8F;&#xFF1A;&#x4E00;&#x662F;&#x7A0B;&#x5E8F;&#x5458;&#x6240;&#x5199;&#x7684;&#x4EE3;&#x7801;&#x7684;&#x987A;&#x5E8F;&#xFF0C;&#x6211;&#x5C06;&#x8FD9;&#x79CD;&#x987A;&#x5E8F;&#x5B9A;&#x4E49;&#x4E3A;&#x903B;&#x8F91;&#x987A;&#x5E8F;&#xFF1B;&#x4E8C;&#x662F;&#x603B;&#x7EBF;&#x4E0A;&#x8BF7;&#x6C42;&#x53D1;&#x751F;&#x7684;&#x987A;&#x5E8F;&#xFF0C;&#x6211;&#x5C06;&#x8FD9;&#x79CD;&#x987A;&#x5E8F;&#x5B9A;&#x4E49;&#x4E3A;&#x7269;&#x7406;&#x987A;&#x5E8F;&#x3002;&#x7136;&#x540E;&#x518D;&#x9488;&#x5BF9;&#x53D1;&#x751F;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x7684;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#x5206;&#x5F00;&#x8BA8;&#x8BBA;&#xFF0C;&#x4F55;&#x65F6;&#x9075;&#x4ECE;&#x903B;&#x8F91;&#x987A;&#x5E8F;&#x4F55;&#x65F6;&#x9075;&#x4ECE;&#x7269;&#x7406;&#x987A;&#x5E8F;&#x3002;</p><p>&#x5148;&#x8BF4;DMA&#x7684;&#x60C5;&#x51B5;&#x3002;DMA&#x4F55;&#x65F6;&#x4F1A;&#x53D1;&#x751F;&#x5462;&#xFF1F;&#x5728;&#x672C;&#x7CFB;&#x7EDF;&#x5185;&#xFF0C;&#x7CFB;&#x7EDF;&#x603B;&#x7EBF;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x7531;&#x603B;&#x7EBF;&#x63A7;&#x5236;&#x5668;&#x4E0A;DMA0-7&#x7684;&#x987A;&#x5E8F;&#x51B3;&#x5B9A;&#xFF0C;I cache&#x63A5;&#x5728;DMA0&#xFF0C;&#x6709;&#x6700;&#x9AD8;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#xFF0C;D cache&#x63A5;&#x5728;DMA1&#xFF0C;&#x4F18;&#x5148;&#x7EA7;&#x6B21;&#x4E4B;&#xFF0C;&#x7136;&#x540E;&#x624D;&#x662F;&#x5404;&#x79CD;DMA&#x8BBE;&#x5907;&#x3002;&#x56E0;&#x6B64;DMA&#x8BBE;&#x5907;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x6559;&#x4E24;&#x4E2A;cache&#x8981;&#x4F4E;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;DMA&#x8BF7;&#x6C42;&#x53EA;&#x6709;&#x5728;&#x4E24;&#x7EC4;cache&#x5747;&#x547D;&#x4E2D;&#x65F6;&#x624D;&#x80FD;&#x62A2;&#x5360;&#x603B;&#x7EBF;&#x4E0E;&#x5185;&#x5B58;&#x901A;&#x8BAF;&#x3002;&#x56E0;&#x6B64;DMA&#x8BF7;&#x6C42;&#x53D1;&#x751F;&#x7684;&#x65F6;&#x673A;&#x5B9E;&#x9645;&#x4E0A;&#x5F88;&#x96BE;&#x53BB;&#x63A8;&#x65AD;&#xFF0C;&#x5F88;&#x96BE;&#x5206;&#x6790;&#x7CFB;&#x7EDF;&#x603B;&#x7EBF;&#x4F55;&#x65F6;&#x4F1A;&#x7A7A;&#x95F2;&#x80FD;&#x591F;&#x8BA9;DMA&#x8BBE;&#x5907;&#x5360;&#x7528;&#xFF0C;&#x8FD9;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x6211;&#x4EEC;&#x65E0;&#x6CD5;&#x786E;&#x5B9A;DMA&#x8BF7;&#x6C42;&#x4E0E;&#x5F53;&#x524D;cache&#x4E2D;&#x7684;&#x8BF7;&#x6C42;&#x4E4B;&#x95F4;&#x7684;&#x903B;&#x8F91;&#x987A;&#x5E8F;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x7CFB;&#x7EDF;&#x5728;&#x5904;&#x7406;DMA&#x8BF7;&#x6C42;&#x5F15;&#x8D77;&#x7684;cache&#x540C;&#x6B65;&#x65F6;&#xFF0C;&#x9075;&#x4ECE;&#x7684;&#x65F6;&#x7269;&#x7406;&#x987A;&#x5E8F;&#xFF0C;&#x53EA;&#x8981;&#x76D1;&#x542C;&#x5230;&#x603B;&#x7EBF;&#x4E0A;&#x6709;&#x6765;&#x81EA;&#x5176;&#x4ED6;&#x8BBE;&#x5907;&#x7684;&#x5199;&#x8BF7;&#x6C42;&#xFF0C;&#x5C31;&#x81EA;&#x52A8;&#x8FDB;&#x884C;&#x540C;&#x6B65;&#xFF0C;&#x5728;&#x7269;&#x7406;&#x987A;&#x5E8F;&#x4E0A;&#x4FDD;&#x8BC1;&#x4ECE;cache&#x4E2D;&#x53D6;&#x51FA;&#x7684;&#x6570;&#x636E;&#x65F6;&#x6700;&#x65B0;&#x7684;&#x3002;<br>&#x518D;&#x8BF4;&#x8BF4;&#x7531;Store X&#x6307;&#x4EE4;&#x5F15;&#x8D77;&#x7684;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x3002;&#x5728;&#x672C;&#x7CFB;&#x7EDF;&#x5185;&#xFF0C;&#x6709;&#x4E00;&#x6761;5&#x7EA7;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#xFF0C;MEM&#x7EA7;&#x5728;&#x6D41;&#x6C34;&#x7EBF;&#x66F4;&#x6DF1;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x8FD9;&#x5C31;&#x610F;&#x5473;&#x7740;&#x5F53;MEM&#x7EA7;&#x6267;&#x884C;&#x7740;&#x7684;store&#x6307;&#x4EE4;&#x5F15;&#x8D77;&#x4E86;I cache&#x7684;&#x540C;&#x6B65;&#xFF0C;&#x82E5;I cache&#x4E2D;&#x6B63;&#x5728;&#x53D6;&#x8FD9;&#x4E2A;&#x5730;&#x5740;&#x4E0A;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x8FD9;&#x4E2A;&#x6307;&#x4EE4;&#x903B;&#x8F91;&#x4E0A;&#x5E94;&#x8BE5;&#x5728;store&#x6307;&#x4EE4;&#x5B8C;&#x6210;&#x540E;&#x518D;&#x88AB;&#x9884;&#x53D6;&#x3002;&#x56E0;&#x6B64;&#x5BF9;&#x4E8E;&#x7531;store&#x6307;&#x4EE4;&#x5F15;&#x8D77;&#x7684;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#xFF0C;&#x672C;&#x7CFB;&#x7EDF;&#x9075;&#x4ECE;&#x903B;&#x8F91;&#x987A;&#x5E8F;&#xFF0C;&#x5373;&#x4FDD;&#x8BC1;&#x53D1;&#x751F;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x65F6;&#xFF0C;I cache&#x4E2D;&#x53D6;&#x51FA;&#x7684;&#x6307;&#x4EE4;&#x662F;Store&#x6307;&#x4EE4;&#x65B0;&#x5B58;&#x5165;&#x7684;&#x6307;&#x4EE4;&#x3002;</p><h2 id="cache&#x540C;&#x6B65;&#x4E0E;&#x5176;&#x4ED6;&#x6D41;&#x6C34;&#x7EBF;&#x63A7;&#x5236;&#x4E8B;&#x4EF6;&#x540C;&#x65F6;&#x53D1;&#x751F;"><a href="#cache&#x540C;&#x6B65;&#x4E0E;&#x5176;&#x4ED6;&#x6D41;&#x6C34;&#x7EBF;&#x63A7;&#x5236;&#x4E8B;&#x4EF6;&#x540C;&#x65F6;&#x53D1;&#x751F;" class="headerlink" title="cache&#x540C;&#x6B65;&#x4E0E;&#x5176;&#x4ED6;&#x6D41;&#x6C34;&#x7EBF;&#x63A7;&#x5236;&#x4E8B;&#x4EF6;&#x540C;&#x65F6;&#x53D1;&#x751F;"></a>cache&#x540C;&#x6B65;&#x4E0E;&#x5176;&#x4ED6;&#x6D41;&#x6C34;&#x7EBF;&#x63A7;&#x5236;&#x4E8B;&#x4EF6;&#x540C;&#x65F6;&#x53D1;&#x751F;</h2><p>&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x662F;&#x6211;&#x8FD9;&#x4E00;&#x4E2A;&#x591A;&#x6708;&#x7740;&#x91CD;&#x601D;&#x8003;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5728;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x91CC;&#x6211;&#x5148;&#x8BF4;&#x4E00;&#x4E0B;&#x5728;IF&#x6307;&#x4EE4;&#x9884;&#x53D6;&#x8FD9;&#x4E2A;&#x9636;&#x6BB5;&#x53EF;&#x80FD;&#x540C;&#x65F6;&#x53D1;&#x751F;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x63A7;&#x5236;&#x4E8B;&#x4EF6;&#x4EE5;&#x53CA;&#x5904;&#x7406;&#x65B9;&#x6CD5;&#x3002;<br>IF&#x7EA7;&#x53EF;&#x80FD;&#x53D1;&#x751F;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5931;&#x8D25;&#x3001;IF&#x7EA7;&#x5F02;&#x5E38;&#xFF08;&#x5982;TLB&#x3001;&#x5730;&#x5740;&#x9519;&#x8BEF;&#xFF09;&#x3001;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x3002;&#x4ED6;&#x4EEC;&#x5982;&#x679C;&#x540C;&#x65F6;&#x53D1;&#x751F;&#xFF0C;&#x4F18;&#x5148;&#x7EA7;&#x5982;&#x4F55;&#x786E;&#x5B9A;&#xFF0C;&#x8C01;&#x5FC5;&#x987B;&#x5148;&#x5904;&#x7406;&#xFF1F;<br>&#x7ECF;&#x8FC7;&#x7F1C;&#x5BC6;&#x7684;&#x601D;&#x8003;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x63D0;&#x51FA;&#x5728;&#x5904;&#x7406;&#x6D41;&#x6C34;&#x7EBF;&#x63A7;&#x5236;&#x4E8B;&#x4EF6;&#x65F6;&#x7684;&#x4E24;&#x6761;&#x539F;&#x5219;:</p><ol><li>&#x7EDD;&#x5BF9;&#x4E0D;&#x80FD;&#x4E22;&#x5931;&#x6B63;&#x786E;&#x7684;&#x5904;&#x7406;&#x987A;&#x5E8F;</li><li>&#x5F02;&#x5E38;&#x4E0D;&#x80FD;&#x88AB;&#x9519;&#x8FC7;</li></ol><p>&#x5F02;&#x5E38;&#x4F1A;&#x4FDD;&#x5B58;&#x5F53;&#x524D;&#x5F15;&#x8D77;&#x5F02;&#x5E38;&#x7684;&#x6307;&#x4EE4;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x5E76;&#x8DF3;&#x8F6C;&#x81F3;base&#xFF1B;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5931;&#x8D25;&#x9700;&#x8981;&#x8DF3;&#x8F6C;&#x81F3;&#x6B63;&#x786E;&#x7684;&#x76EE;&#x6807;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x4FDD;&#x5B58;&#x5730;&#x5740;&#xFF1B;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#xFF08;SMC&#xFF09;&#x5219;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x8BFB;&#x53D6;&#x5F53;&#x524D;&#x5730;&#x5740;&#xFF0C;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x4FDD;&#x5B58;&#x5730;&#x5740;&#x3002;&#x4E0B;&#x9762;&#x5206;&#x6790;&#x4ED6;&#x4EEC;&#x4E09;&#x4E2A;&#x4E4B;&#x95F4;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x3002;&#x5BF9;&#x4E8E;&#x7B2C;&#x4E00;&#x6761;&#x539F;&#x5219;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x505A;&#x5230;&#x65E0;&#x8BBA;&#x600E;&#x4E48;&#x53BB;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x4E8B;&#x4EF6;&#xFF0C;&#x90FD;&#x8981;&#x4FDD;&#x8BC1;&#x6B63;&#x786E;&#x7684;&#x5904;&#x7406;&#x987A;&#x5E8F;&#x4E0D;&#x88AB;&#x4E22;&#x5931;&#xFF0C;&#x4F8B;&#x5982;&#x5982;&#x679C;&#x5728;&#x5F02;&#x5E38;&#x548C;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5931;&#x8D25;&#x540C;&#x65F6;&#x53D1;&#x751F;&#x65F6;&#xFF0C;&#x9009;&#x62E9;&#x5904;&#x7406;&#x5F02;&#x5E38;&#xFF0C;&#x7531;&#x4E8E;&#x5F53;&#x524D;&#x7684;&#x5F02;&#x5E38;&#x5E76;&#x4E0D;&#x662F;&#x6B63;&#x786E;&#x7684;&#x5C06;&#x8981;&#x5904;&#x7406;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x56E0;&#x6B64;&#x5904;&#x7406;&#x5F02;&#x5E38;&#x4F1A;&#x4E22;&#x5931;&#x5F53;&#x524D;ID&#x7EA7;&#x6B63;&#x5728;&#x6267;&#x884C;&#x7684;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x4EA7;&#x751F;&#x7684;&#x6B63;&#x786E;&#x7684;&#x8DF3;&#x8F6C;&#x76EE;&#x6807;&#xFF0C;&#x8FD9;&#x5E94;&#x8BE5;&#x662F;&#x4E0D;&#x5141;&#x8BB8;&#x7684;&#x3002;&#x5BF9;&#x4E8E;&#x7B2C;&#x4E8C;&#x6761;&#x539F;&#x5219;&#xFF0C;&#x7531;&#x4E8E;&#x5904;&#x7406;&#x5668;&#x4F1A;&#x6682;&#x505C;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5199;&#x540E;&#x8BFB;&#x548C;&#x591A;&#x5468;&#x671F;&#x4F1A;&#x53EA;&#x6682;&#x505C;IF&#x548C;ID&#x7EA7;&#xFF0C;&#x8981;&#x4FDD;&#x8BC1;&#x5728;&#x5904;&#x7406;&#x5668;&#x6682;&#x505C;&#x65F6;&#xFF0C;&#x5176;&#x4ED6;&#x5F02;&#x5E38;&#x4E0D;&#x80FD;&#x88AB;&#x9519;&#x8FC7;&#xFF0C;&#x5C31;&#x8981;&#x4FDD;&#x8BC1;&#x5F02;&#x5E38;&#x53EA;&#x548C;&#x6D41;&#x6C34;&#x7EBF;&#x5BC4;&#x5B58;&#x5668;&#x6709;&#x5173;&#xFF0C;&#x5F53;&#x6D41;&#x6C34;&#x7EBF;&#x5BC4;&#x5B58;&#x5668;&#x53D8;&#x5316;&#x65F6;&#xFF0C;&#x5404;&#x79CD;&#x5F02;&#x5E38;&#x4FE1;&#x53F7;&#x53D8;&#x5316;&#xFF0C;&#x5F53;&#x6D41;&#x6C34;&#x7EBF;&#x5BC4;&#x5B58;&#x5668;&#x4E0D;&#x53D8;&#x65F6;&#xFF0C;&#x5404;&#x79CD;&#x5F02;&#x5E38;&#x4FE1;&#x53F7;&#x4FDD;&#x6301;&#x3002;<br>&#x6839;&#x636E;&#x8FD9;&#x4E24;&#x6761;&#x539F;&#x5219;&#xFF0C;&#x6211;&#x786E;&#x5B9A;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5931;&#x8D25;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x6700;&#x9AD8;&#xFF0C;&#x5F53;&#x4ED6;&#x53D1;&#x751F;&#x65F6;&#xFF0C;npc&#x8BBE;&#x7F6E;&#x4E3A;&#x6B63;&#x786E;&#x7684;&#x8DF3;&#x8F6C;&#x76EE;&#x6807;&#xFF0C;&#x4E0D;&#x4FDD;&#x5B58;EPC&#xFF0C;&#x64A4;&#x9500;&#x5F53;&#x524D;IF&#x3002;EXC&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x7D27;&#x968F;&#x5176;&#x540E;&#xFF0C;npc&#x8BBE;&#x7F6E;&#x4E3A;base&#xFF0C;&#x4FDD;&#x5B58;EPC&#x5E76;&#x64A4;&#x9500;&#x5F53;&#x524D;IF&#x3002;SMC&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x6700;&#x5C0F;&#xFF0C;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x524D;&#x4E24;&#x8005;&#x53D1;&#x751F;&#x65F6;&#xFF0C;IF&#x7EA7;&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x4F1A;&#x88AB;&#x5E9F;&#x5F03;&#xFF0C;cache&#x7684;&#x540C;&#x6B65;&#x5728;cache&#x5185;&#x90E8;&#x81EA;&#x52A8;&#x8FDB;&#x884C;&#x3002;</p><p>&#x672C;&#x5E73;&#x53F0;&#x4F7F;&#x7528;&#x7684;&#x603B;&#x7EBF;&#x63A7;&#x5236;&#x5668;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x7684;&#x88C5;&#x7F6E;&#xFF0C;&#x5176;&#x5185;&#x90E8;&#x7684;&#x72B6;&#x6001;&#x673A;&#x4E5F;&#x5341;&#x5206;&#x7B80;&#x5355;&#xFF0C;&#x5E76;&#x4E0D;&#x80FD;&#x5B9E;&#x73B0;&#x64A4;&#x9500;&#x5DF2;&#x7ECF;&#x5411;&#x603B;&#x7EBF;&#x4E0A;&#x7684;&#x8BBE;&#x5907;&#x53D1;&#x9001;&#x7684;&#x8BF7;&#x6C42;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x56E0;&#x6B64;&#x8981;&#x60F3;&#x5B9E;&#x73B0;&#x8FD9;&#x4E9B;&#x4F18;&#x5148;&#x7EA7;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x8981;&#x5728;cache&#x540C;&#x6B65;&#x673A;&#x5236;&#x4E2D;&#x589E;&#x52A0;&#x6B63;&#x786E;&#x7684;&#x64A4;&#x9500;&#x673A;&#x5236;&#xFF0C;&#x4FDD;&#x8BC1;&#x5DF2;&#x7ECF;&#x9001;&#x51FA;&#x7684;&#x8BF7;&#x6C42;&#x4E0D;&#x88AB;&#x64A4;&#x9500;&#xFF0C;&#x7B49;&#x5F85;&#x5176;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x3002;</p><h2 id="cache&#x540C;&#x6B65;&#x673A;&#x5236;&#x7684;&#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;"><a href="#cache&#x540C;&#x6B65;&#x673A;&#x5236;&#x7684;&#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;" class="headerlink" title="cache&#x540C;&#x6B65;&#x673A;&#x5236;&#x7684;&#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;"></a>cache&#x540C;&#x6B65;&#x673A;&#x5236;&#x7684;&#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;</h2><h3 id="&#x540C;&#x6B65;&#x673A;&#x5236;"><a href="#&#x540C;&#x6B65;&#x673A;&#x5236;" class="headerlink" title="&#x540C;&#x6B65;&#x673A;&#x5236;"></a>&#x540C;&#x6B65;&#x673A;&#x5236;</h3><p>&#x540C;&#x6B65;&#x673A;&#x5236;&#x662F;&#x7531;&#x603B;&#x7EBF;&#x76D1;&#x542C;&#x5B8C;&#x6210;&#x7684;&#x3002;<br>&#x9996;&#x5148;&#xFF0C;&#x5F15;&#x5165;&#x4E00;&#x7EC4;&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x6301;&#x7EED;&#x4E0D;&#x65AD;&#x5730;&#x76D1;&#x542C;&#x603B;&#x7EBF;&#x4E0A;&#x7684;&#x5199;&#x8BF7;&#x6C42;&#x3002;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x7279;&#x6B8A;&#x8BF4;&#x660E;&#x7684;&#x662F;&#xFF0C;&#x9664;&#x4E86;&#x8981;&#x76D1;&#x542C;&#x5199;&#x8BF7;&#x6C42;&#xFF0C;&#x8FD8;&#x8981;&#x76D1;&#x542C;&#x81EA;&#x5DF1;&#x7684;&#x603B;&#x7EBF;&#x5141;&#x8BB8;&#x4FE1;&#x53F7;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x5C06;&#x81EA;&#x5DF1;&#x7684;&#x8BF7;&#x6C42;&#x6392;&#x9664;&#x5728;&#x5916;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x5728;&#x76D1;&#x542C;&#x65F6;&#x6392;&#x9664;&#x81EA;&#x5DF1;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x5C31;&#x4F1A;&#x4F7F;&#x7CFB;&#x7EDF;&#x9677;&#x5165;&#x81EA;&#x5DF1;&#x7684;&#x5199;&#x8BF7;&#x6C42;&#xFF0C;&#x9700;&#x8981;&#x540C;&#x6B65;&#xFF0C;&#x53C8;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x5199;&#x8BF7;&#x6C42;&#xFF0C;&#x53C8;&#x9700;&#x8981;&#x540C;&#x6B65;&#x2026;&#x2026;&#x8FD9;&#x6837;&#x7684;&#x6B7B;&#x5FAA;&#x73AF;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//BUS_addr_reg registered the address bus</span></span><br><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] BUS_addr_reg;</span><br><span class="line"><span class="hljs-comment">//BUS_RW_reg registered the write request of the BUS.</span></span><br><span class="line"><span class="hljs-comment">//BUS_grant_reg registered the grant signal for this cache. It is used to identify </span></span><br><span class="line"><span class="hljs-comment">//whether the currently monitored bus request is issued by itself. The bus request </span></span><br><span class="line"><span class="hljs-comment">//issued by itself does not need to be monitored. </span></span><br><span class="line"><span class="hljs-keyword">reg</span> BUS_RW_reg, BUS_grant_reg;</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x4E9B;&#x5BC4;&#x5B58;&#x5668;&#x5728;clr&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#x65F6;&#x6E05;&#x96F6;&#xFF0C;&#x65E0;&#x89C6;&#x7CFB;&#x7EDF;&#x7684;stall&#x4FE1;&#x53F7;&#xFF0C;&#x5728;&#x6BCF;&#x4E2A;&#x65F6;&#x949F;&#x4E0A;&#x8FB9;&#x6CBF;&#x5BC4;&#x5B58;&#x603B;&#x7EBF;&#x4E0A;&#x7684;&#x8BF7;&#x6C42;&#x3002;&#x8FD9;&#x610F;&#x5473;&#x7740;cache&#x5BF9;&#x603B;&#x7EBF;&#x7684;&#x76D1;&#x542C;&#x6301;&#x7EED;&#x4E0D;&#x65AD;&#xFF0C;cache&#x5185;&#x90E8;&#x7684;&#x66F4;&#x65B0;&#x6301;&#x7EED;&#x4E0D;&#x65AD;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">always</span> @ (<span class="hljs-keyword">posedge</span> clk)</span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (clr)</span><br><span class="line">        <span class="hljs-keyword">begin</span></span><br><span class="line">            BUS_addr_reg &lt;= <span class="hljs-number">32&apos;b0</span>;</span><br><span class="line">            BUS_RW_reg   &lt;= <span class="hljs-number">0</span>;</span><br><span class="line">            BUS_grant_reg&lt;= <span class="hljs-number">0</span>;</span><br><span class="line">        <span class="hljs-keyword">end</span></span><br><span class="line">    <span class="hljs-keyword">else</span>    </span><br><span class="line">        <span class="hljs-keyword">begin</span></span><br><span class="line">            BUS_addr_reg &lt;= BUS_addr;</span><br><span class="line">            BUS_RW_reg   &lt;= BUS_RW;</span><br><span class="line">            BUS_grant_reg&lt;= BUS_grant;</span><br><span class="line">        <span class="hljs-keyword">end</span></span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#xFF0C;&#x4ECE;&#x76D1;&#x542C;&#x5F97;&#x7684;&#x603B;&#x7EBF;&#x5730;&#x5740;&#x4E2D;&#x5207;&#x7247;&#x51FA;&#x7D22;&#x5F15;&#x548C;&#x6807;&#x7B7E;&#xFF0C;&#x4F9B;&#x6BD4;&#x5BF9;&#x4F7F;&#x7528;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//sync index from the BUS or BUS register</span></span><br><span class="line"><span class="hljs-keyword">wire</span> [INDEX-<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] index_sync = BUS_addr [INDEX+<span class="hljs-number">1</span> : <span class="hljs-number">2</span>];</span><br><span class="line"><span class="hljs-keyword">wire</span> [INDEX-<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] index_sync_reg = BUS_addr_reg [INDEX+<span class="hljs-number">1</span> : <span class="hljs-number">2</span>];</span><br><span class="line"><span class="hljs-comment">//sync tag from the BUS or BUS register</span></span><br><span class="line"><span class="hljs-keyword">wire</span> [tag_size-<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] tag_sync = BUS_addr [<span class="hljs-number">31</span>:INDEX+<span class="hljs-number">2</span>];</span><br><span class="line"><span class="hljs-keyword">wire</span> [tag_size-<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] tag_sync_reg = BUS_addr_reg[<span class="hljs-number">31</span>:INDEX+<span class="hljs-number">2</span>];</span><br></pre></td></tr></table></figure><p>&#x63A5;&#x4E0B;&#x6765;&#x9700;&#x8981;&#x4FEE;&#x6539;TAG&#xFF0C;&#x4E3A;TAG&#x589E;&#x52A0;&#x4E00;&#x4E2A;&#x8BFB;&#x63A5;&#x53E3;&#xFF0C;&#x548C;&#x603B;&#x7EBF;&#x4E0A;&#x76D1;&#x542C;&#x5F97;&#x7684;&#x8BF7;&#x6C42;&#x5BF9;&#x6BD4;&#xFF0C;&#x5224;&#x65AD;&#x5F53;&#x524D;&#x5730;&#x5740;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x5728;cache&#x4E2D;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//Out put registers for bus sniffing.</span></span><br><span class="line"><span class="hljs-keyword">reg</span> [tag_size-<span class="hljs-number">1</span> : <span class="hljs-number">0</span>] TAG_A_sync_out, TAG_B_sync_out;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//Memory for TAG_A.</span></span><br><span class="line"><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk)</span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (WE_A) </span><br><span class="line">        TAG_A [index_reg] = tag_reg;</span><br><span class="line">    <span class="hljs-comment">//This is a registered read out. since the index can change according to the</span></span><br><span class="line">    <span class="hljs-comment">//state of CPU, use a continuous read (assign statement) could cause a </span></span><br><span class="line">    <span class="hljs-comment">//combinational logic loop from CPU_stall to ready.    </span></span><br><span class="line">    <span class="hljs-comment">//if read and write at same time, get the new value.</span></span><br><span class="line">    TAG_A_out = TAG_A [index];</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//read for cache sync is index by the bus directly</span></span><br><span class="line">    TAG_A_sync_out = TAG_A [index_sync];</span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x503C;&#x5F97;&#x8BF4;&#x660E;&#x7684;&#x662F;&#xFF0C;&#x5BF9;&#x4E8E;TAG_X_sync_out&#x6240;&#x4F7F;&#x7528;&#x7684;&#x7D22;&#x5F15;&#x662F;&#x76F4;&#x63A5;&#x4ECE;&#x603B;&#x7EBF;&#x7684;&#x5730;&#x5740;&#x7EBF;&#x4E0A;&#x63A5;&#x8FC7;&#x6765;&#x7684;&#x800C;&#x4E0D;&#x662F;&#x76D1;&#x542C;&#x5BC4;&#x5B58;&#x5668;&#x4E2D;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x539F;&#x56E0;&#x662F;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x8FC7;&#x7684;&#xFF0C;altera FPGA&#x677F;&#x8F7D;&#x7684;&#x5B58;&#x50A8;&#x63A5;&#x53E3;&#x4E0A;&#x7531;&#x5185;&#x7F6E;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BBE;&#x8BA1;&#x4F7F;&#x5F97;&#x5728;&#x65F6;&#x949F;&#x4E0A;&#x5347;&#x6CBF;&#x5230;&#x8FBE;&#x540E;&#xFF0C;TAG_X_sync_out&#x4E2D;&#x6240;&#x4FDD;&#x5B58;&#x7684;&#x6807;&#x7B7E;&#x548C;&#x76D1;&#x542C;&#x5BC4;&#x5B58;&#x5668;&#x4E2D;&#x4FDD;&#x5B58;&#x7684;&#x6807;&#x7B7E;&#x5BF9;&#x5E94;&#x7740;&#x540C;&#x4E00;&#x65F6;&#x523B;&#x3002;</p><p>&#x5728;&#x83B7;&#x5F97;&#x76D1;&#x542C;&#x7ED3;&#x679C;&#x540E;&#xFF0C;&#x5C31;&#x8981;&#x8FDB;&#x884C;&#x6BD4;&#x5BF9;&#xFF0C;&#x5224;&#x65AD;&#x603B;&#x7EBF;&#x4E0A;&#x7684;&#x5199;&#x8BF7;&#x6C42;&#x662F;&#x5426;&#x5B58;&#x5728;&#x4E8E;cache&#x5185;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//cache_sync signal is HIGH when the sniffed request from the bus is cached. </span></span><br><span class="line"><span class="hljs-keyword">wire</span> cache_sync_A, cache_sync_B;</span><br><span class="line"><span class="hljs-comment">//~BUS_grant_reg means that we don&apos;t sync the request that issued by itself</span></span><br><span class="line"><span class="hljs-comment">//BUS_RW_reg means that we only sync the write request</span></span><br><span class="line"><span class="hljs-comment">//(tag_sync_reg == TAG_A_sync_out) means that the sync mechanism is active when</span></span><br><span class="line"><span class="hljs-comment">//the sniffed request is cached. </span></span><br><span class="line"><span class="hljs-keyword">assign</span> cache_sync_A = ~BUS_grant_reg &amp; BUS_RW_reg &amp; (tag_sync_reg == TAG_A_sync_out);</span><br><span class="line"><span class="hljs-keyword">assign</span> cache_sync_B = ~BUS_grant_reg &amp; BUS_RW_reg &amp; (tag_sync_reg == TAG_B_sync_out);</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;&#x540C;&#x6B65;&#x4FE1;&#x53F7;cache_sync_X&#x4F7F;&#x7528;&#x4E86;&#x524D;&#x9762;&#x6240;&#x8BF4;&#xFF0C;&#x53EA;&#x5728;&#x6709;&#x5176;&#x4ED6;&#x8BBE;&#x5907;&#x7684;&#x5199;&#x5165;&#x8BF7;&#x6C42;&#x5B58;&#x5728;&#x5728;cache&#x4E2D;&#x65F6;&#x4EA7;&#x751F;&#x9AD8;&#x7535;&#x5E73;&#x3002;</p><p>&#x5982;&#x679C;&#x67D0;&#x4E00;&#x7EC4;&#x540C;&#x6B65;&#x4FE1;&#x53F7;&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#xFF0C;&#x610F;&#x5473;&#x7740;cache&#x5C06;&#x5728;&#x4E0B;&#x4E2A;&#x65F6;&#x949F;&#x4E0A;&#x8FB9;&#x6CBF;&#x5230;&#x6765;&#x65F6;&#x6E05;&#x96F6;&#x5BF9;&#x5E94;&#x7684;valid bit&#x3002;<br>&#x90A3;&#x4E48;&#x5982;&#x679C;&#x5F53;&#x524D;&#x76D1;&#x542C;&#x5230;&#x7684;&#x8BF7;&#x6C42;&#x548C;&#x5F53;&#x524D;cache&#x7684;&#x8BF7;&#x6C42;&#x65F6;&#x540C;&#x4E00;&#x5730;&#x5740;&#xFF0C;&#x6E05;&#x96F6;&#x5BF9;&#x5E94;&#x7684;valid bit&#x8981;&#x5728;&#x4E0B;&#x4E00;&#x4E2A;&#x65F6;&#x949F;&#x4E0A;&#x8FB9;&#x6CBF;&#x5230;&#x6765;&#x65F6;&#x624D;&#x53D1;&#x751F;&#xFF0C;&#x6B64;&#x65F6;&#x5982;&#x679C;cache&#x547D;&#x4E2D;&#x600E;&#x4E48;&#x529E;&#xFF1F;&#x8FD9;&#x65F6;&#x6211;&#x4EEC;&#x4F9D;&#x636E;&#x4E0A;&#x4E00;&#x8282;&#x5BF9;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x4E8B;&#x4EF6;&#x7684;&#x987A;&#x5E8F;&#x7684;&#x8BA8;&#x8BBA;&#xFF0C;&#x786E;&#x5B9A;&#x8FD9;&#x5957;&#x673A;&#x5236;&#x7684;&#x884C;&#x4E3A;&#x3002;&#x5982;&#x679C;&#x76D1;&#x542C;&#x5230;&#x7684;&#x8BF7;&#x6C42;&#x662F;&#x67D0;&#x4E00;DMA&#x8BBE;&#x5907;&#x53D1;&#x6765;&#x7684;&#xFF0C;&#x5219;&#x6211;&#x4EEC;&#x5E94;&#x5F53;&#x4F9D;&#x7167;&#x7269;&#x7406;&#x987A;&#x5E8F;&#xFF0C;&#x8BA4;&#x4E3A;&#x5F53;&#x524D;&#x7684;cache&#x7684;&#x8BF7;&#x6C42;&#x53D1;&#x751F;&#x5728;DMA&#x8BF7;&#x6C42;&#x4E4B;&#x540E;&#xFF0C;&#x5373;&#x5E94;&#x5F53;&#x5C4F;&#x853D;&#x6389;&#x5F53;&#x524D;&#x7684;cache&#x547D;&#x4E2D;&#x4FE1;&#x53F7;&#xFF0C;&#x4FDD;&#x8BC1;cache&#x8BFB;&#x51FA;&#x7684;&#x662F;&#x65B0;&#x5185;&#x5BB9;&#xFF1B;&#x5982;&#x679C;&#x76D1;&#x542C;&#x5230;&#x7684;&#x8BF7;&#x6C42;&#x65F6;D cache&#x53D1;&#x51FA;&#x7684;&#x5199;&#x8BF7;&#x6C42;&#xFF0C;&#x5219;&#x6211;&#x4EEC;&#x5E94;&#x5F53;&#x4F9D;&#x7167;&#x903B;&#x8F91;&#x987A;&#x5E8F;&#xFF0C;&#x8BA4;&#x4E3A;&#x5F53;&#x524D;&#x7684;cache&#x8BF7;&#x6C42;&#x53D1;&#x751F;&#x5728;&#x76D1;&#x542C;&#x5230;&#x7684;&#x5199;&#x8BF7;&#x6C42;&#x4E4B;&#x540E;&#xFF0C;&#x5373;&#x4E5F;&#x5E94;&#x5F53;&#x5C4F;&#x853D;&#x6389;&#x5F53;&#x524D;&#x7684;cache&#x547D;&#x4E2D;&#x4FE1;&#x53F7;&#xFF0C;&#x4FDD;&#x8BC1;cache&#x8BFB;&#x51FA;&#x7684;&#x662F;&#x65B0;&#x5185;&#x5BB9;&#x3002;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#x7684;&#x5904;&#x7406;&#x65B9;&#x6CD5;&#x4E00;&#x81F4;&#xFF0C;&#x8FD9;&#x662F;&#x5DE7;&#x5408;&#x5417;&#xFF1F;&#x8FD9;&#x4E0E;&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x6240;&#x5B9A;&#x7684;&#x539F;&#x5219;&#x6709;&#x5173;&#xFF0C;&#x90A3;&#x4E24;&#x6761;&#x539F;&#x5219;&#x786E;&#x5B9A;&#x4E86;&#x8FD9;&#x6837;&#x7684;&#x884C;&#x4E3A;&#x3002;<br>&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x8981;&#x6309;&#x7167;&#x4E24;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x60C5;&#x51B5;&#x4EA7;&#x751F;&#x5BF9;&#x5E94;&#x7684;valid bit&#x6E05;&#x96F6;&#x4FE1;&#x53F7;&#xFF1A;</p><ol><li>&#x76D1;&#x542C;&#x5230;&#x7684;&#x8BF7;&#x6C42;&#x4E0E;&#x5F53;&#x524D;cache&#x7684;&#x8BF7;&#x6C42;&#x662F;&#x4E0D;&#x540C;&#x5730;&#x5740;</li><li>&#x76D1;&#x542C;&#x5230;&#x7684;&#x8BF7;&#x6C42;&#x4E0E;&#x5F53;&#x524D;cache&#x7684;&#x8BF7;&#x6C42;&#x662F;&#x76F8;&#x540C;&#x5730;&#x5740;&#x4E14;cache&#x8BFB;&#x547D;&#x4E2D;</li></ol><p>&#x5BF9;&#x4E8E;&#x60C5;&#x51B5;&#x4E00;&#xFF0C;&#x7531;&#x4E8E;&#x540C;&#x6B65;&#x64CD;&#x4F5C;&#x4E0D;&#x5F71;&#x54CD;cache&#x5F53;&#x524D;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x56E0;&#x6B64;&#x76F4;&#x63A5;&#x4F9D;&#x7167;&#x540C;&#x6B65;&#x4FE1;&#x53F7;&#x751F;&#x6210;&#x5BF9;&#x5E94;&#x7684;&#x6E05;&#x96F6;&#x4FE1;&#x53F7;&#x3002;<br>&#x5BF9;&#x4E8E;&#x60C5;&#x51B5;&#x4E8C;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x4EC5;&#x8981;&#x4EA7;&#x751F;&#x5BF9;&#x5E94;&#x7684;&#x6E05;&#x96F6;&#x4FE1;&#x53F7;&#xFF0C;&#x8FD8;&#x8981;&#x5C4F;&#x853D;&#x5F53;&#x524D;&#x7684;&#x5047;&#x7684;cache&#x547D;&#x4E2D;&#x4FE1;&#x53F7;&#x3002;&#x56E0;&#x4E3A;&#x4EA7;&#x751F;&#x7684;&#x6E05;&#x96F6;&#x4FE1;&#x53F7;&#x8981;&#x5728;&#x4E0B;&#x4E00;&#x4E2A;&#x65F6;&#x949F;&#x4E0A;&#x8FB9;&#x6CBF;&#x5230;&#x6765;&#x65F6;&#x624D;&#x751F;&#x6548;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//VALID_X_clr is HIGH when we need to clear the valid bit. </span></span><br><span class="line"><span class="hljs-keyword">wire</span> VALID_A_clr, VALID_B_clr;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//There are two situations here:</span></span><br><span class="line"><span class="hljs-comment">//  1. The monitored request is different from the request to the cache</span></span><br><span class="line"><span class="hljs-comment">//          --Clear valid bit directly</span></span><br><span class="line"><span class="hljs-comment">//  2. The monitored request is the same as the request to the cache</span></span><br><span class="line"><span class="hljs-comment">//          --Clear valid bit only when there&apos;s a read hit. </span></span><br><span class="line"><span class="hljs-keyword">assign</span> VALID_A_clr = (BUS_addr_reg == addr_reg) ? </span><br><span class="line">                (cache_sync_A &amp; ~CPU_RW_reg &amp; HIT_A) : cache_sync_A;</span><br><span class="line"><span class="hljs-keyword">assign</span> VALID_B_clr = (BUS_addr_reg == addr_reg) ? </span><br><span class="line">                (cache_sync_B &amp; ~CPU_RW_reg &amp; HIT_B) : cache_sync_B;</span><br><span class="line"><span class="hljs-keyword">wire</span> HIT_mask ;</span><br><span class="line"><span class="hljs-keyword">assign</span> HIT_mask = (BUS_addr_reg == addr_reg)? (VALID_A_clr|VALID_B_clr) :<span class="hljs-number">0</span>;</span><br></pre></td></tr></table></figure><p>&#x540C;&#x65F6;&#x5C06;HIT_mask&#x52A0;&#x5165;CACHE_HIT_R&#x7684;&#x6761;&#x4EF6;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">wire</span> CACHE_HIT_R = NO_CACHE ? HIT_C : (HIT_A|HIT_B) &amp; ~HIT_mask;</span><br></pre></td></tr></table></figure><p>&#x6700;&#x540E;&#x8981;&#x4FEE;&#x6539;valid bits&#xFF0C;&#x4F7F;&#x5176;&#x5728;&#x76F8;&#x5E94;&#x7684;&#x6E05;&#x96F6;&#x4FE1;&#x53F7;&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#x65F6;&#x6E05;&#x96F6;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk)</span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (clr || cache_clr)</span><br><span class="line">        VALID_A = <span class="hljs-number">32&apos;b0</span>;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (WE_A) </span><br><span class="line">        VALID_A[index_reg] =<span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (VALID_A_clr)</span><br><span class="line">        VALID_A[index_sync_reg] =<span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-comment">//This is a registered read out. since the index can change according to the</span></span><br><span class="line">    <span class="hljs-comment">//state of CPU, use a continuous read (assign statement) could cause a </span></span><br><span class="line">    <span class="hljs-comment">//combinational logic loop from CPU_stall to ready.</span></span><br><span class="line">    <span class="hljs-comment">//If read and write at same time, get the new value.</span></span><br><span class="line">    VALID_A_out = VALID_A[index];</span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><p>&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x6E05;&#x96F6;&#x4FE1;&#x53F7;&#x4F7F;&#x7528;&#x7684;&#x7D22;&#x5F15;&#x662F;&#x7ECF;&#x8FC7;&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x7ED3;&#x679C;&#x3002;</p><h3 id="&#x64A4;&#x9500;&#x673A;&#x5236;"><a href="#&#x64A4;&#x9500;&#x673A;&#x5236;" class="headerlink" title="&#x64A4;&#x9500;&#x673A;&#x5236;"></a>&#x64A4;&#x9500;&#x673A;&#x5236;</h3><p>&#x7531;&#x4E8E;&#x6211;&#x6240;&#x8BBE;&#x8BA1;&#x7684;&#x603B;&#x7EBF;&#x548C;&#x603B;&#x7EBF;&#x63A7;&#x5236;&#x5668;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x65E0;&#x6CD5;&#x64A4;&#x9500;&#x5DF2;&#x7ECF;&#x5411;&#x603B;&#x7EBF;&#x4E0A;&#x7684;&#x8BBE;&#x5907;&#x9001;&#x51FA;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x800C;CU&#x4F1A;&#x5411;cache&#x53D1;&#x9001;&#x64A4;&#x9500;&#x8BF7;&#x6C42;&#xFF0C;&#x64A4;&#x9500;&#x8BF7;&#x6C42;&#x5728;cache&#x5185;&#x90E8;&#x5FC5;&#x987B;&#x6839;&#x636E;cache&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x5411;&#x603B;&#x7EBF;&#x53D1;&#x51FA;&#x8BF7;&#x6C42;&#x6765;&#x5224;&#x65AD;&#x64A4;&#x9500;&#x4FE1;&#x53F7;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x56E0;&#x6B64;&#x5F15;&#x5165;&#x4E86;&#x64A4;&#x9500;&#x673A;&#x5236;&#x3002;<br>&#x9996;&#x5148;&#xFF0C;&#x5F15;&#x5165;&#x4E00;&#x4E2A;&#x72B6;&#x6001;&#x5BC4;&#x5B58;&#x5668;req_sent,&#x7528;&#x6765;&#x8BB0;&#x5F55;&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x5468;&#x671F;&#x5185;&#xFF0C;&#x5411;&#x603B;&#x7EBF;&#x7684;&#x8BF7;&#x6C42;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x53D1;&#x9001;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//The bus controller we used here is a simple controller, it can&apos;t handle</span></span><br><span class="line"><span class="hljs-comment">//situations like cancelling the sent request. So when cancel signal is high</span></span><br><span class="line"><span class="hljs-comment">//we need to make sure that the sent request is still there.</span></span><br><span class="line"><span class="hljs-comment">//To achieve this we use a register to indicate whether the request has been </span></span><br><span class="line"><span class="hljs-comment">//sent during this cycle.</span></span><br><span class="line"><span class="hljs-keyword">reg</span> req_sent;</span><br><span class="line"><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk)</span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (clr) </span><br><span class="line">        req_sent &lt;=<span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-comment">//req_sent resets when every new instruction is pre-fetched</span></span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (~CPU_stall)</span><br><span class="line">        req_sent &lt;=<span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-comment">//req_sent goes high when the cache request the bus. </span></span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (BUS_grant)</span><br><span class="line">        req_sent &lt;=<span class="hljs-number">1</span>;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><p>&#x6BCF;&#x5F53;&#x65B0;&#x6307;&#x4EE4;&#x5230;&#x6765;&#x65F6;(~CPU_stall)&#xFF0C;&#x8BE5;&#x5BC4;&#x5B58;&#x5668;&#x6E05;&#x96F6;&#xFF0C;&#x4F7F;&#x7528;BUS_grant&#x4F5C;&#x4E3A;&#x5411;&#x603B;&#x7EBF;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x7684;&#x6807;&#x5FD7;&#x3002;</p><p>&#x7136;&#x540E;&#x4FEE;&#x6539;BUS_req&#x4FE1;&#x53F7;&#xFF0C;&#x4F7F;&#x5F97;&#x5728;&#x8BF7;&#x6C42;&#x5C1A;&#x672A;&#x5728;&#x603B;&#x7EBF;&#x4E0A;&#x53D1;&#x9001;&#x65F6;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x5916;&#x90E8;&#x4FE1;&#x53F7;(cancel)&#x64A4;&#x9500;&#x603B;&#x7EBF;&#x8BF7;&#x6C42;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//BUS request can be canceled if the request hasn&apos;t been sent</span></span><br><span class="line"><span class="hljs-keyword">assign</span> BUS_req = CPU_req_reg &amp;(~cancel | req_sent) &amp; ((~CPU_RW_reg &amp; ~CACHE_HIT_R )</span><br><span class="line">                |(CPU_RW_reg &amp; ~ready_reg));</span><br></pre></td></tr></table></figure><p>&#x6700;&#x540E;&#xFF0C;&#x4FEE;&#x6539;cache&#x7684;ready&#x4FE1;&#x53F7;&#xFF0C;&#x5F53;&#x603B;&#x7EBF;&#x8BF7;&#x6C42;&#x88AB;&#x6210;&#x529F;&#x64A4;&#x9500;&#x65F6;(cancel &amp; ~req_sent)&#xFF0C;cache&#x76F4;&#x63A5;&#x51C6;&#x5907;&#x597D;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">always</span> @(*)</span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    <span class="hljs-comment">//if there&apos;s no request to cache, cache ready is HIGH</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (~CPU_req_reg)</span><br><span class="line">        ready_o &lt;= <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-comment">//if the request has been canceled, cache ready is HIGH</span></span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cancel &amp; ~req_sent)</span><br><span class="line">        ready_o &lt;= <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-comment">//If the request is a write request. When and after the bus announced ready</span></span><br><span class="line">    <span class="hljs-comment">//The cache is ready. Registered ready signal avoids missing ready signal when</span></span><br><span class="line">    <span class="hljs-comment">//CPU is stalled.</span></span><br><span class="line">    <span class="hljs-comment">//rw and req signal should be the registered one to avoid logic loop from</span></span><br><span class="line">    <span class="hljs-comment">//CPU_stall to ready_o.</span></span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (CPU_RW_reg) </span><br><span class="line">        <span class="hljs-comment">//use CPU_req_reg as a mask can filter the HIGH Z on bus ready.</span></span><br><span class="line">        ready_o &lt;= (CPU_req_reg &amp;&amp; ready_in) || ready_reg;</span><br><span class="line">    <span class="hljs-comment">//IF the request is a read request. If there is a cache hit, or cache miss but</span></span><br><span class="line">    <span class="hljs-comment">//BUS ready, the cache is ready. When cache isn&apos;t hit, cache hit signal will be</span></span><br><span class="line">    <span class="hljs-comment">//HIGH at the next positive edge of clock when received ready signal from the bus.</span></span><br><span class="line">    <span class="hljs-keyword">else</span> </span><br><span class="line">        ready_o &lt;= (CPU_req_reg &amp;&amp; ready_in) || CACHE_HIT_R;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><h2 id="cache&#x540C;&#x6B65;&#x673A;&#x5236;&#x7684;&#x6D4B;&#x8BD5;"><a href="#cache&#x540C;&#x6B65;&#x673A;&#x5236;&#x7684;&#x6D4B;&#x8BD5;" class="headerlink" title="cache&#x540C;&#x6B65;&#x673A;&#x5236;&#x7684;&#x6D4B;&#x8BD5;"></a>cache&#x540C;&#x6B65;&#x673A;&#x5236;&#x7684;&#x6D4B;&#x8BD5;</h2><p>&#x7531;&#x4E8E;&#x540C;&#x6B65;&#x548C;&#x64A4;&#x9500;&#x673A;&#x5236;&#x662F;&#x5728;&#x539F;&#x6709;&#x8BBE;&#x8BA1;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x6DFB;&#x52A0;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x4FEE;&#x6539;&#x540E;&#xFF0C;&#x6211;&#x9996;&#x5148;&#x8FD0;&#x884C;&#x4E86;&#x539F;&#x6709;&#x7684;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;&#xFF0C;&#x6D4B;&#x8BD5;&#x539F;&#x6709;&#x7684;&#x529F;&#x80FD;&#x6709;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x3002;&#x7ECF;&#x6D4B;&#x8BD5;&#xFF0C;&#x539F;&#x6709;&#x7684;&#x8BBE;&#x8BA1;&#x529F;&#x80FD;&#x6CA1;&#x6709;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x3002;&#x7136;&#x540E;&#x6211;&#x9488;&#x5BF9;&#x65B0;&#x529F;&#x80FD;&#x8FDB;&#x884C;&#x4E86;&#x6D4B;&#x8BD5;&#x3002;&#x6D4B;&#x8BD5;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x4FEE;&#x6539;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;cache_t.v&#x5C06;&#x5176;&#x4E2D;&#x7684;&#x8BF7;&#x6C42;&#x5730;&#x5740;&#x5E8F;&#x5217;&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x4FEE;&#x6539;&#x3002;<br>&#x5C06;I cache&#x7684;&#x8BF7;&#x6C42;&#x5E8F;&#x5217;&#x4FEE;&#x6539;&#x4E3A;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    address[<span class="hljs-number">0</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    <span class="hljs-comment">//cache sync</span></span><br><span class="line">    address[<span class="hljs-number">1</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">   </span><br><span class="line">    address[<span class="hljs-number">2</span>]= <span class="hljs-number">0</span> ; </span><br><span class="line">    <span class="hljs-comment">//cache miss</span></span><br><span class="line">    address[<span class="hljs-number">3</span>]= <span class="hljs-number">4</span> ;</span><br><span class="line">    <span class="hljs-comment">//cache hit</span></span><br><span class="line">    address[<span class="hljs-number">4</span>]= <span class="hljs-number">4</span> ;</span><br><span class="line">    address[<span class="hljs-number">5</span>]= <span class="hljs-number">16</span> ; </span><br><span class="line">    address[<span class="hljs-number">6</span>]= <span class="hljs-number">0</span> ; </span><br><span class="line">    <span class="hljs-comment">//cache sync</span></span><br><span class="line">    address[<span class="hljs-number">7</span>]= <span class="hljs-number">4</span> ; </span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><p>&#x5C06;D cache&#x7684;&#x8BF7;&#x6C42;&#x5E8F;&#x5217;&#x4FEE;&#x6539;&#x4E3A;:</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] exe_address [<span class="hljs-number">0</span>:<span class="hljs-number">7</span>];</span><br><span class="line"><span class="hljs-keyword">initial</span></span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    exe_address[<span class="hljs-number">0</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    <span class="hljs-comment">//write at 0</span></span><br><span class="line">    exe_address[<span class="hljs-number">1</span>]= <span class="hljs-number">0</span>;</span><br><span class="line">    exe_address[<span class="hljs-number">2</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    exe_address[<span class="hljs-number">3</span>]= <span class="hljs-number">20</span>;</span><br><span class="line">    exe_address[<span class="hljs-number">4</span>]= <span class="hljs-number">20</span>;</span><br><span class="line">    <span class="hljs-comment">//write at 4</span></span><br><span class="line">    exe_address[<span class="hljs-number">5</span>]= <span class="hljs-number">4</span>;</span><br><span class="line">    exe_address[<span class="hljs-number">6</span>]= <span class="hljs-number">24</span>;</span><br><span class="line">    exe_address[<span class="hljs-number">7</span>]= <span class="hljs-number">24</span>;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] exe_req [<span class="hljs-number">0</span>:<span class="hljs-number">7</span>];</span><br><span class="line"><span class="hljs-keyword">initial</span></span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    exe_req[<span class="hljs-number">0</span>]=<span class="hljs-number">0</span>;</span><br><span class="line">    exe_req[<span class="hljs-number">1</span>]=<span class="hljs-number">1</span>;</span><br><span class="line">    exe_req[<span class="hljs-number">2</span>]=<span class="hljs-number">1</span>;</span><br><span class="line">    exe_req[<span class="hljs-number">3</span>]=<span class="hljs-number">1</span>;</span><br><span class="line">    exe_req[<span class="hljs-number">4</span>]=<span class="hljs-number">1</span>;</span><br><span class="line">    exe_req[<span class="hljs-number">5</span>]=<span class="hljs-number">1</span>;</span><br><span class="line">    exe_req[<span class="hljs-number">6</span>]=<span class="hljs-number">1</span>;</span><br><span class="line">    exe_req[<span class="hljs-number">7</span>]=<span class="hljs-number">1</span>;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] data [<span class="hljs-number">0</span>:<span class="hljs-number">7</span>];</span><br><span class="line"><span class="hljs-keyword">initial</span></span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    data[<span class="hljs-number">0</span>]= <span class="hljs-number">32&apos;hab2112a</span> ;</span><br><span class="line">    data[<span class="hljs-number">1</span>]= <span class="hljs-number">32&apos;hab2112b</span> ;</span><br><span class="line">    data[<span class="hljs-number">2</span>]= <span class="hljs-number">32&apos;hab2112c</span> ;</span><br><span class="line">    data[<span class="hljs-number">3</span>]= <span class="hljs-number">32&apos;hab21123</span> ;</span><br><span class="line">    data[<span class="hljs-number">4</span>]= <span class="hljs-number">32&apos;hab21124</span> ;</span><br><span class="line">    data[<span class="hljs-number">5</span>]= <span class="hljs-number">32&apos;hab21128</span> ;</span><br><span class="line">    data[<span class="hljs-number">6</span>]= <span class="hljs-number">32&apos;hab21129</span> ;</span><br><span class="line">    data[<span class="hljs-number">7</span>]= <span class="hljs-number">32&apos;hab21121</span> ;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] rw;</span><br><span class="line"><span class="hljs-keyword">initial</span></span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    rw[<span class="hljs-number">0</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    rw[<span class="hljs-number">1</span>]= <span class="hljs-number">1</span> ;</span><br><span class="line">    rw[<span class="hljs-number">2</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    rw[<span class="hljs-number">3</span>]= <span class="hljs-number">1</span> ;</span><br><span class="line">    rw[<span class="hljs-number">4</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    rw[<span class="hljs-number">5</span>]= <span class="hljs-number">1</span> ;</span><br><span class="line">    rw[<span class="hljs-number">6</span>]= <span class="hljs-number">1</span> ;</span><br><span class="line">    rw[<span class="hljs-number">7</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5206;&#x522B;&#x6D4B;&#x8BD5;&#x4E86;&#x5468;&#x671F;1 &#x5BF9;&#x5730;&#x5740;0&#x5199;&#x5165;&#x65F6;&#x5F15;&#x8D77;&#x7684;&#x4E0E;&#x5F53;&#x524D;I cache&#x8BF7;&#x6C42;&#x5730;&#x5740;&#x76F8;&#x540C;&#x7684;&#x540C;&#x6B65;&#x4E8B;&#x4EF6;&#xFF0C;&#x548C;&#x5468;&#x671F;5&#x5BF9;&#x5730;&#x5740;4&#x5199;&#x5165;&#x65F6;&#x5F15;&#x8D77;&#x7684;&#x4E0E;&#x5F53;&#x524D;I cache&#x8BF7;&#x6C42;&#x5730;&#x5740;&#x4E0D;&#x540C;&#x7684;&#x540C;&#x6B65;&#x4E8B;&#x4EF6;&#x3002;<br>&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;&#x5982;&#x56FE;&#xFF1A;<br><img src="/Cache%E5%90%8C%E6%AD%A5%E6%9C%BA%E5%88%B6%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%AE%9E%E7%8E%B0%E5%92%8C%E6%B5%8B%E8%AF%95/cache_sync_test_1.JPG" alt="test1"><br>&#x7531;&#x56FE;&#x53EF;&#x89C1;&#xFF1A;<br>110ns&#xFF0C;I cache&#x8BFB;&#x53D6;&#x5B8C;&#x5730;&#x5740;0&#xFF0C;CPU&#x51C6;&#x5907;&#x5B8C;&#x6BD5;&#xFF0C;&#x8FDB;&#x5165;&#x4E0B;&#x4E00;&#x8BF7;&#x6C42;&#x3002;<br>130ns&#xFF0C;&#x7531;&#x4E8E;I cache&#x547D;&#x4E2D;&#x5BFC;&#x81F4;&#x603B;&#x7EBF;&#x8BA9;&#x7ED9;D cache&#x5199;&#x5165;&#x5730;&#x5740;0&#xFF0C;I cache&#x5728;&#x4E0B;&#x4E00;&#x65F6;&#x949F;&#x76D1;&#x542C;&#x5230;&#x8BE5;&#x8BF7;&#x6C42;&#xFF0C;&#x64A4;&#x9500;&#x4E86;&#x547D;&#x4E2D;&#x4FE1;&#x53F7;&#xFF0C;&#x91CD;&#x65B0;&#x8BF7;&#x6C42;&#x603B;&#x7EBF;&#x5F97;&#x5230;&#x5199;&#x5165;&#x7684;&#x65B0;&#x5185;&#x5BB9;<br><img src="/Cache%E5%90%8C%E6%AD%A5%E6%9C%BA%E5%88%B6%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%AE%9E%E7%8E%B0%E5%92%8C%E6%B5%8B%E8%AF%95/cache_sync_test_2.JPG" alt="test2"><br><img src="/Cache%E5%90%8C%E6%AD%A5%E6%9C%BA%E5%88%B6%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%AE%9E%E7%8E%B0%E5%92%8C%E6%B5%8B%E8%AF%95/cache_sync_test_3.JPG" alt="test3"><br>&#x7531;&#x56FE;&#x53EF;&#x89C1;&#xFF1A;<br>430ns&#xFF0C;&#x7531;&#x4E8E;I cache&#x4E4B;&#x524D;&#x8BFB;&#x8FC7;&#x5730;&#x5740;4&#xFF0C;&#x4F7F;&#x5F97;&#x8FD9;&#x6B21;&#x8BFB;&#x53D6;cache&#x547D;&#x4E2D;&#x3002;<br>670ns&#xFF0C;D cache&#x5411;&#x603B;&#x7EBF;&#x53D1;&#x8D77;&#x5199;&#x8BF7;&#x6C42;&#xFF0C;&#x5199;&#x5730;&#x5740;4&#xFF0C;&#x8FD9;&#x5E94;&#x5F53;&#x51FA;&#x53D1;I cache&#x7684;&#x540C;&#x6B65;&#x673A;&#x5236;&#x3002;<br>870ns&#xFF0C;&#x53EF;&#x89C1;I cache&#x518D;&#x6B21;&#x8BFB;&#x53D6;&#x5730;&#x5740;4&#xFF0C;&#x6CA1;&#x6709;&#x547D;&#x4E2D;&#xFF0C;&#x8BF4;&#x660E;&#x540C;&#x6B65;&#x673A;&#x5236;&#x8D77;&#x4F5C;&#x7528;&#x4E86;&#x3002;</p><p>&#x5BF9;&#x4E8E;&#x64A4;&#x9500;&#x673A;&#x5236;&#x7684;&#x6D4B;&#x8BD5;&#xFF1A;<br><img src="/Cache%E5%90%8C%E6%AD%A5%E6%9C%BA%E5%88%B6%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%AE%9E%E7%8E%B0%E5%92%8C%E6%B5%8B%E8%AF%95/cache_sync_test_4.JPG" alt="test4"><br>&#x5728;30-50ns&#x5F15;&#x5165;cancel&#x4FE1;&#x53F7;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x7531;&#x4E8E;&#x5F53;&#x524D;&#x5BF9;&#x603B;&#x7EBF;&#x7684;&#x8BF7;&#x6C42;&#x5C1A;&#x672A;&#x53D1;&#x9001;&#x81F3;&#x5404;&#x8BBE;&#x5907;&#xFF0C;&#x56E0;&#x6B64;&#x8BE5;&#x8BF7;&#x6C42;&#x6210;&#x529F;&#x53D6;&#x6D88;&#x3002;<br><img src="/Cache%E5%90%8C%E6%AD%A5%E6%9C%BA%E5%88%B6%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%AE%9E%E7%8E%B0%E5%92%8C%E6%B5%8B%E8%AF%95/cache_sync_test_5.JPG" alt="test5"><br>&#x800C;&#x82E5;&#x662F;&#x5728;50-60ns&#x5F15;&#x5165;cancel&#x4FE1;&#x53F7;&#xFF0C;&#x7531;&#x4E8E;&#x5728;50ns&#x7684;&#x65F6;&#x949F;&#x4E0A;&#x8FB9;&#x6CBF;&#x5DF2;&#x7ECF;&#x5C06;&#x603B;&#x7EBF;&#x8BF7;&#x6C42;&#x53D1;&#x51FA;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x80FD;&#x64A4;&#x9500;&#x5F53;&#x524D;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x5FC5;&#x987B;&#x7B49;&#x5F85;&#x5F53;&#x524D;&#x8BF7;&#x6C42;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x3002;</p><h2 id="&#x5C0F;&#x7ED3;"><a href="#&#x5C0F;&#x7ED3;" class="headerlink" title="&#x5C0F;&#x7ED3;"></a>&#x5C0F;&#x7ED3;</h2><p>&#x5F53;&#x524D;&#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x521D;&#x6B65;&#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x56E0;&#x4E3A;&#x540E;&#x7EED;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x63A7;&#x5236;&#x8FD8;&#x6CA1;&#x6709;&#x6700;&#x7EC8;&#x6572;&#x5B9A;&#x3002;<br>&#x5728;&#x8BBE;&#x8BA1;&#x548C;&#x9A8C;&#x8BC1;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x51FA;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x5C0F;&#x95EE;&#x9898;&#xFF0C;&#x5C31;&#x662F;&#x6211;&#x4F7F;&#x7528;&#x7684;quartus lite&#x7248;&#x672C;&#xFF0C;&#x7ADF;&#x7136;&#x5728;&#x4EFF;&#x771F;&#x65F6;&#x63D0;&#x793A;&#x6211;&#x811A;&#x672C;&#x8FC7;&#x957F;&#xFF0C;&#x8D85;&#x8FC7;&#x4E86;&#x514D;&#x8D39;&#x7248;&#x672C;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x5B83;&#x56E0;&#x6B64;&#x6545;&#x610F;&#x5C06;&#x4EFF;&#x771F;&#x901F;&#x5EA6;&#x8FDB;&#x884C;&#x4E86;&#x9650;&#x5236;&#x3002;</p><h2 id="&#x5DF2;&#x77E5;&#x95EE;&#x9898;"><a href="#&#x5DF2;&#x77E5;&#x95EE;&#x9898;" class="headerlink" title="&#x5DF2;&#x77E5;&#x95EE;&#x9898;"></a>&#x5DF2;&#x77E5;&#x95EE;&#x9898;</h2><p>&#x7531;&#x6D4B;&#x8BD5;1&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x8BE5;&#x540C;&#x6B65;&#x673A;&#x5236;&#xFF0C;&#x5BF9;&#x4E8E;&#x603B;&#x7EBF;&#x6709;&#x8981;&#x6C42;&#xFF0C;&#x8981;&#x6C42;&#x4E00;&#x4E2A;&#x603B;&#x7EBF;&#x4E8B;&#x52A1;&#x81F3;&#x5C11;&#x4E24;&#x4E2A;&#x5468;&#x671F;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x65F6;&#x949F;&#x4E0A;&#x8FB9;&#x6CBF;&#x5404;&#x4E2A;&#x8BBE;&#x5907;&#x63A5;&#x53D7;&#x8BF7;&#x6C42;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x4E0A;&#x8DF3;&#x6CBF;&#x5404;&#x4E2A;&#x8BBE;&#x5907;&#x53D1;&#x9001;&#x51C6;&#x5907;&#x597D;&#x4FE1;&#x53F7;&#x3002;&#x5426;&#x5219;&#x7684;&#x8BDD;&#xFF0C;&#x4E0D;&#x80FD;&#x5B8C;&#x6210;&#x6240;&#x8981;&#x6C42;&#x7684;&#x540C;&#x6B65;&#x4E0E;&#x5F53;&#x524D;cache&#x8BF7;&#x6C42;&#x76F8;&#x540C;&#x7684;&#x5730;&#x5740;&#x7684;&#x8981;&#x6C42;&#x3002;</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&amp;#x4E0A;&amp;#x7BC7;&amp;#x6587;&amp;#x7AE0;&amp;#x8BE6;&amp;#x7EC6;&amp;#x63CF;&amp;#x8FF0;&amp;#x4E86;&amp;#x7EC4;&amp;#x76F8;&amp;#x8054;cache&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x548C;&amp;#x6</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>关于指令译码级(ID stage)的设计决策</title>
    <link href="https://gpthimble.github.io/%E5%85%B3%E4%BA%8E%E6%8C%87%E4%BB%A4%E8%AF%91%E7%A0%81%E7%BA%A7(ID%20stage)%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%86%B3%E7%AD%96/"/>
    <id>https://gpthimble.github.io/%E5%85%B3%E4%BA%8E%E6%8C%87%E4%BB%A4%E8%AF%91%E7%A0%81%E7%BA%A7(ID%20stage)%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%86%B3%E7%AD%96/</id>
    <published>2020-11-27T01:37:51.000Z</published>
    <updated>2021-01-29T16:11:33.220Z</updated>
    
    <content type="html"><![CDATA[<p>ID&#x7EA7;&#x7684;&#x4EFB;&#x52A1;&#x662F;&#x5BF9;&#x6307;&#x4EE4;&#x8BD1;&#x7801;&#xFF0C;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;&#x6307;&#x4EE4;&#x4EA7;&#x751F;&#x76F8;&#x5E94;&#x7684;&#x63A7;&#x5236;&#x4FE1;&#x53F7;&#xFF0C;&#x63A7;&#x5236;CPU&#x5185;&#x7684;&#x5176;&#x4ED6;&#x90E8;&#x4EF6;&#x6309;&#x8981;&#x6C42;&#x5DE5;&#x4F5C;&#x3002;<br>&#x8981;&#x8BBE;&#x8BA1;ID&#x7EA7;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x786E;&#x5B9A;CPU&#x652F;&#x6301;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x7136;&#x540E;&#x6839;&#x636E;&#x6307;&#x4EE4;&#xFF0C;&#x7F16;&#x5236;&#x63A7;&#x5236;&#x4FE1;&#x53F7;&#x8868;&#xFF0C;&#x4F9D;&#x7167;&#x63A7;&#x5236;&#x4FE1;&#x53F7;&#x8868;&#x8FDB;&#x884C;&#x786C;&#x4EF6;&#x8BBE;&#x8BA1;&#x5DE5;&#x4F5C;&#x3002;ID&#x7EA7;&#x9700;&#x8981;&#x8003;&#x8651;&#x8DF3;&#x8F6C;&#x3001;&#x4E2D;&#x65AD;&#x3001;&#x5F02;&#x5E38;&#x3001;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x7684;&#x590D;&#x6742;&#x4EFB;&#x52A1;&#xFF0C;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x90FD;&#x9700;&#x8981;&#x5728;&#x8BBE;&#x8BA1;&#x524D;&#x63D0;&#x524D;&#x786E;&#x5B9A;&#x3002;&#x867D;&#x7136;&#x7B2C;&#x4E00;&#x9636;&#x6BB5;&#x6211;&#x7684;CPU&#x4E0D;&#x4E00;&#x5B9A;&#x5BF9;&#x590D;&#x6742;&#x7684;&#x529F;&#x80FD;&#x8FDB;&#x884C;&#x652F;&#x6301;&#xFF0C;&#x4F46;&#x662F;&#x4E3A;&#x4E86;&#x5728;&#x4EE5;&#x540E;&#x8FDB;&#x884C;&#x6269;&#x5C55;&#x65F6;&#x4E0D;&#x5BF9;&#x7CFB;&#x7EDF;&#x8FDB;&#x884C;&#x5927;&#x7684;&#x6539;&#x52A8;&#xFF0C;&#x8FD9;&#x4E9B;&#x90E8;&#x5206;&#x786E;&#x5B9E;&#x9700;&#x8981;&#x4ED4;&#x7EC6;&#x8003;&#x8651;&#x3002;&#x5176;&#x4E2D;&#x4E00;&#x4E9B;&#x95EE;&#x9898;&#x662F;&#x76F8;&#x4E92;&#x5173;&#x8054;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x63D0;&#x524D;&#x8003;&#x8651;&#x597D;&#xFF0C;&#x4EE5;&#x540E;&#x6539;&#x52A8;&#x8D77;&#x6765;&#x4F1A;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;&#x3002;</p><h2 id="&#x5206;&#x652F;&#x9884;&#x6D4B;&#x8FD8;&#x662F;&#x5EF6;&#x65F6;&#x69FD;&#xFF1F;"><a href="#&#x5206;&#x652F;&#x9884;&#x6D4B;&#x8FD8;&#x662F;&#x5EF6;&#x65F6;&#x69FD;&#xFF1F;" class="headerlink" title="&#x5206;&#x652F;&#x9884;&#x6D4B;&#x8FD8;&#x662F;&#x5EF6;&#x65F6;&#x69FD;&#xFF1F;"></a>&#x5206;&#x652F;&#x9884;&#x6D4B;&#x8FD8;&#x662F;&#x5EF6;&#x65F6;&#x69FD;&#xFF1F;</h2><p>&#x8FD9;&#x662F;&#x9996;&#x5148;&#x8981;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;&#x3002;&#x6211;&#x6700;&#x521D;&#x7684;&#x8BBE;&#x60F3;&#xFF0C;&#x662F;&#x6CBF;&#x7528;&#x65E9;&#x671F;RISC&#x5904;&#x7406;&#x5668;&#x7684;&#x5EF6;&#x65F6;&#x69FD;&#xFF0C;&#x8BA4;&#x4E3A;&#x5176;&#x786C;&#x4EF6;&#x5B9E;&#x73B0;&#x7B80;&#x5355;&#xFF0C;&#x5373;&#x4FBF;&#x8F6F;&#x4EF6;&#x4E0A;&#x9700;&#x8981;&#x4E00;&#x4E9B;&#x4F18;&#x5316;&#x63AA;&#x65BD;&#xFF0C;&#x4E5F;&#x53EF;&#x6682;&#x4E0D;&#x5B9E;&#x65BD;&#xFF0C;&#x4EE5;&#x7A7A;&#x6307;&#x4EE4;&#x586B;&#x5145;&#x5EF6;&#x65F6;&#x69FD;&#x3002;&#x4F46;&#x662F;&#x73B0;&#x4EE3;&#x5904;&#x7406;&#x5668;&#x7EB7;&#x7EB7;&#x629B;&#x5F03;&#x6307;&#x4EE4;&#x5EF6;&#x65F6;&#x69FD;&#x662F;&#x6709;&#x539F;&#x56E0;&#x7684;(<a href="https://stackoverflow.com/questions/54724410/why-is-the-branch-delay-slot-deprecated-or-obsolete">&#x76F8;&#x5173;&#x8BA8;&#x8BBA;</a>)&#xFF0C;&#x800C;&#x6211;&#x5728;&#x8BBE;&#x8BA1;&#x8FC7;&#x7A0B;&#x4E2D;&#x6240;&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;&#x5408;&#x8FD9;&#x4E9B;&#x5386;&#x53F2;&#x4E00;&#x6837;&#xFF0C;&#x8FD9;&#x4F7F;&#x6211;&#x4E0D;&#x5F97;&#x4E0D;&#x91CD;&#x65B0;&#x6743;&#x8861;&#x4E8C;&#x8005;&#x4E4B;&#x95F4;&#x7684;&#x5229;&#x5F0A;&#x3002;</p><h3 id="&#x5EF6;&#x65F6;&#x69FD;&#x771F;&#x7684;&#x4F1A;&#x7B80;&#x5316;&#x786C;&#x4EF6;&#x8BBE;&#x8BA1;&#x5417;&#xFF1F;"><a href="#&#x5EF6;&#x65F6;&#x69FD;&#x771F;&#x7684;&#x4F1A;&#x7B80;&#x5316;&#x786C;&#x4EF6;&#x8BBE;&#x8BA1;&#x5417;&#xFF1F;" class="headerlink" title="&#x5EF6;&#x65F6;&#x69FD;&#x771F;&#x7684;&#x4F1A;&#x7B80;&#x5316;&#x786C;&#x4EF6;&#x8BBE;&#x8BA1;&#x5417;&#xFF1F;"></a>&#x5EF6;&#x65F6;&#x69FD;&#x771F;&#x7684;&#x4F1A;&#x7B80;&#x5316;&#x786C;&#x4EF6;&#x8BBE;&#x8BA1;&#x5417;&#xFF1F;</h3><p>&#x521D;&#x6B65;&#x770B;&#xFF0C;&#x5EF6;&#x65F6;&#x69FD;&#x786E;&#x5B9E;&#x53EF;&#x4EE5;&#x7B80;&#x5316;&#x6D41;&#x6C34;&#x7EBF;&#x7684;&#x7ED3;&#x6784;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x53D6;&#x6307;&#x9636;&#x6BB5;&#x3002;&#x4F46;&#x662F;&#x5F15;&#x5165;&#x5EF6;&#x65F6;&#x69FD;&#x4F1A;&#x4F7F;&#x5F97;&#x4E2D;&#x65AD;&#x548C;&#x5F02;&#x5E38;&#x7684;&#x8BBE;&#x8BA1;&#x53D8;&#x5F97;&#x590D;&#x6742;&#x3002;&#x4E00;&#x65E6;&#x5F15;&#x5165;&#x5EF6;&#x65F6;&#x69FD;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x5206;&#x6790;&#x53D1;&#x751F;&#x4E2D;&#x65AD;&#x6216;&#x5F02;&#x5E38;&#x65F6;&#xFF0C;&#x5404;&#x7EA7;&#x6307;&#x4EE4;&#x662F;&#x5426;&#x662F;&#x5EF6;&#x65F6;&#x69FD;&#x4E2D;&#x7684;&#x6307;&#x4EE4;&#x3002;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x4ECE;&#x4E2D;&#x65AD;&#x6216;&#x5F02;&#x5E38;&#x8FD4;&#x56DE;&#x65F6;&#x8981;&#x786E;&#x5B9A;&#x7684;&#x8FD4;&#x56DE;&#x5730;&#x5740;&#x4E0E;&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x662F;&#x5426;&#x662F;&#x5EF6;&#x65F6;&#x69FD;&#x4E2D;&#x7684;&#x6307;&#x4EE4;&#x6709;&#x5173;&#x3002;&#x5EF6;&#x65F6;&#x69FD;&#x6539;&#x53D8;&#x4E86;&#x6D41;&#x6C34;&#x7EBF;&#x4E2D;&#x539F;&#x672C;&#x7684;&#x987A;&#x5E8F;&#x7ED3;&#x6784;&#xFF0C;&#x5982;&#x679C;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#x7684;&#x6307;&#x4EE4;&#x662F;&#x5EF6;&#x65F6;&#x69FD;&#x4E2D;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x6309;&#x7167;&#x5904;&#x7406;&#x5F02;&#x5E38;&#x7684;&#x60EF;&#x4F8B;&#xFF0C;&#x9700;&#x8981;&#x5728;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x5B8C;&#x6BD5;&#x540E;&#x8FD4;&#x56DE;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#xFF0C;&#x82E5;&#x4E0D;&#x505A;&#x7279;&#x6B8A;&#x5904;&#x7406;&#xFF0C;&#x5904;&#x7406;&#x5668;&#x5C31;&#x4F1A;&#x4E22;&#x5F03;&#x5F02;&#x5E38;&#x6307;&#x4EE4;&#x524D;&#x7684;&#x4E00;&#x4E2A;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x7684;&#x8DF3;&#x8F6C;&#xFF0C;&#x4F7F;&#x5F97;&#x5904;&#x7406;&#x5668;&#x6267;&#x884C;&#x53D1;&#x751F;&#x9519;&#x8BEF;&#x3002;&#x8FD9;&#x79CD;&#x7531;&#x5EF6;&#x65F6;&#x69FD;&#x5F15;&#x5165;&#x7684;&#x590D;&#x6742;&#x6027;&#xFF0C;&#x5BF9;&#x4E8E;&#x4E2D;&#x65AD;&#x6765;&#x8BF4;&#x597D;&#x5904;&#x7406;&#x4E00;&#x4E9B;&#xFF0C;&#x6BD5;&#x7ADF;&#x4E2D;&#x65AD;&#x65F6;&#x6765;&#x81EA;&#x5916;&#x90E8;&#x8BBE;&#x5907;&#xFF0C;&#x603B;&#x53EF;&#x4EE5;&#x8BA9;&#x5916;&#x90E8;&#x8BBE;&#x5907;&#x5148;&#x7B49;&#x4E00;&#x7B49;&#xFF0C;&#x7B49;&#x5230;CPU&#x72B6;&#x6001;&#x7A33;&#x5B9A;&#x4E00;&#x4E9B;&#x5728;&#x5904;&#x7406;&#x4E2D;&#x65AD;&#x3002;&#x4F46;&#x5BF9;&#x4E8E;&#x5F02;&#x5E38;&#x6765;&#x8BF4;&#x5C31;&#x6CA1;&#x6709;&#x90A3;&#x4E48;&#x5E78;&#x8FD0;&#x4E86;&#xFF0C;&#x5F02;&#x5E38;&#x53EF;&#x4EE5;&#x53D1;&#x751F;&#x5728;CPU&#x7684;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x9636;&#x6BB5;&#xFF1A;&#x53D6;&#x6307;&#x9636;&#x6BB5;&#x6709;&#x7F3A;&#x9875;&#x5F02;&#x5E38;&#xFF0C;&#x8BD1;&#x7801;&#x9636;&#x6BB5;&#x6709;&#x4E3A;&#x5B9E;&#x73B0;&#x7684;&#x6307;&#x4EE4;&#x5F02;&#x5E38;&#xFF0C;EXE&#x7EA7;&#x6709;&#x6EA2;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;WB&#x7EA7;&#x6709;&#x7F3A;&#x9875;&#x5F02;&#x5E38;&#x3002;&#x5355;&#x72EC;&#x5206;&#x6790;&#x8FD9;&#x4E9B;&#x9636;&#x6BB5;&#x4E0E;&#x5EF6;&#x65F6;&#x69FD;&#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x663E;&#x5F97;&#x5F97;&#x4E0D;&#x507F;&#x5931;&#x3002;</p><h3 id="&#x5206;&#x652F;&#x9884;&#x6D4B;&#x6BD4;&#x5EF6;&#x65F6;&#x69FD;&#x590D;&#x6742;&#x591A;&#x5C11;&#xFF1F;"><a href="#&#x5206;&#x652F;&#x9884;&#x6D4B;&#x6BD4;&#x5EF6;&#x65F6;&#x69FD;&#x590D;&#x6742;&#x591A;&#x5C11;&#xFF1F;" class="headerlink" title="&#x5206;&#x652F;&#x9884;&#x6D4B;&#x6BD4;&#x5EF6;&#x65F6;&#x69FD;&#x590D;&#x6742;&#x591A;&#x5C11;&#xFF1F;"></a>&#x5206;&#x652F;&#x9884;&#x6D4B;&#x6BD4;&#x5EF6;&#x65F6;&#x69FD;&#x590D;&#x6742;&#x591A;&#x5C11;&#xFF1F;</h3><p>&#x9759;&#x6001;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x548C;&#x7B80;&#x5355;&#x7684;&#x52A8;&#x6001;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5E76;&#x4E0D;&#x590D;&#x6742;&#x3002;&#x62FF;&#x9759;&#x6001;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x6765;&#x8BF4;&#xFF0C;&#x6211;&#x82E5;&#x603B;&#x662F;&#x9884;&#x6D4B;&#x8DF3;&#x8F6C;&#x4E0D;&#x53D1;&#x751F;&#xFF0C;&#x5373;&#x603B;&#x662F;&#x9884;&#x53D6;&#x8DF3;&#x8F6C;&#x540E;&#x7684;&#x4E0B;&#x4E00;&#x6761;&#x6307;&#x4EE4;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x5728;&#x6307;&#x4EE4;&#x9884;&#x53D6;&#x9636;&#x6BB5;&#x589E;&#x52A0;&#x4E00;&#x5957;&#x6D41;&#x6C34;&#x7EBF;&#x5E9F;&#x5F03;&#x673A;&#x5236;&#xFF0C;&#x5F53;ID&#x7EA7;&#x5BF9;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x8BD1;&#x7801;&#x5B8C;&#x6BD5;&#x65F6;&#xFF0C;&#x5373;&#x53EF;&#x5224;&#x65AD;&#x5F53;&#x524D;&#x9884;&#x53D6;&#x7684;&#x6307;&#x4EE4;&#x662F;&#x5426;&#x662F;&#x6B63;&#x786E;&#x7684;&#x8DF3;&#x8F6C;&#x76EE;&#x6807;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x662F;&#xFF0C;&#x5E9F;&#x5F03;&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x5373;&#x53EF;&#x3002;&#x8FD9;&#x6837;&#x505A;&#x867D;&#x7136;&#x6027;&#x80FD;&#x5DEE;&#x4E00;&#x70B9;&#xFF0C;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x6211;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x53EA;&#x6709;5&#x7EA7;&#x6D41;&#x6C34;&#x7EBF;&#x7684;CPU&#x6765;&#x8BF4;&#xFF0C;&#x6027;&#x80FD;&#x635F;&#x5931;&#x5E76;&#x4E0D;&#x5927;&#xFF0C;&#x800C;&#x4E14;&#x5373;&#x4F7F;&#x4F7F;&#x7528;&#x5EF6;&#x65F6;&#x69FD;&#xFF0C;&#x6211;&#x4E5F;&#x6CA1;&#x6709;&#x6253;&#x7B97;&#x5B8C;&#x6574;&#x7684;&#x8FDB;&#x884C;&#x7F16;&#x8BD1;&#x5668;&#x7684;&#x4F18;&#x5316;&#xFF08;lcc&#x76EE;&#x524D;&#x5E76;&#x4E0D;&#x652F;&#x6301;&#x5EF6;&#x65F6;&#x69FD;&#x7684;&#x4F18;&#x5316;&#xFF0C;&#x8FD9;&#x4E2A;&#x9700;&#x8981;&#x6211;&#x624B;&#x5DE5;&#x5B8C;&#x6210;&#xFF09;&#x3002;&#x4F46;&#x662F;&#x4F7F;&#x7528;&#x9759;&#x6001;&#x5206;&#x652F;&#x9884;&#x6D4B;&#xFF0C;&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x540E;&#x7EED;&#x6D41;&#x6C34;&#x7EBF;&#x4E2D;&#x7684;&#x6709;&#x6548;&#x6307;&#x4EE4;&#x5747;&#x662F;&#x6B63;&#x786E;&#x7684;&#x6267;&#x884C;&#x987A;&#x5E8F;&#xFF0C;&#x5728;&#x5206;&#x6790;&#x5F02;&#x5E38;&#x65F6;&#xFF0C;&#x4E0D;&#x7528;&#x518D;&#x8003;&#x8651;&#x8DF3;&#x8F6C;&#x7684;&#x5F71;&#x54CD;&#xFF0C;&#x5F02;&#x5E38;&#x548C;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x5C31;&#x4F1A;&#x5927;&#x5927;&#x7B80;&#x5316;&#x3002;</p><h3 id="&#x6211;&#x7684;&#x8BBE;&#x8BA1;&#x51B3;&#x7B56;"><a href="#&#x6211;&#x7684;&#x8BBE;&#x8BA1;&#x51B3;&#x7B56;" class="headerlink" title="&#x6211;&#x7684;&#x8BBE;&#x8BA1;&#x51B3;&#x7B56;"></a>&#x6211;&#x7684;&#x8BBE;&#x8BA1;&#x51B3;&#x7B56;</h3><p>&#x6B63;&#x5982;CPU&#x8BBE;&#x8BA1;&#x7684;&#x4E3B;&#x6D41;&#xFF0C;&#x6211;&#x4E5F;&#x503E;&#x5411;&#x4E8E;&#x4F7F;&#x7528;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x66FF;&#x4EE3;&#x5EF6;&#x65F6;&#x69FD;&#x3002;&#x6211;&#x8BBE;&#x8BA1;&#x8FD9;&#x4E2A;CPU&#x7684;&#x76EE;&#x7684;&#x4E00;&#x662F;&#x7528;&#x4E8E;&#x6559;&#x5B66;&#x5B9E;&#x8DF5;&#xFF0C;&#x4E8C;&#x662F;&#x7528;&#x4E8E;&#x5B66;&#x672F;&#x7814;&#x7A76;&#xFF0C;&#x663E;&#x7136;&#x7814;&#x7A76;&#x5404;&#x79CD;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x65B9;&#x6CD5;&#x7684;&#x6548;&#x7387;&#x5BF9;&#x6BD4;&#x662F;&#x5F88;&#x6709;&#x4EF7;&#x503C;&#x7684;&#x3002;&#x4E00;&#x65E6;&#x9009;&#x62E9;&#x4E86;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x8FD9;&#x6761;&#x8BBE;&#x8BA1;&#x8DEF;&#x7EBF;&#xFF0C;&#x4EE5;&#x540E;&#x5728;&#x8FD9;&#x4E2A;&#x5E73;&#x53F0;&#x4E0A;&#x5B9E;&#x73B0;&#x4E0D;&#x540C;&#x7684;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x65B9;&#x6CD5;&#x4F1A;&#x5F88;&#x65B9;&#x4FBF;&#x3002;&#x56E0;&#x6B64;&#x6211;&#x9009;&#x62E9;&#x5206;&#x652F;&#x9884;&#x6D4B;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x56E0;&#x4E3A;&#x6027;&#x80FD;&#xFF0C;&#x66F4;&#x591A;&#x7684;&#x662F;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x4EE5;&#x540E;&#x7684;&#x8BBE;&#x8BA1;&#x3002;&#x76EE;&#x524D;&#x6211;&#x51B3;&#x5B9A;&#x91C7;&#x7528;&#x9759;&#x6001;&#x5206;&#x652F;&#x9884;&#x6D4B;&#xFF0C;&#x603B;&#x662F;&#x9884;&#x6D4B;&#x8DF3;&#x8F6C;&#x4E0D;&#x53D1;&#x751F;&#xFF0C;&#x5373;&#x603B;&#x662F;&#x4E0E;&#x53BB;&#x8DF3;&#x8F6C;&#x540E;&#x7684;&#x4E0B;&#x4E00;&#x6761;&#x6307;&#x4EE4;&#xFF0C;&#x7136;&#x540E;&#x5728;ID&#x7EA7;&#x8FDB;&#x884C;&#x8DF3;&#x8F6C;&#x7ED3;&#x679C;&#x7684;&#x6BD4;&#x5BF9;&#xFF0C;&#x5982;&#x679C;&#x8DF3;&#x8F6C;&#x540E;&#x7684;&#x9884;&#x53D6;&#x4E0D;&#x6B63;&#x786E;&#xFF0C;&#x5C31;&#x5E9F;&#x5F03;&#x9884;&#x53D6;&#x7684;&#x6307;&#x4EE4;&#x3002;&#x4EE5;&#x540E;&#x7684;&#x8DEF;&#x7EBF;&#x5305;&#x62EC;&#x589E;&#x52A0;&#x9971;&#x548C;&#x8BA1;&#x6570;&#x5668;&#x548C;&#x4E8C;&#x7EA7;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5668;&#x7B49;&#x52A8;&#x6001;&#x6307;&#x4EE4;&#x9884;&#x53D6;&#x3002;&#x8FD9;&#x6837;&#x6211;&#x5728;&#x5B9E;&#x73B0;&#x5404;&#x79CD;&#x5F02;&#x5E38;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x4F1A;&#x8F7B;&#x677E;&#x5F88;&#x591A;&#x3002;</p><h3 id="&#x52A8;&#x6001;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x4E0E;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;"><a href="#&#x52A8;&#x6001;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x4E0E;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;" class="headerlink" title="&#x52A8;&#x6001;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x4E0E;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;"></a>&#x52A8;&#x6001;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x4E0E;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;</h3><p>&#x5982;&#x679C;&#x5B9E;&#x73B0;&#x4E86;&#x52A8;&#x6001;&#x5206;&#x652F;&#x9884;&#x6D4B;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x4E0E;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x914D;&#x5408;&#x7684;&#x673A;&#x5236;&#x3002;&#x9971;&#x548C;&#x8BA1;&#x6570;&#x5668;&#x7B49;&#x52A8;&#x6001;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5668;&#xFF0C;&#x5F80;&#x5F80;&#x91C7;&#x7528;&#x6307;&#x4EE4;&#x7684;&#x5730;&#x5740;&#x4F5C;&#x4E3A;&#x6807;&#x7B7E;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x5728;IF&#x7EA7;&#x5C31;&#x80FD;&#x77E5;&#x9053;&#x67D0;&#x4E2A;&#x6307;&#x4EE4;&#x662F;&#x5426;&#x662F;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x548C;&#x9884;&#x6D4B;&#x7684;&#x8DF3;&#x8F6C;&#x76EE;&#x6807;&#xFF0C;&#x4F46;&#x8FD9;&#x4E0E;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x6709;&#x4E00;&#x5B9A;&#x7684;&#x51B2;&#x7A81;&#x3002;&#x8BD5;&#x60F3;&#x67D0;&#x4E00;&#x6761;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x5DF2;&#x7ECF;&#x5B58;&#x50A8;&#x5728;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5668;&#x4E2D;&#xFF0C;&#x8FD9;&#x65F6;&#x5982;&#x679C;&#x53D1;&#x751F;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x8FD9;&#x4E00;&#x5730;&#x5740;&#x7684;&#x6307;&#x4EE4;&#x88AB;&#x4FEE;&#x6539;&#x4E3A;&#x5176;&#x4ED6;&#x7684;&#x6307;&#x4EE4;&#x3002;&#x800C;&#x7531;&#x4E8E;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5668;&#x662F;&#x7528;&#x5730;&#x5740;&#x4F5C;&#x4E3A;&#x6807;&#x7B7E;&#x7684;&#xFF0C;&#x4E0E;cache&#x4E00;&#x6837;&#x5B58;&#x5728;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x7684;&#x540C;&#x6B65;&#x95EE;&#x9898;&#x3002;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x5728;Intel&#x7684;X86&#x5904;&#x7406;&#x5668;&#x624B;&#x518C;&#x4E0A;&#x6211;&#x6CA1;&#x6709;&#x627E;&#x5230;&#x76F8;&#x5173;&#x7684;&#x8868;&#x8FF0;&#xFF0C;&#x5012;&#x662F;&#x5728;analog devices&#x7684;&#x4E00;&#x4E2A;DSP&#x7684;&#x624B;&#x518C;&#x91CC;&#x770B;&#x5230;&#x4E86;&#x76F8;&#x5173;&#x7684;&#x63CF;&#x8FF0;&#xFF08;<a href="https://www.analog.com/media/en/technical-documentation/application-notes/EE373v01.pdf">Tuning Dynamic Branch Prediction on ADSP-BF70x Processors</a>&#xFF09;&#x3002;</p><blockquote><p>Finally, it is good programming practice to reset the BP if self-modifying code is used. This will clear invalid branch entries associated with previous execution from the affected memory space from the BP table and result in correct operation. For a detailed description of the procedure for clearing the BP table, see the ADSPBF70x Blackfin+ Processor Programming Reference.</p></blockquote><p>&#x6211;&#x731C;&#x60F3;X86&#x5904;&#x7406;&#x5668;&#x7684;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5668;&#x5E94;&#x8BE5;&#x548C;&#x5176;cache&#x4E00;&#x6837;&#xFF0C;&#x6709;&#x76F8;&#x5173;&#x7684;&#x786C;&#x4EF6;&#x5904;&#x7406;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;</p><p>&#x4E0E;cache&#x7684;&#x540C;&#x6B65;&#x673A;&#x5236;&#x4E0D;&#x540C;&#xFF0C;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5668;&#x7684;&#x540C;&#x6B65;&#x673A;&#x5236;&#x903B;&#x8F91;&#x8F83;&#x4E3A;&#x7B80;&#x5355;&#xFF0C;&#x53EF;&#x4EE5;&#x4E0D;&#x6D89;&#x53CA;&#x7CFB;&#x7EDF;&#x603B;&#x7EBF;&#x7684;&#x76D1;&#x542C;&#x3002;&#x56E0;&#x4E3A;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5668;&#x5185;&#x53EA;&#x8BB0;&#x5F55;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x5BF9;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5668;&#x7684;&#x540C;&#x6B65;&#x53EA;&#x9700;&#x8981;&#x4FDD;&#x8BC1;&#x9884;&#x53D6;&#x7684;&#x5730;&#x5740;&#x6B63;&#x786E;&#x5373;&#x53EF;&#xFF0C;&#x5730;&#x5740;&#x5185;&#x7684;&#x6307;&#x4EE4;&#x6709;cache&#x7684;&#x540C;&#x6B65;&#x673A;&#x5236;&#x4FDD;&#x8BC1;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5728;&#x6BCF;&#x6B21;&#x6267;&#x884C;&#x5230;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5668;&#x4E2D;&#x8BB0;&#x5F55;&#x7684;&#x5730;&#x5740;&#x65F6;&#xFF0C;ID&#x7EA7;&#x8981;&#x68C0;&#x67E5;&#x8BE5;&#x5730;&#x5740;&#x5305;&#x542B;&#x7684;&#x6307;&#x4EE4;&#x662F;&#x5426;&#x662F;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x5219;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5668;&#x5185;&#x7684;&#x8BB0;&#x5F55;&#x4E0D;&#x52A8;&#xFF0C;&#x4F9D;&#x7167;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x6267;&#x884C;&#x7684;&#x7ED3;&#x679C;&#x76F8;&#x5E94;&#x7684;&#x66F4;&#x65B0;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5668;&#x5185;&#x8BE5;&#x8BB0;&#x5F55;&#x7684;&#x72B6;&#x6001;&#x5373;&#x53EF;&#x3002;&#x5982;&#x679C;&#x8BE5;&#x6307;&#x4EE4;&#x5728;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5668;&#x5185;&#x4F46;&#x4E0D;&#x662F;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#xFF0C;&#x8BF4;&#x660E;&#x53D1;&#x751F;&#x4E86;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#xFF0C;&#x6B64;&#x65F6;&#x5E94;&#x4F7F;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5668;&#x5185;&#x7684;&#x6761;&#x76EE;&#x5931;&#x6548;&#xFF0C;&#x5E76;&#x6839;&#x636E;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x7684;&#x7ED3;&#x679C;&#x5224;&#x65AD;&#x662F;&#x5426;&#x5C06;&#x9884;&#x53D6;&#x7684;&#x6307;&#x4EE4;&#x5E9F;&#x5F03;&#xFF0C;&#x82E5;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x7684;&#x7ED3;&#x679C;&#x662F;&#x8DF3;&#x8F6C;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x5C06;IF&#x7EA7;&#x9884;&#x53D6;&#x7684;&#x6307;&#x4EE4;&#x5E9F;&#x5F03;&#x5E76;&#x4FEE;&#x6539;NextPC&#x4E3A;PC+4&#xFF0C;&#x5426;&#x5219;&#x9884;&#x53D6;&#x7684;&#x4ECD;&#x662F;&#x6B63;&#x786E;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x4EC5;&#x5C06;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x5668;&#x5185;&#x7684;&#x6761;&#x76EE;&#x4F5C;&#x5E9F;&#x5373;&#x53EF;&#x3002;</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ID&amp;#x7EA7;&amp;#x7684;&amp;#x4EFB;&amp;#x52A1;&amp;#x662F;&amp;#x5BF9;&amp;#x6307;&amp;#x4EE4;&amp;#x8BD1;&amp;#x7801;&amp;#xFF0C;&amp;#x6839;&amp;#x636E;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x6307</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>组相联cache设计、实现与测试</title>
    <link href="https://gpthimble.github.io/%E7%BB%84%E7%9B%B8%E8%81%94cache%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/"/>
    <id>https://gpthimble.github.io/%E7%BB%84%E7%9B%B8%E8%81%94cache%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/</id>
    <published>2020-11-17T07:52:44.000Z</published>
    <updated>2020-11-18T11:38:15.013Z</updated>
    
    <content type="html"><![CDATA[<p>&#x6211;&#x5728;&#x4E0A;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#xFF0C;&#x63CF;&#x8FF0;&#x4E86;&#x6211;&#x5728;&#x8BBE;&#x8BA1;cache&#x8FC7;&#x7A0B;&#x4E2D;&#x9047;&#x5230;&#x7684;&#x56F0;&#x96BE;&#x4EE5;&#x53CA;&#x4EA7;&#x751F;&#x7684;&#x60F3;&#x6CD5;&#xFF0C;&#x63D0;&#x5230;&#x4E86;fpga&#x7247;&#x4E0A;&#x7684;RAM&#x9690;&#x542B;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x5F15;&#x8D77;&#x7684;&#x8BBE;&#x8BA1;&#x56F0;&#x96BE;&#xFF0C;cache&#x540C;&#x6B65;&#x7684;&#x95EE;&#x9898;&#x4EE5;&#x53CA;&#x672C;&#x5E73;&#x53F0;&#x76EE;&#x524D;&#x5BF9;cache&#x540C;&#x6B65;&#x673A;&#x5236;&#x7684;&#x76EE;&#x6807;&#x3002;&#x7ECF;&#x8FC7;&#x534A;&#x4E2A;&#x6708;&#x7684;&#x8BBE;&#x8BA1;&#x4E0E;&#x6D4B;&#x8BD5;&#xFF0C;&#x672C;&#x7CFB;&#x7EDF;&#x4E2D;&#x5C06;&#x8981;&#x4F7F;&#x7528;&#x7684;&#x4E24;&#x8DEF;&#x7EC4;&#x76F8;&#x8054;cache&#xFF08;2-way set associative cache&#xFF09;&#x8BBE;&#x8BA1;&#x5B8C;&#x6BD5;&#x5E76;&#x901A;&#x8FC7;&#x6D4B;&#x8BD5;&#x3002;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x4E3B;&#x8981;&#x4ECB;&#x7ECD;&#x6211;&#x7684;&#x8BBE;&#x8BA1;&#x5B9E;&#x73B0;&#x548C;&#x6D4B;&#x8BD5;&#x8FC7;&#x7A0B;&#xFF0C;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x6211;&#x6240;&#x5199;&#x7684;&#x4EE3;&#x7801;&#x7684;&#x6587;&#x6863;&#x4F7F;&#x7528;&#x3002;</p><h2 id="cache-&#x8BBE;&#x8BA1;&#x76EE;&#x6807;"><a href="#cache-&#x8BBE;&#x8BA1;&#x76EE;&#x6807;" class="headerlink" title="cache &#x8BBE;&#x8BA1;&#x76EE;&#x6807;"></a>cache &#x8BBE;&#x8BA1;&#x76EE;&#x6807;</h2><ul><li>&#x53EA;&#x9700;&#x4E00;&#x4E2A;&#x65F6;&#x949F;&#x5468;&#x671F;&#x5373;&#x53EF;&#x8BA1;&#x7B97;&#x51FA;&#x662F;&#x5426;cache&#x547D;&#x4E2D;&#xFF0C;&#x547D;&#x4E2D;&#x540E;&#x7ACB;&#x523B;&#x901A;&#x77E5;CPU</li><li>2&#x8DEF;&#x7EC4;&#x76F8;&#x8054;&#x8BBE;&#x8BA1;</li><li>cache&#x5199;&#x7B56;&#x7565;&#x4E3A;&#x5199;&#x900F;&#xFF08;&#x6BCF;&#x5F53;&#x6709;&#x5199;&#x8BF7;&#x6C42;&#xFF0C;&#x540C;&#x65F6;&#x5199;&#x5165;cache&#x548C;&#x5185;&#x5B58;&#xFF09;</li><li>cache&#x66FF;&#x6362;&#x7B56;&#x7565;&#x4E3A;&#x968F;&#x673A;&#x66FF;&#x6362;</li><li>&#x5141;&#x8BB8;&#x901A;&#x8FC7;&#x6539;&#x5199;&#x53C2;&#x6570;&#x81EA;&#x5B9A;&#x4E49;&#x65E0;&#x9700;&#x7F13;&#x5B58;&#x7684;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x4F9B;IO&#x548C;DMA&#x8BBE;&#x5907;&#x4F7F;&#x7528;</li><li>&#x5141;&#x8BB8;&#x901A;&#x8FC7;&#x6539;&#x5199;&#x53C2;&#x6570;&#x6539;&#x53D8;cache&#x7684;&#x89C4;&#x6A21;</li><li>&#x6307;&#x4EE4;&#x548C;&#x6570;&#x636E;cache&#x90FD;&#x662F;&#x672C;&#x6A21;&#x5757;&#x7684;&#x5B9E;&#x4F8B;</li><li>&#x591A;&#x4E2A;cache&#x5B9E;&#x4F8B;&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x8BBF;&#x95EE;&#x7CFB;&#x7EDF;&#x603B;&#x7EBF;</li></ul><h2 id="&#x7EC4;&#x76F8;&#x8054;cache&#x7684;&#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;"><a href="#&#x7EC4;&#x76F8;&#x8054;cache&#x7684;&#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;" class="headerlink" title="&#x7EC4;&#x76F8;&#x8054;cache&#x7684;&#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;"></a>&#x7EC4;&#x76F8;&#x8054;cache&#x7684;&#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;</h2><p>&#x7EC4;&#x76F8;&#x8054;cache&#x5E76;&#x4E0D;&#x662F;&#x9AD8;&#x5927;&#x4E0A;&#x7684;&#x6280;&#x672F;&#xFF0C;&#x5728;&#x8BB8;&#x591A;&#x53C2;&#x8003;&#x4E66;&#x4E2D;&#x90FD;&#x6709;&#x4ECB;&#x7ECD;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x73B0;&#x4EE3;&#x5904;&#x7406;&#x5668;&#x4E2D;&#x5927;&#x91CF;&#x4F7F;&#x7528;&#x3002;&#x4F46;&#x662F;&#x4E92;&#x8054;&#x7F51;&#x4E0A;&#x6709;&#x5173;&#x7EC4;&#x76F8;&#x8054;cache&#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;&#x7684;&#x6587;&#x7AE0;&#x5E76;&#x4E0D;&#x591A;&#xFF0C;&#x66F4;&#x591A;&#x7684;&#x662F;&#x5BF9;&#x5176;&#x7406;&#x8BBA;&#x6982;&#x5FF5;&#x7684;&#x63CF;&#x8FF0;&#x3002;&#x770B;&#x8D77;&#x6765;&#x7EC4;&#x76F8;&#x8054;cache&#x662F;&#x5F88;&#x7B80;&#x5355;&#x7684;&#xFF0C;&#x4F46;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x6A21;&#x5757;&#xFF0C;&#x5B9E;&#x73B0;&#x8D77;&#x6765;&#x4E5F;&#x9700;&#x8981;&#x4E0B;&#x70B9;&#x529F;&#x592B;&#x3002;<br>&#x5173;&#x4E8E;&#x7EC4;&#x76F8;&#x8054;cache&#x7684;&#x7406;&#x8BBA;&#xFF0C;&#x5728;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x91CC;&#x6211;&#x5C31;&#x4E0D;&#x8D58;&#x8FF0;&#x4E86;&#xFF0C;&#x76F4;&#x63A5;&#x5207;&#x5165;&#x6B63;&#x9898;&#x3002;<br>&#x5728;&#x672C;&#x5E73;&#x53F0;&#x4E2D;&#x4F7F;&#x7528;&#x7684;cache&#x539F;&#x7406;&#x56FE;&#x5982;&#x4E0B;&#xFF0C;&#x56FE;&#x4E2D;&#x7684;&#x4FE1;&#x53F7;&#x540D;&#x79F0;&#x548C;&#x4EE3;&#x7801;&#x4E2D;&#x7684;&#x4FE1;&#x53F7;&#x540D;&#x79F0;&#x4E00;&#x4E00;&#x5BF9;&#x5E94;&#x3002;<br><img src="/%E7%BB%84%E7%9B%B8%E8%81%94cache%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/cache.JPG" alt="2-way set associative cache"></p><p>&#x6574;&#x4E2A;cache&#x4E3B;&#x8981;&#x5206;&#x4E3A;&#x56DB;&#x90E8;&#x5206;&#xFF0C;&#x5206;&#x522B;&#x662F;&#x4E0E;CPU&#x548C;&#x603B;&#x7EBF;&#x7684;&#x63A5;&#x53E3;&#x3001;&#x5185;&#x90E8;&#x7684;&#x5B58;&#x50A8;&#x5668;&#x7EC4;&#x4EE5;&#x53CA;&#x63A7;&#x5236;&#x5355;&#x5143;&#x3002;&#x5728;&#x8FD9;&#x4E2A;&#x5E73;&#x53F0;&#x4E0A;&#xFF0C;&#x6307;&#x4EE4;cache&#x8981;&#x6BD4;&#x6570;&#x636E;cache&#x7B80;&#x5355;&#xFF0C;&#x56E0;&#x4E3A;&#x6307;&#x4EE4;cache&#x662F;&#x53EA;&#x8BFB;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5982;&#x679C;&#x4E3A;&#x6307;&#x4EE4;cache&#x548C;&#x6570;&#x636E;cache&#x6D89;&#x53CA;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x6A21;&#x5757;&#x4F1A;&#x51CF;&#x5C11;&#x5BF9;FPGA&#x8D44;&#x6E90;&#x7684;&#x5360;&#x7528;&#x3002;&#x4F46;&#x662F;&#x6211;&#x5077;&#x4E86;&#x4E2A;&#x5C0F;&#x61D2;&#xFF0C;&#x8BA9;&#x4E24;&#x4E2A;cache&#x5171;&#x7528;&#x4E00;&#x4E2A;&#x6A21;&#x5757;&#xFF0C;&#x8FD9;&#x6837;&#x5927;&#x5927;&#x51CF;&#x5C11;&#x4E86;&#x6211;&#x7684;&#x5DE5;&#x4F5C;&#x91CF;&#x3002;</p><h3 id="&#x4E0E;CPU&#x7684;&#x63A5;&#x53E3;"><a href="#&#x4E0E;CPU&#x7684;&#x63A5;&#x53E3;" class="headerlink" title="&#x4E0E;CPU&#x7684;&#x63A5;&#x53E3;"></a>&#x4E0E;CPU&#x7684;&#x63A5;&#x53E3;</h3><p>&#x5982;&#x56FE;&#x4E2D;&#x6240;&#x793A;&#xFF0C;cache&#x4E0E;cpu&#x7684;&#x63A5;&#x53E3;&#x5305;&#x62EC;&#xFF1A;</p><ul><li>CPU_stall &#x4FE1;&#x53F7;&#xFF0C;&#x8BE5;&#x4FE1;&#x53F7;&#x662F;&#x7531;CPU ID&#x7EA7;&#x7684;CU&#x6839;&#x636E;&#x4E24;&#x4E2A;cache&#x7684;&#x72B6;&#x6001;&#x4EA7;&#x751F;&#x7684;&#x53CD;&#x9988;&#x3002;</li><li>CPU_Addr &#x603B;&#x7EBF;&#x5BF9;&#x4E8E;&#x6307;&#x4EE4;cache&#x6765;&#x8BF4;&#xFF0C;&#x5E94;&#x8BE5;&#x76F4;&#x63A5;&#x4E0E;NextPC&#x591A;&#x8DEF;&#x5668;&#x7684;&#x8F93;&#x51FA;&#x76F8;&#x8FDE;&#xFF0C;&#x5BF9;&#x4E8E;&#x6570;&#x636E;cache&#x5219;&#x4E0E;EXE&#x7EA7;&#x7684;&#x5730;&#x5740;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;&#x76F4;&#x63A5;&#x76F8;&#x8FDE;&#x3002;&#x76F4;&#x63A5;&#x4E0E;&#x524D;&#x4E00;&#x7EA7;&#x8F93;&#x51FA;&#x800C;&#x4E0D;&#x662F;&#x4E0E;&#x6D41;&#x6C34;&#x7EBF;&#x5BC4;&#x5B58;&#x5668;&#x76F8;&#x8FDE;&#xFF0C;&#x662F;&#x4E3A;&#x4E86;&#x5728;&#x4F7F;&#x7528;&#x677F;&#x8F7D;RAM&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x4ECD;&#x80FD;&#x6EE1;&#x8DB3;&#x4E00;&#x4E2A;&#x5468;&#x671F;&#x5F97;&#x5230;cache&#x547D;&#x4E2D;&#x7ED3;&#x679C;&#x7684;&#x5173;&#x952E;&#x3002;&#x677F;&#x8F7D;RAM&#x4E0A;&#x6709;&#x5185;&#x7F6E;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x5982;&#x679C;&#x5730;&#x5740;&#x8F93;&#x5165;&#x4E0D;&#x4E0E;&#x524D;&#x7EA7;&#x8F93;&#x51FA;&#x76F4;&#x63A5;&#x76F8;&#x8FDE;&#xFF0C;&#x9700;&#x8981;&#x81F3;&#x5C11;&#x4E24;&#x4E2A;&#x5468;&#x671F;&#x624D;&#x53EF;&#x4EE5;&#x77E5;&#x9053;cache&#x547D;&#x4E2D;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x6570;&#x636E;&#x8981;&#x5148;&#x7ECF;&#x8FC7;&#x6D41;&#x6C34;&#x7EBF;&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x518D;&#x7ECF;&#x8FC7;&#x677F;&#x8F7D;RAM&#x5185;&#x90E8;&#x5730;&#x5740;&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x624D;&#x80FD;&#x8F93;&#x5165;&#x7ED3;&#x679C;&#x3002;</li><li>CPU_data &#x603B;&#x7EBF;&#x5BF9;&#x4E8E;&#x6307;&#x4EE4;Cache&#x6765;&#x8BF4;&#x5E94;&#x5F53;&#x5168;&#x90E8;&#x662F;&#x96F6;&#xFF0C;&#x56E0;&#x4E3A;&#x6307;&#x4EE4;cache&#x662F;&#x53EA;&#x8BFB;&#x7684;&#xFF1B;&#x5BF9;&#x4E8E;&#x6570;&#x636E;cache&#x5E94;&#x76F4;&#x63A5;&#x8FDE;&#x63A5;&#x524D;&#x4E00;&#x7EA7;&#x7684;&#x8F93;&#x51FA;&#x3002;</li><li>CPU_req &#x4FE1;&#x53F7;&#xFF0C;&#x9AD8;&#x7535;&#x5E73;&#x8868;&#x793A;&#x9700;&#x8981;&#x4ECE;cache&#x83B7;&#x53D6;&#x6570;&#x636E;&#x6216;&#x6307;&#x4EE4;&#x3002;&#x5BF9;&#x4E8E;I cache&#x800C;&#x8A00;&#xFF0C;&#x8BE5;&#x4FE1;&#x53F7;&#x5E94;&#x59CB;&#x7EC8;&#x662F;&#x9AD8;&#x7535;&#x5E73;&#xFF0C;&#x56E0;&#x4E3A;CPU&#x603B;&#x662F;&#x9700;&#x8981;&#x83B7;&#x53D6;&#x65B0;&#x7684;&#x5730;&#x5740;&#xFF1B;&#x800C;&#x5BF9;&#x4E8E;D cache&#xFF0C;&#x8BE5;&#x4FE1;&#x53F7;&#x5E94;&#x4E0E;&#x524D;&#x4E00;&#x7EA7;&#x8F93;&#x51FA;&#x76F8;&#x8FDE;&#xFF0C;&#x7531;CPU&#x7684;ID&#x7EA7;&#x7ED9;&#x51FA;&#x7684;&#x4FE1;&#x53F7;&#x63A7;&#x5236;&#xFF0C;&#x56E0;&#x4E3A;&#x4E0D;&#x662F;&#x6BCF;&#x6761;&#x6307;&#x4EE4;&#x90FD;&#x9700;&#x8981;&#x8BBF;&#x95EE;D cache&#x3002;</li><li>CPU_RW &#x4FE1;&#x53F7;&#x6807;&#x5FD7;&#x5F53;&#x524D;&#x8BF7;&#x6C42;&#x662F;&#x8BFB;&#x8BF7;&#x6C42;&#x8FD8;&#x662F;&#x5199;&#x8BF7;&#x6C42;&#x3002;&#x8BE5;&#x4FE1;&#x53F7;&#x5BF9;&#x4E8E;I cache&#x800C;&#x8A00;&#x59CB;&#x7EC8;&#x662F;&#x4F4E;&#x7535;&#x5E73;&#xFF0C;&#x56E0;&#x4E3A;&#x5176;&#x662F;&#x53EA;&#x8BFB;&#x7684;&#x3002;&#x5BF9;&#x4E8E;D cache &#x5E94;&#x76F4;&#x63A5;&#x4E0E;&#x524D;&#x4E00;&#x7EA7;&#x8F93;&#x51FA;&#x76F8;&#x8FDE;&#xFF0C;&#x7531;ID&#x7EA7;&#x63A7;&#x5236;&#x3002;</li><li>CPU_clr &#x4FE1;&#x53F7;&#x662F;&#x63A7;&#x5236;cache&#x5185;&#x90E8;&#x7684;valid bits&#x7684;&#x6E05;&#x96F6;&#x4FE1;&#x53F7;&#xFF0C;&#x5982;&#x679C;&#x8BE5;&#x4FE1;&#x53F7;&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#xFF0C;&#x5219;&#x4E0B;&#x4E00;&#x65F6;&#x949F;&#x4E0A;&#x8DF3;&#x65F6;&#x6E05;&#x9664;&#x6574;&#x4E2A;cache&#x7684;valid bits&#x3002;&#x6211;&#x4F1A;&#x5728;ID&#x7EA7;&#x5B9E;&#x73B0;&#x4E24;&#x4E2A;&#x5206;&#x522B;&#x6E05;&#x96F6;I cache &#x548C;D cache&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x7528;&#x8FD9;&#x4E2A;&#x6307;&#x4EE4;&#x63D0;&#x4F9B;&#x8F6F;&#x4EF6;&#x63A7;&#x5236;&#x7684;&#x7F13;&#x5B58;&#x540C;&#x6B65;&#x673A;&#x5236;&#x3002;&#x5F53;&#x5B58;&#x5728;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x65F6;&#xFF0C;&#x7CFB;&#x7EDF;&#x7A0B;&#x5E8F;&#x5458;&#x5E94;&#x4F7F;&#x7528;&#x76F8;&#x5E94;&#x7684;cache&#x6E05;&#x96F6;&#x6307;&#x4EE4;&#x3002;</li><li>data_o &#x662F;&#x5411;CPU&#x8F93;&#x51FA;&#x7684;&#x51C6;&#x5907;&#x597D;&#x7684;&#x6570;&#x636E;&#x3002;</li><li>ready_o &#x4FE1;&#x53F7;&#x8868;&#x793A;cache&#x662F;&#x5426;&#x51C6;&#x5907;&#x597D;&#x3002;<br>&#x5728;&#x8FD9;&#x91CC;&#x503C;&#x5F97;&#x8BF4;&#x660E;&#x7684;&#x662F;&#xFF0C;&#x7531;&#x4E8E;FPGA&#x677F;&#x8F7D;ram&#x4E0A;&#x6709;&#x5185;&#x7F6E;&#x7684;register&#xFF0C;&#x5730;&#x5740;&#x8F93;&#x5165;&#x5FC5;&#x987B;&#x76F4;&#x63A5;&#x4E0E;&#x4E0A;&#x4E00;&#x7EA7;&#x76F8;&#x8FDE;&#xFF0C;&#x8FD9;&#x5728;&#x67D0;&#x79CD;&#x7A0B;&#x5EA6;&#x4E0A;&#x4F1A;&#x5F15;&#x8D77;&#x6D41;&#x6C34;&#x7EBF;&#x5BC4;&#x5B58;&#x5668;&#x8BBE;&#x8BA1;&#x7684;&#x5272;&#x88C2;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x5C06;&#x6240;&#x6709;&#x4E0A;&#x4E00;&#x7EA7;&#x6765;&#x7684;&#x8F93;&#x5165;&#x4FE1;&#x53F7;&#x5168;&#x90E8;&#x8BBE;&#x8BA1;&#x6210;&#x4E0E;cache&#x6A21;&#x5757;&#x76F4;&#x63A5;&#x76F8;&#x8FDE;&#xFF0C;&#x5728;&#x6A21;&#x5757;&#x5185;&#x90E8;&#x5E76;&#x884C;&#x7684;&#x589E;&#x8BBE;&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x5C06;&#x4E0E;cache&#x76F8;&#x5173;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x5BC4;&#x5B58;&#x5668;&#x653E;&#x7F6E;&#x5728;cache&#x5185;&#x90E8;&#xFF0C;&#x5E76;&#x8BBE;&#x7F6E;&#x4E86;&#x8FD9;&#x4E9B;&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x8F93;&#x51FA;&#x63A5;&#x53E3;&#x5982;addr_reg_o,&#x4F9B;&#x4E0B;&#x4E00;&#x7EA7;&#x6D41;&#x6C34;&#x7EBF;&#x4F7F;&#x7528;&#x3002;</li></ul><h3 id="&#x4E0E;&#x603B;&#x7EBF;&#x7684;&#x63A5;&#x53E3;"><a href="#&#x4E0E;&#x603B;&#x7EBF;&#x7684;&#x63A5;&#x53E3;" class="headerlink" title="&#x4E0E;&#x603B;&#x7EBF;&#x7684;&#x63A5;&#x53E3;"></a>&#x4E0E;&#x603B;&#x7EBF;&#x7684;&#x63A5;&#x53E3;</h3><p>&#x5728;&#x603B;&#x7EBF;&#x63A7;&#x5236;&#x5668;&#x7684;&#x8BBE;&#x8BA1;&#x65F6;&#x6211;&#x4F7F;&#x7528;&#x4E86;&#x4E09;&#x6001;&#x95E8;&#xFF0C;&#x4F46;&#x662F;&#x5B9E;&#x9645;&#x7EFC;&#x5408;&#x51FA;&#x7684;&#x903B;&#x8F91;&#x4E0D;&#x80FD;&#x8BC6;&#x522B;&#x9AD8;&#x963B;&#x6001;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x8BBE;&#x8BA1;&#x65F6;&#x8981;&#x8003;&#x8651;&#x5BF9;&#x9AD8;&#x963B;&#x6001;&#x4FE1;&#x53F7;&#x7684;&#x5C4F;&#x853D;&#x3002;&#x603B;&#x7EBF;&#x63A5;&#x53E3;&#x5305;&#x542B;&#xFF1A;</p><ul><li>BUS_addr &#x5730;&#x5740;&#x603B;&#x7EBF;</li><li>BUS_data &#x6570;&#x636E;&#x603B;&#x7EBF;</li><li>BUS_RW &#x8BFB;&#x5199;&#x6807;&#x5FD7;</li><li>BUS_req &#x603B;&#x7EBF;&#x8BF7;&#x6C42;&#x6807;&#x5FD7;&#xFF0C;&#x8BE5;&#x4FE1;&#x53F7;&#x5E94;&#x8FDE;&#x63A5;&#x603B;&#x7EBF;&#x63A7;&#x5236;&#x5668;&#x4E0A;&#x7684;DMA[0:7],&#x6839;&#x636E;DMA&#x7F16;&#x53F7;&#x4E0D;&#x540C;&#x5B9E;&#x73B0;&#x4E0D;&#x540C;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x3002;</li><li>BUS_grant &#x603B;&#x7EBF;&#x8BF7;&#x6C42;&#x8BB8;&#x53EF;&#xFF0C;&#x8BE5;&#x4FE1;&#x53F7;&#x4ECE;&#x603B;&#x7EBF;&#x63A7;&#x5236;&#x5668;&#x53D1;&#x6765;&#xFF0C;&#x5F53;&#x603B;&#x7EBF;&#x8BF7;&#x6C42;&#x83B7;&#x5F97;&#x63A7;&#x5236;&#x5668;&#x7684;&#x8BB8;&#x53EF;&#x540E;&#x8BE5;&#x4FE1;&#x53F7;&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#xFF0C;&#x8BE5;&#x4FE1;&#x53F7;&#x4E3B;&#x8981;&#x53C2;&#x4E0E;&#x603B;&#x7EBF;&#x63A5;&#x53E3;&#x4E09;&#x6001;&#x95E8;&#x7684;&#x63A7;&#x5236;&#x3002;</li><li>BUS_ready &#x4FE1;&#x53F7;&#xFF0C;&#x9AD8;&#x7535;&#x5E73;&#x6807;&#x5FD7;&#x603B;&#x7EBF;&#x8BF7;&#x6C42;&#x7ED3;&#x675F;&#x3002;</li></ul><p>&#x7CFB;&#x7EDF;&#x603B;&#x7EBF;&#x63A5;&#x53E3;&#x8FD9;&#x90E8;&#x5206;&#x7684;&#x4EE3;&#x7801;&#x4E3B;&#x8981;&#x662F;&#x5BF9;&#x603B;&#x7EBF;&#x4E0A;&#x4E09;&#x6001;&#x95E8;&#x7684;&#x63A7;&#x5236;&#xFF0C;&#x903B;&#x8F91;&#x8BBE;&#x8BA1;&#x8981;&#x4FDD;&#x8BC1;&#x603B;&#x7EBF;&#x4E0A;&#x5176;&#x4ED6;&#x8BBE;&#x5907;&#x7684;&#x4FE1;&#x53F7;&#x4E0D;&#x80FD;&#x5E72;&#x6270;&#x672C;&#x8BBE;&#x5907;&#x3002;<br>&#x9996;&#x5148;&#x8981;&#x4FDD;&#x8BC1;&#x5F53;&#x4E14;&#x4EC5;&#x5F53;&#x603B;&#x7EBF;&#x8BF7;&#x6C42;&#x88AB;&#x63A7;&#x5236;&#x5668;&#x5141;&#x8BB8;&#x540E;&#x624D;&#x80FD;&#x5411;&#x603B;&#x7EBF;&#x53D1;&#x9001;&#x6570;&#x636E;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//BUS Interface</span></span><br><span class="line">    <span class="hljs-keyword">assign</span> BUS_addr = BUS_grant ? addr_reg : <span class="hljs-number">32&apos;bz</span>;</span><br><span class="line">    <span class="hljs-keyword">assign</span> BUS_RW = BUS_grant ? CPU_RW_reg : <span class="hljs-number">1&apos;bz</span>;</span><br></pre></td></tr></table></figure><p>&#x540C;&#x65F6;&#x4E5F;&#x8981;&#x786E;&#x4FDD;&#x53EA;&#x6536;&#x5230;&#x53D1;&#x9001;&#x7ED9;&#x81EA;&#x5DF1;&#x7684;ready&#x4FE1;&#x53F7;,&#x5728;&#x81EA;&#x5DF1;&#x6CA1;&#x6709;&#x603B;&#x7EBF;&#x8BF7;&#x6C42;&#x65F6;&#x8FC7;&#x6EE4;&#x6389;&#x603B;&#x7EBF;&#x7684;ready&#x4FE1;&#x53F7;&#xFF0C;&#x4FDD;&#x8BC1;ready&#x4FE1;&#x53F7;&#x7EBF;&#x4E0A;&#x7684;&#x9AD8;&#x963B;&#x6001;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x81EA;&#x5DF1;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">wire</span> ready_in = BUS_grant ? BUS_ready : <span class="hljs-number">1&apos;b0</span>;</span><br></pre></td></tr></table></figure><p>&#x603B;&#x7EBF;&#x7684;&#x6570;&#x636E;&#x63A5;&#x53E3;&#x662F;&#x53CC;&#x5411;&#x63A5;&#x53E3;&#xFF0C;&#x5411;&#x603B;&#x7EBF;&#x53D1;&#x9001;&#x5199;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x76F4;&#x63A5;&#x5C06;&#x6570;&#x636E;&#x9001;&#x81F3;&#x6570;&#x636E;&#x603B;&#x7EBF;&#xFF1B;&#x53D1;&#x8D77;&#x8BFB;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x5E94;&#x8BBE;&#x7F6E;&#x4E3A;&#x9AD8;&#x963B;&#x6001;&#xFF0C;&#x76F4;&#x63A5;&#x4ECE;&#x6570;&#x636E;&#x603B;&#x7EBF;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] data_to_bus = CPU_RW_reg ? data_reg : <span class="hljs-number">32&apos;bz</span>;</span><br><span class="line"><span class="hljs-keyword">assign</span> BUS_data = BUS_grant ? data_to_bus : <span class="hljs-number">32&apos;bz</span>;</span><br></pre></td></tr></table></figure><p>&#x5728;&#x8BFB;cache&#x4E0D;&#x547D;&#x4E2D;&#x3001;&#x5199;&#x5165;&#x6216;&#x8BFB;&#x5199;&#x4E0D;&#x9700;&#x8981;cache&#x7684;&#x5730;&#x5740;&#x65F6;&#xFF0C;&#x624D;&#x5E94;&#x50CF;&#x603B;&#x7EBF;&#x53D1;&#x8D77;&#x8BF7;&#x6C42;&#xFF0C;&#x5176;&#x4ED6;&#x60C5;&#x51B5;&#x8BA9;&#x51FA;&#x603B;&#x7EBF;&#x7684;&#x63A7;&#x5236;&#x6743;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">assign</span> BUS_req = CPU_req_reg &amp;&amp; ((~CPU_RW_reg &amp;&amp; ~CACHE_HIT_R )</span><br><span class="line">            ||(CPU_RW_reg &amp;&amp; ~ready_reg));</span><br></pre></td></tr></table></figure><p>&#x503C;&#x5F97;&#x8BF4;&#x660E;&#x7684;&#x4E00;&#x70B9;&#x662F;&#xFF0C;&#x7531;&#x4E8E;&#x6A21;&#x5757;&#x7684;&#x8F93;&#x5165;&#x90FD;&#x662F;&#x4E0A;&#x4E00;&#x7EA7;&#x7684;&#x76F4;&#x63A5;&#x8F93;&#x5165;&#xFF0C;&#x5BC4;&#x5B58;&#x5668;&#x5728;&#x6A21;&#x5757;&#x7684;&#x5185;&#x90E8;&#xFF0C;&#x800C;&#x4E14;cache&#x7684;ready&#x4FE1;&#x53F7;&#x4E0E;cpu&#x7684;stall&#x4FE1;&#x53F7;&#x76F4;&#x63A5;&#x6709;&#x5173;&#xFF0C;&#x56E0;&#x6B64;&#x63A7;&#x5236;&#x4FE1;&#x53F7;&#x7684;&#x903B;&#x8F91;&#x9700;&#x8981;&#x5C0F;&#x5FC3;&#x8BBE;&#x8BA1;&#xFF0C;&#x907F;&#x514D;&#x51FA;&#x73B0;&#x7EC4;&#x5408;&#x903B;&#x8F91;&#x73AF;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;cache&#x7684;ready&#x4FE1;&#x53F7;&#x5E94;&#x8BE5;&#x53EA;&#x548C;&#x6A21;&#x5757;&#x5185;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x503C;&#x6709;&#x5173;&#x7CFB;&#xFF0C;&#x4E0D;&#x5E94;&#x5F53;&#x4E0E;stall&#x4FE1;&#x53F7;&#x76F4;&#x63A5;&#x76F8;&#x5173;&#x3002;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x603B;&#x7EBF;&#x63A5;&#x53E3;&#x7684;&#x8BBE;&#x8BA1;&#x9075;&#x5FAA;&#x4E86;&#x8FD9;&#x6837;&#x7684;&#x539F;&#x5219;&#x3002;&#x5F53;&#x603B;&#x7EBF;ready&#x65F6;&#xFF0C;cache&#x5E94;&#x540C;&#x65F6;&#x7ED9;cpu ready&#x4FE1;&#x53F7;&#xFF0C;&#x56E0;&#x6B64;cache&#x7684;ready&#x4FE1;&#x53F7;&#x4E0E;&#x603B;&#x7EBF;&#x7684;&#x72B6;&#x6001;&#x6709;&#x5173;&#xFF0C;&#x603B;&#x7EBF;&#x7684;&#x72B6;&#x6001;&#x4E5F;&#x5E94;&#x8BE5;&#x4EC5;&#x4E0E;&#x5BC4;&#x5B58;&#x5668;&#x4E2D;&#x7684;&#x503C;&#x76F8;&#x5173;&#x3002;&#x5728;&#x603B;&#x7EBF;&#x63A5;&#x53E3;&#x90E8;&#x5206;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x63A7;&#x5236;&#x4FE1;&#x53F7;&#x5747;&#x4F7F;&#x7528;&#x5BC4;&#x5B58;&#x5668;&#x4E2D;&#x7684;&#x503C;&#x800C;&#x4E0D;&#x662F;&#x4E0A;&#x4E00;&#x7EA7;&#x7684;&#x76F4;&#x63A5;&#x8F93;&#x5165;&#x3002;</p><h3 id="cache&#x5185;&#x90E8;&#x7684;&#x5B58;&#x50A8;&#x5668;"><a href="#cache&#x5185;&#x90E8;&#x7684;&#x5B58;&#x50A8;&#x5668;" class="headerlink" title="cache&#x5185;&#x90E8;&#x7684;&#x5B58;&#x50A8;&#x5668;"></a>cache&#x5185;&#x90E8;&#x7684;&#x5B58;&#x50A8;&#x5668;</h3><p>&#x5982;&#x56FE;&#x6240;&#x793A;&#xFF0C;cache&#x5185;&#x90E8;&#x5171;&#x6709;&#x4E09;&#x7C7B;&#x5B58;&#x50A8;&#x5668;&#xFF0C;&#x5206;&#x522B;&#x5B58;&#x50A8;TAG&#x3001;&#x6709;&#x6548;&#x4F4D;(valid bits)&#x548C;&#x5B9E;&#x9645;&#x8BF7;&#x6C42;&#x7684;&#x6570;&#x636E;(RAM)&#x3002;<br>&#x8FD9;&#x4E2A;cache&#x6A21;&#x5757;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6539;&#x5199;&#x53C2;&#x6570;&#x7684;&#x65B9;&#x5F0F;&#x6539;&#x53D8;cache&#x7684;&#x89C4;&#x6A21;&#xFF0C;cache&#x7684;&#x89C4;&#x6A21;&#x7531;&#x7D22;&#x5F15;&#x7684;&#x5BBD;&#x5EA6;INDEX&#x8868;&#x793A;,INDEX&#x9ED8;&#x8BA4;&#x503C;&#x662F;7&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x5185;&#x5B58;&#x5730;&#x5740;&#x51FA;&#x53BB;&#x5B57;&#x5185;&#x5730;&#x5740;&#x4F4E;&#x4E24;&#x4F4D;,[INDEX+1:2]&#x8FD9;&#x4E2A;&#x8303;&#x56F4;&#x4F5C;&#x4E3A;&#x4E03;&#x4F4D;&#x7684;&#x7D22;&#x5F15;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x7D22;&#x5F15;cache_lines = 2&lt;&lt; (INDEX -1) &#x884C;&#xFF0C;&#x5728;TAG&#x4E2D;&#x5B58;&#x50A8;&#x7684;TAG&#x5C3A;&#x5BF8;&#x4E3A;tag_size = 32-2- INDEX&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//Number of Lines in each group.</span></span><br><span class="line">    <span class="hljs-keyword">localparam</span> cache_lines = <span class="hljs-number">2</span>&lt;&lt; (INDEX -<span class="hljs-number">1</span>);</span><br><span class="line">    <span class="hljs-keyword">localparam</span> tag_size = <span class="hljs-number">32</span>-<span class="hljs-number">2</span>- INDEX;</span><br><span class="line"><span class="hljs-comment">//default size of the cache is two 512 bytes (128 lines) set, total size is 1KB.</span></span><br><span class="line">    <span class="hljs-keyword">parameter</span> INDEX=<span class="hljs-number">7</span>;</span><br><span class="line">    <span class="hljs-keyword">parameter</span> WIDTH=<span class="hljs-number">32</span>;</span><br></pre></td></tr></table></figure><p>&#x6240;&#x8C13;2&#x8DEF;&#x7EC4;&#x76F8;&#x8054;&#xFF0C;&#x610F;&#x601D;&#x662F;&#x6BCF;&#x4E2A;index&#x53EF;&#x4EE5;&#x7D22;&#x5F15;&#x4E24;&#x7EC4;&#x5185;&#x5BB9;&#xFF0C;&#x5206;&#x522B;&#x5B58;&#x653E;&#x5728;A&#x3001;B&#x4E24;&#x7EC4;TAG&#x3001;valid bits&#x548C;RAM&#x4E2D;&#xFF0C;&#x540C;&#x65F6;&#x5BF9;&#x6BD4;&#x4E24;&#x7EC4;&#x7684;TAG&#x548C;Valid bits&#xFF0C;&#x5F97;&#x5230;cache&#x547D;&#x4E2D;&#x7ED3;&#x679C;&#x3002;&#x5BF9;&#x6BD4;&#x76F4;&#x63A5;&#x955C;&#x50CF;&#x7684;&#x597D;&#x5904;&#x662F;&#x81EA;&#x7531;&#x5EA6;&#x66F4;&#x5927;&#x4E00;&#x4E9B;&#xFF0C;&#x5F53;&#x8BFB;&#x53D6;&#x5230;&#x4E24;&#x4E2A;index&#x76F8;&#x540C;&#x7684;&#x5185;&#x5B58;&#x5730;&#x5740;&#x65F6;&#xFF0C;&#x8FD9;&#x4E24;&#x4E2A;&#x6570;&#x636E;&#x90FD;&#x53EF;&#x4EE5;&#x5B58;&#x653E;&#x5728;cache&#x4E2D;&#xFF0C;&#x800C;&#x5728;&#x76F4;&#x63A5;&#x955C;&#x50CF;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6B64;&#x65F6;&#x5C31;&#x4F1A;&#x53D1;&#x751F;cache&#x66FF;&#x6362;&#x3002;<br>&#x9996;&#x5148;&#x5B9A;&#x4E49;index&#x548C;tag&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//vector index is for indexing the whole cache.</span></span><br><span class="line"><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] addr = CPU_stall ? addr_reg : CPU_addr;</span><br><span class="line"><span class="hljs-keyword">wire</span> [INDEX-<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] index = addr[INDEX+<span class="hljs-number">1</span> :<span class="hljs-number">2</span>];</span><br><span class="line"><span class="hljs-keyword">wire</span> [INDEX-<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] index_reg = addr_reg[INDEX+<span class="hljs-number">1</span> :<span class="hljs-number">2</span>];</span><br><span class="line"><span class="hljs-comment">//vector tag is used to determined if there&apos;s a cache hit, if not, new tag is written</span></span><br><span class="line"><span class="hljs-comment">//in the tag storage. </span></span><br><span class="line"><span class="hljs-keyword">wire</span> [tag_size-<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] tag_reg = addr_reg [<span class="hljs-number">31</span>:INDEX+<span class="hljs-number">2</span>];</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x5B9A;&#x4E49;TAG&#x3001;Valid bits&#x548C;RAM&#x4E09;&#x4E2A;&#x5B58;&#x50A8;&#x5668;&#x3002;&#x4EE5;&#x5176;&#x4E2D;A&#x7EC4;&#x4E3A;&#x4F8B;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//Memory for TAG_A.</span></span><br><span class="line"><span class="hljs-keyword">reg</span> [tag_size-<span class="hljs-number">1</span> : <span class="hljs-number">0</span>] TAG_A [<span class="hljs-number">0</span> : cache_lines-<span class="hljs-number">1</span>];</span><br><span class="line"><span class="hljs-keyword">reg</span> [tag_size-<span class="hljs-number">1</span> : <span class="hljs-number">0</span>] TAG_A_out;</span><br><span class="line"><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk)</span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (WE_A) </span><br><span class="line">        TAG_A [index_reg] = tag_reg;</span><br><span class="line">    TAG_A_out = TAG_A [index];</span><br><span class="line"><span class="hljs-keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//valid bits for group A.</span></span><br><span class="line"><span class="hljs-keyword">reg</span> VALID_A_out ;</span><br><span class="line"><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk)</span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (clr || cache_clr)</span><br><span class="line">        VALID_A = <span class="hljs-number">32&apos;b0</span>;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (WE_A) </span><br><span class="line">        VALID_A[index_reg] =<span class="hljs-number">1</span>;</span><br><span class="line">    VALID_A_out = VALID_A[index];</span><br><span class="line"><span class="hljs-keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//memory for group A.</span></span><br><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] RAM_A [<span class="hljs-number">0</span> : cache_lines-<span class="hljs-number">1</span>];</span><br><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] RAM_A_out;</span><br><span class="line"><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk)</span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (WE_A)</span><br><span class="line">        RAM_A[index_reg] = RAM_in;</span><br><span class="line"></span><br><span class="line">    RAM_A_out = RAM_A[index];</span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x4E9B;&#x7EC6;&#x8282;&#x503C;&#x5F97;&#x8BF4;&#x660E;&#x3002;index&#x4FE1;&#x53F7;&#x662F;&#x5BF9;addr&#x7684;&#x622A;&#x53D6;&#xFF0C;addr&#x6839;&#x636E;&#x5F53;&#x524D;cpu&#x7684;&#x72B6;&#x6001;&#x9009;&#x62E9;&#x76F4;&#x63A5;&#x4ECE;&#x4E0A;&#x4E00;&#x7EA7;&#x6D41;&#x6C34;&#x8F93;&#x5165;&#x7684;&#x5730;&#x5740;&#x6216;&#x662F;&#x5185;&#x90E8;&#x5BC4;&#x5B58;&#x7684;&#x5730;&#x5740;&#x3002;index_reg&#x662F;&#x4ECE;&#x5185;&#x90E8;&#x7684;&#x5730;&#x5740;&#x5BC4;&#x5B58;&#x5668;&#x622A;&#x53D6;&#x7684;&#x3002;&#x540C;&#x65F6;&#x4F7F;&#x7528;&#x4E24;&#x4E2A;&#x4FE1;&#x53F7;&#x662F;&#x5B9E;&#x73B0;&#x5355;&#x4E2A;&#x5468;&#x671F;&#x8BA1;&#x7B97;&#x662F;&#x5426;cache&#x547D;&#x4E2D;&#x7684;&#x5173;&#x952E;&#x3002;&#x5728;&#x4E0A;&#x8FF0;&#x7684;&#x4E09;&#x4E2A;&#x5B58;&#x50A8;&#x5668;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6240;&#x6709;&#x7684;&#x8BFB;&#x63A5;&#x53E3;&#x7684;&#x7D22;&#x5F15;&#x90FD;&#x4F7F;&#x7528;index&#xFF0C;&#x8FD9;&#x5C31;&#x4FDD;&#x8BC1;&#x4E86;&#x5728;&#x7B2C;&#x4E00;&#x4E2A;&#x65F6;&#x949F;&#x5468;&#x671F;&#x4E0A;&#x8DF3;&#xFF0C;&#x5B58;&#x50A8;&#x5668;&#x5C31;&#x5DF2;&#x7ECF;&#x5C06;&#x65B0;&#x8BFB;&#x53D6;&#x7ED3;&#x679C;&#x3002;&#x800C;&#x5BF9;&#x8FD9;&#x4E9B;&#x5B58;&#x50A8;&#x7684;&#x4FEE;&#x6539;&#x4EC5;&#x5F53;cache&#x4E0D;&#x547D;&#x4E2D;&#x6216;&#x8005;&#x5199;&#x900F;&#x65F6;&#x624D;&#x53D1;&#x751F;&#xFF0C;&#x56E0;&#x6B64;&#x5199;&#x5165;&#x6700;&#x65E9;&#x5E94;&#x8BE5;&#x53D1;&#x751F;&#x5728;&#x4E0B;&#x4E00;&#x5468;&#x671F;&#x4E0A;&#x8FB9;&#x6CBF;&#xFF08;&#x56E0;&#x4E3A;&#x603B;&#x7EBF;&#x4E0A;&#x7684;&#x8BBE;&#x5907;&#x7684;&#x54CD;&#x5E94;&#x65F6;&#x95F4;&#x4E0D;&#x540C;&#xFF0C;&#x5982;&#x679C;&#x603B;&#x7EBF;&#x4E0A;&#x7684;&#x8BBE;&#x5907;&#x80FD;&#x591F;&#x5728;&#x5F53;&#x524D;&#x5468;&#x671F;&#x5185;&#x76F8;&#x5E94;&#xFF0C;&#x5C31;&#x662F;&#x6240;&#x8C13;&#x7684;&#x6700;&#x65E9;&#x7684;&#x60C5;&#x51B5;&#xFF09;&#xFF0C;&#x800C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x4E0A;&#x4E00;&#x7EA7;&#x6D41;&#x6C34;&#x8F93;&#x51FA;&#x7684;&#x4FE1;&#x53F7;&#x5DF2;&#x7ECF;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x5E76;&#x4E0D;&#x80FD;&#x963B;&#x6B62;&#x8FD9;&#x79CD;&#x6539;&#x53D8;&#x53D1;&#x751F;&#xFF0C;&#x56E0;&#x6B64;&#x6240;&#x6709;&#x7684;&#x5199;&#x5165;&#x4FE1;&#x53F7;&#x90FD;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x5185;&#x90E8;&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x8F93;&#x51FA;&#xFF08;&#x8FD9;&#x4E2A;&#x5185;&#x90E8;&#x5BC4;&#x5B58;&#x5668;&#x5C31;&#x662F;&#x6D41;&#x6C34;&#x7EBF;&#x5BC4;&#x5B58;&#x5668;&#xFF09;&#x3002;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4F7F;&#x7528;stall&#x4FE1;&#x53F7;&#x6765;&#x533A;&#x5206;cpu&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x5982;&#x679C;&#x6B64;&#x65F6;stall&#x4FE1;&#x53F7;&#x4E3A;&#x4F4E;&#x7535;&#x5E73;&#xFF0C;&#x8FD9;&#x8BF4;&#x660E;cpu&#x5728;&#x5904;&#x7406;&#x65B0;&#x6307;&#x4EE4;&#xFF0C;index&#x7684;&#x503C;&#x662F;&#x76F4;&#x63A5;&#x4ECE;&#x4E0A;&#x4E00;&#x7EA7;&#x622A;&#x53D6;&#x7684;&#xFF0C;&#x4F7F;&#x7528;index&#x63D0;&#x4F9B;&#x7684;&#x7D22;&#x5F15;&#x8BFB;&#x53D6;cache&#x5185;&#x90E8;&#x5B58;&#x50A8;&#x5224;&#x65AD;&#x662F;&#x5426;&#x547D;&#x4E2D;&#xFF0C;&#x82E5;&#x4E0D;&#x547D;&#x4E2D;&#xFF0C;&#x5219;&#x7B49;&#x5F85;&#x603B;&#x7EBF;&#x54CD;&#x5E94;&#xFF0C;&#x540C;&#x65F6;&#x901A;&#x8FC7;ready&#x4FE1;&#x53F7;&#x4F7F;cpu&#x6682;&#x505C;&#xFF0C;&#x6B64;&#x65F6;stall&#x4FE1;&#x53F7;&#x4E3A;&#x9AD8;&#x7535;&#x5E73;&#xFF0C;&#x6B64;&#x540E;&#x7684;&#x5468;&#x671F;&#x76F4;&#x5230;&#x7F13;&#x5B58;&#x51C6;&#x5907;&#x597D;&#xFF0C;&#x8BFB;&#x8BF7;&#x6C42;&#x7684;&#x7D22;&#x5F15;index&#x90FD;&#x88AB;stall&#x4FE1;&#x53F7;&#x9009;&#x62E9;&#x6210;&#x5185;&#x90E8;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x8F93;&#x51FA;&#xFF0C;&#x53EF;&#x786E;&#x4FDD;&#x5728;&#x4E0A;&#x4E00;&#x8BF7;&#x6C42;&#x6CA1;&#x5B8C;&#x6210;&#x65F6;&#x7EE7;&#x7EED;&#x8BFB;&#x53D6;&#x4E0A;&#x4E00;&#x7D22;&#x5F15;&#x3002;<br>&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x4E86;&#x963B;&#x585E;&#x8D4B;&#x503C;&#x8BED;&#x53E5;&#xFF0C;&#x5BF9;&#x4E8E;&#x540C;&#x65F6;&#x5199;&#x5165;&#x548C;&#x8BFB;&#x53D6;&#x540C;&#x4E00;&#x4E2A;&#x5730;&#x5740;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x8BFB;&#x53D6;&#x7684;&#x7ED3;&#x679C;&#x662F;&#x5199;&#x5165;&#x7684;&#x65B0;&#x503C;&#xFF0C;&#x7EFC;&#x5408;&#x7684;&#x7ED3;&#x679C;&#x4F1A;&#x52A0;&#x5165;&#x4E00;&#x4E9B;&#x6570;&#x636E;&#x65C1;&#x8DEF;&#x6765;&#x7B26;&#x5408;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x7684;&#x884C;&#x4E3A;&#x3002;&#x603B;&#x662F;&#x8BFB;&#x53D6;&#x65B0;&#x503C;&#x5728;&#x6211;&#x7684;&#x8BBE;&#x8BA1;&#x4E2D;&#x662F;&#x5FC5;&#x8981;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x5F53;&#x603B;&#x7EBF;&#x51C6;&#x5907;&#x597D;&#x65F6;&#xFF0C;&#x5F53;&#x524D;cache&#x4E5F;&#x51C6;&#x5907;&#x597D;&#xFF0C;&#x800C;&#x6B64;&#x65F6;&#x53E6;&#x4E00;&#x4E2A;cache&#x53EF;&#x80FD;&#x5C1A;&#x672A;&#x51C6;&#x5907;&#x597D;&#x6B63;&#x5728;&#x8BF7;&#x6C42;&#x603B;&#x7EBF;&#xFF0C;&#x56E0;&#x6B64;cpu&#x8981;&#x7EE7;&#x7EED;&#x7B49;&#x5F85;&#x3002;&#x6B64;&#x65F6;&#x4E0B;&#x4E00;&#x4E2A;&#x65F6;&#x949F;&#x4E0A;&#x8FB9;&#x6CBF;&#xFF0C;&#x5F53;&#x524D;cache&#x5C06;&#x65B0;&#x7684;TAG&#x3001;Valid bit&#x548C;RAM&#x5199;&#x5165;cache&#xFF0C;&#x4F46;&#x662F;&#x603B;&#x7EBF;&#x4E0A;&#x7684;ready&#x4FE1;&#x53F7;&#x968F;&#x5373;&#x6D88;&#x5931;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;&#x8FD9;&#x4E2A;&#x65F6;&#x949F;&#x4E0A;&#x8FB9;&#x6CBF;&#x76F4;&#x63A5;&#x53D6;&#x5F97;cache&#x547D;&#x4E2D;&#x4FE1;&#x53F7;&#xFF0C;&#x8BA9;cpu&#x7B49;&#x5F85;&#x65F6;&#x4E0D;&#x9519;&#x8FC7;&#x8FD9;&#x6B21;&#x8BF7;&#x6C42;&#x7684;cache&#x4FE1;&#x53F7;&#x3002;&#x603B;&#x662F;&#x8BFB;&#x53D6;&#x65B0;&#x503C;&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x5728;&#x603B;&#x7EBF;&#x51C6;&#x5907;&#x597D;&#x540E;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x65F6;&#x949F;&#x4E0A;&#x8FB9;&#x6CBF;&#x5C31;&#x80FD;&#x8F93;&#x51FA;cache&#x547D;&#x4E2D;&#x4FE1;&#x53F7;&#x3002;<br>&#x5BF9;&#x4E8E;valid bits&#xFF0C;&#x7531;&#x4E8E;&#x5B58;&#x5728;&#x7740;&#x6E05;&#x96F6;&#x4FE1;&#x53F7;&#xFF0C;&#x7531;&#x4E8E;altera&#x7684;&#x677F;&#x8F7D;&#x5B58;&#x50A8;&#x4E0D;&#x652F;&#x6301;&#x6E05;&#x96F6;&#x4FE1;&#x53F7;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x4F1A;&#x88AB;&#x7EFC;&#x5408;&#x6210;&#x5BC4;&#x5B58;&#x5668;&#x3002;&#x800C;&#x5176;&#x4ED6;&#x4E24;&#x5757;&#x5B58;&#x50A8;&#x4F1A;&#x88AB;&#x7EFC;&#x5408;&#x6210;&#x5B58;&#x50A8;&#x5668;&#xFF0C;&#x4F7F;&#x7528;&#x7247;&#x4E0A;&#x7684;RAM&#x8D44;&#x6E90;&#x3002;&#x6211;&#x6240;&#x8BBE;&#x60F3;&#x7684;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;&#x662F;&#x4E0D;&#x7528;&#x5546;&#x4E1A;IP&#xFF0C;&#x4E0E;FPGA&#x65E0;&#x5173;&#xFF0C;&#x4F7F;&#x7528;&#x6807;&#x51C6;&#x7684;&#x786C;&#x4EF6;&#x63CF;&#x8FF0;&#x8BED;&#x8A00;&#x8BBE;&#x8BA1;&#xFF0C;&#x5728;&#x6CA1;&#x6709;&#x7247;&#x4E0A;RAM&#x8D44;&#x6E90;&#x7684;FPGA&#x4E0A;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4ECD;&#x7136;&#x80FD;&#x591F;&#x7EFC;&#x5408;&#xFF0C;&#x4E0D;&#x8FC7;&#x8981;&#x6D88;&#x8017;&#x5927;&#x91CF;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x8D44;&#x6E90;&#x3002;<br>valid bits&#x7684;&#x8BFB;&#x51FA;&#x5E94;&#x8BE5;&#x662F;&#x5BC4;&#x5B58;&#x5668;&#x800C;&#x4E0D;&#x662F;assign&#x8FDE;&#x7EED;&#x8D4B;&#x503C;&#xFF0C;&#x56E0;&#x4E3A;valid bit&#x7684;&#x8F93;&#x51FA;&#x76F4;&#x63A5;&#x5173;&#x7CFB;&#x5230;ready&#x4FE1;&#x53F7;&#xFF0C;&#x800C;index&#x4E0E;stall&#x4FE1;&#x53F7;&#x6709;&#x5173;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x8FDE;&#x7EED;&#x8D4B;&#x503C;&#xFF0C;&#x4F1A;&#x4EA7;&#x751F;&#x7EC4;&#x5408;&#x903B;&#x8F91;&#x5FAA;&#x73AF;&#x3002;</p><h4 id="&#x9488;&#x5BF9;&#x4E0D;&#x9700;cache&#x7684;&#x5730;&#x5740;&#x8303;&#x56F4;&#x7684;&#x7279;&#x6B8A;&#x8BBE;&#x8BA1;"><a href="#&#x9488;&#x5BF9;&#x4E0D;&#x9700;cache&#x7684;&#x5730;&#x5740;&#x8303;&#x56F4;&#x7684;&#x7279;&#x6B8A;&#x8BBE;&#x8BA1;" class="headerlink" title="&#x9488;&#x5BF9;&#x4E0D;&#x9700;cache&#x7684;&#x5730;&#x5740;&#x8303;&#x56F4;&#x7684;&#x7279;&#x6B8A;&#x8BBE;&#x8BA1;"></a>&#x9488;&#x5BF9;&#x4E0D;&#x9700;cache&#x7684;&#x5730;&#x5740;&#x8303;&#x56F4;&#x7684;&#x7279;&#x6B8A;&#x8BBE;&#x8BA1;</h4><p>&#x6211;&#x6240;&#x8BBE;&#x8BA1;&#x7684;CPU&#x91C7;&#x7528;memory mapped IO&#x8BBE;&#x8BA1;&#xFF0C;IO&#x4F7F;&#x7528;&#x8BBF;&#x5B58;&#x6307;&#x4EE4;&#x6765;&#x63A7;&#x5236;&#x3002;&#x5728;&#x4E0D;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x786C;&#x4EF6;&#x7F13;&#x5B58;&#x540C;&#x6B65;&#x673A;&#x5236;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;IO&#x6240;&#x4F7F;&#x7528;&#x7684;&#x5730;&#x5740;&#x8303;&#x56F4;&#x4F1A;&#x4EA7;&#x751F;cache&#x540C;&#x6B65;&#x95EE;&#x9898;&#x3002;&#x6211;&#x91C7;&#x53D6;MIPS&#x7684;&#x505A;&#x6CD5;&#xFF0C;&#x5728;&#x4E0D;&#x9700;&#x8981;cache&#x7684;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x4E2D;&#x7ED5;&#x8FC7;cache&#x3002;<br>&#x5177;&#x4F53;&#x505A;&#x6CD5;&#x5E76;&#x4E0D;&#x590D;&#x6742;&#x3002;<br>&#x9996;&#x5148;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x5BC4;&#x5B58;&#x5668;NO_CACHE&#x5224;&#x65AD;&#x5F53;&#x524D;&#x8BF7;&#x6C42;&#x7684;&#x5730;&#x5740;&#x662F;&#x5426;&#x5728;&#x4E0D;&#x9700;&#x8981;cache&#x7684;&#x8303;&#x56F4;,&#x8BE5;&#x5BC4;&#x5B58;&#x5668;&#x4EC5;&#x5728;&#x83B7;&#x53D6;&#x65B0;&#x8BF7;&#x6C42;&#x65F6;&#x66F4;&#x65B0;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">reg</span> NO_CACHE;</span><br><span class="line"><span class="hljs-keyword">always</span>@(<span class="hljs-keyword">posedge</span> clk)</span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (clr) </span><br><span class="line">        NO_CACHE &lt;= <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (~ CPU_stall) </span><br><span class="line">        NO_CACHE &lt;= (addr &lt;= no_cache_end) &amp;&amp; (addr &gt;=no_cache_start);</span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x5F15;&#x5165;&#x7EC4;C&#x4F5C;&#x4E3A;&#x4F5C;&#x4E3A;&#x8FD9;no cache&#x533A;&#x57DF;&#x7684;&#x7F13;&#x5B58;&#x3002;&#x8BBE;&#x8BA1;&#x8FD9;&#x7EC4;&#x7F13;&#x5B58;&#x662F;&#x5FC5;&#x8981;&#x7684;&#xFF0C;&#x539F;&#x56E0;&#x4E0A;&#x9762;&#x5DF2;&#x7ECF;&#x4ECB;&#x7ECD;&#x4E86;&#x3002;&#x56E0;&#x4E3A;&#x6BCF;&#x6B21;&#x5BF9;&#x8FD9;&#x4E00;&#x5730;&#x5740;&#x8303;&#x56F4;&#x7684;&#x8BF7;&#x6C42;&#x90FD;&#x662F;cache&#x4E0D;&#x547D;&#x4E2D;&#xFF0C;&#x90FD;&#x9700;&#x8981;&#x4ECE;&#x603B;&#x7EBF;&#x4E0A;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x3002;&#x603B;&#x7EBF;&#x4E0A;&#x7684;&#x6570;&#x636E;&#x4EC5;&#x4EC5;&#x5B58;&#x5728;&#x4E00;&#x4E2A;&#x5468;&#x671F;&#x5373;&#x603B;&#x7EBF;ready&#x7684;&#x90A3;&#x4E2A;&#x5468;&#x671F;&#x3002;&#x5982;&#x679C;CPU&#x5728;&#x8FD9;&#x4E2A;&#x5468;&#x671F;&#x7531;&#x4E8E;&#x5176;&#x4ED6;&#x7684;&#x539F;&#x56E0;stall&#xFF0C;CPU&#x5C31;&#x4F1A;&#x9519;&#x8FC7;&#x603B;&#x7EBF;&#x4E0A;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x5728;&#x8FD9;&#x5F15;&#x5165;&#x989D;&#x5916;&#x7684;&#x4E00;&#x7EC4;C&#xFF0C;C&#x7EC4;&#x6CA1;&#x6709;TAG&#xFF0C;valid bits&#x53EA;&#x6709;&#x4E00;&#x4F4D;&#xFF0C;RAM&#x4E5F;&#x53EA;&#x6709;&#x4E00;&#x884C;&#xFF0C;&#x5728;&#x603B;&#x7EBF;ready&#x540E;&#xFF0C;&#x540C;&#x5176;&#x4ED6;&#x7EC4;&#x4E00;&#x6837;&#xFF0C;&#x5C06;&#x603B;&#x7EBF;&#x6765;&#x7684;&#x6570;&#x636E;&#x5199;&#x5165;&#x5230;RAM&#x540C;&#x65F6;&#x66F4;&#x65B0;valid bits&#xFF0C;&#x4E3A;CPU&#x63D0;&#x4F9B;cache&#x547D;&#x4E2D;&#x4FE1;&#x53F7;&#x3002;<br>&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;&#x7ED5;&#x8FC7;cache&#x7684;&#x673A;&#x5236;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x76F4;&#x63A5;&#x5728;&#x6BCF;&#x6B21;&#x65B0;&#x8BF7;&#x6C42;&#x53D1;&#x751F;&#x65F6;&#xFF0C;&#x5C06;C&#x7EC4;&#x7684;valid bit&#x6E05;&#x96F6;&#x5373;&#x53EF;&#x5B9E;&#x73B0;&#x6BCF;&#x6B21;&#x5BF9;no cache&#x533A;&#x57DF;&#x7684;&#x8BBF;&#x95EE;&#x90FD;&#x4E0D;&#x547D;&#x4E2D;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">reg</span> VALID_C;</span><br><span class="line"><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk)</span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    <span class="hljs-keyword">if</span> ((~CPU_stall) || clr )</span><br><span class="line">        VALID_C &lt;= <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (WE_C) </span><br><span class="line">        VALID_C &lt;= <span class="hljs-number">1</span>;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] RAM_C;</span><br><span class="line"><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk)</span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (WE_C)</span><br><span class="line">        RAM_C &lt;= RAM_in;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><p>&#x5F15;&#x5165;C&#x7EC4;&#x7684;&#x597D;&#x5904;&#x662F;&#x5728;&#x63D0;&#x4F9B;&#x76EE;&#x6807;&#x529F;&#x80FD;&#x7684;&#x540C;&#x65F6;&#xFF0C;&#x7B80;&#x5316;&#x4E86;&#x63A7;&#x5236;&#x5355;&#x5143;&#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x63A7;&#x5236;&#x5355;&#x5143;&#x53EA;&#x9700;&#x8981;&#x6839;&#x636E;NO_CACHE&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x7ED3;&#x679C;&#x9009;&#x62E9;&#x76F8;&#x5E94;&#x7684;&#x4FE1;&#x53F7;&#x5373;&#x53EF;&#x3002;</p><h4 id="&#x5404;&#x7EC4;&#x7684;&#x66F4;&#x65B0;&#x4FE1;&#x53F7;"><a href="#&#x5404;&#x7EC4;&#x7684;&#x66F4;&#x65B0;&#x4FE1;&#x53F7;" class="headerlink" title="&#x5404;&#x7EC4;&#x7684;&#x66F4;&#x65B0;&#x4FE1;&#x53F7;"></a>&#x5404;&#x7EC4;&#x7684;&#x66F4;&#x65B0;&#x4FE1;&#x53F7;</h4><p>WE_A, WE_B, WE_C&#x4E3A;&#x4E09;&#x4E2A;&#x7EC4;&#x7684;&#x66F4;&#x65B0;&#x4FE1;&#x53F7;&#x3002;&#x8BE5;&#x4FE1;&#x53F7;&#x7531;cache&#x63A7;&#x5236;&#x5668;&#x8BA1;&#x7B97;&#xFF0C;&#x6BCF;&#x6B21;&#x66F4;&#x65B0;&#x53EA;&#x6709;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x6709;&#x6548;&#x3002;</p><h3 id="cache&#x63A7;&#x5236;&#x5668;&#x7684;&#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;"><a href="#cache&#x63A7;&#x5236;&#x5668;&#x7684;&#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;" class="headerlink" title="cache&#x63A7;&#x5236;&#x5668;&#x7684;&#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;"></a>cache&#x63A7;&#x5236;&#x5668;&#x7684;&#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;</h3><p>cache&#x63A7;&#x5236;&#x5668;&#x4E3B;&#x8981;&#x89E3;&#x51B3;&#x4E09;&#x65B9;&#x9762;&#x7684;&#x95EE;&#x9898;&#xFF1A;</p><ol><li>&#x547D;&#x4E2D;&#x4FE1;&#x53F7;&#x7684;&#x903B;&#x8F91;</li><li>&#x4E0D;&#x547D;&#x4E2D;&#x65F6;&#x7684;cache&#x66FF;&#x6362;</li><li>&#x5199;&#x5165;cache&#x7684;&#x5185;&#x5BB9;&#x548C;&#x5411;CPU&#x8F93;&#x51FA;&#x7684;&#x5185;&#x5BB9;&#x7684;&#x9009;&#x62E9;</li></ol><h4 id="cache&#x547D;&#x4E2D;&#x4FE1;&#x53F7;ready-o"><a href="#cache&#x547D;&#x4E2D;&#x4FE1;&#x53F7;ready-o" class="headerlink" title="cache&#x547D;&#x4E2D;&#x4FE1;&#x53F7;ready_o"></a>cache&#x547D;&#x4E2D;&#x4FE1;&#x53F7;ready_o</h4><p>&#x4E0A;&#x6587;&#x4E2D;&#x6211;&#x5DF2;&#x63D0;&#x5230;&#xFF0C;BUS&#x4E0A;&#x7684;&#x6570;&#x636E;&#x53EA;&#x5B58;&#x5728;&#x4E00;&#x4E2A;&#x5468;&#x671F;&#xFF0C;&#x4F46;&#x662F;CPU&#x53EF;&#x80FD;&#x5728;&#x8FD9;&#x4E2A;&#x5468;&#x671F;&#x56E0;&#x4E3A;&#x5176;&#x4ED6;&#x539F;&#x56E0;&#x6682;&#x505C;&#x3002;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x5728;&#x603B;&#x7EBF;&#x5C31;&#x7EEA;&#x65F6;&#x5C06;&#x6570;&#x636E;&#x4FDD;&#x5B58;&#x5728;cache&#x5185;&#x90E8;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x64CD;&#x4F5C;&#x81EA;&#x7136;&#x5E94;&#x8BE5;&#x5305;&#x542B;BUS&#x7684;ready&#x4FE1;&#x53F7;&#x3002;<br>&#x5F15;&#x5165;&#x4E00;&#x4E2A;&#x5BC4;&#x5B58;&#x5668;ready_reg&#x4FDD;&#x5B58;&#x4ECE;&#x603B;&#x7EBF;&#x4E0A;&#x63A5;&#x6536;&#x7684;&#x5C31;&#x7EEA;&#x4FE1;&#x53F7;, &#x8BE5;&#x5BC4;&#x5B58;&#x5668;&#x5728;&#x65B0;&#x8BF7;&#x6C42;&#x5230;&#x6765;&#x65F6;&#x6E05;&#x96F6;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">reg</span> ready_reg;</span><br><span class="line"><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk)</span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (~CPU_stall)</span><br><span class="line">        ready_reg &lt;= <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (CPU_req_reg &amp;&amp; ready_in)</span><br><span class="line">        ready_reg &lt;= <span class="hljs-number">1</span>;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><p>&#x9488;&#x5BF9;&#x4E09;&#x4E2A;&#x7EC4;&#xFF0C;&#x6BCF;&#x4E2A;&#x7EC4;&#x90FD;&#x8981;&#x6709;&#x5355;&#x72EC;&#x7684;&#x547D;&#x4E2D;&#x4FE1;&#x53F7;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">wire</span> HIT_A = tag_reg == TAG_A_out &amp;&amp; VALID_A_out;</span><br><span class="line"><span class="hljs-keyword">wire</span> HIT_B = tag_reg == TAG_B_out &amp;&amp; VALID_B_out;</span><br><span class="line"><span class="hljs-keyword">wire</span> HIT_C = VALID_C;</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5728;AB&#x4E24;&#x7EC4;&#x7684;&#x547D;&#x4E2D;&#x4FE1;&#x53F7;&#x6BD4;&#x5BF9;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x5168;&#x90E8;&#x662F;&#x7ECF;&#x8FC7;&#x5BC4;&#x5B58;&#x5668;&#x540C;&#x6B65;&#x7684;&#x503C;&#xFF0C;&#x8FD9;&#x907F;&#x514D;&#x4E86;&#x4ECE;cpu_stall&#x5230;ready_o&#x4E4B;&#x95F4;&#x7684;&#x7EC4;&#x5408;&#x903B;&#x8F91;&#x73AF;&#x3002;<br>&#x6709;&#x4E86;&#x5404;&#x7EC4;&#x7684;&#x547D;&#x4E2D;&#x4FE1;&#x53F7;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x4E3A;&#x8BFB;&#x8BF7;&#x6C42;&#x8BBE;&#x7F6E;&#x547D;&#x4E2D;&#x4FE1;&#x53F7;&#x3002;&#x82E5;&#x8BF7;&#x6C42;&#x5728;no cache&#x8303;&#x56F4;&#xFF0C;&#x5219;&#x4EE5;HIT_C&#x4E3A;&#x51C6;&#xFF0C;&#x5426;&#x5219;&#x4E0E;AB&#x7684;&#x6216;&#x4E3A;&#x51C6;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">wire</span> CACHE_HIT_R = NO_CACHE ? HIT_C : (HIT_A || HIT_B);</span><br></pre></td></tr></table></figure><p>&#x6700;&#x7EC8;&#x7684;&#x547D;&#x4E2D;&#x4FE1;&#x53F7;ready_o&#x8FD8;&#x4E0E;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x7684;&#x4FE1;&#x53F7;&#x76F8;&#x5173;&#xFF1A;</p><ul><li>&#x5982;&#x679C;&#x6B64;&#x65F6;&#x5E76;&#x6CA1;&#x6709;&#x8BF7;&#x6C42;cache&#xFF08;cpu_req_reg == 0)&#xFF0C;&#x5219;&#x5E94;&#x76F4;&#x63A5;&#x7ED9;&#x51FA;&#x547D;&#x4E2D;&#x4FE1;&#x53F7;&#xFF0C;&#x901A;&#x77E5;CPU&#x7EE7;&#x7EED;&#x5DE5;&#x4F5C;&#x3002;</li><li>&#x5982;&#x679C;&#x662F;&#x5199;&#x8BF7;&#x6C42;&#xFF0C;&#x5219;&#x547D;&#x4E2D;&#x4FE1;&#x53F7;&#x5E94;&#x662F;&#x603B;&#x7EBF;&#x5C31;&#x7EEA;&#x4FE1;&#x53F7;&#x4E0E;ready_reg&#x7684;&#x903B;&#x8F91;&#x6216;&#x3002;</li><li>&#x5982;&#x679C;&#x662F;&#x8BFB;&#x8BF7;&#x6C42;&#xFF0C;&#x5219;&#x547D;&#x4E2D;&#x4FE1;&#x53F7;&#x5E94;&#x662F;&#x603B;&#x7EBF;&#x5C31;&#x7EEA;&#x4FE1;&#x53F7;&#x4E0E;&#x8BFB;&#x547D;&#x4E2D;&#x4FE1;&#x53F7;(CACHE_HIT_R)&#x7684;&#x903B;&#x8F91;&#x6216;&#x3002;<figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">always</span> @(*)</span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (~CPU_req_reg)</span><br><span class="line">        ready_o &lt;= <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (CPU_RW_reg) </span><br><span class="line">        ready_o &lt;= (CPU_req_reg &amp;&amp; ready_in) || ready_reg;</span><br><span class="line">    <span class="hljs-keyword">else</span> </span><br><span class="line">        ready_o &lt;= (CPU_req_reg &amp;&amp; ready_in) || CACHE_HIT_R;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure>&#x603B;&#x7EBF;&#x5C31;&#x7EEA;&#x4FE1;&#x53F7;&#x4F7F;&#x7528;&#x8BF7;&#x6C42;&#x4FE1;&#x53F7;&#x8FDB;&#x884C;&#x8FC7;&#x6EE4;&#xFF0C;&#x9632;&#x6B62;&#x9AD8;&#x963B;&#x6001;&#x7684;ready&#x5E72;&#x6270;&#x3002;</li></ul><h4 id="cache&#x66FF;&#x6362;&#x63A7;&#x5236;"><a href="#cache&#x66FF;&#x6362;&#x63A7;&#x5236;" class="headerlink" title="cache&#x66FF;&#x6362;&#x63A7;&#x5236;"></a>cache&#x66FF;&#x6362;&#x63A7;&#x5236;</h4><p>&#x5F53;&#x8BFB;&#x4E0D;&#x547D;&#x4E2D;&#x6216;&#x6709;&#x5199;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x8981;&#x8FDB;&#x884C;cache&#x7684;&#x66F4;&#x65B0;&#x3002;Cache&#x7684;&#x66F4;&#x65B0;&#x673A;&#x5236;&#x4E3B;&#x8981;&#x89E3;&#x51B3;&#x4E24;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;</p><ol><li>&#x4F55;&#x65F6;&#x66F4;&#x65B0;&#xFF1F;</li><li>&#x66F4;&#x65B0;&#x90A3;&#x4E00;&#x7EC4;&#xFF1F;</li></ol><p>&#x7B2C;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x5F53;&#x4E14;&#x4EC5;&#x5F53;&#x603B;&#x7EBF;&#x4E0A;&#x6570;&#x636E;&#x51C6;&#x5907;&#x597D;&#x7684;&#x65F6;&#x5019;&#x66F4;&#x65B0;cache&#xFF0C;&#x56E0;&#x4E3A;&#x6240;&#x6709;&#x7684;&#x4E0D;&#x547D;&#x4E2D;&#x90FD;&#x9700;&#x8981;&#x8BF7;&#x6C42;&#x603B;&#x7EBF;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">wire</span> need_update = BUS_grant &amp;&amp; ready_in;</span><br></pre></td></tr></table></figure><p>&#x7B2C;&#x4E8C;&#x4E2A;&#x95EE;&#x9898;&#x7A0D;&#x5FAE;&#x590D;&#x6742;&#x4E00;&#x4E9B;&#x3002;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x968F;&#x673A;&#x66FF;&#x6362;&#x7B56;&#x7565;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x8BBE;&#x8BA1;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x968F;&#x673A;&#x6570;&#x4EA7;&#x751F;&#x5668;&#x3002;&#x8FD9;&#x91CC;&#x6211;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x8BA1;&#x6570;&#x5668;&#x4F5C;&#x4E3A;&#x968F;&#x673A;&#x6570;&#x4EA7;&#x751F;&#x5668;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">reg</span> random;</span><br><span class="line"><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk)</span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    random &lt;= random+ <span class="hljs-number">1&apos;b1</span>;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><p>&#x5BF9;&#x4E8E;&#x4E0D;&#x9700;&#x8981;cache&#x7684;&#x5730;&#x5740;&#x8303;&#x56F4;&#xFF0C;&#x5904;&#x7406;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#x3002;&#x56E0;&#x4E3A;&#x7EC4;C&#x53EA;&#x6709;&#x4E00;&#x884C;&#xFF0C;&#x56E0;&#x6B64;&#x76F4;&#x63A5;&#x66FF;&#x6362;&#x5373;&#x53EF;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">assign</span> WE_C = NO_CACHE &amp;&amp; need_update;</span><br></pre></td></tr></table></figure><p>&#x5BF9;&#x4E8E;&#x6B63;&#x5E38;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5904;&#x7406;&#x7A0D;&#x5FAE;&#x9EBB;&#x70E6;&#x4E00;&#x4E9B;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x5F88;&#x591A;&#x8BFB;&#x8005;&#x60F3;&#x8C61;&#x7684;&#x76F4;&#x63A5;&#x5229;&#x7528;&#x4E0A;&#x9762;&#x63CF;&#x8FF0;&#x7684;&#x968F;&#x673A;&#x6570;&#x4EA7;&#x751F;&#x5668;&#x3002;<br>&#x8003;&#x8651;&#x8FD9;&#x6837;&#x7684;&#x51E0;&#x79CD;&#x60C5;&#x51B5;&#xFF1A;</p><ul><li>&#x5982;&#x679C;&#x4E00;&#x884C;&#x5185;&#x7684;&#x4E24;&#x7EC4;&#x69FD;&#x4F4D;&#xFF0C;&#x6709;&#x4E00;&#x4E2A;&#x662F;&#x7A7A;&#x7684;&#x5E94;&#x8BE5;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5F80;&#x7A7A;&#x7684;&#x7EC4;&#x586B;&#x5199;&#x6570;&#x636E;&#x5417;&#xFF1F;<br>  &#x5F88;&#x9057;&#x61BE;&#x7B54;&#x6848;&#x662F;&#x5426;&#x5B9A;&#x7684;&#x3002;</li><li>&#x5982;&#x679C;&#x4E24;&#x7EC4;&#x90FD;&#x662F;&#x6EE1;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x968F;&#x673A;&#x66FF;&#x6362;&#x5417;&#xFF1F;<br>   &#x5F88;&#x9057;&#x61BE;&#x7B54;&#x6848;&#x8FD8;&#x662F;&#x5426;&#x5B9A;&#x7684;&#x3002;</li></ul><p>&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x968F;&#x5373;&#x66FF;&#x6362;&#x5462;&#xFF1F;&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#xFF1A;<br>&#x5982;&#x679C;&#x4E24;&#x7EC4;&#x90FD;&#x662F;&#x6EE1;&#x7684;&#xFF0C;A&#x5185;&#x5B58;&#x653E;&#x5730;&#x5740;0&#x7684;&#x7F13;&#x5B58;&#xFF0C;B&#x5185;&#x5B58;&#x653E;&#x5730;&#x5740;8&#x7684;&#x7F13;&#x5B58;&#x3002;&#x6B64;&#x65F6;&#x6211;&#x9700;&#x8981;&#x5411;&#x5730;&#x5740;0&#x518D;&#x6B21;&#x5199;&#x5165;&#x65B0;&#x503C;&#x3002;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x80FD;&#x4F7F;&#x7528;&#x968F;&#x673A;&#x66FF;&#x6362;&#x5417;&#xFF1F;&#x7B54;&#x6848;&#x5F53;&#x7136;&#x662F;&#x5426;&#x5B9A;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x4F18;&#x5148;&#x66FF;&#x6362;TAG&#x76F8;&#x540C;&#x7684;&#x7EC4;&#x3002;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x5E94;&#x5F53;&#x5C06;&#x5BF9;&#x5730;&#x5740;0&#x5199;&#x5165;&#x7684;&#x65B0;&#x503C;&#x76F4;&#x63A5;&#x653E;&#x5165;&#x539F;&#x6765;&#x5C31;&#x5B58;&#x653E;&#x5730;&#x5740;0&#x7684;&#x7EC4;A&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x968F;&#x673A;&#x66FF;&#x6362;&#x7EC4;B&#x3002;&#x8FD9;&#x6837;&#x505A;&#x9664;&#x4E86;&#x6709;&#x6027;&#x80FD;&#x4F18;&#x52BF;&#x4EE5;&#x5916;&#xFF0C;&#x8FD8;&#x4FDD;&#x8BC1;&#x4E86;cache&#x4E0D;&#x53D1;&#x751F;&#x610F;&#x5916;&#x5730;&#x9519;&#x8BEF;&#x3002;&#x5982;&#x679C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x968F;&#x5373;&#x66FF;&#x6362;&#x66FF;&#x6362;&#x6389;&#x4E86;B&#x7EC4;&#xFF0C;&#x5219;cache&#x5185;&#x4F1A;&#x6709;&#x4E24;&#x6761;&#x5173;&#x4E8E;&#x5730;&#x5740;0&#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x5728;&#x6CA1;&#x6709;&#x989D;&#x5916;&#x7684;&#x63AA;&#x65BD;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x5C31;&#x76F4;&#x63A5;&#x5F15;&#x8D77;&#x4E86;&#x9519;&#x8BEF;&#xFF01;CPU&#x4E0D;&#x77E5;&#x9053;&#x90A3;&#x4E2A;&#x6570;&#x636E;&#x662F;&#x6B63;&#x786E;&#x7684;&#x3002;<br>&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x786E;&#x5B9A;&#x4E86;&#x4F7F;&#x7528;&#x968F;&#x673A;&#x66FF;&#x6362;&#x65F6;&#x7684;&#x7B56;&#x7565;&#xFF1A;</p><ul><li>&#x82E5;cache&#x5185;&#x5DF2;&#x7ECF;&#x5B58;&#x653E;&#x6709;&#x8BE5;&#x5730;&#x5740;&#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x76F4;&#x63A5;&#x66FF;&#x6362;&#x8FD9;&#x4E00;&#x7EC4;&#xFF0C;&#x4E0D;&#x4F7F;&#x7528;&#x968F;&#x673A;&#x66FF;&#x6362;&#x3002;</li><li>&#x5426;&#x5219;&#x518D;&#x770B;&#x662F;&#x5426;&#x6709;&#x7A7A;&#x95F2;&#x7684;&#x7EC4;&#xFF0C;&#x5982;&#x6709;&#x5219;&#x653E;&#x5165;&#x7A7A;&#x95F2;&#x7EC4;&#xFF0C;&#x5426;&#x5219;&#x4F7F;&#x7528;&#x968F;&#x5373;&#x66FF;&#x6362;&#x3002;<br>&#x4FE1;&#x53F7;WE_A,WE_B&#x5B9E;&#x73B0;&#x4E86;&#x4E0A;&#x8FF0;&#x903B;&#x8F91;&#xFF1A;<figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] group_sel;</span><br><span class="line"><span class="hljs-keyword">always</span> @(*)</span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    <span class="hljs-comment">//replace group with the same tag first.</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (TAG_A_out == tag_reg)</span><br><span class="line">        group_sel &lt;= <span class="hljs-number">2&apos;b01</span>;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (TAG_B_out ==tag_reg)</span><br><span class="line">        group_sel &lt;= <span class="hljs-number">2&apos;b10</span>;</span><br><span class="line">    <span class="hljs-comment">//if both group is empty or valid, randomly choose one group.</span></span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (VALID_A_out == VALID_B_out)</span><br><span class="line">        group_sel &lt;= random ? <span class="hljs-number">2&apos;b01</span> : <span class="hljs-number">2&apos;b10</span>;</span><br><span class="line">    <span class="hljs-comment">//if only one group is empty, choose the empty group.</span></span><br><span class="line">    <span class="hljs-keyword">else</span></span><br><span class="line">        group_sel &lt;= VALID_A_out ? <span class="hljs-number">2&apos;b10</span> : <span class="hljs-number">2&apos;b01</span>;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br><span class="line"><span class="hljs-comment">//only when requested address is in cache range, WE_A or WE_B can be active.</span></span><br><span class="line"><span class="hljs-keyword">assign</span> WE_A = (~NO_CACHE) &amp;&amp; need_update &amp;&amp; group_sel[<span class="hljs-number">0</span>];</span><br><span class="line"><span class="hljs-keyword">assign</span> WE_B = (~NO_CACHE) &amp;&amp; need_update &amp;&amp; group_sel[<span class="hljs-number">1</span>];</span><br></pre></td></tr></table></figure>&#x9700;&#x8981;&#x7559;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x7684;&#x63A7;&#x5236;&#x4FE1;&#x53F7;&#x4E5F;&#x90FD;&#x662F;&#x7ECF;&#x8FC7;&#x5BC4;&#x5B58;&#x5668;&#x540C;&#x6B65;&#x8FC7;&#x7684;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x7EC4;&#x5408;&#x903B;&#x8F91;&#x73AF;&#x3002;</li></ul><h4 id="&#x5411;cache&#x5185;&#x5199;&#x5165;&#x7684;&#x6570;&#x636E;&#x548C;&#x5BF9;CPU&#x8F93;&#x51FA;&#x7684;&#x6570;&#x636E;&#x9009;&#x62E9;"><a href="#&#x5411;cache&#x5185;&#x5199;&#x5165;&#x7684;&#x6570;&#x636E;&#x548C;&#x5BF9;CPU&#x8F93;&#x51FA;&#x7684;&#x6570;&#x636E;&#x9009;&#x62E9;" class="headerlink" title="&#x5411;cache&#x5185;&#x5199;&#x5165;&#x7684;&#x6570;&#x636E;&#x548C;&#x5BF9;CPU&#x8F93;&#x51FA;&#x7684;&#x6570;&#x636E;&#x9009;&#x62E9;"></a>&#x5411;cache&#x5185;&#x5199;&#x5165;&#x7684;&#x6570;&#x636E;&#x548C;&#x5BF9;CPU&#x8F93;&#x51FA;&#x7684;&#x6570;&#x636E;&#x9009;&#x62E9;</h4><p>&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6839;&#x636E;&#x8BFB;&#x3001;&#x5199;&#x8BF7;&#x6C42;&#x7684;&#x4E0D;&#x540C;&#x4EE5;&#x53CA;&#x603B;&#x7EBF;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x9009;&#x62E9;&#x5411;cache&#x5185;&#x5199;&#x5165;&#x7684;&#x6570;&#x636E;RAM_in&#x548C;&#x5411;CPU&#x8F93;&#x51FA;&#x7684;&#x4FE1;&#x53F7;data_o.<br>&#x5BF9;&#x4E8E;RAM_in&#x3002;&#x8BFB;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x5E94;&#x9009;&#x62E9;&#x603B;&#x7EBF;&#x4E0A;&#x7684;&#x6570;&#x636E;BUS_data;&#x5199;&#x8BF7;&#x6C42;&#x65F6;&#x5E94;&#x9009;&#x62E9;CPU&#x4ECE;&#x4E0A;&#x4E00;&#x7EA7;&#x6D41;&#x6C34;&#x7EBF;&#x8F93;&#x5165;&#x7684;&#x6570;&#x636E;data_reg.</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">assign</span> RAM_in = CPU_RW_reg ? data_reg : BUS_data;</span><br></pre></td></tr></table></figure><p>&#x5BF9;&#x4E8E;data_o&#x3002;&#x82E5;&#x662F;&#x5199;&#x8BF7;&#x6C42;&#xFF0C;&#x5219;&#x4E0D;&#x9700;&#x8981;&#x5411;cpu&#x8F93;&#x51FA;&#x6570;&#x636E;&#xFF1B;&#x82E5;&#x662F;&#x8BFB;&#x8BF7;&#x6C42;&#xFF0C;&#x5F53;&#x603B;&#x7EBF;&#x51C6;&#x5907;&#x5C31;&#x7EEA;&#x65F6;&#xFF0C;&#x603B;&#x662F;&#x9009;&#x62E9;&#x603B;&#x7EBF;&#x4E0A;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x82E5;&#x9519;&#x8FC7;&#x4E86;&#x603B;&#x7EBF;&#x7684;&#x5C31;&#x7EEA;&#x4FE1;&#x53F7;&#xFF0C;&#x5219;&#x6309;&#x7167;&#x5404;&#x7EC4;&#x7684;&#x547D;&#x4E2D;&#x60C5;&#x51B5;&#xFF0C;&#x9009;&#x62E9;&#x5404;&#x7EC4;&#x7684;RAM&#x4F5C;&#x4E3A;&#x8F93;&#x51FA;&#x3002;&#x5176;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">always</span>@(*)</span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (CPU_RW_reg)</span><br><span class="line">        data_o &lt;= <span class="hljs-number">32&apos;b0</span>;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ready_in)</span><br><span class="line">        data_o &lt;= BUS_data;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (NO_CACHE)</span><br><span class="line">        data_o &lt;= RAM_C_out;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (HIT_A)</span><br><span class="line">        data_o &lt;= RAM_A_out;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (HIT_B)</span><br><span class="line">        data_o &lt;= RAM_B_out;</span><br><span class="line">    <span class="hljs-keyword">else</span></span><br><span class="line">        data_o &lt;= <span class="hljs-number">32&apos;b0</span>;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><p>&#x81F3;&#x6B64;&#x8FD9;&#x4E2A;&#x7B26;&#x5408;&#x4E0A;&#x6587;&#x6240;&#x8FF0;&#x7684;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;&#x7684;cache&#x6A21;&#x5757;&#x8BBE;&#x8BA1;&#x5B8C;&#x6BD5;&#x4E86;&#x3002;&#x63A5;&#x4E0B;&#x6765;&#x662F;&#x7E41;&#x7410;&#x7684;&#x6D4B;&#x8BD5;&#x5DE5;&#x4F5C;&#x3002;</p><h2 id="&#x7EC4;&#x76F8;&#x8054;cache&#x7684;&#x4EFF;&#x771F;&#x3001;&#x6D4B;&#x8BD5;"><a href="#&#x7EC4;&#x76F8;&#x8054;cache&#x7684;&#x4EFF;&#x771F;&#x3001;&#x6D4B;&#x8BD5;" class="headerlink" title="&#x7EC4;&#x76F8;&#x8054;cache&#x7684;&#x4EFF;&#x771F;&#x3001;&#x6D4B;&#x8BD5;"></a>&#x7EC4;&#x76F8;&#x8054;cache&#x7684;&#x4EFF;&#x771F;&#x3001;&#x6D4B;&#x8BD5;</h2><p>&#x4ECE;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x7684;&#x7BC7;&#x5E45;&#x6765;&#x770B;&#xFF0C;&#x8FD9;&#x7EDD;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x56E0;&#x6B64;&#x5176;&#x6D4B;&#x8BD5;&#x4E5F;&#x9700;&#x8981;&#x4ED4;&#x7EC6;&#x8003;&#x91CF;&#x3002;&#x672C;&#x6587;&#x5F00;&#x5934;&#x6240;&#x63CF;&#x8FF0;&#x7684;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;&#x5E94;&#x5F53;&#x5168;&#x90E8;&#x5305;&#x542B;&#x5728;&#x6D4B;&#x8BD5;&#x4E2D;&#x3002;&#x7ECF;&#x8FC7;&#x6211;&#x7684;&#x601D;&#x8003;&#xFF0C;&#x786E;&#x5B9A;&#x4E86;&#x6D4B;&#x8BD5;&#x7684;&#x6D41;&#x7A0B;&#xFF1A;&#x5BF9;&#x4E8E;&#x529F;&#x80FD;&#x6D4B;&#x8BD5;&#xFF0C;&#x5747;&#x91C7;&#x7528;&#x5355;&#x4E2A;cache&#x5B9E;&#x4F8B;&#xFF1B;&#x5728;&#x901A;&#x8FC7;&#x4E86;&#x529F;&#x80FD;&#x6D4B;&#x8BD5;&#x540E;&#xFF0C;&#x4F7F;&#x7528;&#x591A;&#x4E2A;cache&#x5B9E;&#x4F8B;&#x6D4B;&#x8BD5;&#x5176;&#x8054;&#x5408;&#x8BBF;&#x95EE;&#x603B;&#x7EBF;&#x3002;&#x8FD9;&#x6837;&#x505A;&#x662F;&#x5408;&#x7406;&#x7684;&#xFF0C;&#x786E;&#x4FDD;&#x5355;&#x4E2A;cache&#x529F;&#x80FD;&#x6B63;&#x5E38;&#xFF0C;&#x591A;&#x4E2A;cache&#x8054;&#x5408;&#x8BBF;&#x5B58;&#x6B63;&#x5E38;&#x5373;&#x53EF;&#x8BF4;&#x660E;&#x8FBE;&#x5230;&#x4E86;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;&#x3002;</p><h3 id="&#x9488;&#x5BF9;&#x5355;&#x4E2A;cache&#x7684;&#x529F;&#x80FD;&#x6D4B;&#x8BD5;"><a href="#&#x9488;&#x5BF9;&#x5355;&#x4E2A;cache&#x7684;&#x529F;&#x80FD;&#x6D4B;&#x8BD5;" class="headerlink" title="&#x9488;&#x5BF9;&#x5355;&#x4E2A;cache&#x7684;&#x529F;&#x80FD;&#x6D4B;&#x8BD5;"></a>&#x9488;&#x5BF9;&#x5355;&#x4E2A;cache&#x7684;&#x529F;&#x80FD;&#x6D4B;&#x8BD5;</h3><p>&#x9996;&#x5148;&#x51C6;&#x5907;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x3002;<br>&#x5148;&#x5B9A;&#x4E49;&#x603B;&#x7EBF;&#x4FE1;&#x53F7;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] BUS_addr, BUS_data;</span><br><span class="line"><span class="hljs-keyword">wire</span> BUS_req, BUS_ready, BUS_RW;</span><br><span class="line"><span class="hljs-keyword">wire</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] DMA, grant;</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x5B9E;&#x4F8B;&#x5316;&#x5355;&#x4E2A;cache&#x548C;&#x6A21;&#x62DF;&#x7684;&#x5185;&#x5B58;&#x63A7;&#x5236;&#x5668;&#xFF0C;&#x5B9E;&#x4F8B;&#x5316;&#x603B;&#x7EBF;&#x63A7;&#x5236;&#x5668;&#xFF0C;&#x5E76;&#x5C06;&#x4ED6;&#x4EEC;&#x8FDE;&#x63A5;&#x5230;&#x603B;&#x7EBF;&#x4E0A;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//hook up the bus controller</span></span><br><span class="line">bus_control bus_control_0 (DMA,grant,BUS_req, BUS_ready,clk);</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//hook up the simulated memory</span></span><br><span class="line">dummy_slave memory(clk,BUS_addr,BUS_data,BUS_req,BUS_ready,BUS_RW);</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//hook up the simulated instruction cache</span></span><br><span class="line">cache I_cache (CPU_stall,next_pc , data[i] , <span class="hljs-number">1&apos;b1</span>, rw[i], <span class="hljs-number">1&apos;b0</span>, CPU_data, CPU_ready, PC,</span><br><span class="line">                BUS_addr, BUS_data, DMA[<span class="hljs-number">0</span>], BUS_RW, grant[<span class="hljs-number">0</span>], BUS_ready, clr, clk,</span><br><span class="line">                we_a,we_b,we_c,needupdate,tag,hitA,hitB,RAM_A_out);</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x6CE8;&#x610F;&#x5230;&#x8FD9;&#x4E2A;cache&#x5B9E;&#x4F8B;&#x662F;&#x8FDE;&#x63A5;&#x5728;DMA[0]&#x4E0A;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x4ED6;&#x5177;&#x6709;&#x6700;&#x9AD8;&#x7684;&#x603B;&#x7EBF;&#x4F18;&#x5148;&#x7EA7;&#x3002;<br>&#x8BBE;&#x7F6E;&#x6A21;&#x62DF;&#x7684;CPU_stall&#x4FE1;&#x53F7;:</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">wire</span> CPU_stall = clr ? <span class="hljs-number">0</span>: ~(CPU_ready &amp;&amp; <span class="hljs-number">1</span>);</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x9884;&#x8BBE;&#x8BF7;&#x6C42;&#x5E8F;&#x5217;&#x6765;&#x6D4B;&#x8BD5;cache&#x7684;&#x529F;&#x80FD;&#x3002;</p><h4 id="&#x521D;&#x6B65;&#x6D4B;&#x8BD5;"><a href="#&#x521D;&#x6B65;&#x6D4B;&#x8BD5;" class="headerlink" title="&#x521D;&#x6B65;&#x6D4B;&#x8BD5;"></a>&#x521D;&#x6B65;&#x6D4B;&#x8BD5;</h4><p>&#x6D4B;&#x8BD5;&#x4E86;cache&#x7684;&#x57FA;&#x672C;&#x529F;&#x80FD;:</p><ul><li>&#x8BFB;&#x4E0D;&#x547D;&#x4E2D;&#x3001;&#x8BFB;&#x547D;&#x4E2D;</li><li>&#x5199;&#x4E0D;&#x547D;&#x4E2D;&#xFF0C;&#x8FDE;&#x7EED;&#x5199;&#x4E0D;&#x547D;&#x4E2D;&#xFF0C;&#x5199;&#x540E;&#x8BFB;&#x547D;&#x4E2D;</li><li>&#x8BFB;&#x5199;no cache&#x8303;&#x56F4;<br>&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x7684;&#x6D4B;&#x8BD5;&#x5E8F;&#x5217;<figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] address [<span class="hljs-number">0</span>:<span class="hljs-number">7</span>] ;</span><br><span class="line"><span class="hljs-keyword">initial</span></span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    address[<span class="hljs-number">0</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    address[<span class="hljs-number">1</span>]= <span class="hljs-number">4</span> ;</span><br><span class="line">    address[<span class="hljs-number">2</span>]= <span class="hljs-number">0</span> ; <span class="hljs-comment">//cache hit</span></span><br><span class="line">    address[<span class="hljs-number">3</span>]= <span class="hljs-number">16</span> ;<span class="hljs-comment">//write</span></span><br><span class="line">    address[<span class="hljs-number">4</span>]= <span class="hljs-number">16</span> ;<span class="hljs-comment">//read</span></span><br><span class="line">    address[<span class="hljs-number">5</span>]= <span class="hljs-number">8</span> ; <span class="hljs-comment">//read in no cache zone</span></span><br><span class="line">    address[<span class="hljs-number">6</span>]= <span class="hljs-number">8</span> ; <span class="hljs-comment">//write in no cache zone</span></span><br><span class="line">    address[<span class="hljs-number">7</span>]= <span class="hljs-number">8</span> ; <span class="hljs-comment">//read in no cache zone</span></span><br><span class="line"><span class="hljs-keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] data [<span class="hljs-number">0</span>:<span class="hljs-number">7</span>];</span><br><span class="line"><span class="hljs-keyword">initial</span></span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    data[<span class="hljs-number">0</span>]= <span class="hljs-number">32&apos;hab2112a</span> ;</span><br><span class="line">    data[<span class="hljs-number">1</span>]= <span class="hljs-number">32&apos;hab2112b</span> ;</span><br><span class="line">    data[<span class="hljs-number">2</span>]= <span class="hljs-number">32&apos;hab2112c</span> ;</span><br><span class="line">    data[<span class="hljs-number">3</span>]= <span class="hljs-number">32&apos;hab21123</span> ;</span><br><span class="line">    data[<span class="hljs-number">4</span>]= <span class="hljs-number">32&apos;hab21124</span> ;</span><br><span class="line">    data[<span class="hljs-number">5</span>]= <span class="hljs-number">32&apos;hab21128</span> ;</span><br><span class="line">    data[<span class="hljs-number">6</span>]= <span class="hljs-number">32&apos;hab21129</span> ;</span><br><span class="line">    data[<span class="hljs-number">7</span>]= <span class="hljs-number">32&apos;hab21121</span> ;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] rw;</span><br><span class="line"><span class="hljs-keyword">initial</span></span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    rw[<span class="hljs-number">0</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    rw[<span class="hljs-number">1</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    rw[<span class="hljs-number">2</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    rw[<span class="hljs-number">3</span>]= <span class="hljs-number">1</span> ;</span><br><span class="line">    rw[<span class="hljs-number">4</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    rw[<span class="hljs-number">5</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    rw[<span class="hljs-number">6</span>]= <span class="hljs-number">1</span> ;</span><br><span class="line">    rw[<span class="hljs-number">7</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure></li></ul><p>&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;&#x5982;&#x56FE;&#xFF1A;<br><img src="/%E7%BB%84%E7%9B%B8%E8%81%94cache%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/basic_test_1.png" alt="&#x5355;&#x4E2A;cache&#x6D4B;&#x8BD5;1"><br>&#x4ECE;&#x56FE;&#x4E2D;&#x53EF;&#x89C1;&#xFF1A;<br>&#x8BFB;&#x53D6;0&#xFF0C;110ns&#x6570;&#x636E;&#x51C6;&#x5907;&#x5B8C;&#x6BD5;&#xFF0C;130ns&#x8FDB;&#x5165;&#x4E0B;&#x4E2A;&#x8BF7;&#x6C42;&#xFF0C;&#x6B64;&#x6B21;&#x8BF7;&#x6C42;&#x672A;&#x547D;&#x4E2D;&#x3002;<br>&#x8BFB;&#x53D6;4&#xFF0C;210ns&#x6570;&#x636E;&#x51C6;&#x5907;&#x5B8C;&#x6BD5;&#xFF0C;230ns&#x8FDB;&#x5165;&#x4E0B;&#x4E2A;&#x8BF7;&#x6C42;&#xFF0C;&#x6B64;&#x6B21;&#x8BF7;&#x6C42;&#x672A;&#x547D;&#x4E2D;&#x3002;<br>&#x8BFB;&#x53D6;0&#xFF0C;&#x6B64;&#x6B21;&#x8BF7;&#x6C42;&#x547D;&#x4E2D;&#xFF0C;&#x6570;&#x636E;&#x5728;&#x4E00;&#x5468;&#x671F;&#x5185;&#x51C6;&#x5907;&#x5B8C;&#x6BD5;&#xFF0C;&#x603B;&#x7EBF;&#x7A7A;&#x95F2;&#xFF0C;250ns&#x8FDB;&#x5165;&#x4E0B;&#x4E2A;&#x8BF7;&#x6C42;&#x3002;<br>&#x5199;&#x5165;16&#xFF0C;&#x5199;&#x8BF7;&#x6C42;&#x603B;&#x662F;&#x672A;&#x547D;&#x4E2D;&#xFF0C;330ns&#x5199;&#x5165;&#x5B8C;&#x6BD5;&#xFF0C;350ns&#x8FDB;&#x5165;&#x4E0B;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x3002;<br>&#x8BFB;&#x53D6;16&#xFF0C;&#x5199;&#x540E;&#x8BFB;&#x547D;&#x4E2D;&#xFF0C;&#x6570;&#x636E;&#x5728;&#x4E00;&#x5468;&#x671F;&#x5185;&#x51C6;&#x5907;&#x5B8C;&#x6BD5;&#xFF0C;&#x603B;&#x7EBF;&#x7A7A;&#x95F2;&#xFF0C;370ns&#x8FDB;&#x5165;&#x4E0B;&#x4E2A;&#x8BF7;&#x6C42;&#x3002;</p><p><img src="/%E7%BB%84%E7%9B%B8%E8%81%94cache%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/basic_test_2.png" alt="&#x5355;&#x4E2A;cache&#x6D4B;&#x8BD5;2"><br>&#x4ECE;&#x56FE;&#x4E2D;&#x53EF;&#x89C1;&#xFF1A;<br>&#x8BFB;&#x53D6;8&#xFF0C;&#x8BF7;&#x6C42;no cache&#x8303;&#x56F4;&#xFF0C;&#x603B;&#x662F;&#x4E0D;&#x547D;&#x4E2D;&#xFF0C;450ns&#x6570;&#x636E;&#x51C6;&#x5907;&#x597D;&#xFF0C;470ns&#x8FDB;&#x5165;&#x4E0B;&#x4E2A;&#x8BF7;&#x6C42;&#x3002;<br>&#x5199;&#x5165;8&#xFF0C;&#x8BF7;&#x6C42;no cache&#x8303;&#x56F4;&#xFF0C;&#x603B;&#x662F;&#x4E0D;&#x547D;&#x4E2D;&#xFF0C;550ns&#x6570;&#x636E;&#x51C6;&#x5907;&#x597D;&#xFF0C;570ns&#x8FDB;&#x5165;&#x4E0B;&#x4E2A;&#x8BF7;&#x6C42;&#x3002;<br>&#x8BFB;&#x53D6;8&#xFF0C;&#x8BF7;&#x6C42;no cache&#x8303;&#x56F4;&#xFF0C;&#x603B;&#x662F;&#x4E0D;&#x547D;&#x4E2D;&#xFF0C;650ns&#x6570;&#x636E;&#x51C6;&#x5907;&#x597D;&#xFF0C;670ns&#x8FDB;&#x5165;&#x4E0B;&#x4E2A;&#x8BF7;&#x6C42;&#x3002;<br>&#x8FD9;&#x4E00;&#x6BB5;&#x6D4B;&#x8BD5;&#x4E86;&#x6709;&#x9650;&#x7684;&#x7F13;&#x5B58;&#x540C;&#x6B65;&#x673A;&#x5236;&#x3002;<br>&#x540E;&#x7EED;&#x4E09;&#x4E2A;&#x8BF7;&#x6C42;&#x8BFB;&#x53D6;0&#xFF0C;4&#xFF0C;0&#x5747;&#x547D;&#x4E2D;&#x3002;<br>&#x57FA;&#x7840;&#x529F;&#x80FD;&#x6D4B;&#x8BD5;&#x5B8C;&#x6BD5;&#x3002;</p><h4 id="&#x66FF;&#x6362;&#x7B56;&#x7565;&#x6D4B;&#x8BD5;"><a href="#&#x66FF;&#x6362;&#x7B56;&#x7565;&#x6D4B;&#x8BD5;" class="headerlink" title="&#x66FF;&#x6362;&#x7B56;&#x7565;&#x6D4B;&#x8BD5;"></a>&#x66FF;&#x6362;&#x7B56;&#x7565;&#x6D4B;&#x8BD5;</h4><p>&#x66FF;&#x6362;&#x7B56;&#x7565;&#x7684;&#x6D4B;&#x8BD5;&#x7A0D;&#x5FAE;&#x7E41;&#x7410;&#x4E00;&#x4E9B;&#x3002;&#x7ECF;&#x8FC7;&#x601D;&#x8003;&#x6211;&#x51B3;&#x5B9A;&#x5148;&#x5C06;cache&#x7684;&#x89C4;&#x6A21;&#x7F29;&#x5C0F;&#xFF0C;&#x7F29;&#x5C0F;&#x5230;&#x6700;&#x5C0F;&#x3002;&#x5F53;cache&#x89C4;&#x6A21;&#x7F29;&#x5230;&#x5F88;&#x5C0F;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x5F88;&#x5BB9;&#x6613;&#x5236;&#x9020;cache&#x66FF;&#x6362;&#x7684;&#x6A21;&#x62DF;&#xFF0C;&#x7136;&#x540E;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#x3002;<br>&#x5C06;&#x53C2;&#x6570;INDEX&#x6539;&#x4E3A;1&#xFF0C;&#x6B64;&#x65F6;cache&#x7684;&#x89C4;&#x6A21;&#x4E3A;&#x4E24;&#x7EC4;&#xFF0C;&#x6BCF;&#x7EC4;&#x4E24;&#x884C;&#x3002;&#x7136;&#x540E;&#x6267;&#x884C;&#x5E8F;&#x5217;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] address [<span class="hljs-number">0</span>:<span class="hljs-number">7</span>] ;</span><br><span class="line"><span class="hljs-keyword">initial</span></span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    address[<span class="hljs-number">0</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    address[<span class="hljs-number">1</span>]= <span class="hljs-number">4</span> ;</span><br><span class="line">    address[<span class="hljs-number">2</span>]= <span class="hljs-number">28</span> ; </span><br><span class="line">    address[<span class="hljs-number">3</span>]= <span class="hljs-number">8</span> ;</span><br><span class="line">    address[<span class="hljs-number">4</span>]= <span class="hljs-number">16</span> ;</span><br><span class="line">    address[<span class="hljs-number">5</span>]= <span class="hljs-number">4</span> ; </span><br><span class="line">    address[<span class="hljs-number">6</span>]= <span class="hljs-number">4</span> ; </span><br><span class="line">    address[<span class="hljs-number">7</span>]= <span class="hljs-number">4</span> ; </span><br><span class="line"><span class="hljs-keyword">end</span></span><br><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] rw;</span><br><span class="line"><span class="hljs-keyword">initial</span></span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    rw[<span class="hljs-number">0</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    rw[<span class="hljs-number">1</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    rw[<span class="hljs-number">2</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    rw[<span class="hljs-number">3</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    rw[<span class="hljs-number">4</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    rw[<span class="hljs-number">5</span>]= <span class="hljs-number">1</span> ;</span><br><span class="line">    rw[<span class="hljs-number">6</span>]= <span class="hljs-number">1</span> ;</span><br><span class="line">    rw[<span class="hljs-number">7</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><p>&#x4EFF;&#x771F;&#x7ED3;&#x679C;&#x5982;&#x56FE;:<br><img src="/%E7%BB%84%E7%9B%B8%E8%81%94cache%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/replace_policy_test_1.png" alt="&#x66FF;&#x6362;&#x7B56;&#x7565;&#x6D4B;&#x8BD5;1"><br><img src="/%E7%BB%84%E7%9B%B8%E8%81%94cache%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/replace_policy_test_2.png" alt="&#x66FF;&#x6362;&#x7B56;&#x7565;&#x6D4B;&#x8BD5;2"><br><img src="/%E7%BB%84%E7%9B%B8%E8%81%94cache%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/replace_policy_test_3.png" alt="&#x66FF;&#x6362;&#x7B56;&#x7565;&#x6D4B;&#x8BD5;3"></p><p>&#x5206;&#x6790;&#x4E0A;&#x8FF0;&#x5E8F;&#x5217;&#x7684;&#x8FC7;&#x7A0B;&#xFF1A;</p><table><thead><tr><th>&#x65F6;&#x523B;</th><th>120ns</th><th>220ns</th><th>320ns</th><th>420ns</th><th>520ns</th><th>620ns</th><th>720ns</th></tr></thead><tbody><tr><td>&#x8BF7;&#x6C42;</td><td>0</td><td>4</td><td>28</td><td>8</td><td>16</td><td>4</td><td>4</td></tr><tr><td>TAG</td><td>0</td><td>0</td><td>11</td><td>1</td><td>10</td><td>0</td><td>0</td></tr><tr><td>INDEX</td><td>0</td><td>1</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td>&#x884C;/&#x7EC4;</td><td>0A</td><td>1A</td><td>1B</td><td>0B</td><td>0B</td><td>1A</td><td>1A</td></tr><tr><td>&#x7B56;&#x7565;</td><td>TAG&#x76F8;&#x540C;&#x7EC4;</td><td>TAG&#x76F8;&#x540C;&#x7EC4;</td><td>&#x7A7A;&#x7684;&#x7EC4;</td><td>&#x7A7A;&#x7684;&#x7EC4;</td><td>&#x6EE1;&#xFF0C;&#x968F;&#x673A;</td><td>&#x6EE1;&#xFF0C;&#x968F;&#x673A;</td><td>TAG&#x76F8;&#x540C;&#x7EC4;</td></tr></tbody></table><p>&#x7531;&#x4EFF;&#x771F;&#x7ED3;&#x679C;&#x53EF;&#x77E5;&#xFF0C;&#x66FF;&#x6362;&#x7B56;&#x7565;&#x901A;&#x8FC7;&#x6D4B;&#x8BD5;&#x3002;</p><h3 id="&#x591A;&#x4E2A;cache&#x7684;&#x8054;&#x5408;&#x8BBF;&#x5B58;&#x6D4B;&#x8BD5;"><a href="#&#x591A;&#x4E2A;cache&#x7684;&#x8054;&#x5408;&#x8BBF;&#x5B58;&#x6D4B;&#x8BD5;" class="headerlink" title="&#x591A;&#x4E2A;cache&#x7684;&#x8054;&#x5408;&#x8BBF;&#x5B58;&#x6D4B;&#x8BD5;"></a>&#x591A;&#x4E2A;cache&#x7684;&#x8054;&#x5408;&#x8BBF;&#x5B58;&#x6D4B;&#x8BD5;</h3><p>&#x5355;&#x4E2A;cache&#x7684;&#x529F;&#x80FD;&#x6D4B;&#x8BD5;&#x5B8C;&#xFF0C;&#x8FBE;&#x5230;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;&#x540E;&#xFF0C;&#x5C31;&#x8981;&#x6D4B;&#x8BD5;&#x591A;&#x4E2A;cache&#x8054;&#x5408;&#x8BBF;&#x95EE;&#x603B;&#x7EBF;&#x7684;&#x6D4B;&#x8BD5;&#x3002;&#x8FD9;&#x4E2A;&#x6D4B;&#x8BD5;&#x4E0D;&#x5355;&#x6D4B;&#x8BD5;cache&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x8981;&#x6D4B;&#x8BD5;&#x603B;&#x7EBF;&#x7684;&#x529F;&#x80FD;&#x3002;<br>&#x9996;&#x5148;&#x5C06;&#x4E24;&#x4E2A;cache&#x5B9E;&#x4F8B;&#x5206;&#x522B;&#x4F5C;&#x4E3A;I cache &#x548C;D cache&#x8FDE;&#x63A5;&#x5728;&#x603B;&#x7EBF;&#x548C;&#x603B;&#x7EBF;&#x63A7;&#x5236;&#x5668;&#x4E0A;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//hook up the simulated instruction cache</span></span><br><span class="line">cache I_cache (CPU_stall,next_pc , <span class="hljs-number">32&apos;b0</span> , <span class="hljs-number">1&apos;b1</span>, <span class="hljs-number">1&apos;b0</span>, <span class="hljs-number">1&apos;b0</span>, CPU_data, CPU_ready, PC,</span><br><span class="line">                BUS_addr, BUS_data, DMA[<span class="hljs-number">0</span>], BUS_RW, grant[<span class="hljs-number">0</span>], BUS_ready, clr, clk,</span><br><span class="line">                we_a,we_b,we_c,needupdate,tag,hitA,hitB,RAM_A_out);</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//hook up the simulated data cache</span></span><br><span class="line">cache D_cache (CPU_stall,exe_address[i],data[i], exe_req[i], rw[i],<span class="hljs-number">1&apos;b0</span>,mem_o,mem_ready,,</span><br><span class="line">                BUS_addr,BUS_data,DMA[<span class="hljs-number">1</span>],BUS_RW, grant[<span class="hljs-number">1</span>],BUS_ready ,clr,clk);</span><br></pre></td></tr></table></figure><p>D_cache&#x63A5;&#x5728;DMA[1]&#x4E0A;&#xFF0C;&#x8868;&#x660E;&#x6307;&#x4EE4;cache&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x6BD4;&#x6570;&#x636E;cache&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x8981;&#x9AD8;&#x3002;<br>&#x7136;&#x540E;&#x8BBE;&#x7F6E;&#x5408;&#x9002;&#x7684;CPU_stall&#x4FE1;&#x53F7;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">wire</span> CPU_stall = clr ? <span class="hljs-number">0</span>: ~(CPU_ready &amp;&amp; mem_ready);</span><br></pre></td></tr></table></figure><p>&#x6700;&#x540E;&#x52A0;&#x8F7D;&#x6A21;&#x62DF;&#x7684;&#x6D4B;&#x8BD5;&#x8BF7;&#x6C42;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//for I cache</span></span><br><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] address [<span class="hljs-number">0</span>:<span class="hljs-number">7</span>] ;</span><br><span class="line"><span class="hljs-keyword">initial</span></span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    address[<span class="hljs-number">0</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    address[<span class="hljs-number">1</span>]= <span class="hljs-number">4</span> ;</span><br><span class="line">    address[<span class="hljs-number">2</span>]= <span class="hljs-number">0</span> ; </span><br><span class="line">    address[<span class="hljs-number">3</span>]= <span class="hljs-number">4</span> ;</span><br><span class="line">    address[<span class="hljs-number">4</span>]= <span class="hljs-number">8</span> ;</span><br><span class="line">    address[<span class="hljs-number">5</span>]= <span class="hljs-number">16</span> ; </span><br><span class="line">    address[<span class="hljs-number">6</span>]= <span class="hljs-number">0</span> ; </span><br><span class="line">    address[<span class="hljs-number">7</span>]= <span class="hljs-number">4</span> ; </span><br><span class="line"><span class="hljs-keyword">end</span></span><br><span class="line"><span class="hljs-comment">//for D cache</span></span><br><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] exe_address [<span class="hljs-number">0</span>:<span class="hljs-number">7</span>];</span><br><span class="line"><span class="hljs-keyword">initial</span></span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    exe_address[<span class="hljs-number">0</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    exe_address[<span class="hljs-number">1</span>]= <span class="hljs-number">20</span>;</span><br><span class="line">    exe_address[<span class="hljs-number">2</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    exe_address[<span class="hljs-number">3</span>]= <span class="hljs-number">20</span>;</span><br><span class="line">    exe_address[<span class="hljs-number">4</span>]= <span class="hljs-number">20</span>;</span><br><span class="line">    exe_address[<span class="hljs-number">5</span>]= <span class="hljs-number">24</span>;</span><br><span class="line">    exe_address[<span class="hljs-number">6</span>]= <span class="hljs-number">24</span>;</span><br><span class="line">    exe_address[<span class="hljs-number">7</span>]= <span class="hljs-number">24</span>;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] exe_req [<span class="hljs-number">0</span>:<span class="hljs-number">7</span>];</span><br><span class="line"><span class="hljs-keyword">initial</span></span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    exe_req[<span class="hljs-number">0</span>]=<span class="hljs-number">0</span>;</span><br><span class="line">    exe_req[<span class="hljs-number">1</span>]=<span class="hljs-number">1</span>;</span><br><span class="line">    exe_req[<span class="hljs-number">2</span>]=<span class="hljs-number">0</span>;</span><br><span class="line">    exe_req[<span class="hljs-number">3</span>]=<span class="hljs-number">1</span>;</span><br><span class="line">    exe_req[<span class="hljs-number">4</span>]=<span class="hljs-number">1</span>;</span><br><span class="line">    exe_req[<span class="hljs-number">5</span>]=<span class="hljs-number">1</span>;</span><br><span class="line">    exe_req[<span class="hljs-number">6</span>]=<span class="hljs-number">1</span>;</span><br><span class="line">    exe_req[<span class="hljs-number">7</span>]=<span class="hljs-number">1</span>;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] data [<span class="hljs-number">0</span>:<span class="hljs-number">7</span>];</span><br><span class="line"><span class="hljs-keyword">initial</span></span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    data[<span class="hljs-number">0</span>]= <span class="hljs-number">32&apos;hab2112a</span> ;</span><br><span class="line">    data[<span class="hljs-number">1</span>]= <span class="hljs-number">32&apos;hab2112b</span> ;</span><br><span class="line">    data[<span class="hljs-number">2</span>]= <span class="hljs-number">32&apos;hab2112c</span> ;</span><br><span class="line">    data[<span class="hljs-number">3</span>]= <span class="hljs-number">32&apos;hab21123</span> ;</span><br><span class="line">    data[<span class="hljs-number">4</span>]= <span class="hljs-number">32&apos;hab21124</span> ;</span><br><span class="line">    data[<span class="hljs-number">5</span>]= <span class="hljs-number">32&apos;hab21128</span> ;</span><br><span class="line">    data[<span class="hljs-number">6</span>]= <span class="hljs-number">32&apos;hab21129</span> ;</span><br><span class="line">    data[<span class="hljs-number">7</span>]= <span class="hljs-number">32&apos;hab21121</span> ;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br><span class="line"><span class="hljs-keyword">reg</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] rw;</span><br><span class="line"><span class="hljs-keyword">initial</span></span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line">    rw[<span class="hljs-number">0</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    rw[<span class="hljs-number">1</span>]= <span class="hljs-number">1</span> ;</span><br><span class="line">    rw[<span class="hljs-number">2</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    rw[<span class="hljs-number">3</span>]= <span class="hljs-number">1</span> ;</span><br><span class="line">    rw[<span class="hljs-number">4</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    rw[<span class="hljs-number">5</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line">    rw[<span class="hljs-number">6</span>]= <span class="hljs-number">1</span> ;</span><br><span class="line">    rw[<span class="hljs-number">7</span>]= <span class="hljs-number">0</span> ;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></table></figure><p>&#x4EFF;&#x771F;&#x7ED3;&#x679C;&#x5982;&#x56FE;:<br><img src="/%E7%BB%84%E7%9B%B8%E8%81%94cache%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/2cache_test_1.png" alt="&#x8054;&#x5408;&#x8BBF;&#x5B58;&#x6D4B;&#x8BD5;1"><br>0-130ns:<br>    I cache&#x672A;&#x547D;&#x4E2D;&#x8BBF;&#x95EE;&#x603B;&#x7EBF;&#xFF0C;D cache&#x65E0;&#x8BF7;&#x6C42;&#xFF0C;130nsCPU&#x51C6;&#x5907;&#x597D;&#x63A5;&#x6536;&#x4E0B;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x3002;<br>130ns-330ns:<br>    I cache&#x672A;&#x547D;&#x4E2D;&#x4F18;&#x5148;&#x8BBF;&#x95EE;&#x603B;&#x7EBF;&#xFF0C;230ns&#x8BBF;&#x95EE;&#x5B8C;&#x6210;&#x8F6E;&#x5230;D cache&#x8BBF;&#x95EE;&#x603B;&#x7EBF;&#xFF0C;330ns CPU&#x51C6;&#x5907;&#x597D;&#x63A5;&#x6536;&#x4E0B;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x3002;<br>330ns-350ns:<br>    I cache&#x548C;Dcache&#x5747;&#x547D;&#x4E2D;&#xFF0C;&#x603B;&#x7EBF;&#x7A7A;&#x95F2;&#xFF0C;350ns CPU&#x51C6;&#x5907;&#x597D;&#x63A5;&#x6536;&#x4E0B;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x3002;<br><img src="/%E7%BB%84%E7%9B%B8%E8%81%94cache%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/2cache_test_2.png" alt="&#x8054;&#x5408;&#x8BBF;&#x5B58;&#x6D4B;&#x8BD5;2"><br>350ns-450ns&#xFF1A;<br>    I cache&#x672A;&#x547D;&#x4E2D; &#x8BBF;&#x95EE;&#x603B;&#x7EBF;&#xFF0C;D cache&#x547D;&#x4E2D;&#xFF0C;450ns CPU&#x51C6;&#x5907;&#x597D;&#x63A5;&#x6536;&#x4E0B;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x3002;<br>450ns-650ns:<br>    I cache&#x672A;&#x547D;&#x4E2D;&#x4F18;&#x5148;&#x8BBF;&#x95EE;&#x603B;&#x7EBF;&#xFF0C;550ns&#x8BBF;&#x95EE;&#x5B8C;&#x6210;&#x8F6E;&#x5230;D cache&#x8BBF;&#x95EE;&#x603B;&#x7EBF;&#xFF0C;650ns CPU&#x51C6;&#x5907;&#x597D;&#x63A5;&#x6536;&#x4E0B;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x3002;<br><img src="/%E7%BB%84%E7%9B%B8%E8%81%94cache%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/2cache_test_3.png" alt="&#x8054;&#x5408;&#x8BBF;&#x5B58;&#x6D4B;&#x8BD5;3"><br>650ns-850ns:<br>    I cache&#x672A;&#x547D;&#x4E2D;&#x4F18;&#x5148;&#x8BBF;&#x95EE;&#x603B;&#x7EBF;&#xFF0C;750ns&#x8BBF;&#x95EE;&#x5B8C;&#x6210;&#x8F6E;&#x5230;D cache&#x8BBF;&#x95EE;&#x603B;&#x7EBF;&#xFF0C;850ns CPU&#x51C6;&#x5907;&#x597D;&#x63A5;&#x6536;&#x4E0B;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x3002;<br>850ns-950ns:<br>    I cache&#x547D;&#x4E2D;&#xFF0C; D cache&#x672A;&#x547D;&#x4E2D;&#xFF0C;&#x8BBF;&#x95EE;&#x603B;&#x7EBF;&#xFF0C;950ns&#x8BBF;&#x95EE;&#x5B8C;&#x6210;&#xFF0C;CPU&#x51C6;&#x5907;&#x597D;&#x3002;<br>950ns-970ns:<br>    I cache&#x3001;D cache&#x5747;&#x547D;&#x4E2D;&#xFF0C;CPU&#x5728;&#x4E00;&#x4E2A;&#x5468;&#x671F;&#x5185;&#x51C6;&#x5907;&#x597D;&#x3002;<br>970ns-990ns:<br>    I cache&#x3001;D cache&#x5747;&#x547D;&#x4E2D;&#xFF0C;CPU&#x5728;&#x4E00;&#x4E2A;&#x5468;&#x671F;&#x5185;&#x51C6;&#x5907;&#x597D;&#x3002;</p><p>&#x7531;&#x4EFF;&#x771F;&#x7ED3;&#x679C;&#x53EF;&#x77E5;&#xFF0C;&#x4E24;&#x4E2A;cache&#x53EF;&#x4EE5;&#x6309;&#x7167;&#x4F18;&#x5148;&#x7EA7;&#x5171;&#x540C;&#x8BBF;&#x95EE;&#x7CFB;&#x7EDF;&#x603B;&#x7EBF;&#xFF0C;&#x800C;&#x4E14;cache&#x7684;&#x5B58;&#x5728;&#x5BF9;CPU&#x7684;&#x6027;&#x80FD;&#x63D0;&#x5347;&#x5F88;&#x6709;&#x5E2E;&#x52A9;&#x3002;&#x6211;&#x4EEC;&#x603B;&#x7EBF;&#x4E0A;&#x6302;&#x7684;&#x6A21;&#x62DF;&#x5185;&#x5B58;&#x63A7;&#x5236;&#x5668;&#x9700;&#x8981;5&#x4E2A;&#x5468;&#x671F;100ns&#x4E8B;&#x4EF6;&#x624D;&#x80FD;&#x5C06;&#x6570;&#x636E;&#x51C6;&#x5907;&#x597D;&#x3002;30-990ns&#x7684;&#x65F6;&#x95F4;&#x5185;&#xFF0C;&#x5171;48&#x4E2A;&#x65F6;&#x949F;&#x5468;&#x671F;&#xFF0C;&#x5171;&#x5B8C;&#x6210;&#x4E86;9&#x6761;&#x6307;&#x4EE4;&#x3002;&#x82E5;cache&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x6BCF;&#x6761;&#x6307;&#x4EE4;&#x9700;&#x8981;10&#x4E2A;&#x5468;&#x671F;&#x624D;&#x80FD;&#x5B8C;&#x6210;&#xFF0C;&#x6700;&#x591A;&#x624D;&#x80FD;&#x6267;&#x884C;4.8&#x6761;&#x3002;</p><h2 id="&#x5DF2;&#x77E5;&#x95EE;&#x9898;"><a href="#&#x5DF2;&#x77E5;&#x95EE;&#x9898;" class="headerlink" title="&#x5DF2;&#x77E5;&#x95EE;&#x9898;"></a>&#x5DF2;&#x77E5;&#x95EE;&#x9898;</h2><p>&#x6211;&#x7684;&#x603B;&#x7EBF;&#x8BBE;&#x5907;&#x548C;&#x603B;&#x7EBF;&#x63A7;&#x5236;&#x5668;&#x4E0D;&#x77E5;&#x9053;&#x5982;&#x4F55;&#x89E3;&#x51B3;&#x5BF9;&#x8BBE;&#x5907;&#x4E2D;&#x6CA1;&#x6709;&#x7684;&#x5730;&#x5740;&#x7684;&#x8BBF;&#x95EE;&#x3002;<br>&#x5982;&#x679C;&#x8BBF;&#x95EE;&#x7684;&#x5730;&#x5740;&#x4E0D;&#x5728;&#x8BBE;&#x5907;&#x7684;&#x8303;&#x56F4;&#x5185;&#xFF0C;&#x7CFB;&#x7EDF;&#x5C31;&#x4F1A;&#x51FA;&#x73B0;&#x5F02;&#x5E38;&#x3002;<br>&#x76EE;&#x524D;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1A;&#x65E0;&#xFF0C;&#x7A0B;&#x5E8F;&#x4E0D;&#x5E94;&#x8BBF;&#x95EE;&#x4E0D;&#x5728;&#x8BBE;&#x5907;&#x8303;&#x56F4;&#x5185;&#x7684;&#x5730;&#x5740;&#x3002;</p><h2 id="&#x5C0F;&#x7ED3;"><a href="#&#x5C0F;&#x7ED3;" class="headerlink" title="&#x5C0F;&#x7ED3;"></a>&#x5C0F;&#x7ED3;</h2><p>&#x6211;&#x5728;&#x5B9E;&#x73B0;&#x8FC7;&#x7A0B;&#x4E2D;&#x9047;&#x5230;&#x7684;&#x6700;&#x5927;&#x7684;&#x95EE;&#x9898;&#x83AB;&#x8FC7;&#x4E8E;&#x7EC4;&#x5408;&#x903B;&#x8F91;&#x73AF;&#x3002;&#x56E0;&#x4E3A;FPGA&#x7247;&#x4E0A;&#x5B58;&#x50A8;&#x7684;&#x7279;&#x6027;&#xFF08;&#x9690;&#x542B;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#xFF09;&#xFF0C;&#x6211;&#x5FC5;&#x987B;&#x5728;&#x6A21;&#x5757;&#x7684;&#x67D0;&#x4E9B;&#x8F93;&#x5165;&#x4E0A;&#x76F4;&#x63A5;&#x7ED5;&#x8FC7;&#x6D41;&#x6C34;&#x7EBF;&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x5E76;&#x4F9D;&#x636E;CPU_stall&#x8FDB;&#x884C;&#x9009;&#x62E9;&#xFF0C;&#x8FD9;&#x5C31;&#x975E;&#x5E38;&#x5BB9;&#x6613;&#x5F15;&#x5165;&#x4ECE;CPU_stall&#x4FE1;&#x53F7;&#x5230;ready_o&#x4FE1;&#x53F7;&#x4E4B;&#x95F4;&#x7684;&#x903B;&#x8F91;&#x73AF;&#x3002;&#x6211;&#x5728;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x4E0A;&#x82B1;&#x4E86;&#x5F88;&#x957F;&#x65F6;&#x95F4;&#x8FDB;&#x884C;&#x8C03;&#x8BD5;&#xFF0C;&#x6700;&#x540E;&#x603B;&#x7ED3;&#x51FA;&#xFF0C;&#x53EA;&#x5728;&#x7247;&#x4E0A;RAM&#x7684;&#x5730;&#x5740;&#x8F93;&#x5165;&#x4E0A;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x7531;stall&#x4FE1;&#x53F7;&#x9009;&#x62E9;&#x7684;&#x8F93;&#x5165;&#xFF0C;&#x5176;&#x4F59;&#x7684;&#x63A7;&#x5236;&#x7535;&#x8DEF;&#x5747;&#x8981;&#x4F7F;&#x7528;&#x7ECF;&#x8FC7;&#x5BC4;&#x5B58;&#x5668;&#x540C;&#x6B65;&#x7684;&#x8F93;&#x5165;&#x3002;&#x56E0;&#x4E3A;&#x7247;&#x4E0A;ram&#x8BFB;&#x53D6;&#x7ED3;&#x679C;&#x662F;&#x7531;&#x5BC4;&#x5B58;&#x5668;&#x540C;&#x6B65;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x6837;&#x7ED5;&#x8FC7;&#x6D41;&#x6C34;&#x7EBF;&#x5BC4;&#x5B58;&#x5668;&#x4E0D;&#x4F1A;&#x5F15;&#x8D77;&#x7EC4;&#x5408;&#x903B;&#x8F91;&#x73AF;&#x3002;<br>&#x7EC4;&#x76F8;&#x8054;cache&#x5728;&#x5404;&#x79CD;&#x6559;&#x79D1;&#x4E66;&#x4E2D;&#x90FD;&#x6709;&#x63D0;&#x53CA;&#xFF0C;&#x4F46;&#x5176;&#x7BC7;&#x5E45;&#x5F80;&#x5F80;&#x4E0D;&#x957F;&#xFF0C;&#x5F80;&#x5F80;&#x5E76;&#x4E0D;&#x80FD;&#x63CF;&#x8FF0;&#x5176;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x3002;&#x6211;&#x505A;&#x8FD9;&#x4EF6;&#x4E8B;&#xFF0C;&#x5199;&#x8FD9;&#x4E9B;&#x6587;&#x7AE0;&#xFF0C;&#x4E00;&#x662F;&#x6EE1;&#x8DB3;&#x81EA;&#x5DF1;&#x7684;&#x6B32;&#x671B;&#xFF0C;&#x4E8C;&#x662F;&#x5E0C;&#x671B;&#x80FD;&#x591F;&#x901A;&#x8FC7;&#x52A8;&#x624B;&#x5B9E;&#x8DF5;&#x6765;&#x586B;&#x8865;&#x7406;&#x8BBA;&#x548C;&#x5B9E;&#x8DF5;&#x4E4B;&#x95F4;&#x5DE8;&#x5927;&#x7684;&#x9E3F;&#x6C9F;&#xFF0C;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x7684;&#x7BC7;&#x5E45;&#x5C31;&#x5F88;&#x80FD;&#x8BF4;&#x660E;&#x95EE;&#x9898;&#x3002;<br>&#x7EC4;&#x76F8;&#x8054;cache&#x8BBE;&#x8BA1;&#x5B8C;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x7684;&#x6B32;&#x671B;&#x518D;&#x4E00;&#x6B21;&#x81A8;&#x80C0;&#x4E86;&#x3002;&#x662F;&#x5426;&#x52A0;&#x5165;&#x5206;&#x652F;&#x9884;&#x6D4B;&#xFF0C;&#x64A4;&#x6389;&#x6709;&#x4E9B;&#x8FC7;&#x65F6;&#x7684;&#x5EF6;&#x65F6;&#x69FD;&#xFF1F;&#x662F;&#x5426;&#x53EF;&#x80FD;&#x5B9E;&#x73B0;&#x7B80;&#x5355;&#x7684;&#x8D85;&#x6807;&#x91CF;&#x6D41;&#x6C34;&#x7EBF;&#xFF1F;&#x8FD9;&#x4E9B;&#x8FD8;&#x662F;&#x7B49;&#x5230;&#x6574;&#x4F53;&#x8BBE;&#x8BA1;&#x5B8C;&#x518D;&#x8BF4;&#x5427;&#x3002;</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&amp;#x6211;&amp;#x5728;&amp;#x4E0A;&amp;#x4E00;&amp;#x7BC7;&amp;#x6587;&amp;#x7AE0;&amp;#x4E2D;&amp;#xFF0C;&amp;#x63CF;&amp;#x8FF0;&amp;#x4E86;&amp;#x6211;&amp;#x5728;&amp;#x8BBE;&amp;#x8BA1;cache&amp;#x8</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>关于Cache设计的思考</title>
    <link href="https://gpthimble.github.io/Cache%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%80%83/"/>
    <id>https://gpthimble.github.io/Cache%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%80%83/</id>
    <published>2020-10-26T02:15:25.000Z</published>
    <updated>2020-12-29T16:43:49.639Z</updated>
    
    <content type="html"><![CDATA[<p>&#x672C;&#x4EE5;&#x4E3A;cache&#x7684;&#x8BBE;&#x8BA1;&#x5E76;&#x4E0D;&#x590D;&#x6742;&#xFF0C;&#x4F46;&#x5B9E;&#x9645;&#x8BBE;&#x8BA1;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x6211;&#x9047;&#x5230;&#x4E86;&#x4E0D;&#x5C11;&#x95EE;&#x9898;&#xFF0C;&#x54EA;&#x6015;&#x7A0D;&#x5FAE;&#x8003;&#x8651;&#x4E00;&#x4E0B;&#x6027;&#x80FD;&#x95EE;&#x9898;&#xFF0C;cache&#x7684;&#x8BBE;&#x8BA1;&#x7684;&#x590D;&#x6742;&#x5EA6;&#x5C31;&#x4F1A;&#x63D0;&#x9AD8;&#x5F88;&#x591A;&#x3002;cache&#x7684;&#x590D;&#x6742;&#x4E0E;cpu&#x6307;&#x4EE4;&#x89E3;&#x7801;&#x7EA7;&#x7684;&#x590D;&#x6742;&#x4E0D;&#x540C;&#xFF0C;CPU&#x6307;&#x4EE4;&#x89E3;&#x7801;&#x7EA7;&#x7684;&#x4FE1;&#x53F7;&#x8F83;&#x591A;&#xFF0C;&#x4F46;&#x8FD9;&#x4E9B;&#x4FE1;&#x53F7;&#x4E4B;&#x95F4;&#x5E76;&#x6CA1;&#x6709;&#x592A;&#x591A;&#x7684;&#x5173;&#x8054;&#xFF0C;&#x66F4;&#x591A;&#x7684;&#x662F;&#x4E00;&#x79CD;&#x7EB5;&#x5411;&#x7684;&#x903B;&#x8F91;&#x5173;&#x7CFB;&#xFF0C;&#x4E00;&#x6761;&#x6307;&#x4EE4;&#x5BF9;&#x5E94;&#x4E00;&#x79CD;&#x4FE1;&#x53F7;&#x7EC4;&#x5408;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x8BBE;&#x8BA1;&#x548C;&#x5206;&#x6790;&#x8FC7;&#x7A0B;&#x4E2D;&#x5E76;&#x6CA1;&#x6709;&#x592A;&#x591A;&#x590D;&#x6742;&#x95EE;&#x9898;&#x3002;&#x4F46;cache&#x4E2D;&#x7684;&#x4FE1;&#x53F7;&#x7684;&#x903B;&#x8F91;&#x5173;&#x7CFB;&#x66F4;&#x590D;&#x6742;&#xFF0C;&#x66F4;&#x96BE;&#x7406;&#x6E05;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x82B1;&#x8D39;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x7CBE;&#x529B;&#x53BB;&#x8BBE;&#x8BA1;&#x3002;&#x6211;&#x5F15;&#x5165;cache&#x7684;&#x672C;&#x610F;&#x5E76;&#x4E0D;&#x662F;&#x5355;&#x7EAF;&#x4E3A;&#x4E86;&#x6027;&#x80FD;&#xFF0C;&#x6700;&#x4E3B;&#x8981;&#x7684;&#x539F;&#x56E0;&#x662F;cpu&#x5185;&#x90E8;&#x91C7;&#x7528;&#x7C7B;&#x4F3C;&#x54C8;&#x5F17;&#x67B6;&#x6784;&#xFF0C;&#x9700;&#x8981;&#x5206;&#x79BB;&#x7684;&#x6307;&#x4EE4;&#x548C;&#x6570;&#x636E;&#x5B58;&#x50A8;&#xFF0C;&#x5F15;&#x5165;cache&#x53EF;&#x4EE5;&#x5728;CPU&#x89C6;&#x89D2;&#x6784;&#x6210;&#x5206;&#x79BB;&#x7684;&#x6307;&#x4EE4;&#x548C;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x3002;&#x4F46;&#x4EBA;&#x7684;&#x91CE;&#x5FC3;&#x603B;&#x662F;&#x8D8A;&#x6765;&#x8D8A;&#x5927;&#xFF0C;&#x5F53;&#x4F60;&#x4E86;&#x89E3;&#x4E86;&#x7B80;&#x5355;&#x7684;cache&#x5982;&#x4F55;&#x8BBE;&#x8BA1;&#x4E4B;&#x540E;&#xFF0C;&#x603B;&#x662F;&#x60F3;&#x80FD;&#x4E0D;&#x80FD;&#x518D;&#x4E00;&#x6B21;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#xFF0C;&#x54EA;&#x6015;&#x63D0;&#x9AD8;&#x4E00;&#x70B9;&#x70B9;&#x3002;&#x4E8E;&#x662F;&#x6211;&#x539F;&#x672C;&#x8BA1;&#x5212;&#x7684;&#x76F4;&#x63A5;&#x6620;&#x50CF;&#x7684;cache&#x5C31;&#x53D8;&#x6210;&#x4E86;&#x73B0;&#x5728;&#x8BBE;&#x8BA1;&#x7684;2&#x8DEF;&#x7EC4;&#x76F8;&#x8054;cache&#x3002;Cache&#x7684;&#x8BBE;&#x8BA1;&#x662F;&#x76EE;&#x524D;&#x6211;&#x5728;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#x8BBE;&#x8BA1;&#x8FC7;&#x7A0B;&#x4E2D;&#x9047;&#x5230;&#x7684;<strong>&#x6700;&#x6709;&#x6311;&#x6218;&#x6027;</strong>&#x7684;&#x5DE5;&#x4F5C;&#x3002;</p><h2 id="Cache-&#x8BBE;&#x8BA1;&#x65F6;&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;"><a href="#Cache-&#x8BBE;&#x8BA1;&#x65F6;&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;" class="headerlink" title="Cache &#x8BBE;&#x8BA1;&#x65F6;&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;"></a>Cache &#x8BBE;&#x8BA1;&#x65F6;&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;</h2><h3 id="Altera&#x7247;&#x4E0A;&#x5B58;&#x50A8;&#x63A5;&#x53E3;&#x4E0A;&#x9690;&#x542B;&#x7684;&#x5BC4;&#x5B58;&#x5668;"><a href="#Altera&#x7247;&#x4E0A;&#x5B58;&#x50A8;&#x63A5;&#x53E3;&#x4E0A;&#x9690;&#x542B;&#x7684;&#x5BC4;&#x5B58;&#x5668;" class="headerlink" title="Altera&#x7247;&#x4E0A;&#x5B58;&#x50A8;&#x63A5;&#x53E3;&#x4E0A;&#x9690;&#x542B;&#x7684;&#x5BC4;&#x5B58;&#x5668;"></a>Altera&#x7247;&#x4E0A;&#x5B58;&#x50A8;&#x63A5;&#x53E3;&#x4E0A;&#x9690;&#x542B;&#x7684;&#x5BC4;&#x5B58;&#x5668;</h3><p>&#x6211;&#x5728;cache&#x8BBE;&#x8BA1;&#x4E2D;&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;&#x4E4B;&#x4E00;&#x662F;&#x5173;&#x4E8E;FPGA&#x7247;&#x4E0A;&#x8D44;&#x6E90;&#x7684;&#x95EE;&#x9898;&#xFF0C;Altera&#x7247;&#x4E0A;&#x5B58;&#x50A8;&#x4E2D;&#x51E0;&#x6761;&#x8F93;&#x5165;&#x7684;&#x5730;&#x5740;&#x7EBF;&#x548C;&#x6570;&#x636E;&#x7EBF;&#x90FD;&#x662F;&#x5FC5;&#x987B;registered&#x7684;&#xFF0C;&#x8FD9;&#x5C31;&#x610F;&#x5473;&#x7740;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x7247;&#x4E0A;&#x7684;&#x5B58;&#x50A8;&#x5B9E;&#x73B0;cache&#xFF0C;IF&#x7EA7;PC&#x5BC4;&#x5B58;&#x5668;&#x5B9E;&#x9645;&#x4E0A;&#x5E94;&#x8BE5;&#x9690;&#x542B;&#x5728;I-cache&#x6A21;&#x5757;&#x5185;&#x90E8;&#xFF0C;EXE&#x548C;MEM&#x7EA7;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x5BC4;&#x5B58;&#x5668;&#x4E2D;&#x5305;&#x542B;&#x5185;&#x5B58;&#x5730;&#x5740;&#x3001;&#x6570;&#x636E;&#x548C;&#x63A7;&#x5236;&#x7684;&#x90E8;&#x5206;&#x4E5F;&#x5E94;&#x8BE5;&#x9690;&#x542B;&#x5728;D-cache&#x7684;&#x5185;&#x90E8;&#xFF0C;&#x8FD9;&#x5B9E;&#x9645;&#x4E0A;&#x7ED9;&#x6A21;&#x5757;&#x5316;&#x8BBE;&#x8BA1;&#x5E26;&#x6765;&#x4E86;&#x56F0;&#x96BE;&#x3002;&#xFF08;Quartus II Handbook Version 9.1 Volume 1: Design and Synthesis, Chapter 6: Recommended HDL Coding Styles, Inferring Memory Function from HDL Code&#xFF09;&#x5982;&#x679C;&#x5728;cpu&#x8BBE;&#x8BA1;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x5FFD;&#x7565;&#x8FD9;&#x9690;&#x542B;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x4F1A;&#x989D;&#x5916;&#x5F15;&#x5165;&#x81F3;&#x5C11;&#x4E00;&#x4E2A;&#x5468;&#x671F;&#x7684;&#x65F6;&#x5EF6;&#x3002;&#x4F46;cache&#x7684;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;&#x662F;&#x8981;&#x6C42;&#x5728;&#x547D;&#x4E2D;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5FC5;&#x987B;&#x5728;&#x4E00;&#x4E2A;&#x5468;&#x671F;&#x7ED9;&#x51FA;&#x6570;&#x636E;&#x548C;&#x6307;&#x4EE4;&#xFF0C;&#x6240;&#x4EE5;&#x9690;&#x542B;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x5FC5;&#x987B;&#x52A0;&#x5165;&#x8003;&#x8651;&#x3002;</p><h3 id="Cache&#x7684;&#x4E00;&#x81F4;&#x6027;&#x95EE;&#x9898;"><a href="#Cache&#x7684;&#x4E00;&#x81F4;&#x6027;&#x95EE;&#x9898;" class="headerlink" title="Cache&#x7684;&#x4E00;&#x81F4;&#x6027;&#x95EE;&#x9898;"></a>Cache&#x7684;&#x4E00;&#x81F4;&#x6027;&#x95EE;&#x9898;</h3><p>&#x53E6;&#x5916;Altera&#x7684;&#x7247;&#x4E0A;&#x5B58;&#x50A8;&#x4E0D;&#x652F;&#x6301;&#x6E05;&#x96F6;&#xFF08;Quartus II Handbook Version 9.1 Volume 1: Design and Synthesis, Chapter 6: Recommended HDL Coding Styles, Inferring Memory Function from HDL Code&#xFF09;&#xFF0C;&#x8FD9;&#x7ED9;&#x5B9E;&#x73B0;cache&#x6E05;&#x96F6;&#x6307;&#x4EE4;&#x5E26;&#x6765;&#x4E86;&#x56F0;&#x96BE;&#xFF1A;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x7247;&#x4E0A;&#x5B58;&#x50A8;&#x6765;&#x5B9E;&#x73B0;cache&#xFF0C;&#x4E0D;&#x80FD;&#x6E05;&#x96F6;&#x4F7F;&#x5F97;&#x5B9E;&#x73B0;cache&#x6E05;&#x96F6;&#x6307;&#x4EE4;&#x6709;&#x56F0;&#x96BE;&#xFF0C;&#x800C;&#x5982;&#x679C;&#x6CA1;&#x6709;cache&#x6E05;&#x96F6;&#x6307;&#x4EE4;&#xFF0C;&#x7F13;&#x5B58;&#x540C;&#x6B65;&#x7684;&#x95EE;&#x9898;&#x5C31;&#x9700;&#x8981;&#x5B8C;&#x5168;&#x7531;&#x786C;&#x4EF6;&#x89E3;&#x51B3;&#x3002;&#x8FD9;&#x53C8;&#x8BA9;&#x6211;&#x601D;&#x8003;&#x662F;&#x5426;&#x5F15;&#x5165;&#x603B;&#x7EBF;&#x76D1;&#x542C;&#xFF08;bus snooping&#xFF09;&#x3002;&#x6709;&#x4EBA;&#x8BA4;&#x4E3A;&#x6211;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x5355;&#x6838;&#x5FC3;&#x5355;&#x7EA7;cache&#x7684;&#x7CFB;&#x7EDF;&#x4E0D;&#x9700;&#x8981;&#x8003;&#x8651;cache&#x4E00;&#x81F4;&#x6027;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x8FD9;&#x6837;&#x7684;&#x60F3;&#x6CD5;&#x4E0D;&#x5B8C;&#x5168;&#x6B63;&#x786E;&#x3002;&#x8003;&#x8651;&#x8FD9;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#xFF1A;&#x4E00;&#x662F;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#xFF08;Self-Modifying code&#xFF09;&#x95EE;&#x9898;&#xFF0C;&#x8BBE;&#x60F3;&#x6709;&#x4E00;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5728;&#x7CFB;&#x7EDF;&#x4E0A;&#x8FD0;&#x884C;&#xFF0C;&#x5C06;&#x67D0;&#x4E2A;&#x7A0B;&#x5E8F;&#x6307;&#x4EE4;&#x4ECE;&#x786C;&#x76D8;&#x52A0;&#x8F7D;&#x5230;&#x5185;&#x5B58;&#xFF0C;&#x6267;&#x884C;&#x4E00;&#x7CFB;&#x5217;LW&#x64CD;&#x4F5C;&#x3002;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4ECE;&#x786C;&#x76D8;&#x8BFB;&#x53D6;&#x4E00;&#x4E32;&#x6307;&#x4EE4;&#xFF0C;&#x653E;&#x5165;&#x5185;&#x5B58;&#x7684;&#x67D0;&#x4E00;&#x4F4D;&#x7F6E;&#xFF0C;&#x6070;&#x597D;&#x8986;&#x76D6;&#x4E86;&#x4E4B;&#x524D;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x6307;&#x4EE4;&#x3002;&#x6B64;&#x65F6;&#x82E5;I-cache&#x5DF2;&#x7ECF;&#x7F13;&#x5B58;&#x8FC7;&#x8FD9;&#x4E00;&#x533A;&#x57DF;&#xFF0C;I-cache&#x6839;&#x672C;&#x4E0D;&#x77E5;&#x9053;LW&#x6307;&#x4EE4;&#x5DF2;&#x7ECF;&#x4FEE;&#x6539;&#x4E86;&#x8FD9;&#x90E8;&#x5206;&#x5185;&#x5B58;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x5C31;&#x4F1A;&#x5F15;&#x8D77;cache&#x4E00;&#x81F4;&#x6027;&#x7684;&#x95EE;&#x9898;&#x3002;&#x5F53;CPU&#x8DF3;&#x8F6C;&#x5230;&#x8FD9;&#x4E2A;&#x533A;&#x57DF;&#xFF0C;I-cache&#x8BA4;&#x4E3A;&#x547D;&#x4E2D;&#xFF0C;&#x5B9E;&#x9645;&#x6267;&#x884C;&#x7684;&#x662F;&#x65E7;&#x6307;&#x4EE4;&#x800C;&#x4E0D;&#x662F;&#x6211;&#x4EEC;&#x901A;&#x8FC7;LW&#x8F7D;&#x5165;&#x7684;&#x65B0;&#x6307;&#x4EE4;&#x3002;&#x4E8C;&#x662F;DMA&#x95EE;&#x9898;&#xFF0C;&#x5F53;&#x603B;&#x7EBF;&#x4E0A;&#x6709;DMA&#x8BF7;&#x6C42;&#x53D1;&#x751F;&#x65F6;&#xFF0C;DMA&#x8BBE;&#x5907;&#x76F4;&#x63A5;&#x4FEE;&#x6539;&#x67D0;&#x4E9B;&#x533A;&#x57DF;&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x800C;Cache&#x5E76;&#x4E0D;&#x77E5;&#x9053;&#xFF0C;&#x8FD9;&#x540C;&#x6837;&#x4F1A;&#x5F15;&#x8D77;&#x7F13;&#x5B58;&#x4E00;&#x81F4;&#x6027;&#x95EE;&#x9898;&#x3002;</p><h4 id="&#x5BF9;&#x4E8E;DMA"><a href="#&#x5BF9;&#x4E8E;DMA" class="headerlink" title="&#x5BF9;&#x4E8E;DMA"></a>&#x5BF9;&#x4E8E;DMA</h4><p>&#x7B2C;&#x4E8C;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;MIPS&#x5904;&#x7406;&#x5668;&#x91C7;&#x53D6;&#x4E00;&#x79CD;&#x7B80;&#x5355;&#x7C97;&#x66B4;&#x7684;&#x529E;&#x6CD5;&#x6765;&#x89E3;&#x51B3;&#xFF0C;&#x5C31;&#x662F;&#x5728;&#x5185;&#x5B58;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x4E2D;&#x5355;&#x72EC;&#x5212;&#x51FA;&#x6765;&#x4E00;&#x90E8;&#x5206;&#x4E0D;&#x88AB;cache&#x7D22;&#x5F15;&#xFF0C;&#x6BCF;&#x5F53;&#x5904;&#x7406;&#x5668;&#x8BD5;&#x56FE;&#x83B7;&#x53D6;&#x8FD9;&#x4E2A;&#x5730;&#x5740;&#x8303;&#x56F4;&#x5185;&#x7684;&#x6570;&#x636E;&#x6216;&#x6307;&#x4EE4;&#x65F6;&#xFF0C;&#x90FD;&#x7ED5;&#x8FC7;cache&#xFF0C;&#x4ECE;&#x5185;&#x5B58;&#x4E0A;&#x8BF7;&#x6C42;&#x3002;&#x4F46;&#x662F;&#x7B2C;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#x8981;&#x9EBB;&#x70E6;&#x4E00;&#x4E9B;&#xFF0C;&#x56E0;&#x4E3A;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x8981;&#x9891;&#x7E41;&#x7684;&#x5C06;&#x7A0B;&#x5E8F;&#x7684;&#x6307;&#x4EE4;&#x5199;&#x5165;&#x5185;&#x5B58;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x603B;&#x662F;&#x628A;&#x80FD;&#x81EA;&#x6211;&#x4FEE;&#x6539;&#x7684;&#x6307;&#x4EE4;&#x90E8;&#x5206;&#x653E;&#x5165;&#x8FD9;&#x4E2A;&#x7ED5;&#x8FC7;cache&#x7684;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x5185;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#x5927;&#x90E8;&#x5206;&#x7A0B;&#x5E8F;&#x90FD;&#x5F97;&#x4E0D;&#x5230;cache&#x7684;&#x901F;&#x5EA6;&#x4F18;&#x52BF;&#xFF0C;&#x8FD8;&#x4E0D;&#x5982;&#x4E0D;&#x5F15;&#x5165;cache&#x3002;</p><h4 id="&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;-&#xFF08;Self-Modifying-Code&#xFF09;"><a href="#&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;-&#xFF08;Self-Modifying-Code&#xFF09;" class="headerlink" title="&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801; &#xFF08;Self-Modifying Code&#xFF09;"></a>&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801; &#xFF08;Self-Modifying Code&#xFF09;</h4><p>&#x5982;&#x4F55;&#x641E;&#x5B9A;&#x8FD9;&#x7B2C;&#x4E8C;&#x79CD;&#x60C5;&#x51B5;&#xFF1F;&#x662F;&#x76F4;&#x63A5;&#x5728;&#x786C;&#x4EF6;&#x4E0A;&#x63D0;&#x4F9B;&#x7F13;&#x5B58;&#x4E00;&#x81F4;&#x6027;&#x7684;&#x652F;&#x6301;&#xFF1F;&#x8FD8;&#x662F;&#x52A0;&#x5165;&#x4E00;&#x4E9B;&#x7F13;&#x5B58;&#x540C;&#x6B65;&#x6307;&#x4EE4;&#x5728;&#x5FC5;&#x8981;&#x7684;&#x65F6;&#x5019;&#x7531;&#x7CFB;&#x7EDF;&#x8F6F;&#x4EF6;&#x7F16;&#x5199;&#x8005;&#x5BF9;cache&#x8FDB;&#x884C;&#x7BA1;&#x7406;&#xFF0C;&#x5982;&#x5728;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x52A0;&#x8F7D;&#x65B0;&#x8FDB;&#x7A0B;&#x7684;&#x65F6;&#x5019;&#x624B;&#x52A8;&#x6E05;&#x7A7A;I-cache&#xFF1F;&#x6211;&#x53C2;&#x8003;&#x4E86;&#x4E00;&#x4E9B;&#x8D44;&#x6599;&#x3002;</p><p>&#x663E;&#x7136;&#x4E0D;&#x540C;&#x5E73;&#x53F0;&#x5BF9;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x5E26;&#x6765;&#x7684;&#x7F13;&#x5B58;&#x4E0D;&#x4E00;&#x81F4;&#x95EE;&#x9898;&#x7684;&#x5904;&#x7406;&#x65B9;&#x5F0F;&#x4E0D;&#x540C;&#x3002;</p><p>X86&#x5E73;&#x53F0;&#x7684;cache&#x4E00;&#x81F4;&#x6027;&#x673A;&#x5236;&#x6BD4;&#x8F83;&#x590D;&#x6742;&#xFF0C;&#x4ECE;&#x67D0;&#x79CD;&#x610F;&#x4E49;&#x4E0A;&#x8BB2;&#xFF0C;&#x53EA;&#x8981;&#x4F7F;&#x7528;&#x8005;&#x6B63;&#x5E38;&#x4F7F;&#x7528;&#x5904;&#x7406;&#x5668;&#xFF0C;cache&#x5BF9;&#x7A0B;&#x5E8F;&#x5458;&#x5B8C;&#x5168;&#x900F;&#x660E;&#x3002;</p><p><a href="https://forum.osdev.org/viewtopic.php?f=13&amp;t=32232">osdev</a>&#x4E0A;&#x6709;&#x4EBA;&#x8BA8;&#x8BBA;&#x8FD9;&#x4E00;&#x70B9;&#xFF1A;</p><blockquote><p>Everything (including DMA) on 80x86 is cache coherent; except for the following cases &gt;(where you have deliberately &#x201C;weakened&#x201D; cache coherency for performance reasons or broken cache coherency):</p><ul><li>You&#x2019;re using the &#x201C;write-combining&#x201D; caching type in the MTRRs and/or PAT. In this case writes that are sitting in a CPU&#x2019;s write-combining buffer won&#x2019;t be seen by other hardware.</li><li>You&#x2019;re using non-temporal stores. In this case writes that are sitting in a CPU&#x2019;s write-combining buffer won&#x2019;t be seen by other hardware.</li><li>You&#x2019;ve seriously messed things up (e.g. used the &#x201C;INVD&#x201D; instruction at CPL=0).</li></ul><p>All hardware trickery (e.g. eDRAM caches, etc) is designed to uphold this.</p></blockquote><p>&#x5728;&#x770B;minix&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#x6211;&#x5C31;&#x610F;&#x8BC6;&#x5230;&#x4E86;&#x8FD9;&#x4E00;&#x70B9;&#x3002;&#x6211;&#x770B;&#x5B8C;&#x6574;&#x4E2A;&#x542F;&#x52A8;&#x5668;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x91CC;&#x9762;&#x914D;&#x5408;BIOS&#x4E2D;&#x65AD;&#x8FDB;&#x884C;&#x4E86;&#x5927;&#x91CF;DMA&#x64CD;&#x4F5C;&#xFF0C;&#x4ECE;&#x78C1;&#x76D8;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x5230;&#x5185;&#x5B58;&#xFF0C;&#x4ECE;&#x6765;&#x6CA1;&#x6709;&#x5728;&#x4EE3;&#x7801;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x51FA;&#x73B0;&#x7BA1;&#x7406;cache&#x7684;&#x6307;&#x4EE4;&#x3002;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x5728;Bootloader&#x4E2D;&#x4E5F;&#x662F;&#x968F;&#x5904;&#x53EF;&#x89C1;&#xFF0C;&#x7B2C;&#x4E00;&#x5904;&#x5C31;&#x51FA;&#x73B0;&#x5728;master boot record&#x7684;&#x5F00;&#x5934;&#xFF0C;&#x5C06;BIOS&#x4ECE;MBR&#x78C1;&#x76D8;&#x7B2C;&#x4E00;&#x6247;&#x533A;&#x7684;&#x4E3B;&#x542F;&#x52A8;&#x8BB0;&#x5F55;&#xFF08;Master boot record&#xFF09;512&#x5B57;&#x8282;&#x7684;&#x4EE3;&#x7801;&#x901A;&#x8FC7;BIOS&#x4E2D;&#x65AD;&#x62F7;&#x8D1D;&#x5230;&#x5185;&#x5B58;&#x540E;&#xFF0C;<a href="http://www.os-forum.com/minix/boot/masterboot.php#">&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;</a>&#x5C06;&#x81EA;&#x8EAB;&#x590D;&#x5236;&#x5230;&#x5176;&#x4ED6;&#x7684;&#x533A;&#x57DF;&#xFF0C;&#x5E76;&#x8DF3;&#x8F6C;&#x5230;&#x8FD9;&#x91CC;&#x3002;&#x8FD9;&#x4E8B;&#x5F88;&#x5178;&#x578B;&#x7684;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x3002;</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">! Code from minix 3.1 master boot record: masterboot.s (line 46-53).</span><br><span class="line">! Copy this code to safety, then jump to it.</span><br><span class="line">movsi, sp! si = start of this code</span><br><span class="line">pushsi! Also where we&apos;ll return to eventually</span><br><span class="line">movdi, #BUFFER! Buffer area</span><br><span class="line">movcx, #512/2! One sector</span><br><span class="line">cld</span><br><span class="line">  repmovs</span><br><span class="line">jmpfBUFFER+migrate, 0! To safety</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x6E05;&#x695A;&#x7684;&#x770B;&#x5230;&#xFF0C;&#x5728;&#x7F16;&#x5199;X86&#x6C47;&#x7F16;&#x7A0B;&#x5E8F;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7A0B;&#x5E8F;&#x5458;&#x4E0D;&#x9700;&#x8981;&#x8003;&#x8651;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x662F;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x800C;&#x5F15;&#x8D77;&#x7684;&#x7F13;&#x5B58;&#x95EE;&#x9898;&#x3002;&#x53EF;&#x662F;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x5728;rep movs&#x6267;&#x884C;&#x65F6;&#xFF0C;&#x540E;&#x7EED;&#x7684;&#x6307;&#x4EE4;&#x5DF2;&#x7ECF;&#x52A0;&#x8F7D;&#x8FDB;&#x5165;&#x6D41;&#x6C34;&#x7EBF;&#x4E86;&#x3002;&#x663E;&#x7136;&#x6D41;&#x6C34;&#x7EBF;&#x4E2D;&#x7684;&#x65E7;&#x6307;&#x4EE4;&#x9700;&#x8981;&#x88AB;&#x5E9F;&#x5F03;&#x3002;</p><p>&#x67E5;&#x770B;X86&#x7CFB;&#x7EDF;&#x7F16;&#x7A0B;&#x624B;&#x518C;&#xFF08;Intel software developer&#x2019;s manual Volume 3A: System Programming Guide 11-18&#xFF09; 11.6 Self-Modifying Code , &#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4ECE;&#x5954;&#x817E;&#x56DB;&#x5F00;&#x59CB;&#xFF0C;x86&#x5904;&#x7406;&#x5668;&#x5DF2;&#x7ECF;&#x5728;&#x6D41;&#x6C34;&#x7EBF;&#x548C;cache&#x786C;&#x4EF6;&#x4E0A;&#x505A;&#x4E86;&#x4E00;&#x81F4;&#x6027;&#x673A;&#x5236;&#xFF0C;&#x53EA;&#x8981;&#x662F;&#x4F7F;&#x7528;&#x540C;&#x4E00;&#x7269;&#x7406;&#x5730;&#x5740;&#x8BBF;&#x95EE;&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x786C;&#x4EF6;&#x63D0;&#x4F9B;&#x4E00;&#x81F4;&#x6027;&#x652F;&#x6301;&#x3002;X86&#x4E0D;&#x4EC5;&#x5728;cache&#x4E2D;&#x5B9E;&#x73B0;&#x4E86;&#x5199;&#x8BF7;&#x6C42;&#x76D1;&#x542C;&#xFF0C;&#x800C;&#x4E14;&#x8FD8;&#x5728;&#x6D41;&#x6C34;&#x7EBF;&#x4E2D;&#x5E9F;&#x5F03;&#x5DF2;&#x7ECF;&#x9884;&#x53D6;&#x7684;&#x6307;&#x4EE4;&#x3002;</p><blockquote><h4 id="11-6-Self-Modifying-Code"><a href="#11-6-Self-Modifying-Code" class="headerlink" title="11.6 Self-Modifying Code"></a>11.6 Self-Modifying Code</h4><p>A write to a memory location in a code segment that is currently cached in the processor causes the associated cache line (or lines) to be invalidated. This check is based on the physical address of the instruction. In addition, the P6 family and Pentium processors check whether a write to a code segment may modify an instruction that has been prefetched for execution. If the write affects a prefetched instruction, the prefetch queue is invalidated. This latter check is based on the linear address of the instruction. For the Pentium 4 and Intel Xeon processors, a write or a snoop of an instruction in a code segment, where the target instruction is already decoded and resident in the trace cache, invalidates the entire trace cache. The latter behavior means that programs that self-modify code can cause severe degradation of performance when run on the Pentium 4 and Intel Xeon processors.</p><p>In practice, the check on linear addresses should not create compatibility problems among IA-32 processors. Appli- cations that include self-modifying code use the same linear address for modifying and fetching the instruction. Systems software, such as a debugger, that might possibly modify an instruction using a different linear address than that used to fetch the instruction, will execute a serializing operation, such as a CPUID instruction, before the modified instruction is executed, which will automatically resynchronize the instruction cache and prefetch queue. (See Section 8.1.3, &#x201C;Handling Self- and Cross-Modifying Code,&#x201D; for more information about the use of self-modifying code.)</p></blockquote><p>&#x5404;&#x4E2A;&#x5E73;&#x53F0;&#x5BF9;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x7684;&#x652F;&#x6301;&#x4E0D;&#x540C;&#x3002;</p><p><a href="https://blog.senr.io/blog/why-is-my-perfectly-good-shellcode-not-working-cache-coherency-on-mips-and-arm">&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;</a>&#x5BF9;&#x8DEF;&#x7531;&#x5668;&#x4E2D;&#x5E7F;&#x6CDB;&#x4F7F;&#x7528;&#x7684;MIPS&#x5904;&#x7406;&#x5668;&#x8FDB;&#x884C;&#x4E86;&#x6D4B;&#x8BD5;&#xFF0C;&#x53D1;&#x73B0;&#x5176;&#x5E76;&#x6CA1;&#x6709;&#x5B9E;&#x73B0;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x7684;&#x7F13;&#x5B58;&#x540C;&#x6B65;&#x673A;&#x5236;&#x3002;&#x7531;Stackoverflow&#x4E0A;&#x7684;<a href="https://stackoverflow.com/questions/10989403/how-is-x86-instruction-cache-synchronized">&#x8BA8;&#x8BBA;</a>,PowerPC&#x4E5F;&#x6CA1;&#x6709;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x673A;&#x5236;&#xFF0C;&#x8981;&#x6C42;&#x7CFB;&#x7EDF;&#x8F6F;&#x4EF6;&#x8BBE;&#x8BA1;&#x8005;&#x4ECE;&#x8F6F;&#x4EF6;&#x5C42;&#x9762;&#x7EF4;&#x62A4;&#x7F13;&#x5B58;&#x7684;&#x4E00;&#x81F4;&#x6027;&#x3002;</p><blockquote><p>3.3.1.2.1 Self-Modifying Code</p><p>When a processor modifies any memory location that can contain an instruction, software must ensure that the instruction cache is made consistent with data memory and that the modifications are made visible to the instruction fetching mechanism. This must be done even if the cache is disabled or if the page is marked caching-inhibited.</p></blockquote><h5 id="&#x6211;&#x6253;&#x7B97;&#x5982;&#x4F55;&#x5BF9;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x7684;&#x7F13;&#x5B58;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF1F;"><a href="#&#x6211;&#x6253;&#x7B97;&#x5982;&#x4F55;&#x5BF9;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x7684;&#x7F13;&#x5B58;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF1F;" class="headerlink" title="&#x6211;&#x6253;&#x7B97;&#x5982;&#x4F55;&#x5BF9;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x7684;&#x7F13;&#x5B58;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF1F;"></a>&#x6211;&#x6253;&#x7B97;&#x5982;&#x4F55;&#x5BF9;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x7684;&#x7F13;&#x5B58;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF1F;</h5><p>&#x5982;&#x679C;&#x4E0D;&#x589E;&#x52A0;&#x603B;&#x7EBF;&#x76D1;&#x542C;&#x3001;&#x6D41;&#x6C34;&#x7EBF;&#x56DE;&#x9000;&#x7B49;&#x673A;&#x5236;&#xFF0C;&#x53EA;&#x5F15;&#x5165;&#x6E05;&#x7A7A;cache&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x90A3;&#x5C31;&#x9700;&#x8981;&#x7CFB;&#x7EDF;&#x7A0B;&#x5E8F;&#x5458;&#x5BF9;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x52A0;&#x4EE5;&#x9650;&#x5236;&#xFF0C;&#x5982;&#x9650;&#x5B9A;&#x5728;&#x5173;&#x4E2D;&#x65AD;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#xFF0C;&#x5E76;&#x5728;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x540E;&#x5F15;&#x5165;&#x82E5;&#x5E72;&#x7A7A;&#x6307;&#x4EE4;&#x586B;&#x5145;&#x6D41;&#x6C34;&#x7EBF;&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;&#x6307;&#x4EE4;cache&#x6E05;&#x96F6;&#x6307;&#x4EE4;&#x6E05;&#x96F6;cache&#x3002;&#x8FD9;&#x6837;&#x505A;&#x964D;&#x4F4E;&#x4E86;&#x786C;&#x4EF6;&#x8BBE;&#x8BA1;&#x7684;&#x96BE;&#x5EA6;&#xFF0C;&#x4F46;&#x5BF9;&#x6240;&#x6709;&#x7684;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x65E0;&#x8BBA;&#x5176;&#x662F;&#x5426;&#x5728;&#x7F13;&#x5B58;&#x4E2D;&#x90FD;&#x9700;&#x8981;&#x7528;&#x63A7;&#x5236;&#x4EE4;&#x586B;&#x5145;&#x6D41;&#x6C34;&#x7EBF;&#x3001;&#x6E05;&#x7A7A;cache&#xFF0C;&#x5E26;&#x6765;&#x4E86;&#x989D;&#x5916;&#x7684;&#x6027;&#x80FD;&#x5F00;&#x9500;&#x3002;</p><p>&#x603B;&#x7EBF;&#x76D1;&#x542C;&#x5B9E;&#x73B0;&#x8D77;&#x6765;&#x4E0D;&#x590D;&#x6742;&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E;cache&#x53D8;&#x5316;&#x5F15;&#x8D77;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x56DE;&#x9000;&#x673A;&#x5236;&#x548C;&#x4E2D;&#x65AD;&#x7684;&#x76F8;&#x4E92;&#x4F5C;&#x7528;&#x5206;&#x6790;&#x8D77;&#x6765;&#x6709;&#x70B9;&#x590D;&#x6742;&#x3002;&#x662F;&#x5426;&#x589E;&#x52A0;&#x6D41;&#x6C34;&#x7EBF;&#x56DE;&#x9000;&#x673A;&#x5236;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;&#x80FD;&#x5426;&#x8054;&#x5408;&#x4E2D;&#x65AD;&#xFF0C;&#x5206;&#x6790;&#x6E05;&#x695A;&#x5904;&#x7406;&#x5668;&#x7684;&#x5DE5;&#x4F5C;&#x72B6;&#x6001;&#x3002;&#x5F53;&#x7136;&#x5F15;&#x5165;&#x8FD9;&#x4E2A;cache&#x4E00;&#x81F4;&#x6027;&#x673A;&#x5236;&#x4F1A;&#x5E26;&#x6765;&#x4E00;&#x4E9B;&#x989D;&#x5916;&#x7684;&#x597D;&#x5904;&#xFF0C;&#x6BD4;&#x5982;&#x53EF;&#x4EE5;&#x62D3;&#x5C55;DMA&#x7684;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#xFF0C;&#x53EA;&#x628A;&#x5355;&#x7EAF;&#x7684;IO&#x653E;&#x5728;&#x4E0D;&#x7ECF;&#x8FC7;cache&#x7684;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x5373;&#x53EF;&#x3002;</p><p>&#x4F46;&#x662F;&#xFF0C;&#x5F53;&#x603B;&#x7EBF;&#x76D1;&#x542C;&#x3001;&#x4E2D;&#x65AD;&#x3001;&#x5F02;&#x5E38;&#x548C;&#x6D41;&#x6C34;&#x7EBF;&#x7ED3;&#x5408;&#x8D77;&#x6765;&#x540E;&#xFF0C;&#x4E8B;&#x60C5;&#x53D8;&#x5F97;&#x6709;&#x70B9;&#x590D;&#x6742;&#x3002;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x662F;&#x8981;&#x7EFC;&#x5408;&#x5206;&#x6790;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x5F15;&#x8D77;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x548C;cache&#x53D8;&#x5316;&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x7684;&#x4E00;&#x573A;&#x548C;&#x4E2D;&#x65AD;&#x7684;&#x7EC4;&#x5408;&#xFF0C;&#x8BBE;&#x8BA1;&#x7535;&#x8DEF;&#x3002;</p><p>&#x7CBE;&#x786E;&#x4E2D;&#x65AD;&#x6709;&#x4E24;&#x79CD;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#xFF0C;&#x4E00;&#x662F;&#x65E0;&#x8BBA;&#x4EC0;&#x4E48;&#x65F6;&#x523B;&#x4E2D;&#x65AD;&#x53D1;&#x751F;&#xFF0C;cpu&#x7ACB;&#x523B;&#x6682;&#x505C;&#x5F53;&#x524D;&#x5DE5;&#x4F5C;&#xFF0C;&#x8FDB;&#x5165;&#x7EC8;&#x7AEF;&#x6D41;&#x7A0B;&#x3002;&#x8FD9;&#x4E2A;&#x8981;&#x6C42;&#x8F83;&#x9AD8;&#xFF0C;&#x9700;&#x8981;&#x5206;&#x6790;&#x4E2D;&#x65AD;&#x53D1;&#x751F;&#x65F6;ID&#x7EA7;&#x7684;&#x4E09;&#x79CD;&#x60C5;&#x51B5;:</p><ul><li>ID&#x7EA7;&#x662F;&#x8F6C;&#x79FB;&#x6307;&#x4EE4;&#x2013;&#x4E2D;&#x65AD;&#x4FDD;&#x5B58;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x4E2D;&#x65AD;&#x8FD4;&#x56DE;&#x91CD;&#x65B0;&#x6267;&#x884C;</li><li>ID&#x7EA7;&#x662F;&#x5904;&#x5728;&#x5EF6;&#x65F6;&#x69FD;&#x4E2D;&#x7684;&#x6307;&#x4EE4;&#x2013;&#x4E2D;&#x65AD;&#x4FDD;&#x5B58;&#x5F53;&#x524D;PC&#xFF0C;&#x8BA9;&#x5EF6;&#x65F6;&#x69FD;&#x4E2D;&#x7684;&#x6307;&#x4EE4;&#x6267;&#x884C;&#x5B8C;&#xFF0C;&#x5F53;&#x524D;PC&#x5C31;&#x662F;&#x4E4B;&#x524D;&#x7684;&#x8DF3;&#x8F6C;&#x8BA1;&#x7B97;&#x51FA;&#x7684;&#x5730;&#x5740;&#x3002;</li><li>&#x5176;&#x4ED6;&#x60C5;&#x51B5;&#x2013;&#x4E2D;&#x65AD;&#x4FDD;&#x5B58;&#x5F53;&#x524D;PC&#xFF0C;&#x4E0E;&#x4E0A;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#x7C7B;&#x4F3C;&#x3002;</li></ul><p>&#x4E4B;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x8003;&#x8651;&#x8FD9;&#x4E9B;&#x60C5;&#x51B5;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;&#x4E2D;&#x65AD;&#x54CD;&#x5E94;&#x8FC7;&#x7A0B;&#x5904;&#x7406;&#x5668;&#x53D6;&#x6307;&#x7684;&#x5730;&#x5740;&#x53D1;&#x751F;&#x53D8;&#x5316;&#xFF0C;&#x800C;&#x662F;&#x5426;&#x662F;&#x8F6C;&#x79FB;&#x6307;&#x4EE4;&#x3001;&#x662F;&#x5426;&#x5904;&#x5728;&#x5EF6;&#x65F6;&#x69FD;&#x4E2D;&#x5BF9;&#x4E8E;CPU&#x4E0B;&#x4E00;&#x5468;&#x671F;&#x53D6;&#x6307;&#x7684;&#x5730;&#x5740;&#x6709;&#x5F71;&#x54CD;&#x3002;</p><p>&#x4E5F;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x7B49;&#x5230;CPU&#x5904;&#x5728;&#x8F83;&#x4E3A;&#x7A33;&#x5B9A;&#x7684;&#x72B6;&#x6001;&#x65F6;&#x5728;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#x3002;&#x4E0A;&#x9762;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x82E5;&#x53D1;&#x751F;&#x4E2D;&#x65AD;&#x65F6;ID&#x7EA7;&#x662F;&#x8F6C;&#x79FB;&#x6307;&#x4EE4;&#xFF0C;&#x5219;&#x6D41;&#x6C34;&#x7EBF;&#x4E2D;&#x8981;&#x53D6;&#x6D88;&#x4E24;&#x6761;&#x6307;&#x4EE4;&#xFF0C;&#x5F85;&#x4E2D;&#x65AD;&#x8FD4;&#x56DE;&#x540E;&#x518D;&#x6B21;&#x91CD;&#x65B0;&#x6267;&#x884C;&#x3002;&#x8FD9;&#x6837;&#x505A;&#x5B9E;&#x9645;&#x4E0A;&#x9020;&#x6210;&#x4E86;&#x989D;&#x5916;&#x7684;&#x6027;&#x80FD;&#x5F00;&#x9500;&#xFF0C;&#x6211;&#x66F4;&#x503E;&#x5411;&#x4E8E;&#x7B49;&#x5F85;CPU&#x8FDB;&#x5165;&#x7A33;&#x5B9A;&#x72B6;&#x6001;&#x65F6;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#x8BF7;&#x6C42;&#xFF0C;&#x5728;ID&#x7EA7;&#x662F;&#x8F6C;&#x79FB;&#x6307;&#x4EE4;&#x6216;&#x5EF6;&#x65F6;&#x69FD;&#x65F6;&#x4E0D;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#x8BF7;&#x6C42;&#x3002;&#x8FD9;&#x6837;&#x505A;&#x9700;&#x8981;&#x5728;&#x4E2D;&#x65AD;&#x63A7;&#x5236;&#x5668;&#x4E2D;&#x589E;&#x52A0;&#x4E00;&#x4E2A;&#x4E2D;&#x65AD;&#x54CD;&#x5E94;&#x673A;&#x5236;&#xFF0C;&#x5728;&#x6536;&#x5230;&#x54CD;&#x5E94;&#x540E;&#x5E94;&#x7ACB;&#x523B;&#x64A4;&#x9500;&#x4E2D;&#x65AD;&#x8BF7;&#x6C42;&#x3002;</p><p>&#x5F02;&#x5E38;&#x7684;&#x60C5;&#x51B5;&#x8981;&#x6BD4;&#x4E2D;&#x65AD;&#x590D;&#x6742;&#xFF0C;&#x56E0;&#x4E3A;&#x5F02;&#x5E38;&#x5F80;&#x5F80;&#x9700;&#x8981;&#x7ACB;&#x5373;&#x5904;&#x7406;&#x3002;&#x4E00;&#x4E2A;&#x590D;&#x6742;&#x7684;CPU&#x5E94;&#x5F53;&#x53EF;&#x4EE5;&#x5904;&#x7406;&#x591A;&#x79CD;&#x5F02;&#x5E38;&#xFF0C;&#x4F8B;&#x5982;&#x4FDD;&#x62A4;&#x6A21;&#x5F0F;&#x5F15;&#x5165;&#x7684;&#x5F02;&#x5E38;&#xFF0C;&#x5728;&#x53D6;&#x6307;&#x3001;&#x8BFB;&#x53D6;&#x3001;&#x5B58;&#x50A8;&#x6570;&#x636E;&#x65F6;&#x90FD;&#x53EF;&#x80FD;&#x53D1;&#x751F;&#x7684;&#x8D85;&#x8FC7;&#x8303;&#x56F4;&#xFF0C;&#x7B97;&#x6570;&#x8FD0;&#x7B97;&#x6EA2;&#x51FA;&#xFF0C;&#x6307;&#x4EE4;&#x672A;&#x5B9E;&#x73B0;&#x3001;syscall&#x6307;&#x4EE4;&#x3001;&#x8FD8;&#x6709;&#x5206;&#x9875;&#x6A21;&#x5F0F;&#x5F15;&#x5165;&#x7684;&#x5F02;&#x5E38;&#x5982;tlb&#x7F3A;&#x5931;&#xFF0C;&#x7F3A;&#x9875;&#x7B49;&#x3002;&#x76EE;&#x524D;&#x6211;&#x5C1A;&#x672A;&#x6253;&#x7B97;&#x5728;&#x6211;&#x7684;CPU&#x4E2D;&#x5B9E;&#x73B0;&#x4FDD;&#x62A4;&#x6A21;&#x5F0F;&#x548C;&#x5206;&#x9875;&#xFF0C;&#x56E0;&#x6B64;&#x76EE;&#x524D;&#x652F;&#x6301;&#x7684;&#x5F02;&#x5E38;&#x65F6;&#x7B97;&#x6570;&#x8FD0;&#x7B97;&#x6EA2;&#x51FA;&#x3001;&#x6307;&#x4EE4;&#x672A;&#x5B9E;&#x73B0;&#x548C;syscall&#x6307;&#x4EE4;&#x3002;&#x7B2C;&#x4E00;&#x4E2A;&#x5F02;&#x5E38;&#x662F;&#x53D1;&#x751F;&#x5728;EXE&#x7EA7;&#xFF0C;&#x540E;&#x4E24;&#x4E2A;&#x662F;&#x53D1;&#x751F;&#x5728;ID&#x7EA7;&#x3002;&#x8FD9;&#x4E09;&#x4E2A;&#x5F02;&#x5E38;EXE&#x7EA7;&#x7684;&#x5F02;&#x5E38;&#x4F18;&#x5148;&#x7EA7;&#x6700;&#x9AD8;&#xFF0C;&#x56E0;&#x4E3A;&#x5176;&#x53D1;&#x751F;&#x5728;&#x6D41;&#x6C34;&#x7EBF;&#x5185;&#x8F83;&#x6DF1;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x800C;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x5F80;&#x5F80;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x6267;&#x884C;&#x9020;&#x6210;&#x5F02;&#x5E38;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x6240;&#x4EE5;&#x5F53;&#x591A;&#x79CD;&#x5F02;&#x5E38;&#x540C;&#x65F6;&#x51FA;&#x73B0;&#x5728;&#x6D41;&#x6C34;&#x7EBF;&#x7684;&#x4E0D;&#x540C;&#x9636;&#x6BB5;&#x4E2D;&#xFF0C;&#x6309;&#x7167;&#x5176;&#x53D1;&#x751F;&#x7684;&#x4F4D;&#x7F6E;&#x5B89;&#x6392;&#x4F18;&#x5148;&#x7EA7;&#x5904;&#x7406;&#x65F6;&#x5F97;&#x5F53;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x7684;&#x786C;&#x4EF6;&#x7535;&#x8DEF;&#x548C;&#x4E2D;&#x65AD;&#x4E00;&#x6837;&#xFF0C;&#x5728;&#x8BBE;&#x8BA1;&#x65F6;&#x9700;&#x8981;&#x5206;&#x6790;&#x4E0D;&#x540C;&#x9636;&#x6BB5;&#x7684;&#x5F02;&#x5E38;EPC&#x4E2D;&#x8981;&#x4FDD;&#x5B58;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x6D41;&#x6C34;&#x7EBF;&#x4E2D;&#x9700;&#x8981;&#x5E9F;&#x5F03;&#x7684;&#x6307;&#x4EE4;&#xFF0C;nPC&#x4E2D;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x6307;&#x4EE4;&#x5730;&#x5740;&#x3002;&#x5177;&#x4F53;&#x5206;&#x6790;&#x7684;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x770B;&#x674E;&#x4E9A;&#x6C11;&#x7684;&#x4E66;&#x3002;</p><p>&#x5176;&#x5B9E;&#x8FD9;&#x91CC;&#x6211;&#x8BA4;&#x4E3A;&#x674E;&#x7684;&#x4E66;&#x4E2D;&#x6240;&#x63CF;&#x8FF0;&#x7684;CPU&#x5DE5;&#x4F5C;&#x8D77;&#x6765;&#x5E94;&#x8BE5;&#x6709;BUG&#x3002;&#x674E;&#x5E76;&#x6CA1;&#x6709;&#x8BBE;&#x8BA1;&#x4E2D;&#x65AD;&#x8BF7;&#x6C42;&#x548C;&#x54CD;&#x5E94;&#x7684;&#x76F8;&#x5E94;&#x673A;&#x5236;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E2D;&#x65AD;&#x5230;&#x6765;&#x5C31;&#x7ACB;&#x523B;&#x8FDB;&#x5165;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x3002;&#x4F46;&#x5728;&#x5176;&#x4EE3;&#x7801;&#x4E2D;&#x53EF;&#x4EE5;&#x6E05;&#x695A;&#x770B;&#x5230;&#xFF0C;&#x4E2D;&#x65AD;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x662F;&#x4F4E;&#x4E8E;&#x5F02;&#x5E38;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5F53;&#x5F02;&#x5E38;&#x548C;&#x4E2D;&#x65AD;&#x540C;&#x65F6;&#x53D1;&#x751F;&#x65F6;&#xFF0C;&#x7531;&#x4E8E;&#x7F3A;&#x4E4F;&#x4E2D;&#x65AD;&#x8BF7;&#x6C42;&#x548C;&#x54CD;&#x5E94;&#x673A;&#x5236;&#xFF0C;CPU&#x53EF;&#x80FD;&#x5728;&#x5904;&#x7406;&#x5F02;&#x5E38;&#x65F6;&#x9519;&#x8FC7;&#x5916;&#x90E8;&#x4E2D;&#x65AD;&#xFF0C;&#x9020;&#x6210;IO&#x8BBE;&#x5907;&#x6570;&#x636E;&#x4E22;&#x5931;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x5982;&#x4E0A;&#x6587;&#x6240;&#x8FF0;&#xFF0C;&#x9009;&#x62E9;&#x7ACB;&#x523B;&#x5904;&#x7406;&#x4E2D;&#x65AD;&#x4F1A;&#x5F15;&#x5165;&#x989D;&#x5916;&#x7684;&#x6027;&#x80FD;&#x5F00;&#x9500;&#xFF0C;&#x4F7F;&#x6D41;&#x6C34;&#x7EBF;&#x6027;&#x80FD;&#x4E0B;&#x964D;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x503E;&#x5411;&#x4E8E;&#x9009;&#x62E9;&#x7B49;&#x5F85;&#x65F6;&#x673A;&#x5904;&#x7406;&#x4E2D;&#x65AD;&#x3002;</p><p>&#x7531;&#x6B64;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#xFF0C;&#x5728;&#x6D41;&#x6C34;&#x7EBF;&#x7CFB;&#x7EDF;&#x91CC;&#x5B9E;&#x73B0;&#x4E2D;&#x65AD;&#x548C;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4EFB;&#x52A1;&#x3002;&#x5F53;&#x4F60;&#x5F15;&#x5165;&#x989D;&#x5916;&#x7684;&#x786C;&#x4EF6;&#x63D0;&#x4F9B;&#x7684;cache&#x540C;&#x6B65;&#x652F;&#x6301;&#x65F6;&#xFF0C;&#x4E8B;&#x60C5;&#x5C31;&#x53D8;&#x5F97;&#x66F4;&#x52A0;&#x590D;&#x6742;&#x3002;&#x5F53;MEM&#x7EA7;&#x53D1;&#x751F;&#x4E00;&#x6B21;cache&#x5199;&#x5165;&#xFF0C;&#x82E5;&#x8FD9;&#x6B21;&#x5199;&#x5165;&#x7684;&#x5730;&#x5740;&#x662F;&#x5DF2;&#x7ECF;&#x9884;&#x53D6;&#x3001;&#x5728;&#x6D41;&#x6C34;&#x7EBF;&#x4E2D;&#x6267;&#x884C;&#x7740;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x9700;&#x8981;&#x6E05;&#x9664;Icache&#x4E2D;&#x7684;&#x67D0;&#x884C;&#xFF0C;&#x540C;&#x65F6;&#x5C06;&#x88AB;&#x5F71;&#x54CD;&#x7684;&#x6307;&#x4EE4;&#x53CA;&#x5176;&#x4E4B;&#x540E;&#x7684;&#x6307;&#x4EE4;&#x4ECE;&#x6D41;&#x6C34;&#x7EBF;&#x4E2D;&#x5E9F;&#x5F03;&#xFF1B;&#x82E5;&#x4E0D;&#x5F71;&#x54CD;&#x5DF2;&#x7ECF;&#x9884;&#x53D6;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x5219;&#x53EA;&#x9700;&#x8981;&#x5728;Icache&#x4E2D;&#x6E05;&#x9664;&#x67D0;&#x884C;&#x5373;&#x53EF;&#x3002;&#x53EF;&#x4EE5;&#x5C06;&#x8FD9;&#x6837;&#x7684;&#x4E8B;&#x4EF6;&#x5F53;&#x4F5C;&#x5F02;&#x5E38;&#x5904;&#x7406;&#xFF0C;&#x4F46;&#x4E0E;&#x5F02;&#x5E38;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x67D0;&#x4E2A;&#x5F15;&#x8D77;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x7684;LW&#x6307;&#x4EE4;&#xFF0C;&#x4E0D;&#x4F1A;&#x4EA7;&#x751F;&#x8F6C;&#x79FB;&#xFF0C;&#x53EA;&#x662F;&#x9700;&#x8981;&#x5728;&#x6D41;&#x6C34;&#x7EBF;&#x4E2D;&#x5E9F;&#x5F03;&#x67D0;&#x4E9B;&#x6307;&#x4EE4;&#x3002;&#x82E5;&#x91C7;&#x7528;&#x674E;&#x7684;&#x4E66;&#x4E2D;&#x505A;&#x6CD5;&#xFF0C;&#x60C5;&#x51B5;&#x5C31;&#x4F1A;&#x53D8;&#x5F97;&#x975E;&#x5E38;&#x590D;&#x6742;&#x3002;&#x6211;&#x82E5;&#x5B9E;&#x73B0;&#x786C;&#x4EF6;cache&#x540C;&#x6B65;&#xFF0C;&#x4E00;&#x5B9A;&#x4F1A;&#x9009;&#x62E9;&#x7B49;&#x5F85;&#x65F6;&#x673A;&#xFF08;&#x5904;&#x7406;&#x5668;&#x65E0;&#x5F02;&#x5E38;&#x3001;ID&#x65E0;&#x8DF3;&#x8F6C;&#x3001;ID&#x4E0D;&#x662F;&#x5EF6;&#x65F6;&#x69FD;&#x3001;cache&#x4E0D;&#x9700;&#x8981;&#x540C;&#x6B65;&#xFF09;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#xFF0C;&#x8FD9;&#x6837;&#x6D41;&#x6C34;&#x7EBF;&#x63A7;&#x5236;&#x8BBE;&#x8BA1;&#x53EA;&#x9700;&#x8981;&#x5206;&#x6790;&#x5F02;&#x5E38;&#x548C;cache&#x540C;&#x6B65;&#x5373;&#x53EF;&#x3002;</p><p>&#x73B0;&#x5206;&#x6790;&#x5F02;&#x5E38;&#x548C;cache&#x540C;&#x6B65;&#xFF1A;&#x5982;&#x679C;&#x6309;&#x7167;&#x6027;&#x80FD;&#x8003;&#x8651;&#xFF0C;cache&#x540C;&#x6B65;&#x4E8B;&#x4EF6;&#x53EF;&#x4EE5;&#x5728;EXE&#x7EA7;&#x5C31;&#x8BA1;&#x7B97;&#x51FA;&#x6765;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x65C1;&#x8DEF;&#x5C06;lw&#x6307;&#x4EE4;&#x5199;&#x5165;&#x7684;&#x76EE;&#x6807;&#x4E0E;IF ID &#x7EA7;&#x6307;&#x4EE4;&#x7684;&#x5730;&#x5740;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x5224;&#x65AD;&#x662F;&#x5426;&#x5E9F;&#x5F03;&#x6D41;&#x6C34;&#x7EBF;&#x4E2D;&#x7684;&#x6307;&#x4EE4;&#x3002;&#x7531;&#x4E8E;lw&#x6307;&#x4EE4;&#x4E0D;&#x662F;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#xFF0C;&#x56E0;&#x6B64;&#x53D1;&#x751F;cache&#x540C;&#x6B65;&#x4E8B;&#x4EF6;&#x65F6;&#xFF0C;ID&#x7EA7;&#x4E00;&#x5B9A;&#x4E0D;&#x5904;&#x5728;&#x5EF6;&#x65F6;&#x69FD;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x8003;&#x8651;&#x6027;&#x80FD;&#xFF0C;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x65E0;&#x8BBA;IF&#x3001;ID&#x90A3;&#x4E2A;&#x6307;&#x4EE4;&#x9700;&#x8981;&#x5E9F;&#x5F03;&#xFF0C;&#x53EA;&#x8981;&#x6709;&#x4E00;&#x4E2A;&#x9700;&#x8981;&#x5E9F;&#x5F03;&#xFF0C;&#x5C31;&#x76F4;&#x63A5;&#x5C06;IF&#x3001;ID&#x4E2D;&#x7684;&#x6307;&#x4EE4;&#x4F5C;&#x5E9F;&#xFF0C;&#x91CD;&#x65B0;&#x6267;&#x884C;&#x3002;&#x5982;&#x679C;&#x8003;&#x8651;&#x6027;&#x80FD;&#xFF0C;&#x4E8B;&#x60C5;&#x5C31;&#x53D8;&#x5F97;&#x590D;&#x6742;&#x4E86;.&#x5982;&#x679C;&#x6B64;&#x65F6;ID&#x7EA7;&#x662F;&#x4E00;&#x4E2A;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#xFF0C;&#x90A3;&#x4E48;&#x5EF6;&#x65F6;&#x69FD;&#x4E2D;&#x7684;&#x6307;&#x4EE4;&#x53D7;&#x5230;cache&#x540C;&#x6B65;&#x7684;&#x5F71;&#x54CD;&#xFF0C;&#x5982;&#x679C;&#x53EA;&#x5E9F;&#x5F03;IF&#x7EA7;&#x6307;&#x4EE4;&#x5C31;&#x4F1A;&#x5F15;&#x8D77;&#x9519;&#x8BEF;&#xFF0C;&#x56E0;&#x4E3A;&#x5904;&#x7406;&#x5668;&#x4E22;&#x5F03;&#x4E86;ID&#x7EA7;&#x7684;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x8BA1;&#x7B97;&#x51FA;&#x7684;&#x8DF3;&#x8F6C;&#x7ED3;&#x679C;&#xFF0C;&#x7B49;&#x4E8E;ID&#x7EA7;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x6CA1;&#x6709;&#x8D77;&#x5230;&#x4F5C;&#x7528;&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C;Cache&#x540C;&#x6B65;&#x5F71;&#x54CD;IF&#x7EA7;&#x4E2D;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x5E94;&#x5F53;&#x5224;&#x65AD;ID&#x7EA7;&#x662F;&#x5426;&#x662F;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#xFF08;&#x6216;syscall&#xFF09;&#xFF0C;&#x5982;&#x679C;&#x662F;&#xFF0C;&#x5219;&#x4E0D;&#x4EC5;&#x8981;&#x5E9F;&#x5F03;IF&#x8FD8;&#x8981;&#x5E9F;&#x5F03;ID&#x3002;</p><p>&#x8FD9;&#x6837;&#x770B;&#x6765;&#xFF0C;&#x786C;&#x4EF6;&#x652F;&#x6301;&#x7684;cache&#x540C;&#x6B65;&#x673A;&#x5236;&#x914D;&#x5408;&#x7B49;&#x5F85;&#x65F6;&#x673A;&#x7684;&#x4E2D;&#x65AD;&#x54CD;&#x5E94;&#x673A;&#x5236;&#xFF0C;&#x4EE5;&#x53CA;&#x7ACB;&#x523B;&#x5904;&#x7406;&#x7684;&#x5F02;&#x5E38;&#x673A;&#x5236;&#x5728;&#x786C;&#x4EF6;&#x4E0A;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x3002;&#x4F46;&#x662F;&#x6211;&#x4E0D;&#x6253;&#x7B97;&#x5B9E;&#x73B0;&#x5B83;&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;</p><p>&#x5728;&#x4E4B;&#x524D;&#x7684;&#x8BBE;&#x60F3;&#x4E2D;&#xFF0C;&#x6211;&#x5C06;&#x539F;&#x672C;&#x53D1;&#x751F;&#x5728;MEM&#x7EA7;&#x7684;cache&#x4E8B;&#x4EF6;&#xFF0C;&#x524D;&#x63A8;&#x5230;EXE&#x7EA7;&#xFF0C;&#x8FD9;&#x5F88;&#x5927;&#x7A0B;&#x5EA6;&#x4E0A;&#x907F;&#x514D;&#x4E86;&#x66F4;&#x591A;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x6027;&#x80FD;&#x635F;&#x5931;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x4EC5;&#x4EC5;&#x53EF;&#x4EE5;&#x5728;&#x65E0;&#x5206;&#x9875;&#x673A;&#x5236;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5B9E;&#x73B0;&#x3002;&#x5982;&#x679C;&#x5B9E;&#x73B0;&#x5206;&#x9875;&#xFF0C;&#x5219;&#x5728;&#x6307;&#x4EE4;&#x4E2D;&#x7684;&#x5730;&#x5740;&#x90FD;&#x662F;&#x865A;&#x5730;&#x5740;&#xFF0C;EXE&#x7EA7;&#x7684;&#x5730;&#x5740;&#x4E5F;&#x662F;&#x865A;&#x5730;&#x5740;&#xFF0C;&#x4E0D;&#x80FD;&#x7528;&#x4E8E;&#x524D;&#x9762;&#x7EA7;&#x6D41;&#x6C34;&#x5BC4;&#x5B58;&#x5668;&#x4E2D;&#x6307;&#x4EE4;&#x5730;&#x5740;&#x7684;&#x6BD4;&#x8F83;&#xFF0C;&#x800C;&#x5B9E;&#x5730;&#x5740;&#x5B9E;&#x5728;&#x67E5;&#x627E;MEM&#x7EA7;&#x4E2D;&#x7684;TLB&#x540E;&#x624D;&#x80FD;&#x5F97;&#x5230;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x4E0A;&#x8FF0;&#x8BBE;&#x8BA1;&#x5728;&#x5B9E;&#x73B0;TLB&#x540E;&#xFF0C;&#x5C31;&#x5931;&#x6548;&#x4E86;&#xFF0C;&#x800C;&#x8BBE;&#x8BA1;TLB&#x662F;&#x672C;&#x9879;&#x76EE;&#x7684;&#x8FDC;&#x671F;&#x8BA1;&#x5212;&#x4E4B;&#x4E00;&#x3002;&#x56E0;&#x6B64;&#x4E0D;&#x59A8;&#x7B49;&#x5230;&#x5B8C;&#x6210;MMU&#x8BBE;&#x8BA1;&#x4E4B;&#x540E;&#xFF0C;&#x5B58;&#x50A8;&#x63A7;&#x5236;&#x7CFB;&#x7EDF;&#x5B9A;&#x578B;&#xFF0C;&#x518D;&#x52A0;&#x5165;&#x786C;&#x4EF6;&#x7684;cache&#x540C;&#x6B65;&#x652F;&#x6301;&#x3002;</p><p>&#x56E0;&#x6B64;&#x5F97;&#x51FA;&#x7ED3;&#x8BBA;&#xFF0C;&#x76EE;&#x524D;&#x7684;&#x8BBE;&#x8BA1;&#x91C7;&#x7528;&#x8F6F;&#x4EF6;&#x63A7;&#x5236;&#x7684;cache&#x540C;&#x6B65;&#xFF0C;&#x63D0;&#x4F9B;&#x786C;&#x4EF6;Cache&#x6E05;&#x7A7A;&#x6307;&#x4EE4;&#x3002;&#x7CFB;&#x7EDF;&#x8F6F;&#x4EF6;&#x7F16;&#x5199;&#x8005;&#x5728;&#x7F16;&#x5199;&#x81EA;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x65F6;&#xFF0C;&#x5E94;&#x5148;&#x5173;&#x95ED;&#x4E2D;&#x65AD;&#xFF0C;&#x5728;&#x4FEE;&#x6539;&#x5B8C;&#x4EE3;&#x7801;&#x540E;&#x624B;&#x52A8;&#x6E05;&#x7A7A;cache&#xFF0C;&#x5E76;&#x4F7F;&#x7528;&#x7D27;&#x968F;&#x5176;&#x540E;&#x7684;&#x82E5;&#x5E72;&#x7A7A;&#x6307;&#x4EE4;&#x6D88;&#x9664;cache&#x4E0D;&#x540C;&#x6B65;&#x5F15;&#x8D77;&#x7684;&#x6D41;&#x6C34;&#x7EBF;&#x9519;&#x8BEF;&#x3002;</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&amp;#x672C;&amp;#x4EE5;&amp;#x4E3A;cache&amp;#x7684;&amp;#x8BBE;&amp;#x8BA1;&amp;#x5E76;&amp;#x4E0D;&amp;#x590D;&amp;#x6742;&amp;#xFF0C;&amp;#x4F46;&amp;#x5B9E;&amp;#x9645;&amp;#x8BBE;&amp;#x8BA1;&amp;#x8</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>总线控制器设计</title>
    <link href="https://gpthimble.github.io/%E6%80%BB%E7%BA%BF%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/"/>
    <id>https://gpthimble.github.io/%E6%80%BB%E7%BA%BF%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/</id>
    <published>2020-10-14T05:59:02.000Z</published>
    <updated>2020-10-16T14:33:38.820Z</updated>
    
    <content type="html"><![CDATA[<h2 id="&#x603B;&#x7EBF;&#x8BBE;&#x8BA1;"><a href="#&#x603B;&#x7EBF;&#x8BBE;&#x8BA1;" class="headerlink" title="&#x603B;&#x7EBF;&#x8BBE;&#x8BA1;"></a>&#x603B;&#x7EBF;&#x8BBE;&#x8BA1;</h2><h3 id="&#x603B;&#x7EBF;&#x5F62;&#x5F0F;"><a href="#&#x603B;&#x7EBF;&#x5F62;&#x5F0F;" class="headerlink" title="&#x603B;&#x7EBF;&#x5F62;&#x5F0F;"></a>&#x603B;&#x7EBF;&#x5F62;&#x5F0F;</h3><p>CPU&#x5185;cache&#x901A;&#x8FC7;&#x603B;&#x7EBF;&#x4E0E;&#x5176;&#x4ED6;&#x8BBE;&#x5907;&#x5305;&#x62EC;RAM&#x3001;ROM&#x53CA;IO&#x8BBE;&#x5907;&#xFF08;Memory Mapped IO&#xFF09;&#x76F8;&#x8FDE;&#x3002;&#x603B;&#x7EBF;&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4E2A;&#x4E3B;&#x8BBE;&#x5907;&#xFF0C;&#x80FD;&#x53D1;&#x8D77;&#x8BFB;&#x5199;&#x8BF7;&#x6C42;&#xFF0C;&#x8FD9;&#x4F7F;&#x5F97;&#x8BE5;&#x7CFB;&#x7EDF;&#x62E5;&#x6709;DMA&#x80FD;&#x529B;&#xFF0C;&#x5176;&#x4ED6;&#x8BBE;&#x5907;&#x80FD;&#x5728;&#x603B;&#x7EBF;&#x7A7A;&#x95F2;&#x65F6;&#x62A2;&#x5360;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x5B58;&#x50A8;&#x8BBE;&#x5907;&#x3002;&#x8FD9;&#x4E00;&#x70B9;&#x662F;&#x53D7;&#x5230;ZipCPU&#x542F;&#x53D1;&#x7684;&#xFF0C;ZipCPU&#x4F7F;&#x7528;&#x4E00;&#x79CD;&#x6210;&#x719F;&#x7684;&#x603B;&#x7EBF;&#xFF0C;&#x5728;&#x672C;&#x9879;&#x76EE;&#x4E2D;&#x6211;&#x8BA1;&#x5212;&#x8BBE;&#x8BA1;&#x4E00;&#x79CD;&#x7B80;&#x5355;&#x7684;&#x603B;&#x7EBF;&#x3002;<br>&#x603B;&#x7EBF;&#x8BBE;&#x8BA1;&#x5982;&#x4E0B;&#xFF1A;</p><pre><code>========address========data--------request--------ready--------r_w--------clk</code></pre><h3 id="&#x603B;&#x7EBF;&#x63A7;&#x5236;&#x5668;"><a href="#&#x603B;&#x7EBF;&#x63A7;&#x5236;&#x5668;" class="headerlink" title="&#x603B;&#x7EBF;&#x63A7;&#x5236;&#x5668;"></a>&#x603B;&#x7EBF;&#x63A7;&#x5236;&#x5668;</h3><p>&#x603B;&#x7EBF;&#x63A7;&#x5236;&#x5668;&#x8BBE;&#x8BA1;&#x5982;&#x4E0B;&#xFF1A;</p><pre><code>          ------------request&lt;--|  state    |--&lt;DMA 0          |           |--&gt;Grant 0          |   BUS     |--&lt;DMA 1          | Controller|--&gt;Grant 1          |           | ...          |           |--&lt;DMA 7    clk&gt;--|           |--&gt;Grant 7          ------------</code></pre><p>&#x63A7;&#x5236;&#x5668;&#x8D1F;&#x8D23;&#x5BF9;&#x603B;&#x7EBF;&#x4E0A;&#x6240;&#x6709;&#x7684;&#x4E3B;&#x8BBE;&#x5907;&#x8BF7;&#x6C42;&#x8FDB;&#x884C;&#x6392;&#x961F;&#xFF0C;&#x5176;&#x5185;&#x90E8;&#x6307;&#x5B9A;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x7531;DMA 0 -&gt; DMA 7&#x9012;&#x51CF;&#x3002;&#x88AB;&#x5141;&#x8BB8;&#x7684;&#x8BBE;&#x5907;&#xFF0C;&#x4F1A;&#x901A;&#x8FC7;Grant X&#x4FE1;&#x53F7;&#x901A;&#x77E5;&#x4E3B;&#x8BBE;&#x5907;&#xFF0C;&#x7531;&#x8BE5;&#x4FE1;&#x53F7;&#x63A7;&#x5236;&#x8BBE;&#x5907;&#x8FDE;&#x63A5;&#x5728;&#x603B;&#x7EBF;&#x4E0A;&#x7684;&#x4E09;&#x6001;&#x95E8;&#xFF0C;&#x5141;&#x8BB8;&#x5176;&#x4E0E;&#x603B;&#x7EBF;&#x901A;&#x8BAF;&#x3002;&#x5F53;&#x4EFB;&#x610F;&#x8BBE;&#x5907;&#x53D1;&#x8D77;DMA&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;request&#x8F93;&#x51FA;&#x9AD8;&#x7535;&#x5E73;&#xFF08;&#x8BE5;&#x4FE1;&#x53F7;&#x4E0E;&#x603B;&#x7EBF;&#x4E0A;&#x7684;request&#x8FDE;&#x63A5;&#xFF09;&#xFF0C;&#x901A;&#x77E5;&#x4ECE;&#x8BBE;&#x5907;&#x8FDB;&#x884C;&#x901A;&#x8BAF;&#x3002;&#x63A7;&#x5236;&#x5668;&#x5185;&#x90E8;&#x6709;&#x4E00;&#x4E2A;&#x72B6;&#x6001;&#x673A;&#xFF0C;&#x5F53;&#x6709;&#x8BF7;&#x6C42;&#x53D1;&#x51FA;&#x65F6;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x65F6;&#x949F;&#x4E0A;&#x8DF3;&#x8FDB;&#x5165;busy&#x72B6;&#x6001;&#xFF0C;&#x6536;&#x5230;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x4ECE;&#x8BBE;&#x5907;&#x53D1;&#x9001;&#x6765;&#x7684;ready&#x540E;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x65F6;&#x949F;&#x4E0A;&#x8DF3;&#x8FDB;&#x5165;idle&#x72B6;&#x6001;&#x3002;&#x5728;busy&#x72B6;&#x6001;&#x5176;&#x8F93;&#x51FA;&#x4E0D;&#x53D8;&#xFF0C;&#x7B49;&#x5F85;&#x8BE5;&#x8BBE;&#x5907;&#x901A;&#x8BAF;&#x7ED3;&#x675F;&#xFF0C;&#x603B;&#x7EBF;&#x624D;&#x7A7A;&#x95F2;&#x3002;&#x8BE5;&#x63A7;&#x5236;&#x5668;&#x7531;bus_control.v&#x5B9E;&#x73B0;&#x3002;&#x603B;&#x7EBF;&#x4E0A;&#x7684;&#x8BF7;&#x6C42;&#x53D1;&#x9001;&#x548C;&#x6570;&#x636E;&#x63A5;&#x6536;&#x90FD;&#x5728;&#x4E00;&#x4E2A;&#x65F6;&#x949F;&#x5185;&#x5B8C;&#x6210;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">module</span> bus_control(</span><br><span class="line">    dma,grant,req,ready,clk</span><br><span class="line">);</span><br><span class="line">    <span class="hljs-keyword">input</span>   [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] dma;</span><br><span class="line">    <span class="hljs-keyword">input</span>   ready, clk;</span><br><span class="line">    <span class="hljs-keyword">output</span>  [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] grant;</span><br><span class="line">    <span class="hljs-keyword">output</span>  req;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//--------------------------    Module implementation  -------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//registered grant value.</span></span><br><span class="line">    <span class="hljs-keyword">reg</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] grant_reg;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//internal state machine</span></span><br><span class="line">    <span class="hljs-keyword">reg</span> state;</span><br><span class="line">    <span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk)</span><br><span class="line">    <span class="hljs-keyword">begin</span></span><br><span class="line">        <span class="hljs-keyword">case</span> (state)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">//Idle state, in this state, if has a req, jump to state busy</span></span><br><span class="line">        <span class="hljs-comment">//and register the grant value, this device is chosen, and </span></span><br><span class="line">        <span class="hljs-comment">//other devices&apos; request can&apos;t change the output.</span></span><br><span class="line">            <span class="hljs-number">0</span>: <span class="hljs-keyword">begin</span></span><br><span class="line">                <span class="hljs-keyword">if</span> (req)</span><br><span class="line">                    state &lt;= <span class="hljs-number">1</span>;</span><br><span class="line">                    grant_reg &lt;= grant_inner;</span><br><span class="line">            <span class="hljs-keyword">end</span></span><br><span class="line">        <span class="hljs-comment">//Busy state, in this state, if has a ready, jump to state idle</span></span><br><span class="line">            <span class="hljs-number">1</span>: <span class="hljs-keyword">begin</span></span><br><span class="line">                <span class="hljs-keyword">if</span> (ready)</span><br><span class="line">                    state &lt;= <span class="hljs-number">0</span>;</span><br><span class="line">            <span class="hljs-keyword">end</span></span><br><span class="line">        <span class="hljs-keyword">endcase</span></span><br><span class="line">    <span class="hljs-keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//dma request queue.</span></span><br><span class="line">    <span class="hljs-keyword">reg</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] grant_inner;</span><br><span class="line">    <span class="hljs-keyword">always</span> @(*)</span><br><span class="line">    <span class="hljs-keyword">begin</span></span><br><span class="line">        <span class="hljs-keyword">casez</span> (dma)</span><br><span class="line">            <span class="hljs-number">8&apos;bzzzzzzz1</span> :  grant_inner = <span class="hljs-number">8&apos;b00000001</span>;</span><br><span class="line">            <span class="hljs-number">8&apos;bzzzzzz10</span> :  grant_inner = <span class="hljs-number">8&apos;b00000010</span>;</span><br><span class="line">            <span class="hljs-number">8&apos;bzzzzz100</span> :  grant_inner = <span class="hljs-number">8&apos;b00000100</span>;</span><br><span class="line">            <span class="hljs-number">8&apos;bzzzz1000</span> :  grant_inner = <span class="hljs-number">8&apos;b00001000</span>;</span><br><span class="line">            <span class="hljs-number">8&apos;bzzz10000</span> :  grant_inner = <span class="hljs-number">8&apos;b00010000</span>;</span><br><span class="line">            <span class="hljs-number">8&apos;bzz100000</span> :  grant_inner = <span class="hljs-number">8&apos;b00100000</span>;</span><br><span class="line">            <span class="hljs-number">8&apos;bz1000000</span> :  grant_inner = <span class="hljs-number">8&apos;b01000000</span>;</span><br><span class="line">            <span class="hljs-number">8&apos;b10000000</span> :  grant_inner = <span class="hljs-number">8&apos;b10000000</span>;</span><br><span class="line">            <span class="hljs-keyword">default</span>     :  grant_inner = <span class="hljs-number">8&apos;b00000000</span>; </span><br><span class="line">        <span class="hljs-keyword">endcase</span></span><br><span class="line">    <span class="hljs-keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//When state == 0 (idle), grant is the instant output of code above</span></span><br><span class="line">    <span class="hljs-comment">//When state == 1 (busy), grant is the registered value.</span></span><br><span class="line">    <span class="hljs-comment">//This lets the grant output stable when one device has already been</span></span><br><span class="line">    <span class="hljs-comment">//chosen.</span></span><br><span class="line">    <span class="hljs-keyword">assign</span>  grant = state ? grant_reg : grant_inner;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//The req signal will remain untill ready signal is received.</span></span><br><span class="line">    <span class="hljs-keyword">assign</span>   req = (|grant) ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">endmodule</span> <span class="hljs-comment">//bus_control</span></span><br></pre></td></tr></table></figure><p>&#x603B;&#x7EBF;&#x63A7;&#x5236;&#x5668;&#x4EFF;&#x771F;&#x5982;&#x56FE;:<br><img src="/%E6%80%BB%E7%BA%BF%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/bus_control_t.JPG" alt="&#x603B;&#x7EBF;&#x63A7;&#x5236;&#x5668;&#x4EFF;&#x771F;"></p><h3 id="&#x603B;&#x7EBF;&#x4E0A;&#x7684;&#x8BBE;&#x5907;"><a href="#&#x603B;&#x7EBF;&#x4E0A;&#x7684;&#x8BBE;&#x5907;" class="headerlink" title="&#x603B;&#x7EBF;&#x4E0A;&#x7684;&#x8BBE;&#x5907;"></a>&#x603B;&#x7EBF;&#x4E0A;&#x7684;&#x8BBE;&#x5907;</h3><p>&#x603B;&#x7EBF;&#x4E0A;&#x7684;&#x4E3B;&#x8BBE;&#x5907;&#xFF0C;&#x8FDE;&#x63A5;&#x603B;&#x7EBF;&#x4E0A;address&#x3001;data&#x3001;r_w&#x548C;ready&#xFF0C;&#x8FDE;&#x63A5;&#x63A7;&#x5236;&#x5668;&#x7684;DMA X&#x548C;Grant X&#x3002;&#x53D1;&#x8D77;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x5C06;DMA x&#x7F6E;&#x9AD8;&#x7535;&#x5E73;&#xFF0C;&#x6392;&#x961F;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x7531;Grant X&#x4FE1;&#x53F7;&#x63A7;&#x5236;address&#x3001;data&#x3001;r_w&#x548C;ready&#x4E0A;&#x7684;&#x4E09;&#x6001;&#x95E8;&#x3002;&#x53EA;&#x6709;&#x5F53;&#x8BBE;&#x5907;&#x88AB;&#x63A7;&#x5236;&#x5668;&#x9009;&#x4E2D;&#xFF0C;address&#x3001;data&#x3001;r_w&#x624D;&#x80FD;&#x5728;&#x603B;&#x7EBF;&#x4E0A;&#x8F93;&#x51FA;&#x6216;&#x8005;&#x8F93;&#x5165;&#xFF0C;&#x5426;&#x5219;&#x8FD9;&#x4E9B;&#x4FE1;&#x53F7;&#x662F;&#x9AD8;&#x963B;&#x72B6;&#x6001;&#x3002;&#x4E3B;&#x8BBE;&#x5907;&#x5BF9;&#x5176;&#x662F;&#x5426;&#x88AB;&#x9009;&#x4E2D;&#x662F;&#x4E0D;&#x53EF;&#x77E5;&#x7684;&#xFF0C;&#x5F53;&#x67D0;&#x4E2A;&#x4E3B;&#x8BBE;&#x5907;&#x53D1;&#x8D77;&#x4E86;&#x8BF7;&#x6C42;&#xFF0C;&#x4ED6;&#x4FBF;&#x5C06;&#x5176;&#x8BF7;&#x6C42;&#x7684;&#x5730;&#x5740;&#x3001;&#x6570;&#x636E;&#x3001;&#x8BFB;&#x5199;&#x60C5;&#x51B5;&#x653E;&#x5728;&#x8F93;&#x51FA;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x8F93;&#x51FA;&#x7AEF;&#x53E3;&#x7684;&#x4E09;&#x6001;&#x95E8;&#x662F;&#x7531;&#x603B;&#x7EBF;&#x63A7;&#x5236;&#x5668;&#x4F20;&#x56DE;&#x7684;Grant X&#x4FE1;&#x53F7;&#x63A7;&#x5236;&#x7684;&#x3002;&#x82E5;&#x5176;&#x672A;&#x88AB;&#x63A7;&#x5236;&#x5668;&#x9009;&#x4E2D;&#xFF0C;&#x8BE5;&#x8BBE;&#x5907;&#x65E0;&#x6CD5;&#x6536;&#x5230;&#x5176;&#x4ED6;&#x8BBE;&#x5907;&#x53D1;&#x9001;&#x7684;ready&#x4FE1;&#x53F7;&#xFF0C;&#x56E0;&#x6B64;&#x5904;&#x4E8E;&#x7B49;&#x5F85;&#x72B6;&#x6001;&#x3002;&#x56E0;&#x6B64;&#x5728;&#x603B;&#x7EBF;&#x7A7A;&#x95F2;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;CPU&#x8FDE;&#x7EED;cache&#x547D;&#x4E2D;&#xFF0C;&#x5176;&#x4ED6;&#x8BBE;&#x5907;&#x5373;&#x53EF;&#x4F7F;&#x7528;&#x603B;&#x7EBF;&#x8FDB;&#x884C;DMA&#x8BF7;&#x6C42;&#x3002;</p><p>&#x603B;&#x7EBF;&#x4E0A;&#x7684;&#x4ECE;&#x8BBE;&#x5907;&#xFF0C;&#x5176;&#x63A5;&#x53E3;&#x5E94;&#x5BF9;&#x5730;&#x5740;&#x7EBF;&#x8FDB;&#x884C;&#x8303;&#x56F4;&#x5224;&#x5B9A;&#xFF0C;&#x5730;&#x5740;&#x7EBF;&#x9009;&#x5B9A;&#x8BE5;&#x8BBE;&#x5907;&#x5185;&#x5730;&#x5740;&#x5373;&#x8BA4;&#x4E3A;&#x5BF9;&#x8BE5;&#x8BBE;&#x5907;&#x53D1;&#x8D77;&#x8BF7;&#x6C42;&#x3002;&#x5728;&#x88AB;&#x8BF7;&#x6C42;&#x7684;&#x6570;&#x636E;&#x51C6;&#x5907;&#x597D;&#x540E;&#xFF0C;&#x5E94;&#x5C06;&#x6570;&#x636E;&#x8F93;&#x51FA;&#x5230;&#x603B;&#x7EBF;&#xFF0C;&#x5E76;&#x5C06;ready&#x7F6E;&#x9AD8;&#x7535;&#x5E73;&#x3002;</p><p>CPU&#x5185;&#x90E8;&#x7684;cache&#x63A7;&#x5236;&#x5668;&#x662F;&#x4E3B;&#x8BBE;&#x5907;&#xFF0C;&#x53EA;&#x80FD;&#x53D1;&#x8D77;&#x8BF7;&#x6C42;&#x800C;&#x4E0D;&#x80FD;&#x88AB;&#x8BF7;&#x6C42;&#x3002;&#x5927;&#x90E8;&#x5206;&#x7684;IO&#x8BBE;&#x5907;&#x90FD;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x4E3B;/&#x4ECE;&#x8BBE;&#x5907;,&#x65E2;&#x53EF;&#x4EE5;&#x53D1;&#x8D77;&#x8BF7;&#x6C42;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x8BF7;&#x6C42;&#x7684;&#x5BF9;&#x8C61;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BBE;&#x5907;&#x8981;&#x8BBE;&#x8BA1;&#x5206;&#x5F00;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x8D1F;&#x8D23;&#x63A5;&#x53D7;&#x8BF7;&#x6C42;&#x7684;&#x4ECE;&#x8BBE;&#x5907;&#x4F7F;&#x7528;&#x4ECE;&#x8BBE;&#x5907;&#x63A5;&#x53E3;&#xFF0C;&#x8D1F;&#x8D23;&#x53D1;&#x8D77;&#x8BF7;&#x6C42;&#x7684;&#x4E3B;&#x8BBE;&#x5907;&#x4F7F;&#x7528;&#x4E3B;&#x8BBE;&#x5907;&#x63A5;&#x53E3;&#x3002;</p><h2 id="&#x6D4B;&#x8BD5;"><a href="#&#x6D4B;&#x8BD5;" class="headerlink" title="&#x6D4B;&#x8BD5;"></a>&#x6D4B;&#x8BD5;</h2><p>&#x5982;&#x4F55;&#x8BBE;&#x8BA1;&#x5E76;&#x5355;&#x72EC;&#x6D4B;&#x8BD5;&#x603B;&#x7EBF;&#x8FD9;&#x4E00;&#x90E8;&#x5206;&#x5462;&#xFF1F;&#x9700;&#x8981;&#x8BBE;&#x8BA1;&#x4E3B;&#x4ECE;&#x8BBE;&#x5907;&#x63A5;&#x53E3;&#xFF0C;&#x4E3B;&#x4ECE;&#x8BBE;&#x5907;&#x6A21;&#x62DF;&#x5668;&#xFF0C;&#x5E76;&#x5C06;&#x6A21;&#x62DF;&#x8BBE;&#x5907;&#x63A5;&#x5165;&#x603B;&#x7EBF;&#x548C;&#x63A7;&#x5236;&#x5668;&#x8FDB;&#x884C;&#x65B9;&#x9488;&#x548C;&#x6D4B;&#x8BD5;&#x3002;</p><h3 id="&#x4ECE;&#x8BBE;&#x5907;&#x6A21;&#x62DF;"><a href="#&#x4ECE;&#x8BBE;&#x5907;&#x6A21;&#x62DF;" class="headerlink" title="&#x4ECE;&#x8BBE;&#x5907;&#x6A21;&#x62DF;"></a>&#x4ECE;&#x8BBE;&#x5907;&#x6A21;&#x62DF;</h3><p>&#x9996;&#x5148;&#x8BBE;&#x8BA1;&#x4E86;&#x4E00;&#x4E2A;&#x6A21;&#x5757;dummy_slave&#x6765;&#x6A21;&#x62DF;&#x4ECE;&#x8BBE;&#x5907;&#x5728;&#x603B;&#x7EBF;&#x4E0A;&#x7684;&#x884C;&#x4E3A;&#x3002;&#x8FD9;&#x4E2A;&#x4ECE;&#x8BBE;&#x5907;&#x53EF;&#x4EE5;&#x770B;&#x4F5C;&#x4E00;&#x4E2A;&#x5185;&#x5B58;&#x8BBE;&#x5907;&#xFF0C;&#x9700;&#x8981;&#x51E0;&#x4E2A;&#x5468;&#x671F;&#x5C06;&#x6570;&#x636E;&#x51C6;&#x5907;&#x597D;&#xFF0C;&#x53EF;&#x4EE5;&#x8BFB;&#x53EF;&#x4EE5;&#x5199;&#x3002;&#x8FD9;&#x4E2A;&#x4ECE;&#x8BBE;&#x5907;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x4F5C;&#x5904;&#x7406;&#x5668;&#x7684;&#x6D4B;&#x8BD5;&#x3002;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//module for dummy slave devices.</span></span><br><span class="line"><span class="hljs-keyword">module</span> dummy_slave( </span><br><span class="line">    clk,address, data, request, ready_out, r_w</span><br><span class="line">);</span><br><span class="line">    <span class="hljs-keyword">input</span> clk, r_w, request;</span><br><span class="line">    <span class="hljs-keyword">input</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] address;</span><br><span class="line">    <span class="hljs-keyword">inout</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] data;</span><br><span class="line">    <span class="hljs-keyword">output</span> ready_out;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//--------------------------    Module implementation  -------------------------</span></span><br><span class="line">    <span class="hljs-comment">//dummy memory</span></span><br><span class="line">    <span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] mem [<span class="hljs-number">0</span>:<span class="hljs-number">32</span>-<span class="hljs-number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//internal state machine</span></span><br><span class="line">    <span class="hljs-keyword">reg</span> [ <span class="hljs-number">2</span>:<span class="hljs-number">0</span>] state;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//address range</span></span><br><span class="line">    <span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] entry_start, entry_end;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//internal registers for bus signal</span></span><br><span class="line">    <span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] addr_reg,data_reg;</span><br><span class="line">    <span class="hljs-keyword">reg</span> r_w_reg,selected_reg;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">initial</span> </span><br><span class="line">    <span class="hljs-keyword">begin</span></span><br><span class="line">        entry_start=<span class="hljs-number">32&apos;b0</span>;</span><br><span class="line">        entry_end  =<span class="hljs-number">32&apos;b11111</span>;</span><br><span class="line">        state      = <span class="hljs-number">0</span>;</span><br><span class="line">        <span class="hljs-comment">//ready signal is Z when idle, ready line should have a tri0 </span></span><br><span class="line">        <span class="hljs-comment">//pulldown resistance. because there&apos;re other devices on the</span></span><br><span class="line">        <span class="hljs-comment">//bus.</span></span><br><span class="line">        ready = <span class="hljs-number">1&apos;b0</span>;</span><br><span class="line">        addr_reg =<span class="hljs-number">0</span>;</span><br><span class="line">        data_reg=<span class="hljs-number">0</span>;</span><br><span class="line">        r_w_reg=<span class="hljs-number">0</span>;</span><br><span class="line">        selected_reg=<span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//selected if request in address range</span></span><br><span class="line">    <span class="hljs-keyword">reg</span> selected;</span><br><span class="line">    <span class="hljs-keyword">always</span> @(*)</span><br><span class="line">    <span class="hljs-keyword">begin</span></span><br><span class="line">        <span class="hljs-keyword">if</span> ((address &gt;= entry_start) &amp;(address &lt;=entry_end) &amp;request )</span><br><span class="line">            selected = <span class="hljs-number">1</span>;</span><br><span class="line">        <span class="hljs-keyword">else</span>    selected =<span class="hljs-number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">end</span> </span><br><span class="line">    <span class="hljs-comment">//put the ready_out High Z when device is not selected.   </span></span><br><span class="line">    <span class="hljs-keyword">reg</span> ready;</span><br><span class="line">    <span class="hljs-keyword">assign</span> ready_out = (selected | selected_reg) ? ready : <span class="hljs-number">1&apos;bz</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//implement inout data port.</span></span><br><span class="line">    <span class="hljs-comment">//if device is selected and the request is a read request, this device</span></span><br><span class="line">    <span class="hljs-comment">//will put data onto the bus. In any other condition, the output will be</span></span><br><span class="line">    <span class="hljs-comment">//high Z.</span></span><br><span class="line">    <span class="hljs-keyword">assign</span> data = (selected_reg &amp; ~r_w_reg &amp; ready) ? read :<span class="hljs-number">32&apos;bz</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//read is the continuous read data out.</span></span><br><span class="line">    <span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] read;</span><br><span class="line">    <span class="hljs-keyword">assign</span> read = mem[addr_reg];</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//the state machine implements the dummy wait cycles and ready signal.</span></span><br><span class="line">    <span class="hljs-comment">//one dummy operation needs four cycles.</span></span><br><span class="line">    <span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk)</span><br><span class="line">    <span class="hljs-keyword">begin</span></span><br><span class="line">        <span class="hljs-comment">//If device is in idle state and selected, register address, r_w </span></span><br><span class="line">        <span class="hljs-comment">//and data.</span></span><br><span class="line">        <span class="hljs-keyword">if</span> ((state == <span class="hljs-number">2&apos;b00</span>)&amp; selected) <span class="hljs-keyword">begin</span></span><br><span class="line">            state &lt;=  <span class="hljs-number">2&apos;b01</span>;</span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment">//pull the ready line low.</span></span><br><span class="line">            ready &lt;=  <span class="hljs-number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment">//registered the request</span></span><br><span class="line">            addr_reg&lt;= address;</span><br><span class="line">            r_w_reg &lt;= r_w;</span><br><span class="line">            selected_reg&lt;=selected;</span><br><span class="line">            <span class="hljs-keyword">if</span> (r_w) <span class="hljs-keyword">begin</span></span><br><span class="line">                data_reg&lt;= data;</span><br><span class="line">            <span class="hljs-keyword">end</span></span><br><span class="line">        <span class="hljs-keyword">end</span></span><br><span class="line">        <span class="hljs-comment">//dummy write and read.</span></span><br><span class="line">        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (state == <span class="hljs-number">2&apos;b01</span> ) <span class="hljs-keyword">begin</span></span><br><span class="line">            state &lt;= <span class="hljs-number">2&apos;b10</span>;</span><br><span class="line">            <span class="hljs-keyword">if</span> (r_w_reg) </span><br><span class="line">                mem[addr_reg] &lt;= data_reg; </span><br><span class="line">        <span class="hljs-keyword">end</span>       </span><br><span class="line">        <span class="hljs-comment">//dummy wait. </span></span><br><span class="line">        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (state == <span class="hljs-number">2&apos;b10</span>) <span class="hljs-keyword">begin</span></span><br><span class="line">            state &lt;= <span class="hljs-number">2&apos;b11</span>;</span><br><span class="line">        <span class="hljs-keyword">end</span></span><br><span class="line">        <span class="hljs-comment">//operation ready</span></span><br><span class="line">        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (state == <span class="hljs-number">2&apos;b11</span>) <span class="hljs-keyword">begin</span> </span><br><span class="line">            state &lt;= <span class="hljs-number">3&apos;b100</span>;</span><br><span class="line">            <span class="hljs-comment">//one cycle ready signal</span></span><br><span class="line">            ready &lt;= <span class="hljs-number">1</span>;</span><br><span class="line">        <span class="hljs-keyword">end</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">//goto idle next cycle, ready for next request</span></span><br><span class="line">        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (state ==<span class="hljs-number">3&apos;b100</span>) <span class="hljs-keyword">begin</span></span><br><span class="line">            state &lt;= <span class="hljs-number">00</span>;</span><br><span class="line">            ready &lt;= <span class="hljs-number">1&apos;b0</span>;</span><br><span class="line">            selected_reg&lt;= <span class="hljs-number">0</span>;</span><br><span class="line">            r_w_reg &lt;=<span class="hljs-number">0</span>;</span><br><span class="line">            data_reg &lt;=<span class="hljs-number">0</span>;</span><br><span class="line">            addr_reg&lt;=<span class="hljs-number">0</span>;</span><br><span class="line">        <span class="hljs-keyword">end</span></span><br><span class="line">        <span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span> </span><br><span class="line">            <span class="hljs-comment">//if device is idle, and there&apos;s no request on this device</span></span><br><span class="line">            <span class="hljs-comment">//clear all internal registers.</span></span><br><span class="line">            state &lt;= <span class="hljs-number">00</span>;</span><br><span class="line">            ready &lt;= <span class="hljs-number">1&apos;b0</span>;</span><br><span class="line">            selected_reg&lt;= <span class="hljs-number">0</span>;</span><br><span class="line">            r_w_reg &lt;=<span class="hljs-number">0</span>;</span><br><span class="line">            data_reg &lt;=<span class="hljs-number">0</span>;</span><br><span class="line">            addr_reg&lt;=<span class="hljs-number">0</span>;</span><br><span class="line">        <span class="hljs-keyword">end</span></span><br><span class="line">    <span class="hljs-keyword">end</span></span><br><span class="line"><span class="hljs-keyword">endmodule</span> <span class="hljs-comment">//dummy_slave</span></span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#xFF0C;&#x5728;quartus&#x4E2D;&#x7EFC;&#x5408;&#x751F;&#x6210;&#x4E86;&#x4E00;&#x4E2A;&#x9690;&#x542B;&#x7684;&#x8C03;&#x7528;FPGA&#x7247;&#x4E0A;&#x5B58;&#x50A8;&#x7684;&#x6A21;&#x5757;&#xFF0C;&#x6A21;&#x5757;&#x7684;&#x7C7B;&#x578B;&#x662F;dual port/single clock RAM.&#x5176;&#x5B9E;&#x6211;&#x6240;&#x8BBE;&#x8BA1;&#x7684;&#x6A21;&#x578B;&#x5E94;&#x5F53;&#x662F;&#x4E00;&#x4E2A;&#x5355;&#x7AEF;&#x53E3;RAM&#xFF0C;&#x6211;&#x67E5;&#x770B;&#x4E86;Altera&#x7684;&#x624B;&#x518C;&#xFF0C;&#x4E5F;&#x53C2;&#x8003;&#x4E86;quartus&#x7684;&#x4EE3;&#x7801;&#x7247;&#x6BB5;,&#x4F46;&#x662F;&#x7EFC;&#x5408;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x4ECD;&#x7136;&#x662F;&#x53CC;&#x7AEF;&#x53E3;RAM&#xFF0C;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x8BA9;&#x6211;&#x60F3;&#x4E0D;&#x660E;&#x767D;&#x3002;&#x4F46;&#x662F;&#x7EFC;&#x5408;&#x7684;&#x7ED3;&#x679C;&#x6EE1;&#x8DB3;&#x6211;&#x7684;&#x8BBE;&#x8BA1;&#x9700;&#x6C42;&#x3002;&#x7EC6;&#x60F3;&#x5355;&#x7AEF;&#x53E3;&#x548C;&#x53CC;&#x7AEF;&#x53E3;RAM&#x7684;&#x533A;&#x522B;&#xFF0C;&#x8FD9;&#x91CC;&#x7EFC;&#x5408;&#x751F;&#x6210;&#x7684;&#x53CC;&#x7AEF;&#x53E3;&#xFF0C;&#x5E94;&#x662F;&#x8BFB;&#x5199;&#x7AEF;&#x53E3;&#x5171;&#x7528;&#x5730;&#x5740;&#x7EBF;&#x548C;&#x6570;&#x636E;&#x7EBF;&#xFF0C;&#x4F46;&#x8BFB;&#x7AEF;&#x53E3;&#x7684;&#x6570;&#x636E;&#x7EBF;&#x7528;&#x4E09;&#x6001;&#x95E8;&#x63A7;&#x5236;&#xFF0C;&#x4EC5;&#x5728;&#x5199;&#x4FE1;&#x53F7;&#x65E0;&#x6548;&#x65F6;&#x624D;&#x5411;&#x603B;&#x7EBF;&#x8F93;&#x51FA;&#x3002;&#x56E0;&#x4E3A;&#x6211;&#x5E76;&#x4E0D;&#x6E05;&#x695A;Quartus&#x7EFC;&#x5408;&#x7684;&#x7EC6;&#x8282;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x5E76;&#x4E0D;&#x7EA0;&#x7ED3;&#x4E3A;&#x4EC0;&#x4E48;&#x7F16;&#x8BD1;&#x5668;&#x6CA1;&#x6709;&#x6309;&#x7167;&#x6211;&#x7684;&#x8981;&#x6C42;&#x7EFC;&#x5408;&#x6210;&#x5355;&#x7AEF;&#x53E3;RAM&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x54EA;&#x4F4D;&#x5927;&#x4F6C;&#x77E5;&#x9053;&#x539F;&#x56E0;&#xFF0C;&#x6B22;&#x8FCE;&#x7559;&#x8A00;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//Quaratus&#x5185;&#x7F6E;&#x7684;&#x5355;&#x7AEF;&#x53E3;ram&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x3002;</span></span><br><span class="line"><span class="hljs-keyword">module</span> single_port_RAM</span><br><span class="line">#(<span class="hljs-keyword">parameter</span> DATA_WIDTH=<span class="hljs-number">8</span>, <span class="hljs-keyword">parameter</span> ADDR_WIDTH=<span class="hljs-number">6</span>)</span><br><span class="line">(</span><br><span class="line"><span class="hljs-keyword">input</span> [(DATA_WIDTH-<span class="hljs-number">1</span>):<span class="hljs-number">0</span>] data,</span><br><span class="line"><span class="hljs-keyword">input</span> [(ADDR_WIDTH-<span class="hljs-number">1</span>):<span class="hljs-number">0</span>] addr,</span><br><span class="line"><span class="hljs-keyword">input</span> we, clk,</span><br><span class="line"><span class="hljs-keyword">output</span> [(DATA_WIDTH-<span class="hljs-number">1</span>):<span class="hljs-number">0</span>] q</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// Declare the RAM variable</span></span><br><span class="line"><span class="hljs-keyword">reg</span> [DATA_WIDTH-<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] ram[<span class="hljs-number">2</span>**ADDR_WIDTH-<span class="hljs-number">1</span>:<span class="hljs-number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// Variable to hold the registered read address</span></span><br><span class="line"><span class="hljs-keyword">reg</span> [ADDR_WIDTH-<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] addr_reg;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">always</span> @ (<span class="hljs-keyword">posedge</span> clk)</span><br><span class="line"><span class="hljs-keyword">begin</span></span><br><span class="line"><span class="hljs-comment">// Write</span></span><br><span class="line"><span class="hljs-keyword">if</span> (we)</span><br><span class="line">ram[addr] &lt;= data;</span><br><span class="line"></span><br><span class="line">addr_reg &lt;= addr;</span><br><span class="line"><span class="hljs-keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// Continuous assignment implies read returns NEW data.</span></span><br><span class="line"><span class="hljs-comment">// This is the natural behavior of the TriMatrix memory</span></span><br><span class="line"><span class="hljs-comment">// blocks in Single Port mode.  </span></span><br><span class="line"><span class="hljs-keyword">assign</span> q = ram[addr_reg];</span><br></pre></td></tr></table></figure><p>dummy_slave&#x7684;&#x4EFF;&#x771F;&#x7ED3;&#x679C;&#xFF1A;<br><img src="/%E6%80%BB%E7%BA%BF%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/dummy_slave_t.JPG" alt="dummy_slave&#x4EFF;&#x771F;"></p><h3 id="&#x4E3B;&#x8BBE;&#x5907;&#x6A21;&#x62DF;"><a href="#&#x4E3B;&#x8BBE;&#x5907;&#x6A21;&#x62DF;" class="headerlink" title="&#x4E3B;&#x8BBE;&#x5907;&#x6A21;&#x62DF;"></a>&#x4E3B;&#x8BBE;&#x5907;&#x6A21;&#x62DF;</h3><p>dummy master&#x6700;&#x7EC8;&#x4F1A;&#x88AB;Cache&#x3001;&#x5404;&#x79CD;DMA&#x8BBE;&#x5907;&#x66FF;&#x4EE3;&#xFF0C;&#x4F46;&#x662F;&#x8BBE;&#x8BA1;&#x4E00;&#x4E2A;dummy master&#x4ECD;&#x7136;&#x6709;&#x610F;&#x4E49;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x6D4B;&#x8BD5;&#x603B;&#x7EBF;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x591A;&#x4E2A;&#x4E3B;&#x8BBE;&#x5907;&#x540C;&#x65F6;&#x8BF7;&#x6C42;&#x7684;&#x60C5;&#x51B5;&#x3002;</p><p>dummy master&#x5185;&#x90E8;&#x662F;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x961F;&#x5217;&#xFF0C;&#x5176;&#x5C06;&#x8BF7;&#x6C42;&#x9001;&#x81F3;&#x603B;&#x7EBF;&#x63A7;&#x5236;&#x5668;&#xFF0C;&#x5728;&#x63A7;&#x5236;&#x5668;&#x5141;&#x8BB8;&#x540E;&#x5C06;&#x8BF7;&#x6C42;&#x9001;&#x81F3;&#x603B;&#x7EBF;&#xFF0C;&#x7B49;&#x5F85;&#x88AB;&#x8BF7;&#x6C42;&#x8BBE;&#x5907;&#x7684;ready&#x4FE1;&#x53F7;&#xFF0C;&#x53D6;&#x8D70;&#x6570;&#x636E;&#x540E;&#x91CD;&#x65B0;&#x6392;&#x961F;&#xFF0C;&#x51C6;&#x5907;&#x4E0B;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x3002;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">module</span> dummy_master(</span><br><span class="line">    clk, request, ready, grant, address, data, r_w</span><br><span class="line">);</span><br><span class="line">    <span class="hljs-keyword">input</span> clk, ready, grant;</span><br><span class="line">    <span class="hljs-keyword">output</span> request, r_w;</span><br><span class="line">    <span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] address;</span><br><span class="line">    <span class="hljs-keyword">inout</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] data;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//dummy requests.</span></span><br><span class="line">    <span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] req_addr [<span class="hljs-number">0</span>:<span class="hljs-number">32</span>-<span class="hljs-number">1</span>];</span><br><span class="line">    <span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] req_r_w;</span><br><span class="line">    <span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] req;</span><br><span class="line">    <span class="hljs-keyword">wire</span> ready_inner;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//dummy memory operation.</span></span><br><span class="line">    <span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] mem      [<span class="hljs-number">0</span>:<span class="hljs-number">32</span>-<span class="hljs-number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">reg</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>]       req_num  ;</span><br><span class="line">    <span class="hljs-comment">//initial dummy operations.</span></span><br><span class="line">    <span class="hljs-keyword">initial</span></span><br><span class="line">    <span class="hljs-keyword">begin</span></span><br><span class="line">        <span class="hljs-comment">//simulated operation is here.</span></span><br><span class="line">    <span class="hljs-keyword">end</span></span><br><span class="line">    <span class="hljs-comment">//internal state machine.</span></span><br><span class="line">    <span class="hljs-keyword">reg</span> state;</span><br><span class="line">    <span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk)</span><br><span class="line">    <span class="hljs-keyword">begin</span></span><br><span class="line">        <span class="hljs-keyword">case</span> (state)</span><br><span class="line">        <span class="hljs-number">1&apos;b0</span>:<span class="hljs-keyword">begin</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (request) state &lt;= <span class="hljs-number">1</span>;     </span><br><span class="line">            <span class="hljs-keyword">else</span> req_num&lt;=req_num +<span class="hljs-number">1</span>;</span><br><span class="line">            <span class="hljs-keyword">end</span></span><br><span class="line">        <span class="hljs-number">1&apos;b1</span>:<span class="hljs-keyword">begin</span> </span><br><span class="line">            <span class="hljs-keyword">if</span> (ready_inner)</span><br><span class="line">                <span class="hljs-keyword">begin</span></span><br><span class="line">                    <span class="hljs-keyword">if</span> (~req_r_w [req_num]) </span><br><span class="line">                        mem[req_num] &lt;= data;</span><br><span class="line">                    state &lt;=<span class="hljs-number">0</span>;</span><br><span class="line">                    req_num&lt;=req_num +<span class="hljs-number">1</span>;</span><br><span class="line">                <span class="hljs-keyword">end</span></span><br><span class="line">            <span class="hljs-keyword">end</span></span><br><span class="line">        <span class="hljs-keyword">endcase</span></span><br><span class="line">    <span class="hljs-keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">assign</span> request  = req [req_num];</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//High z when not granted</span></span><br><span class="line">    <span class="hljs-keyword">assign</span> address = grant ? req_addr[req_num] : <span class="hljs-number">32&apos;bz</span>;</span><br><span class="line">    <span class="hljs-keyword">assign</span> r_w = grant ? req_r_w [req_num] : <span class="hljs-number">1&apos;bz</span>;</span><br><span class="line">    <span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] data_out = req_r_w [req_num] ? mem [req_num] :<span class="hljs-number">32&apos;bz</span>;</span><br><span class="line">    <span class="hljs-keyword">assign</span> data = grant ? data_out: <span class="hljs-number">32&apos;bz</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//mask out ready signal when not granted</span></span><br><span class="line">    <span class="hljs-keyword">assign</span> ready_inner = grant? ready :<span class="hljs-number">1&apos;b0</span>; </span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">endmodule</span> <span class="hljs-comment">//dummy_master</span></span><br></pre></td></tr></table></figure><p>&#x4EFF;&#x771F;&#x60C5;&#x51B5;&#x5982;&#x56FE;:<br><img src="/%E6%80%BB%E7%BA%BF%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/dummy_master_t.JPG" alt="dummy_master &#x4EFF;&#x771F;"></p><h3 id="&#x603B;&#x7EBF;&#x4E8B;&#x52A1;&#x6D4B;&#x8BD5;"><a href="#&#x603B;&#x7EBF;&#x4E8B;&#x52A1;&#x6D4B;&#x8BD5;" class="headerlink" title="&#x603B;&#x7EBF;&#x4E8B;&#x52A1;&#x6D4B;&#x8BD5;"></a>&#x603B;&#x7EBF;&#x4E8B;&#x52A1;&#x6D4B;&#x8BD5;</h3><p>&#x8FD9;&#x91CC;&#x8BBE;&#x8BA1;&#x7684;test bench&#x5728;&#x603B;&#x7EBF;&#x4E0A;&#x8FDE;&#x63A5;&#x4E86;&#x4E24;&#x4E2A;DMA&#x8BBE;&#x5907;&#xFF0C;&#x5206;&#x522B;&#x63A5;&#x5165;&#x63A7;&#x5236;&#x5668;&#x7684;DMA[0]&#x548C;DMA[1]&#x56E0;&#x6B64;&#xFF0C;DMA[0]&#x6709;&#x9AD8;&#x4F18;&#x5148;&#x7EA7;&#x3002;&#x603B;&#x7EBF;&#x4E0A;&#x540C;&#x65F6;&#x63A5;&#x5165;&#x4E86;&#x4E24;&#x4E2A;&#x4ECE;&#x8BBE;&#x5907;&#xFF08;&#x5185;&#x5B58;&#x8BBE;&#x5907;&#xFF09;&#xFF0C;&#x4E24;&#x4E2A;&#x5185;&#x5B58;&#x8BBE;&#x5907;&#x7684;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x5206;&#x522B;&#x662F;32&#x2019;b0 -&gt; 32&#x2019;b11111 &#x548C; 32&#x2019;b100000-&gt;32&#x2019;b111111&#x3002;test bench&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5C06;&#x7EBF;&#x7F51;&#x8FDE;&#x63A5;&#x81F3;&#x5404;&#x4E2A;&#x6A21;&#x5757;&#x7684;&#x5B9E;&#x4F8B;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF1A;</p><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//This module is the test bench for bus</span></span><br><span class="line"><span class="hljs-keyword">module</span> bus_t(</span><br><span class="line">    clk,address_o,data_o,request_o,ready_o,rw_o,DMA_o,grant_o ,ready_inner</span><br><span class="line">);</span><br><span class="line">    <span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] address_o, data_o;</span><br><span class="line">    <span class="hljs-keyword">output</span> request_o, ready_o,rw_o,ready_inner;</span><br><span class="line">    <span class="hljs-keyword">output</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] DMA_o, grant_o;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">input</span> clk;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//These wires are internal bus signal</span></span><br><span class="line">    <span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] address,data;</span><br><span class="line">    <span class="hljs-keyword">wire</span> request, ready, r_w;</span><br><span class="line">    <span class="hljs-keyword">wire</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] DMA, grant;</span><br><span class="line"></span><br><span class="line">   <span class="hljs-comment">//these ports are used by the simulator output</span></span><br><span class="line">    <span class="hljs-keyword">assign</span> address_o =address;</span><br><span class="line">    <span class="hljs-keyword">assign</span> data_o = data;</span><br><span class="line">    <span class="hljs-keyword">assign</span> request_o = request;</span><br><span class="line">    <span class="hljs-keyword">assign</span> ready_o = ready;</span><br><span class="line">    <span class="hljs-keyword">assign</span> rw_o = r_w;</span><br><span class="line">    <span class="hljs-keyword">assign</span> DMA_o = DMA;</span><br><span class="line">    <span class="hljs-keyword">assign</span> grant_o = grant;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//instances of bus component</span></span><br><span class="line">    bus_control bus_control_0 (DMA,grant, request,ready,clk);</span><br><span class="line">    dummy_slave dummy_slave_a (clk,address,data,request,ready,r_w);</span><br><span class="line">    dummy_slave_1 dummy_slave_b (clk,address,data,request,ready,r_w);</span><br><span class="line">    dummy_master dummy_master_a (clk,DMA[<span class="hljs-number">0</span>],ready, grant[<span class="hljs-number">0</span>],address,data,r_w);</span><br><span class="line">    dummy_master_1 dummy_master_b (clk,DMA[<span class="hljs-number">1</span>],ready, grant[<span class="hljs-number">1</span>],address,data,r_w,ready_inner);    </span><br><span class="line"><span class="hljs-keyword">endmodule</span></span><br></pre></td></tr></table></figure><p>&#x4EFF;&#x771F;&#x8F93;&#x51FA;&#x4E3A;&#xFF1A;<br><img src="/%E6%80%BB%E7%BA%BF%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1/bus_t.JPG" alt="&#x603B;&#x7EBF;&#x4E8B;&#x52A1;&#x4EFF;&#x771F;"><br>&#x4ECE;&#x4EFF;&#x771F;&#x7ED3;&#x679C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6A21;&#x62DF;&#x7684;&#x56DB;&#x4E2A;&#x8BBE;&#x5907;8&#x4E2A;&#x603B;&#x7EBF;&#x4E8B;&#x52A1;&#x529F;&#x80FD;&#x6B63;&#x5E38;&#x3002;</p><h2 id="&#x5C0F;&#x7ED3;"><a href="#&#x5C0F;&#x7ED3;" class="headerlink" title="&#x5C0F;&#x7ED3;"></a>&#x5C0F;&#x7ED3;</h2><p>&#x603B;&#x7EBF;&#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x53EF;&#x4EE5;&#x9694;&#x79BB;CPU&#x548C;&#x5916;&#x56F4;&#x8BBE;&#x5907;&#xFF0C;&#x751A;&#x81F3;&#x53EF;&#x4EE5;&#x9694;&#x79BB;IO&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x6240;&#x8981;&#x8BBE;&#x8BA1;&#x7684;CPU&#x4F7F;&#x7528;memory mapped IO&#x3002;&#x6709;&#x4E86;&#x603B;&#x7EBF;&#xFF0C;IO&#x8BBE;&#x5907;&#x53EA;&#x662F;&#x603B;&#x7EBF;&#x4E0A;&#x94FE;&#x63A5;&#x7684;&#x4E00;&#x4E2A;&#x8BBE;&#x5907;&#x7F62;&#x4E86;, &#x800C;&#x4E14;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x5B9E;&#x73B0;&#x4E0D;&#x540C;&#x7684;&#x5185;&#x5B58;&#x6620;&#x5C04;&#xFF0C;&#x8FDE;&#x63A5;ROM&#x548C;RAM&#x3002;&#x6240;&#x4EE5;&#x603B;&#x7EBF;&#x8BBE;&#x8BA1;&#x5B8C;&#x6210;&#xFF0C;&#x662F;&#x672C;&#x9879;&#x76EE;&#x7684;&#x4E00;&#x4E2A;&#x91CC;&#x7A0B;&#x7891;&#xFF0C;&#x5B83;&#x6807;&#x5FD7;&#x7740;&#x5BF9;&#x5F00;&#x53D1;&#x8BBE;&#x8BA1;&#x6D41;&#x7A0B;&#x7684;&#x9A8C;&#x8BC1;&#x3002;</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;&amp;#x603B;&amp;#x7EBF;&amp;#x8BBE;&amp;#x8BA1;&quot;&gt;&lt;a href=&quot;#&amp;#x603B;&amp;#x7EBF;&amp;#x8BBE;&amp;#x8BA1;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x603B;&amp;#x7EBF;&amp;#x8BBE;&amp;#x8</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>关于中断和io控制器</title>
    <link href="https://gpthimble.github.io/%E5%85%B3%E4%BA%8E%E4%B8%AD%E6%96%AD%E5%92%8Cio%E6%8E%A7%E5%88%B6%E5%99%A8/"/>
    <id>https://gpthimble.github.io/%E5%85%B3%E4%BA%8E%E4%B8%AD%E6%96%AD%E5%92%8Cio%E6%8E%A7%E5%88%B6%E5%99%A8/</id>
    <published>2020-09-29T00:54:54.000Z</published>
    <updated>2020-09-29T02:56:56.000Z</updated>
    
    <content type="html"><![CDATA[<p>io&#x548C;&#x4E2D;&#x65AD;&#x7684;&#x8BBE;&#x8BA1;&#x5B9A;&#x578B;&#xFF0C;&#x6210;&#x4E86;&#x76EE;&#x524D;&#x6211;&#x7684;cpu&#x8BBE;&#x8BA1;&#x8FC7;&#x7A0B;&#x4E2D;&#x6700;&#x4E9F;&#x5F85;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;&#x3002;&#x82E5;&#x4E0D;&#x5B9A;&#x578B;&#xFF0C;&#x53EF;&#x80FD;&#x5F71;&#x54CD;&#x63A5;&#x4E0B;&#x6765;&#x5176;&#x4ED6;&#x7EC4;&#x4EF6;&#x7684;&#x8BBE;&#x8BA1;&#x548C;&#x6D4B;&#x8BD5;&#x5DE5;&#x4F5C;&#x3002;</p><p>&#x4E2D;&#x65AD;&#x63A7;&#x5236;&#x57FA;&#x672C;&#x6CA1;&#x5565;&#x53EF;&#x4FEE;&#x6539;&#x7684;&#xFF0C;cpu&#x7AEF;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x4E2D;&#x65AD;&#x811A;&#xFF0C;cp0&#xFF08;&#x534F;&#x5904;&#x7406;&#x5668;0&#xFF0C;&#x5373;cu&#xFF09;&#x4E2D;&#x6709;&#x56DB;&#x4E2A;&#x5BC4;&#x5B58;&#x5668;&#xFF0C;cause&#x7528;&#x4E8E;&#x8BB0;&#x5F55;&#x5916;&#x90E8;&#x4E2D;&#x65AD;&#x3001;&#x5185;&#x90E8;&#x4E2D;&#x65AD;&#x548C;&#x5F02;&#x5E38;&#x7684;&#x79CD;&#x7C7B;&#xFF1B;status&#x4E2D;&#x63A7;&#x5236;&#x8FD9;&#x4E00;&#x4E2A;&#x4E2D;&#x65AD;&#x7684;&#x5F00;&#x5173;&#xFF1B;base&#x8BB0;&#x5F55;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x5728;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x4E2D;&#x4F7F;&#x7528;mfc0&#x6307;&#x4EE4;&#x67E5;&#x8BE2;cause&#x5BC4;&#x5B58;&#x5668;&#x8DF3;&#x8F6C;&#x5230;&#x76F8;&#x5E94;&#x4E2D;&#x65AD;&#x7684;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x5730;&#x5740;&#xFF1B;EPC&#x7528;&#x6765;&#x4FDD;&#x5B58;&#x4E2D;&#x65AD;&#x524D;&#x7684;&#x6307;&#x4EE4;&#x5730;&#x5740;&#x3002;&#x8FD9;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x6211;&#x53EA;&#x9700;&#x8981;&#x989D;&#x5916;&#x5B9E;&#x73B0;&#x4E09;&#x6761;&#x6307;&#x4EE4;mfc0&#xFF0C;mtc0&#x548C;eret&#x3002;</p><p>io&#x6A21;&#x5757;&#x7684;&#x8F93;&#x5165;&#x8F93;&#x51FA;&#x90E8;&#x5206;&#x5E94;&#x8BE5;&#x662F;&#x4E00;&#x4E2A;&#x5BC4;&#x5B58;&#x5668;&#x7EC4;&#xFF0C;&#x5305;&#x62EC;&#x72B6;&#x6001;&#x5BC4;&#x5B58;&#x5668;&#x3001;&#x6307;&#x4EE4;&#x5BC4;&#x5B58;&#x5668;&#x3001;&#x6570;&#x636E;&#x5BC4;&#x5B58;&#x5668;&#x3002;&#x72B6;&#x6001;&#x5BC4;&#x5B58;&#x5668;&#x6807;&#x5FD7;&#x5FD9;&#x95F2;&#xFF0C;&#x6307;&#x4EE4;&#x5BC4;&#x5B58;&#x5668;&#x4E3A;&#x4ECE;cpu&#x83B7;&#x53D6;&#x6307;&#x4EE4;&#xFF0C;&#x6570;&#x636E;&#x5BC4;&#x5B58;&#x5668;&#x4F5C;&#x4E3A;io&#x63A7;&#x5236;&#x5668;&#x8F93;&#x5165;&#x8F93;&#x51FA;&#x7684;&#x901A;&#x9053;&#x3002;&#x6B64;&#x5916;&#xFF0C;io&#x6A21;&#x5757;&#x8FD8;&#x8981;&#x4E0E;cause&#x5BC4;&#x5B58;&#x5668;&#x76F8;&#x8FDE;&#xFF0C;&#x8F85;&#x52A9;&#x4E00;&#x5957;&#x4E2D;&#x65AD;&#x5C4F;&#x853D;&#x4E0E;&#x4F18;&#x5148;&#x7EA7;&#x903B;&#x8F91;&#xFF0C;&#x5B8C;&#x6210;&#x4E2D;&#x65AD;&#x5411;&#x91CF;&#x3002;IO&#x6A21;&#x5757;&#x4E2D;&#x7684;&#x4E2D;&#x65AD;&#x63A7;&#x5236;&#x53EF;&#x4EE5;&#x7EA7;&#x8054;&#x3002;</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;io&amp;#x548C;&amp;#x4E2D;&amp;#x65AD;&amp;#x7684;&amp;#x8BBE;&amp;#x8BA1;&amp;#x5B9A;&amp;#x578B;&amp;#xFF0C;&amp;#x6210;&amp;#x4E86;&amp;#x76EE;&amp;#x524D;&amp;#x6211;&amp;#x7684;cpu&amp;#x8BBE;&amp;#x8</summary>
      
    
    
    
    <category term="home brew computer system" scheme="https://gpthimble.github.io/categories/home-brew-computer-system/"/>
    
    
    <category term="development log" scheme="https://gpthimble.github.io/tags/development-log/"/>
    
  </entry>
  
  <entry>
    <title>cpu内部只采用一个时钟，对于不同速度的组件将采用clock enabler</title>
    <link href="https://gpthimble.github.io/cpu%E5%86%85%E9%83%A8%E5%8F%AA%E9%87%87%E7%94%A8%E4%B8%80%E4%B8%AA%E6%97%B6%E9%92%9F%EF%BC%8C%E5%AF%B9%E4%BA%8E%E4%B8%8D%E5%90%8C%E9%80%9F%E5%BA%A6%E7%9A%84%E7%BB%84%E4%BB%B6%E5%B0%86%E9%87%87%E7%94%A8clock-enabler/"/>
    <id>https://gpthimble.github.io/cpu%E5%86%85%E9%83%A8%E5%8F%AA%E9%87%87%E7%94%A8%E4%B8%80%E4%B8%AA%E6%97%B6%E9%92%9F%EF%BC%8C%E5%AF%B9%E4%BA%8E%E4%B8%8D%E5%90%8C%E9%80%9F%E5%BA%A6%E7%9A%84%E7%BB%84%E4%BB%B6%E5%B0%86%E9%87%87%E7%94%A8clock-enabler/</id>
    <published>2020-09-29T00:41:46.000Z</published>
    <updated>2020-09-30T03:06:23.000Z</updated>
    
    <content type="html"><![CDATA[<p>&#x51E0;&#x4E4E;&#x6240;&#x6709;&#x4EBA;&#x90FD;&#x4E0D;&#x5EFA;&#x8BAE;&#xFF0C;&#x5728;FPGA&#x4E2D;&#x4F7F;&#x7528;&#x591A;&#x4E8E;&#x4E00;&#x4E2A;&#x65F6;&#x949F;&#x3002;&#x5728;FPGA&#x4E2D;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x65F6;&#x949F;&#xFF0C;&#x6D89;&#x53CA;&#x5230;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x65F6;&#x949F;&#x57DF;&#xFF08;clock domain&#xFF09;&#x8FDB;&#x884C;&#x540C;&#x6B65;&#xFF0C;&#x6570;&#x636E;&#x7684;&#x540C;&#x6B65;&#x901A;&#x5E38;&#x4F7F;&#x7528;&#x4E24;&#x4E2A;&#x4E32;&#x8054;&#x7684;&#x89E6;&#x53D1;&#x5668;&#xFF0C;flag&#xFF08;&#x4E00;&#x4E2A;&#x5468;&#x671F;&#x7684;&#x4FE1;&#x53F7;&#xFF09;&#x901A;&#x5E38;&#x8F6C;&#x6362;&#x6210;&#x7535;&#x5E73;&#x8F6C;&#x6362;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5230;&#x53E6;&#x4E00;&#x4E2A;&#x57DF;&#x8FDB;&#x884C;&#x540C;&#x6B65;&#xFF0C;&#x8BE6;&#x7EC6;&#x7684;&#x8BBE;&#x8BA1;&#x53EF;&#x4EE5;&#x770B;<a href="https://www.fpga4fun.com/CrossClockDomain.html">&#x8FD9;&#x91CC;</a>&#x3002;</p><p>&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4E5F;&#x51B3;&#x5B9A;&#x5728;&#x6211;&#x7684;&#x8BBE;&#x8BA1;&#x4E2D;&#x64A4;&#x9500;&#x5F02;&#x6B65;&#x7684;&#x6E05;&#x96F6;&#x3001;&#x4E0B;&#x8FB9;&#x6CBF;&#x7684;&#x6E05;&#x96F6;&#x3002;&#x5728;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x901F;&#x5EA6;&#x7684;&#x7EC4;&#x4EF6;&#xFF0C;&#x5982;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;&#x4E2D;&#x7684;&#x53EF;&#x4EE5;&#x6682;&#x505C;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x8C03;&#x901F;&#x7684;cpu&#xFF0C;&#x91C7;&#x7528;&#x8BA1;&#x6570;&#x5668;&#x6FC0;&#x6D3B;&#x7684;clock enabler&#xFF0C;&#x8BE6;&#x7EC6;&#x8BBE;&#x8BA1;&#x53EF;&#x4EE5;&#x770B;<a href="https://zipcpu.com/blog/2017/06/02/generating-timing.html">&#x8FD9;&#x91CC;</a>&#x3002;&#x8FD9;&#x6837;&#x5BF9;&#x6211;&#x73B0;&#x6709;&#x7684;&#x8BBE;&#x8BA1;&#x7684;&#x4FEE;&#x6539;&#x4EA7;&#x751F;&#x4E86;&#x4E00;&#x5B9A;&#x7684;&#x5DE5;&#x4F5C;&#x91CF;&#x3002;</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&amp;#x51E0;&amp;#x4E4E;&amp;#x6240;&amp;#x6709;&amp;#x4EBA;&amp;#x90FD;&amp;#x4E0D;&amp;#x5EFA;&amp;#x8BAE;&amp;#xFF0C;&amp;#x5728;FPGA&amp;#x4E2D;&amp;#x4F7F;&amp;#x7528;&amp;#x591A;&amp;#x4E8E;&amp;#x4E</summary>
      
    
    
    
    <category term="home brew computer system" scheme="https://gpthimble.github.io/categories/home-brew-computer-system/"/>
    
    
    <category term="development log" scheme="https://gpthimble.github.io/tags/development-log/"/>
    
  </entry>
  
  <entry>
    <title>下一步的计划</title>
    <link href="https://gpthimble.github.io/%E4%B8%8B%E4%B8%80%E6%AD%A5%E7%9A%84%E8%AE%A1%E5%88%92/"/>
    <id>https://gpthimble.github.io/%E4%B8%8B%E4%B8%80%E6%AD%A5%E7%9A%84%E8%AE%A1%E5%88%92/</id>
    <published>2020-09-26T09:49:27.000Z</published>
    <updated>2020-09-27T01:52:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>&#x73B0;&#x5728;lcc&#x7684;&#x4EE3;&#x7801;&#x5DF2;&#x8BFB;&#x5B8C;&#xFF0C;&#x4E0B;&#x4E00;&#x6B65;&#x8981;&#x505A;&#x7684;&#x662F;soc&#x7684;&#x8BBE;&#x8BA1;&#x548C;&#x9A8C;&#x8BC1;&#xFF0C;&#x4EE5;&#x53CA;lcc&#x7684;&#x79FB;&#x690D;&#x3001;&#x6C47;&#x7F16;&#x5668;&#x7684;&#x79FB;&#x690D;&#x3002;<br>&#x5BF9;&#x4E8E;&#x6C47;&#x7F16;&#x5668;&#xFF0C;&#x6211;&#x51C6;&#x5907;&#x4F7F;&#x7528;<a href="https://github.com/hlorenzi/customasm">customasm</a>.<br>&#x5982;&#x679C;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x6C47;&#x7F16;&#x5668;&#xFF0C;&#x53EF;&#x80FD;&#x5728;&#x79FB;&#x690D;lcc&#x65F6;&#x9700;&#x8981;&#x4FEE;&#x6539;lcc&#x6A21;&#x677F;&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x4F2A;&#x6307;&#x4EE4;&#x5982;ld,lcomm&#x7B49;&#x3002;</p><p>&#x5BF9;&#x4E8E;soc&#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x8FD9;&#x4E9B;&#x5929;&#x4E00;&#x76F4;&#x5728;&#x601D;&#x8003;&#x7684;&#x95EE;&#x9898;&#x662F;&#x5F02;&#x6B65;&#x901A;&#x8BAF;&#x7684;&#x95EE;&#x9898;&#x3002;&#x6211;&#x6240;&#x5E0C;&#x671B;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;cpu&#x8FD0;&#x884C;&#x7684;&#x901F;&#x5EA6;&#x5E94;&#x8BE5;&#x662F;&#x53EF;&#x53D8;&#x7684;&#xFF0C;&#x751A;&#x81F3;&#x53EF;&#x4EE5;&#x662F;&#x5355;&#x6B65;&#x7684;&#x3002;&#x800C;&#x6211;&#x53C8;&#x5E0C;&#x671B;&#x80FD;&#x4F7F;&#x7528;de0 nao&#x677F;&#x8F7D;&#x7684;SDRAM&#xFF0C;&#x56E0;&#x6B64;&#x5185;&#x5B58;&#x63A7;&#x5236;&#x7CFB;&#x7EDF;&#x4E0E;cpu&#x7684;&#x901A;&#x8BAF;&#x4E00;&#x5B9A;&#x662F;&#x5F02;&#x6B65;&#x7684;&#x3002;&#x5F02;&#x6B65;&#x901A;&#x8BAF;&#x8981;&#x6709;ready&#x4FE1;&#x53F7;&#xFF0C;&#x7531;&#x4E8E;&#x6211;&#x5E0C;&#x671B;cpu&#x8FD0;&#x884C;&#x7684;&#x901F;&#x5EA6;&#x53EF;&#x53D8;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x9700;&#x8981;&#x5728;cache&#x63A7;&#x5236;&#x5668;&#x4E2D;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x53CC;&#x89E6;&#x53D1;&#x7684;&#x89E6;&#x53D1;&#x5668;&#xFF0C;&#x5728;ready&#x4FE1;&#x53F7;&#x53D8;&#x5316;&#x65F6;&#x8BB0;&#x5F55;&#x5E76;&#x4FDD;&#x6301;ready&#x4FE1;&#x53F7;&#xFF0C;&#x76F4;&#x81F3;cpu&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x5468;&#x671F;&#x5230;&#x6765;&#xFF0C;&#x7528;&#x8FD9;&#x4E2A;&#x4FE1;&#x53F7;&#x63A7;&#x5236;cpu&#x4E2D;cache&#x63A7;&#x5236;&#x5668;&#x548C;ram&#x63A7;&#x5236;&#x5668;&#x7684;&#x5F02;&#x6B65;&#x901A;&#x8BAF;&#x3002;</p><p>&#x7CFB;&#x7EDF;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x7684;&#x5212;&#x5206;&#xFF0C;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x9700;&#x8981;&#x786E;&#x5B9A;&#x7684;&#x8BBE;&#x8BA1;&#x3002;&#x76EE;&#x524D;&#x6211;&#x8BA1;&#x5212;&#x5C06;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x6309;&#x7167;| ROM | IO | RAM |&#x5212;&#x5206;&#xFF0C;&#x5177;&#x4F53;&#x5404;&#x533A;&#x57DF;&#x5C3A;&#x5BF8;&#x5C1A;&#x672A;&#x786E;&#x5B9A;&#x3002;&#x7CFB;&#x7EDF;cache&#x53EA;&#x5BF9;RAM&#x533A;&#x57DF;&#x6709;&#x6548;&#x3002;&#x76EE;&#x524D;&#x6211;&#x7684;&#x60F3;&#x6CD5;&#x662F;&#xFF0C;&#x6839;&#x636E;&#x6307;&#x4EE4;&#x548C;&#x6570;&#x636E;&#x9700;&#x6C42;&#x7684;&#x4E0D;&#x540C;&#xFF0C;&#x5728;cache&#x63A7;&#x5236;&#x5668;&#x4E0A;&#x589E;&#x52A0;&#x7247;&#x9009;&#x3001;&#x63A7;&#x5236;&#x4FE1;&#x53F7;mux&#xFF0C;&#x4EE5;&#x5B9E;&#x73B0;&#x4E0D;&#x540C;&#x533A;&#x57DF;&#x5BF9;cache&#x7684;&#x4E0D;&#x540C;&#x64CD;&#x4F5C;&#x3002;&#x5BF9;&#x4E8E;&#x6307;&#x4EE4;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x8BFB;&#x53D6;ROM&#x548C;RAM&#xFF0C;&#x6240;&#x4EE5;I cache&#x53EA;&#x9700;&#x8981;&#x5728;&#x539F;&#x6709;I cache&#x4E0A;&#x589E;&#x52A0;&#x5BF9;ROM&#x7684;&#x591A;&#x8DEF;&#x590D;&#x7528;&#xFF08;&#x76F4;&#x901A;&#xFF09;&#xFF0C;&#x7531;&#x4E8E;&#x8FD9;&#x4E2A;ROM&#x662F;&#x7528;&#x4F5C;bootloader&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x9700;&#x8981;&#x5F88;&#x5927;&#x4F53;&#x79EF;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x540C;&#x6B65;&#x7684;&#x65B9;&#x5F0F;&#x4E0E;I cache&#x94FE;&#x63A5;&#xFF0C;&#x56E0;&#x6B64;I cache&#x7684;&#x6539;&#x52A8;&#x5F88;&#x5C0F;&#x3002;&#x5BF9;&#x4E8E;&#x6570;&#x636E;&#xFF0C;&#x5219;&#x4E09;&#x4E2A;&#x533A;&#x57DF;&#x90FD;&#x9700;&#x8981;&#x8BFB;&#x53D6;&#x3002;<br>&#x663E;&#x7136;&#xFF0C;io&#x4E0E;cpu&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x8BAF;&#x4E5F;&#x662F;&#x5F02;&#x6B65;&#x7684;&#xFF0C;&#x4F46;&#x6211;&#x5C1A;&#x672A;&#x6784;&#x601D;&#x5B8C;&#x6BD5;&#x6574;&#x4E2A;io&#x63A7;&#x5236;&#x5668;&#x7684;&#x7ED3;&#x6784;&#xFF0C;&#x56E0;&#x6B64;io&#x63A7;&#x5236;&#x5668;&#x7684;&#x8BBE;&#x8BA1;&#x5E94;&#x8BE5;&#x662F;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x5DE5;&#x4F5C;&#x4E4B;&#x4E00;&#x3002;</p><p>IO&#x63A7;&#x5236;&#x5668;&#x5E94;&#x8BE5;&#x5305;&#x62EC;&#x4E00;&#x4E9B;&#x603B;&#x7EBF;&#xFF08;I2C&#xFF0C;SPI&#xFF0C;etc&#xFF09;&#xFF0C;&#x4E00;&#x4E9B;&#x901A;&#x8BAF;&#x7AEF;&#x53E3;&#xFF08;GPIO&#xFF0C;Uart&#xFF0C;etc&#xFF09;&#xFF0C;&#x4EE5;&#x53CA;&#x5411;&#x91CF;&#x4E2D;&#x65AD;&#x548C;&#x5F02;&#x6B65;&#x901A;&#x8BAF;&#x7684;&#x652F;&#x6301;&#x3002;&#x9700;&#x8981;&#x4ED4;&#x7EC6;&#x8003;&#x8651;&#x3002;</p><p>&#x6211;&#x76EE;&#x524D;&#x5DF2;&#x6709;cpu&#x90E8;&#x5206;&#x7684;Verilog&#x4EE3;&#x7801;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x90E8;&#x5206;&#x4EE3;&#x7801;&#x7F3A;&#x4E4F;&#x6D4B;&#x8BD5;&#xFF0C;&#x6CA1;&#x6709;&#x7CBE;&#x786E;&#x4E2D;&#x65AD;&#x652F;&#x6301;&#xFF0C;&#x6CA1;&#x6709;&#x4E0E;cache&#x96C6;&#x6210;&#xFF0C;&#x800C;&#x4E14;&#x4E00;&#x4E9B;&#x6307;&#x4EE4;&#x8FD8;&#x9700;&#x8981;&#x4FEE;&#x6539;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;&#x6211;&#x6253;&#x7B97;&#x5220;&#x9664;&#x4E58;&#x6CD5;&#x548C;&#x9664;&#x6CD5;&#x7684;&#x786C;&#x4EF6;&#x652F;&#x6301;&#xFF0C;&#x539F;&#x56E0;&#x662F;&#x539F;&#x6709;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#x5BF9;&#x4E58;&#x6CD5;&#x548C;&#x9664;&#x6CD5;&#x7684;&#x786C;&#x4EF6;&#x652F;&#x6301;&#x6765;&#x81EA;Altera&#x7684;IP&#xFF0C;&#x8FD9;&#x4E0E;&#x672C;&#x9879;&#x76EE;&#x7684;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;&#x51B2;&#x7A81;&#xFF0C;&#x800C;&#x4E14;&#x5728;sparc&#x5E73;&#x53F0;&#x7684;lcc&#x540E;&#x7AEF;&#x4E2D;&#xFF0C;&#x6709;&#x4F7F;&#x7528;&#x8F6F;&#x4EF6;&#x652F;&#x6301;&#x4E58;&#x6CD5;&#x9664;&#x6CD5;&#x7684;&#x53C2;&#x8003;&#x6837;&#x4F8B;&#xFF1B;&#x6211;&#x8FD8;&#x9700;&#x8981;&#x8003;&#x8651;&#x662F;&#x5426;&#x589E;&#x52A0;&#x4E0D;&#x540C;&#x957F;&#x5EA6;&#x7684;&#x53D6;&#x6570;&#x64CD;&#x4F5C;&#xFF0C;&#x8003;&#x8651;&#x5982;&#x679C;&#x5728;lcc&#x79FB;&#x690D;&#x8FC7;&#x7A0B;&#x4E2D;&#x5C06;&#x6240;&#x6709;&#x6574;&#x6570;&#x7C7B;&#x578B;&#x7684;&#x5C3A;&#x5BF8;&#x6216;&#x8005;&#x5BF9;&#x9F50;&#x90FD;&#x8BBE;&#x7F6E;&#x4E3A;4&#x5B57;&#x8282;&#x4F1A;&#x600E;&#x6837;&#x3002;</p><p>&#x4F46;&#x662F;&#x8FD9;&#x4E9B;&#x5DE5;&#x4F5C;&#x7684;&#x987A;&#x5E8F;&#x5F88;&#x96BE;&#x786E;&#x5B9A;&#xFF0C;&#x8FD9;&#x662F;&#x6211;&#x9996;&#x5148;&#x8981;&#x8003;&#x8651;&#x7684;&#x95EE;&#x9898;&#x3002;</p><p>&#x76EE;&#x524D;&#x6211;&#x60F3;&#x5230;&#x7684;&#x5408;&#x7406;&#x7684;&#x987A;&#x5E8F;&#x662F;&#xFF1A;</p><ul><li>&#x8003;&#x8651;&#x662F;&#x5426;&#x589E;&#x52A0;&#x4E0D;&#x540C;&#x957F;&#x5EA6;&#x7684;&#x53D6;&#x6570;&#x64CD;&#x4F5C;</li><li>&#x56DE;&#x987E;&#x5DF2;&#x6709;&#x7684;cpu&#x4EE3;&#x7801;&#xFF0C;&#x5206;&#x6790;&#x90A3;&#x4E9B;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x4E0E;cache&#x3001;IO&#x3001;&#x4E2D;&#x65AD;&#x7B49;&#x72EC;&#x7ACB;&#xFF0C;&#x5E76;&#x5BF9;&#x8FD9;&#x4E9B;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#x3002;</li><li>&#x5B9A;&#x4E49;&#x5B58;&#x50A8;&#x63A7;&#x5236;&#x548C;io&#x63A7;&#x5236;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x4E0E;cpu&#x5BF9;&#x63A5;&#xFF0C;&#x6D4B;&#x8BD5;cpu&#x7684;&#x4E2D;&#x65AD;</li><li>&#x8BBE;&#x8BA1;&#x5B58;&#x50A8;&#x63A7;&#x5236;</li><li>&#x8BBE;&#x8BA1;io&#x63A7;&#x5236;</li><li>&#x5DE5;&#x5177;&#x94FE;&#x7684;&#x79FB;&#x690D;</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&amp;#x73B0;&amp;#x5728;lcc&amp;#x7684;&amp;#x4EE3;&amp;#x7801;&amp;#x5DF2;&amp;#x8BFB;&amp;#x5B8C;&amp;#xFF0C;&amp;#x4E0B;&amp;#x4E00;&amp;#x6B65;&amp;#x8981;&amp;#x505A;&amp;#x7684;&amp;#x662F;soc&amp;#x</summary>
      
    
    
    
    <category term="home brew computer system" scheme="https://gpthimble.github.io/categories/home-brew-computer-system/"/>
    
    
    <category term="development log" scheme="https://gpthimble.github.io/tags/development-log/"/>
    
    <category term="computer architecture" scheme="https://gpthimble.github.io/tags/computer-architecture/"/>
    
  </entry>
  
  <entry>
    <title>读完LCC完整源代码</title>
    <link href="https://gpthimble.github.io/%E8%AF%BB%E5%AE%8CLCC%E5%AE%8C%E6%95%B4%E6%BA%90%E4%BB%A3%E7%A0%81/"/>
    <id>https://gpthimble.github.io/%E8%AF%BB%E5%AE%8CLCC%E5%AE%8C%E6%95%B4%E6%BA%90%E4%BB%A3%E7%A0%81/</id>
    <published>2020-09-26T07:31:08.000Z</published>
    <updated>2020-09-26T09:53:44.000Z</updated>
    
    <content type="html"><![CDATA[<p>&#x7ECF;&#x8FC7;&#x4E86;&#x51E0;&#x4E2A;&#x6708;&#xFF0C;&#x7EC8;&#x4E8E;&#x5B8C;&#x6574;&#x7684;&#x8BFB;&#x5B8C;&#x4E86;lcc 3.6 &#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x8FD9;&#x4E00;&#x9636;&#x6BB5;&#x5DE5;&#x4F5C;&#x57FA;&#x672C;&#x544A;&#x4E00;&#x6BB5;&#x843D;&#x3002;&#x5BF9;&#x4E8E;&#x6211;&#x6765;&#x8BF4;&#xFF0C;lcc&#x662F;&#x4E00;&#x4E2A;&#x5341;&#x5206;&#x590D;&#x6742;&#x7684;&#x8F6F;&#x4EF6;&#xFF0C;&#x867D;&#x7136;&#x6211;&#x80FD;&#x611F;&#x53D7;&#x5230;&#x4F5C;&#x8005;&#x5728;&#x89E3;&#x91CA;&#x5176;&#x5B9E;&#x73B0;&#x6240;&#x7528;&#x7684;&#x6781;&#x5927;&#x52AA;&#x529B;&#xFF0C;&#x4F46;&#x7406;&#x89E3;&#x8D77;&#x6765;&#x4ECD;&#x7136;&#x5341;&#x5206;&#x56F0;&#x96BE;&#x3002;&#x4F46;&#x662F;&#x5F53;&#x6211;&#x5B8C;&#x6574;&#x7684;&#x770B;&#x5B8C;lcc&#x7684;&#x4EE3;&#x7801;&#x5305;&#x62EC;&#x5176;&#x540E;&#x7AEF;&#x540E;&#xFF0C;&#x5F97;&#x5230;&#x7684;&#x6536;&#x83B7;&#x786E;&#x5B9E;&#x5F88;&#x5927;&#x3002;&#x901A;&#x8FC7;&#x9605;&#x8BFB;&#xFF0C;&#x57FA;&#x672C;&#x53EF;&#x4EE5;&#x786E;&#x5B9A;&#x5BF9;&#xFF0C;&#x4E8E;&#x6211;&#x6765;&#x8BF4;&#xFF0C;lcc&#x7684;&#x79FB;&#x690D;&#x5DE5;&#x4F5C;&#x6280;&#x672F;&#x4E0A;&#x662F;&#x53EF;&#x884C;&#x7684;&#x3002;</p><h1 id="LCC&#x7684;&#x7ED3;&#x6784;"><a href="#LCC&#x7684;&#x7ED3;&#x6784;" class="headerlink" title="LCC&#x7684;&#x7ED3;&#x6784;"></a>LCC&#x7684;&#x7ED3;&#x6784;</h1><p>&#x5148;&#x8C08;&#x4E00;&#x4E0B;lcc&#x7684;&#x7ED3;&#x6784;&#x3002;&#x539F;&#x4E66;&#x4E2D;&#x7684;&#x53D9;&#x8FF0;&#x65B9;&#x6CD5;&#xFF0C;&#x66F4;&#x591A;&#x7684;&#x662F;&#x4ECE;&#x529F;&#x80FD;&#x6A21;&#x5757;&#x7684;&#x89D2;&#x5EA6;&#x8FDB;&#x884C;&#x53D9;&#x8FF0;&#x7684;&#xFF0C;&#x8BE6;&#x7EC6;&#x7684;&#x63CF;&#x8FF0;&#x4E86;&#x6BCF;&#x4E00;&#x4E2A;&#x6A21;&#x5757;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x4F46;&#x662F;&#x4ECE;&#x7EB5;&#x6DF1;&#x7684;&#x89D2;&#x5EA6;&#x6765;&#x770B;&#xFF0C;&#x7F3A;&#x4E4F;&#x5BF9;&#x6A21;&#x5757;&#x4E4B;&#x95F4;&#x76F8;&#x4E92;&#x8C03;&#x7528;&#x76F8;&#x4E92;&#x914D;&#x5408;&#x7684;&#x63CF;&#x8FF0;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x9605;&#x8BFB;&#x65F6;&#x7279;&#x522B;&#x7559;&#x610F;&#x6574;&#x4E2A;&#x7F16;&#x8BD1;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x8FC7;&#x7A0B;&#x4E2D;&#x51FD;&#x6570;&#x4E4B;&#x95F4;&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x624D;&#x80FD;&#x628A;&#x63E1;&#x8FD9;&#x4E2A;&#x590D;&#x6742;&#x7684;&#x7F16;&#x8BD1;&#x7A0B;&#x5E8F;&#x7684;&#x6574;&#x4F53;&#x8109;&#x7EDC;&#x3002;</p><p>&#x5982;&#x679C;&#x4ECE;&#x4F20;&#x7EDF;&#x7684;&#x524D;&#x7AEF;-&#x540E;&#x7AEF;&#x89D2;&#x5EA6;&#x53BB;&#x770B;&#x8FD9;&#x4E2A;&#x7F16;&#x8BD1;&#x5668;&#xFF0C;&#x5F88;&#x96BE;&#x53BB;&#x7406;&#x89E3;&#x3002;&#x6211;&#x8BA4;&#x4E3A;&#x524D;&#x7AEF;-&#x540E;&#x7AEF;&#x8FD9;&#x6837;&#x7684;&#x5206;&#x6CD5;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x4ECE;&#x529F;&#x80FD;&#x7684;&#x903B;&#x8F91;&#x5C42;&#x9762;&#x53BB;&#x8003;&#x8651;&#x7684;&#x3002;&#x867D;&#x7136;&#x6574;&#x4E2A;lcc&#x786E;&#x5B9E;&#x5728;&#x5B9E;&#x73B0;&#x4E0A;&#x533A;&#x5206;&#x4E86;&#x524D;&#x7AEF;&#x548C;&#x540E;&#x7AEF;&#xFF0C;&#x4F46;&#x662F;&#x5728;&#x8FD0;&#x884C;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x524D;&#x7AEF;&#x548C;&#x540E;&#x7AEF;&#x7684;&#x4EE3;&#x7801;&#x59CB;&#x7EC8;&#x5728;&#x76F8;&#x4E92;&#x914D;&#x5408;&#xFF0C;&#x96BE;&#x4EE5;&#x5728;&#x8FD0;&#x884C;&#x8FC7;&#x7A0B;&#x660E;&#x786E;&#x5206;&#x79BB;&#x3002;&#x5728;&#x6211;&#x5C1A;&#x672A;&#x610F;&#x8BC6;&#x5230;&#x8FD9;&#x4E00;&#x70B9;&#x65F6;&#xFF0C;&#x9605;&#x8BFB;&#x4EE3;&#x7801;&#x57FA;&#x672C;&#x662F;&#x5728;&#x5173;&#x6CE8;&#x67D0;&#x4E2A;&#x6A21;&#x5757;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x6BD4;&#x5982;&#x8BED;&#x6CD5;&#x5206;&#x6790;&#x3002;&#x800C;&#x8FD9;&#x4E9B;&#x6A21;&#x5757;&#x5982;&#x8BED;&#x6CD5;&#x8BED;&#x6CD5;&#x5206;&#x6790;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x8FD0;&#x884C;&#x8FC7;&#x7A0B;&#x4E2D;&#x6BD4;&#x8F83;&#x6DF1;&#x5F97;&#x4E00;&#x5C42;&#xFF0C;&#x4F46;&#x4ECE;&#x8FD9;&#x4E2A;&#x89D2;&#x5EA6;&#xFF0C;&#x5F88;&#x96BE;&#x770B;&#x5230;&#x9605;&#x8BFB;&#x7F16;&#x8BD1;&#x5668;&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4F55;&#x5E26;&#x7ED9;&#x4EBA;&#x4E0E;&#x4EC5;&#x4E0A;&#x7F16;&#x8BD1;&#x539F;&#x7406;&#x8BFE;&#x7A0B;&#x4E0D;&#x540C;&#x7684;&#x597D;&#x5904;&#xFF0C;&#x586B;&#x8865;&#x7406;&#x8BBA;&#x548C;&#x5B9E;&#x8DF5;&#x4E4B;&#x95F4;&#x7684;&#x9E3F;&#x6C9F;&#x3002;<br>&#x56E0;&#x4E3A;&#x8FD9;&#x4E9B;&#x4E00;&#x4E2A;&#x4E00;&#x4E2A;&#x7684;&#x6A21;&#x5757;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x8BED;&#x6CD5;&#x5206;&#x6790;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x4E0E;&#x7F16;&#x8BD1;&#x539F;&#x7406;&#x7684;&#x8BFE;&#x7A0B;&#x5185;&#x5BB9;&#x5F88;&#x76F8;&#x4F3C;&#xFF0C;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x7F16;&#x8BD1;&#x539F;&#x7406;&#x8BFE;&#x7A0B;&#x4E0E;&#x8BED;&#x6CD5;&#x5206;&#x6790;&#x8FD9;&#x90E8;&#x5206;&#x7684;&#x5B9E;&#x73B0;&#x91CD;&#x53E0;&#x5F88;&#x5927;&#x3002;</p><p>&#x4ECE;&#x8BED;&#x6CD5;&#x5206;&#x6790;&#x5230;&#x8BED;&#x4E49;&#x5206;&#x6790;&#xFF0C;&#x8FD9;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#x5C31;&#x5F00;&#x59CB;&#x663E;&#x73B0;&#x4E0E;&#x8BA1;&#x7B97;&#x673A;&#x8BFE;&#x7A0B;&#x4E4B;&#x95F4;&#x7684;&#x533A;&#x522B;&#x4E86;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x5B9E;&#x73B0;&#x4E86;ANSI C&#x5B8C;&#x6574;&#x7684;&#x8BED;&#x4E49;&#xFF0C;&#x9605;&#x8BFB;&#x8FD9;&#x90E8;&#x5206;&#xFF0C;&#x66F4;&#x50CF;&#x662F;&#x9605;&#x8BFB;C&#x8BED;&#x8A00;&#x6807;&#x51C6;&#xFF0C;&#x8FD9;&#x91CC;&#x9762;&#x53EF;&#x4EE5;&#x63D0;&#x70BC;&#x51FA;&#x4E00;&#x4E9B;&#x8BDD;&#x9898;&#x8FDB;&#x884C;&#x6DF1;&#x5165;&#x8BA8;&#x8BBA;&#xFF0C;&#x5982;C&#x8BED;&#x8A00;&#x4E2D;&#x7684;&#x7A7A;&#x6307;&#x9488;&#x5B9A;&#x4E49;&#xFF0C;&#x5F3A;&#x5236;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#xFF0C;&#x51FD;&#x6570;&#x8C03;&#x7528;&#xFF0C;&#x53EF;&#x53D8;&#x53C2;&#x6570;&#x51FD;&#x6570;&#xFF0C;&#x53C2;&#x6570;&#x7684;&#x4F30;&#x503C;&#x987A;&#x5E8F;&#xFF0C;&#x7ED3;&#x6784;&#x4F53;&#x4E2D;&#x6570;&#x636E;&#x7684;&#x5BF9;&#x9F50;&#xFF0C;C&#x8BED;&#x8A00;&#x4E2D;&#x590D;&#x6742;&#x7684;&#x58F0;&#x660E;&#x7B49;&#x7B49;&#x3002;&#x4ECE;&#x7F16;&#x8BD1;&#x5668;&#x89D2;&#x5EA6;&#x770B;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#xFF0C;&#x7684;&#x786E;&#x7ED9;&#x4EBA;&#x8033;&#x76EE;&#x4E00;&#x65B0;&#x7684;&#x611F;&#x89C9;&#xFF0C;&#x4F46;&#x662F;&#x4EC5;&#x4EC5;&#x8BFB;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x4ECD;&#x7136;&#x4F1A;&#x6709;&#x8BB8;&#x591A;&#x7591;&#x60D1;&#x5C1A;&#x672A;&#x88AB;&#x89E3;&#x91CA;&#x3002;&#x4F8B;&#x5982;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x3001;&#x53C2;&#x6570;&#x4F20;&#x9012;&#xFF0C;&#x8FD9;&#x4E9B;&#x90FD;&#x9700;&#x8981;&#x548C;&#x8BA1;&#x7B97;&#x5E73;&#x53F0;&#x914D;&#x5408;&#xFF0C;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#xFF0C;&#x8FD8;&#x8981;&#x7EE7;&#x7EED;&#x6DF1;&#x5165;&#x4E86;&#x89E3;&#x3002;&#x6211;&#x8BFB;&#x5230;&#x8FD9;&#x91CC;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6700;&#x5927;&#x7684;&#x7591;&#x60D1;&#x5C31;&#x662F;&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x662F;&#x5982;&#x4F55;&#x548C;&#x5404;&#x4E2A;&#x6807;&#x8BC6;&#x7B26;&#x76F8;&#x5173;&#x8054;&#x7684;&#xFF0C;&#x5185;&#x5B58;&#x7684;&#x5730;&#x5740;&#x662F;&#x5982;&#x4F55;&#x548C;&#x53D8;&#x91CF;&#x540D;&#x76F8;&#x5173;&#x8054;&#x7684;&#x3002;</p><p>&#x7EE7;&#x7EED;&#x6DF1;&#x5165;&#x4E0B;&#x53BB;&#xFF0C;lcc&#x7684;&#x7ED3;&#x6784;&#x5C31;&#x6E10;&#x6E10;&#x6D6E;&#x51FA;&#x6C34;&#x9762;&#x3002;&#x6309;&#x7167;c&#x8BED;&#x8A00;&#x7684;&#x6587;&#x6CD5;&#xFF0C;&#x4E00;&#x4E2A;translation unit&#x662F;c&#x8BED;&#x8A00;&#x7A0B;&#x5E8F;&#x7684;&#x57FA;&#x672C;&#x5904;&#x7406;&#x5355;&#x5143;&#xFF0C;translation unit &#x5305;&#x62EC;&#x58F0;&#x660E;&#xFF0C;&#x53EF;&#x4EE5;&#x662F;&#x53D8;&#x91CF;&#x6216;&#x8005;&#x662F;&#x51FD;&#x6570;&#x7684;&#x58F0;&#x660E;&#xFF0C;&#x4E00;&#x4E2A;c&#x8BED;&#x8A00;&#x6587;&#x4EF6;&#x53EF;&#x4EE5;&#x5305;&#x62EC;&#x82E5;&#x5E72;translation unit&#x3002;&#x53D8;&#x91CF;&#x7684;&#x58F0;&#x660E;&#xFF0C;&#x53EA;&#x662F;&#x5904;&#x7406;&#x4E86;&#x6807;&#x8BC6;&#x7B26;&#x3001;&#x7C7B;&#x578B;&#x3001;&#x503C;&#x5728;&#x7F16;&#x8BD1;&#x5668;&#x5185;&#x7684;&#x5185;&#x90E8;&#x8868;&#x793A;&#x3002;&#x5BF9;&#x4E8E;&#x53D8;&#x91CF;&#x7684;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x4E0D;&#x4EA7;&#x751F;&#x4EE3;&#x7801;&#xFF0C;&#x800C;&#x662F;&#x76F4;&#x63A5;&#x5C06;&#x7B26;&#x53F7;&#x548C;&#x503C;&#x76F8;&#x4E92;&#x5BF9;&#x5E94;&#x8D77;&#x6765;&#x3002;&#x53EA;&#x6709;&#x8FDB;&#x884C;&#x51FD;&#x6570;&#x5B9A;&#x4E49;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x624D;&#x4F1A;&#x751F;&#x6210;&#x4EE3;&#x7801;&#x3002;&#x6240;&#x4EE5;&#x5206;&#x6790;lcc&#x7684;&#x6574;&#x4F53;&#x8109;&#x7EDC;&#xFF0C;&#x9700;&#x8981;&#x77E5;&#x9053;&#x4E66;&#x4E2D;&#x8BA8;&#x8BBA;&#x7684;&#x5404;&#x79CD;&#x529F;&#x80FD;&#x6A21;&#x5757;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x4EE5;&#x51FD;&#x6570;&#x5B9A;&#x4E49;&#x4E3A;&#x5355;&#x5143;&#xFF0C;&#x5F80;&#x590D;&#x8FDB;&#x884C;&#x8C03;&#x7528;&#x3002;&#x6240;&#x4EE5;&#x5206;&#x6790;&#x5E94;&#x4ECE;&#x51FD;&#x6570;&#x5B9A;&#x4E49;&#x5F00;&#x59CB;&#xFF0C;&#x9010;&#x6B65;&#x6DF1;&#x5165;&#x3002;&#x4FBF;&#x53EF;&#x7406;&#x89E3;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;c&#x8BED;&#x8A00;&#x7A0B;&#x5E8F;&#x662F;&#x5982;&#x4F55;&#x88AB;lcc&#x5904;&#x7406;&#x7684;&#x3002;</p><p>&#x5904;&#x7406;&#x51FD;&#x6570;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;funcdefn&#x7B2C;&#x4E00;&#x90E8;&#x5206;&#x5904;&#x7406;&#x8981;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x53C2;&#x6570;&#x5217;&#x8868;&#xFF0C;&#x5904;&#x7406;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x548C;&#x53C2;&#x6570;&#xFF08;&#x4E3B;&#x8981;&#x662F;&#x901A;&#x8FC7;&#x540E;&#x7AEF;&#x6307;&#x5B9A;&#x540D;&#x5B57;&#xFF0C;&#x5C06;&#x540D;&#x5B57;&#x6307;&#x5B9A;&#x4E3A;&#x76F8;&#x5BF9;&#x4E8E;&#x6808;&#x7684;offset&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x5BF9;&#x51FD;&#x6570;&#x5B9A;&#x4E49;&#x7684;compound statement&#x8FDB;&#x884C;&#x8BED;&#x6CD5;&#x8BED;&#x4E49;&#x5206;&#x6790;&#xFF0C;&#x4E00;&#x8FB9;&#x5206;&#x6790;&#xFF0C;&#x4E00;&#x8FB9;&#x751F;&#x6210;&#x4E2D;&#x95F4;&#x8BED;&#x8A00;&#xFF08;&#x68EE;&#x6797;&#x5F62;&#x5F0F;&#x7684;&#x4E2D;&#x95F4;&#x8BED;&#x8A00;&#xFF09;&#xFF0C;&#x751F;&#x6210;&#x4E2D;&#x95F4;&#x8BED;&#x8A00;&#x7684;&#x8FC7;&#x7A0B;&#x52A0;&#x4EE5;&#x4F18;&#x5316;&#xFF08;&#x5982;&#x6D88;&#x9664;&#x516C;&#x5171;&#x5B50;&#x5F0F;&#xFF0C;&#x5E38;&#x91CF;&#x6298;&#x53E0;&#xFF09;&#x3002;&#x7136;&#x540E;&#x8C03;&#x7528;&#x540E;&#x7AEF;function&#x51FD;&#x6570;&#xFF0C;&#x5BF9;&#x4E2D;&#x95F4;&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;</p><p>function&#x51FD;&#x6570;&#xFF0C;&#x9996;&#x5148;&#x6839;&#x636E;funcdefn&#x4F20;&#x9012;&#x8FC7;&#x6765;&#x7684;&#x53C2;&#x6570;&#x548C;&#x5C40;&#x90E8;&#x53D8;&#x91CF;offset&#x8BA1;&#x7B97;&#x6808;&#x504F;&#x79FB;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#xFF0C;&#x5219;&#x4E3A;&#x751F;&#x6210;&#x590D;&#x5236;&#x53C2;&#x6570;&#x7684;&#x4EE3;&#x7801;&#xFF08;&#x5982;&#x539F;&#x6765;&#x53C2;&#x6570;&#x7531;&#x5BC4;&#x5B58;&#x5668;&#x4F20;&#x5165;&#xFF0C;&#x9700;&#x8981;&#x7528;&#x53E6;&#x4E00;&#x4E2A;&#x5BC4;&#x5B58;&#x5668;&#x6216;&#x653E;&#x5165;&#x6808;&#x4E2D;&#xFF09;&#xFF0C;&#x4E3A;&#x751F;&#x6210;&#x4FDD;&#x5B58;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x7EA6;&#x5B9A;&#x4E2D;&#x8981;&#x4FDD;&#x5B58;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x4EE3;&#x7801;&#x505A;&#x51C6;&#x5907;&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528;gencode&#xFF0C;&#x5BF9;&#x4E2D;&#x95F4;&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;</p><p>gencode&#x9996;&#x5148;&#x751F;&#x6210;&#x5BF9;&#x53C2;&#x6570;&#x8FDB;&#x884C;&#x590D;&#x5236;&#x7684;&#x4E2D;&#x95F4;&#x8BED;&#x8A00;&#xFF0C;&#x7136;&#x540E;&#x6839;&#x636E;&#x4E2D;&#x95F4;&#x4EE3;&#x7801;&#x68EE;&#x6797;&#x4E2D;&#x6811;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x8C03;&#x7528;&#x76F8;&#x5E94;&#x7684;&#x540E;&#x7AEF;&#x51FD;&#x6570;&#x3002;Blockbeg&#x5BF9;&#x4E8E;compound statement&#x4E2D;&#x7684;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x4EE5;for&#x5FAA;&#x73AF;&#x7684;&#x5F62;&#x5F0F;&#x9010;&#x4E2A;&#x8C03;&#x7528;local&#xFF0C;&#x5206;&#x914D;&#x5BC4;&#x5B58;&#x5668;&#x53D8;&#x91CF;&#x6216;&#x5728;&#x6808;&#x4E2D;&#x5212;&#x5206;&#x7A7A;&#x95F4;&#xFF1B;Local&#xFF0C;address&#x8282;&#x70B9;&#x4E13;&#x95E8;&#x5904;&#x7406;&#x4E34;&#x65F6;&#x751F;&#x6210;&#x7684;local&#x53D8;&#x91CF;&#x3002;gen&#x8282;&#x70B9;&#x662F;&#x91CD;&#x4E2D;&#x4E4B;&#x91CD;&#xFF0C;&#x8D1F;&#x8D23;&#x751F;&#x6210;&#x4E3B;&#x8981;&#x7684;&#x4EE3;&#x7801;&#x3002;</p><p>gencode&#x2014;&gt;gen,&#x5904;&#x7406;&#x6811;&#x72B6;&#x7684;&#x4E2D;&#x95F4;&#x8BED;&#x8A00;&#x3002;&#x8FD9;&#x90E8;&#x5206;&#x4E66;&#x4E2D;&#x8868;13.1&#x63CF;&#x8FF0;&#x7684;&#x8F83;&#x4E3A;&#x6E05;&#x6670;&#xFF0C;prelabel&#x5904;&#x7406;&#x5DF2;&#x7ECF;&#x786E;&#x5B9A;&#x4E86;&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x8282;&#x70B9;&#x7684;target&#xFF0C;_label&#x5728;&#x6811;&#x4E0A;&#x7528;&#x6811;&#x6587;&#x6CD5;&#x4E0E;&#x540E;&#x7AEF;&#x6A21;&#x677F;&#x8FDB;&#x884C;&#x5339;&#x914D;&#xFF0C;reduce&#x9009;&#x62E9;&#x6700;&#x597D;&#x7684;&#x6307;&#x4EE4;&#x8F93;&#x51FA;&#x3002;prune&#x5220;&#x53BB;&#x4E00;&#x4E9B;&#x4E0D;&#x751F;&#x6210;&#x6307;&#x4EE4;&#x7684;&#x5B50;&#x8282;&#x70B9;&#xFF0C;linerize&#x5BF9;&#x6307;&#x4EE4;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#xFF0C;&#x6700;&#x540E;ralloc&#x5BF9;&#x9700;&#x8981;&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x8282;&#x70B9;&#x5206;&#x914D;&#x5BC4;&#x5B58;&#x5668;&#x3002;</p><p>&#x7136;&#x540E;function &#x51FD;&#x6570;&#x5F00;&#x59CB;&#x771F;&#x6B63;&#x751F;&#x6210;&#x4EE3;&#x7801;&#xFF0C;&#x9996;&#x5148;&#x5148;&#x8F93;&#x51FA;&#x51FD;&#x6570;&#x540D;&#x4F5C;&#x4E3A;label&#xFF0C;&#x4F5C;&#x4E3A;&#x51FD;&#x6570;&#x7684;&#x5165;&#x53E3;&#xFF0C;&#x7136;&#x540E;&#x8BA1;&#x7B97;framesize&#x548C;sp&#xFF0C;&#x5E76;&#x5C06;sp&#x79FB;&#x52A8;&#x7684;&#x6307;&#x4EE4;&#x8F93;&#x51FA;&#xFF08;&#x5212;&#x5206;&#x6808;&#x7A7A;&#x95F4;&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x8F93;&#x51FA;&#x4FDD;&#x5B58;&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x662F;&#x79FB;&#x52A8;&#x53C2;&#x6570;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x8FD9;&#x4E9B;&#x5DE5;&#x4F5C;&#x505A;&#x5B8C;&#xFF0C;function&#x8C03;&#x7528;emitcode&#x51FD;&#x6570;&#xFF0C;&#x751F;&#x6210;&#x51FD;&#x6570;&#x4E2D;&#x7684;&#x8BED;&#x53E5;&#x751F;&#x6210;&#x7684;&#x4EE3;&#x7801;&#xFF08;&#x4ECE;&#x5DF2;&#x7ECF;&#x88AB;&#x6807;&#x8BB0;&#x4FEE;&#x51CF;&#x7684;&#x4E2D;&#x95F4;&#x8BED;&#x8A00;&#x6811;&#x4E2D;&#xFF0C;&#x6309;&#x6A21;&#x677F;&#x751F;&#x6210;&#x6C47;&#x7F16;&#x6307;&#x4EE4;&#xFF09;&#x3002;&#x6700;&#x540E;&#x751F;&#x6210;&#x51FD;&#x6570;&#x7684;&#x51FA;&#x53E3;&#xFF0C;&#x5305;&#x62EC;&#x6062;&#x590D;&#x4FDD;&#x5B58;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x6808;&#x5F39;&#x51FA;&#xFF0C;&#x8DF3;&#x8F6C;&#x8FD4;&#x56DE;&#x6307;&#x4EE4;&#x3002;</p><h1 id="&#x53D8;&#x91CF;&#x7684;&#x6807;&#x8BC6;&#x7B26;&#x548C;&#x503C;"><a href="#&#x53D8;&#x91CF;&#x7684;&#x6807;&#x8BC6;&#x7B26;&#x548C;&#x503C;" class="headerlink" title="&#x53D8;&#x91CF;&#x7684;&#x6807;&#x8BC6;&#x7B26;&#x548C;&#x503C;"></a>&#x53D8;&#x91CF;&#x7684;&#x6807;&#x8BC6;&#x7B26;&#x548C;&#x503C;</h1><p>&#x6211;&#x5728;&#x9605;&#x8BFB;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5341;&#x5206;&#x5173;&#x6CE8;&#x6807;&#x8BC6;&#x7B26;&#x548C;&#x503C;&#x662F;&#x5982;&#x4F55;&#x5173;&#x8054;&#x7684;&#x3002;&#x5B9E;&#x9645;&#x4E0A;lcc&#x5C06;&#x4E8E;C&#x8BED;&#x8A00;&#x7684;&#x53D8;&#x91CF;&#x540D;&#xFF0C;&#x5904;&#x7406;&#x4E3A;&#x5728;&#x6570;&#x636E;&#x6BB5;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x6807;&#x7B7E;&#x3002;&#x5BF9;&#x4E8E;&#x672A;&#x521D;&#x59CB;&#x5316;&#x7684;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#xFF0C;lcc&#x5C06;&#x53D8;&#x91CF;&#x540D;&#x6807;&#x7B7E;&#x653E;&#x5165;bss&#x6BB5;&#xFF1B;&#x5BF9;&#x4E8E;&#x521D;&#x59CB;&#x5316;&#x7684;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#xFF0C;lcc&#x6839;&#x636E;&#x60C5;&#x51B5;&#x5C06;&#x3010;&#x53D8;&#x91CF;&#x540D;&#x6807;&#x7B7E;&#xFF1A;&#x503C;&#x3011;&#x5BF9;&#x653E;&#x5165;LIT&#xFF08;read only&#xFF09;&#x6216;data&#x6BB5;&#xFF0C;&#x5B9E;&#x9645;&#x7684;&#x5730;&#x5740;&#x751F;&#x6210;&#x662F;&#x6C47;&#x7F16;&#x5668;&#x7684;&#x5DE5;&#x4F5C;&#x3002;&#x5BF9;&#x4E8E;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#xFF0C;&#x5219;&#x5168;&#x90E8;&#x8868;&#x793A;&#x4E3A;&#x6808;&#x504F;&#x79FB;&#x7684;&#x5F62;&#x5F0F;&#x3002;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x539F;&#x56E0;&#x662F;&#x663E;&#x800C;&#x6613;&#x89C1;&#x7684;&#xFF1A;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x65F6;&#x7684;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x662F;&#x52A8;&#x6001;&#x7684;&#xFF0C;&#x5F88;&#x96BE;&#x786E;&#x5B9A;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x7684;&#x7EDD;&#x5BF9;&#x5730;&#x5740;&#xFF0C;&#x6240;&#x4EE5;&#x4F7F;&#x7528;&#x76F8;&#x5BF9;&#x4E8E;&#x6808;&#x7684;&#x504F;&#x79FB;&#x6765;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x3002;&#x4E0D;&#x540C;&#x4E8E;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#xFF0C;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x7684;&#x521D;&#x59CB;&#x5316;&#x662F;&#x7528;&#x751F;&#x6210;&#x7684;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x7684;&#x3002;</p><p>&#x5BF9;&#x4E8E;&#x4E00;&#x4E9B;&#x7279;&#x6B8A;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x5982;&#x6570;&#x7EC4;&#x3001;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x9996;&#x5148;&#x5C06;&#x5E38;&#x91CF;&#x7684;&#x5185;&#x5BB9;&#x653E;&#x5165;LIT&#x6BB5;&#xFF0C;&#x7136;&#x540E;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x4E34;&#x65F6;&#x53D8;&#x91CF;&#x4FDD;&#x5B58;&#x8FD9;&#x4E2A;&#x5E38;&#x91CF;&#x5185;&#x5BB9;&#x7684;&#x6807;&#x7B7E;&#x3002;</p><h1 id="lcc&#x4E2D;mips&#x540E;&#x7AEF;&#x7684;&#x5E27;&#x7ED3;&#x6784;"><a href="#lcc&#x4E2D;mips&#x540E;&#x7AEF;&#x7684;&#x5E27;&#x7ED3;&#x6784;" class="headerlink" title="lcc&#x4E2D;mips&#x540E;&#x7AEF;&#x7684;&#x5E27;&#x7ED3;&#x6784;"></a>lcc&#x4E2D;mips&#x540E;&#x7AEF;&#x7684;&#x5E27;&#x7ED3;&#x6784;</h1><pre><code>&#x9AD8;&#x5730;&#x5740;    --------------------------------    | &#x8C03;&#x7528;&#x8005;&#x7684;&#x5E27;                    |    --------------------------------    |&#x8C03;&#x7528;&#x8005;&#x4F20;&#x9012;&#x7684;&#x53C2;&#x6570;               |    --------------------------------        &#x2014;&#x2014;    |&#x5C40;&#x90E8;&#x53D8;&#x91CF;                       |        |    --------------------------------    |&#x88AB;&#x8C03;&#x7528;&#x8005;&#x4FDD;&#x5B58;&#x7684;&#x73B0;&#x573A;             |       Framesize    -------------------------------    |&#x88AB;&#x8C03;&#x7528;&#x8005;&#x8C03;&#x7528;&#x5176;&#x4ED6;&#x51FD;&#x6570;&#x65F6;&#x4F20;&#x9012;&#x7684;&#x53C2;&#x6570;|         |    -------------------------------         &#x2014;&#x2014;-----&gt;sp    |&#x53E6;&#x4E00;&#x4E2A;&#x5E27;                       |&#x4F4E;&#x5730;&#x5740;        </code></pre><p>&#x8FD9;&#x91CC;&#x503C;&#x5F97;&#x4E00;&#x63D0;&#x7684;&#x662F;&#xFF0C;&#x53C2;&#x6570;&#x7684;&#x504F;&#x79FB;&#x662F;&#x76F8;&#x5BF9;&#x4E8E;sp+framesize&#x7684;&#x6B63;&#x504F;&#x79FB;&#xFF0C;&#x56E0;&#x6B64;&#x662F;&#x4ECE;&#x8C03;&#x7528;&#x8005;&#x7684;&#x5E27;&#x4E2D;&#x83B7;&#x53D6;&#x53C2;&#x6570;&#x7684;&#x503C;&#xFF08;&#x53C2;&#x6570;&#x4F20;&#x9012;&#xFF09;&#xFF0C;&#x800C;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x7684;&#x504F;&#x79FB;&#x662F;&#x76F8;&#x5BF9;&#x4E8E;sp+framesize&#x7684;&#x8D1F;&#x504F;&#x79FB;&#x3002;</p><p>&#x53E6;&#x4E00;&#x5904;&#x503C;&#x5F97;&#x8BF4;&#x660E;&#x7684;&#x662F;&#xFF0C;&#x88AB;&#x8C03;&#x7528;&#x8005;&#x5982;&#x679C;&#x8C03;&#x7528;&#x4E86;&#x5176;&#x4ED6;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x9700;&#x8981;&#x5728;&#x5F53;&#x524D;&#x6808;&#x4E2D;&#x5F00;&#x8F9F;&#x5B58;&#x653E;outgoing argument&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x5F88;&#x591A;&#x4E2A;&#x5176;&#x4ED6;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x4E2A;&#x7A7A;&#x95F4;&#x5982;&#x4F55;&#x786E;&#x5B9A;&#xFF1F;&#x5728;&#x751F;&#x6210;&#x51FD;&#x6570;&#x7684;&#x4EE3;&#x7801;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5BF9;&#x6240;&#x6709;&#x7684;&#x5B50;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x7684;&#x53C2;&#x6570;&#x8FDB;&#x884C;&#x7EDF;&#x8BA1;&#xFF0C;&#x5F97;&#x5230;&#x6700;&#x5927;&#x7684;outgoing argument&#x6570;&#x91CF;&#xFF0C;&#x8FD9;&#x91CC;&#x8FD9;&#x4E2A;&#x7A7A;&#x95F4;&#x662F;&#x8FD9;&#x6837;&#x786E;&#x5B9A;&#x7684;&#x3002;</p><h1 id="&#x5C0F;&#x7ED3;"><a href="#&#x5C0F;&#x7ED3;" class="headerlink" title="&#x5C0F;&#x7ED3;"></a>&#x5C0F;&#x7ED3;</h1><p>&#x4E86;&#x89E3;&#x4E86;lcc&#x7684;&#x7ED3;&#x6784;&#xFF0C;&#x7406;&#x89E3;&#x4E86;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;c&#x8BED;&#x8A00;&#x7A0B;&#x5E8F;&#x662F;&#x5982;&#x4F55;&#x7531;lcc&#x4E00;&#x6B65;&#x4E00;&#x6B65;&#x751F;&#x6210;&#x6C47;&#x7F16;&#x8BED;&#x8A00;&#x7684;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x79FB;&#x690D;&#x5DE5;&#x4F5C;&#x4E86;&#x3002;</p><p>&#x79FB;&#x690D;&#x5DE5;&#x4F5C;&#x4E3B;&#x8981;&#x5305;&#x62EC;&#xFF1A;&#x4FEE;&#x6539;&#x6307;&#x4EE4;&#x6A21;&#x677F;&#xFF0C;&#x4FEE;&#x6539;&#x5BC4;&#x5B58;&#x5668;&#x5206;&#x914D;&#x89C4;&#x5219;&#xFF0C;&#x4FEE;&#x6539;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x89C4;&#x5219;&#xFF0C;&#x4FEE;&#x6539;&#x5404;&#x4E2A;&#x57FA;&#x672C;&#x7C7B;&#x578B;&#x7684;&#x957F;&#x5EA6;&#x548C;&#x5BF9;&#x9F50;&#xFF0C;&#x4FEE;&#x6539;&#x5404;&#x79CD;&#x540D;&#x79F0;&#x7EA6;&#x5B9A;&#xFF08;&#x5982;&#x5404;&#x6570;&#x636E;&#x6BB5;&#x7684;&#x540D;&#x5B57;&#xFF09;&#x7B49;&#x3002;</p><p>&#x5BF9;&#x4E8E;&#x6211;&#x5373;&#x5C06;&#x8FDB;&#x884C;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x4E3B;&#x8981;&#x7684;&#x4FEE;&#x6539;&#x5E94;&#x8BE5;&#x5305;&#x62EC;&#x4FEE;&#x6539;&#x7C7B;&#x578B;&#x7684;&#x957F;&#x5EA6;&#x548C;&#x5BF9;&#x9F50;&#xFF08;&#x7531;&#x4E8E;cpu&#x53D6;&#x6570;&#x64CD;&#x4F5C;&#x4E0E;mips&#x4E0D;&#x540C;&#xFF09;&#xFF0C;&#x5BF9;&#x4E8E;&#x4E58;&#x6CD5;&#x9664;&#x6CD5;&#x6307;&#x4EE4;&#x6A21;&#x677F;&#x5E94;&#x8BE5;&#x4E3A;&#x51FD;&#x6570;&#x8C03;&#x7528;&#xFF08;cpu&#x65E0;&#x4E58;&#x6CD5;&#x5668;&#x3001;&#x9664;&#x6CD5;&#x5668;&#xFF0C;&#x8FD9;&#x91CC;&#x8FD8;&#x9700;&#x4FEE;&#x6539;clobber&#x51FD;&#x6570;&#xFF09;&#xFF0C;&#x5BF9;&#x4E8E;&#x6D6E;&#x70B9;&#x64CD;&#x4F5C;&#xFF0C;&#x9700;&#x8981;&#x5148;&#x7528;&#x7F16;&#x8BD1;&#x5668;&#x7F16;&#x8BD1;&#x751F;&#x6210;&#x8BA1;&#x7B97;&#x51FD;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x6307;&#x4EE4;&#x6A21;&#x677F;&#x4FEE;&#x6539;&#x4E3A;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x3002;&#x4FEE;&#x6539;&#x4E2A;&#x6570;&#x636E;&#x6BB5;&#x540D;&#x5B57;&#x4E0E;&#x6C47;&#x7F16;&#x5668;&#x914D;&#x5408;&#x3002;</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&amp;#x7ECF;&amp;#x8FC7;&amp;#x4E86;&amp;#x51E0;&amp;#x4E2A;&amp;#x6708;&amp;#xFF0C;&amp;#x7EC8;&amp;#x4E8E;&amp;#x5B8C;&amp;#x6574;&amp;#x7684;&amp;#x8BFB;&amp;#x5B8C;&amp;#x4E86;lcc 3.6 &amp;#x7684;&amp;</summary>
      
    
    
    
    <category term="home brew computer system" scheme="https://gpthimble.github.io/categories/home-brew-computer-system/"/>
    
    
    <category term="development log" scheme="https://gpthimble.github.io/tags/development-log/"/>
    
    <category term="compiler" scheme="https://gpthimble.github.io/tags/compiler/"/>
    
  </entry>
  
  <entry>
    <title>Hello World!</title>
    <link href="https://gpthimble.github.io/en/hello%20world/"/>
    <id>https://gpthimble.github.io/en/hello%20world/</id>
    <published>2020-09-26T07:31:08.000Z</published>
    <updated>2020-09-30T10:10:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>Hello World!</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Hello World!&lt;/p&gt;
</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>在MIPS CPU中引入微代码</title>
    <link href="https://gpthimble.github.io/%E5%9C%A8MIPS-CPU%E4%B8%AD%E5%BC%95%E5%85%A5%E5%BE%AE%E4%BB%A3%E7%A0%81/"/>
    <id>https://gpthimble.github.io/%E5%9C%A8MIPS-CPU%E4%B8%AD%E5%BC%95%E5%85%A5%E5%BE%AE%E4%BB%A3%E7%A0%81/</id>
    <published>2020-05-04T04:44:34.000Z</published>
    <updated>2020-09-30T08:47:51.000Z</updated>
    
    <content type="html"><![CDATA[<p>&#x672C;&#x9879;&#x76EE;&#x6240;&#x8BBE;&#x8BA1;&#x7684;CPU&#xFF0C;&#x4E0E;&#x674E;&#x4E9A;&#x6C11;&#x4E66;&#x4E2D;&#x6240;&#x63CF;&#x8FF0;&#x7684;CPU&#x4E3B;&#x8981;&#x533A;&#x522B;&#x662F;&#x5728;MIPS CPU&#x4E2D;&#x5F15;&#x5165;&#x4E86;&#x5FAE;&#x4EE3;&#x7801;&#xFF0C;&#x65B9;&#x4FBF;&#x6307;&#x4EE4;&#x96C6;&#x7684;&#x6269;&#x5C55;&#x3001;&#x7F16;&#x8BD1;&#x5668;&#x7684;&#x79FB;&#x690D;&#x548C;&#x7CFB;&#x7EDF;&#x7F16;&#x7A0B;&#x3002;</p><h2 id="&#x5E26;&#x6709;&#x5FAE;&#x6307;&#x4EE4;&#x7684;IF&#x7EA7;"><a href="#&#x5E26;&#x6709;&#x5FAE;&#x6307;&#x4EE4;&#x7684;IF&#x7EA7;" class="headerlink" title="&#x5E26;&#x6709;&#x5FAE;&#x6307;&#x4EE4;&#x7684;IF&#x7EA7;"></a>&#x5E26;&#x6709;&#x5FAE;&#x6307;&#x4EE4;&#x7684;IF&#x7EA7;</h2><p><img src="/%E5%9C%A8MIPS-CPU%E4%B8%AD%E5%BC%95%E5%85%A5%E5%BE%AE%E4%BB%A3%E7%A0%81/IF_with_micro_code.png" alt="&#x539F;&#x7406;&#x56FE;"></p><p>&#x7531;&#x539F;&#x7406;&#x56FE;&#x53EF;&#x77E5;&#xFF0C;&#x4E3B;&#x8981;&#x7684;&#x4FEE;&#x6539;&#x662F;&#x52A0;&#x5165;&#x4E86;&#xFF1A;</p><ul><li>&#x5FAE;&#x6307;&#x4EE4;&#x5B58;&#x50A8;&#x5668; uprog</li><li>&#x5FAE;&#x6307;&#x4EE4;&#x5BC4;&#x5B58;&#x5668; uPC</li><li>&#x4E0B;&#x4E00;&#x4E2A;&#x5FAE;&#x6307;&#x4EE4;&#x9009;&#x62E9;&#x5668;</li><li>IF&#x63A7;&#x5236;&#x5668; IF Control</li><li>&#x72B6;&#x6001;&#x5BC4;&#x5B58;&#x5668; State</li></ul><h2 id="&#x5FAE;&#x6307;&#x4EE4;&#x5B58;&#x50A8;&#x5668;&#x7684;&#x7ED3;&#x6784;"><a href="#&#x5FAE;&#x6307;&#x4EE4;&#x5B58;&#x50A8;&#x5668;&#x7684;&#x7ED3;&#x6784;" class="headerlink" title="&#x5FAE;&#x6307;&#x4EE4;&#x5B58;&#x50A8;&#x5668;&#x7684;&#x7ED3;&#x6784;"></a>&#x5FAE;&#x6307;&#x4EE4;&#x5B58;&#x50A8;&#x5668;&#x7684;&#x7ED3;&#x6784;</h2><p>&#x672C;&#x5E73;&#x53F0;&#x4F7F;&#x7528;&#x7684;&#x5FAE;&#x6307;&#x4EE4;&#x6709;&#x5982;&#x4E0B;&#x7ED3;&#x6784;&#xFF1A;</p><pre class="mermaid">classDiagramclass MicroCode{    head 1    head 2    ......    head n    code1 ()    code2 ()    coden ()}class Head{    a JUMP instruction    first op in the code section-delay slot}</pre><p>&#x5FAE;&#x6307;&#x4EE4;&#x5B58;&#x50A8;&#x5668;&#x5305;&#x62EC;&#x4E24;&#x4E2A;&#x90E8;&#x5206;,&#x5934;&#x90E8;&#x6309;&#x7167;&#x6307;&#x4EE4;&#x53F7;&#x5BFB;&#x5740;&#xFF0C;&#x6309;&#x987A;&#x5E8F;&#x5B58;&#x653E;&#x5728;&#x5B58;&#x50A8;&#x5668;&#x4E2D;&#x3002;&#x6BCF;&#x4E2A;&#x5934;&#x90E8;&#x57DF;&#x6709;&#x4E24;&#x884C;&#xFF0C;&#x7B2C;&#x4E00;&#x884C;&#x662F;&#x4E00;&#x4E2A;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#xFF0C;&#x8DF3;&#x8F6C;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x4EE3;&#x7801;&#x57DF;&#xFF0C;&#x7B2C;&#x4E8C;&#x884C;&#x662F;&#x4E3A;&#x4E86;&#x6EE1;&#x8DB3;&#x5EF6;&#x65F6;&#x69FD;&#x7684;&#x7279;&#x70B9;&#xFF0C;&#x5C06;&#x4EE3;&#x7801;&#x57DF;&#x7684;&#x7B2C;&#x4E00;&#x884C;&#x4EE3;&#x7801;&#x653E;&#x7F6E;&#x5728;&#x5EF6;&#x65F6;&#x69FD;&#x4E2D;&#x3002;</p><p>&#x7531;&#x4E8E;&#x5FAE;&#x6307;&#x4EE4;&#x7684;&#x5934;&#x90E8;&#x6709;&#x4E24;&#x884C;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x4F7F;&#x7528;&#x6307;&#x4EE4;&#x4E2D;&#x7684;&#x6307;&#x4EE4;&#x53F7;&#x4F5C;&#x4E3A;&#x5730;&#x5740;&#x5BF9;&#x5FAE;&#x4EE3;&#x7801;&#x5B58;&#x50A8;&#x5668;&#x5BFB;&#x5740;&#x65F6;&#xFF0C;&#x8981;&#x5148;&#x5411;&#x5DE6;&#x4F4D;&#x79FB;&#x4E00;&#x4F4D;&#x3002;</p><p>&#x5982;&#x6B64;&#x8BBE;&#x8BA1;&#x5FAE;&#x6307;&#x4EE4;&#x5B58;&#x50A8;&#x5668;&#xFF0C;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x5BFB;&#x5740;&#xFF0C;&#x5E76;&#x4E14;&#x6700;&#x5927;&#x9650;&#x5EA6;&#x5730;&#x5229;&#x7528;&#x5FAE;&#x6307;&#x4EE4;&#x5B58;&#x50A8;&#x5668;&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x5934;&#x90E8;&#x548C;&#x4EE3;&#x7801;&#x4E4B;&#x95F4;&#x6CA1;&#x6709;&#x5206;&#x5272;&#x3002;</p><p>&#x5FAE;&#x6307;&#x4EE4;&#x5B58;&#x50A8;&#x5668;&#x7684;&#x4EE3;&#x7801;&#x57DF;&#x7531;&#x4E00;&#x4E2A;&#x7EC8;&#x7ED3;&#x6307;&#x4EE4;&#x5206;&#x5272;&#x3002;&#x8FD9;&#x4E2A;&#x7EC8;&#x7ED3;&#x6307;&#x4EE4;&#x4F9B;IF&#x63A7;&#x5236;&#x5668;&#x5224;&#x65AD;&#x4E00;&#x4E2A;&#x5FAE;&#x6307;&#x4EE4;&#x662F;&#x5426;&#x7ED3;&#x675F;&#x3002;&#x4EE3;&#x7801;&#x57DF;&#x4E2D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4EFB;&#x4F55;&#x4E00;&#x6761;&#x7528;&#x786C;&#x7EBF;&#x903B;&#x8F91;&#x5B9E;&#x73B0;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x4E00;&#x65E6;&#x8FDB;&#x5165;&#x5FAE;&#x6307;&#x4EE4;&#x72B6;&#x6001;&#xFF0C;&#x5FAE;&#x6307;&#x4EE4;&#x4E2D;&#x7684;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x5C06;&#x53EA;&#x4FEE;&#x6539;&#x5FAE;&#x6307;&#x4EE4;&#x8BA1;&#x6570;&#x5668;uPC&#x3002;&#x6BCF;&#x4E2A;&#x5FAE;&#x6307;&#x4EE4;&#x4EE3;&#x7801;&#x57DF;&#x7684;&#x6700;&#x540E;&#x4E00;&#x6761;&#x6307;&#x4EE4;&#xFF08;&#x7EC8;&#x6B62;&#x7B26;&#x524D;&#xFF09;&#x4E0D;&#x80FD;&#x662F;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x3002;</p><h2 id="&#x5FAE;&#x6307;&#x4EE4;&#x5DE5;&#x4F5C;&#x8FC7;&#x7A0B;"><a href="#&#x5FAE;&#x6307;&#x4EE4;&#x5DE5;&#x4F5C;&#x8FC7;&#x7A0B;" class="headerlink" title="&#x5FAE;&#x6307;&#x4EE4;&#x5DE5;&#x4F5C;&#x8FC7;&#x7A0B;"></a>&#x5FAE;&#x6307;&#x4EE4;&#x5DE5;&#x4F5C;&#x8FC7;&#x7A0B;</h2><p>&#x5728;&#x4E0D;&#x8003;&#x8651;&#x4E2D;&#x65AD;&#x6216;&#x5F02;&#x5E38;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6574;&#x4E2A;IF&#x9636;&#x6BB5;&#x5B9E;&#x9645;&#x4E0A;&#x5206;&#x4E3A;&#x4E24;&#x4E2A;&#x4E2A;&#x72B6;&#x6001;&#xFF1A;</p><ol><li>&#x6B63;&#x5E38;&#x72B6;&#x6001;<ul><li>&#x8BE5;&#x72B6;&#x6001;&#x662F;&#x6307;&#x73B0;&#x5728;&#x6CA1;&#x6709;&#x5FAE;&#x6307;&#x4EE4;&#x5728;&#x6267;&#x884C;</li></ul></li><li>&#x4F2A;&#x6307;&#x4EE4;&#x72B6;&#x6001;<ul><li>&#x8BE5;&#x72B6;&#x6001;&#x6307;&#x73B0;&#x5728;&#x6B63;&#x5728;&#x6267;&#x884C;&#x5FAE;&#x6307;&#x4EE4;</li></ul></li></ol><p>&#x4E0E;&#x6B64;&#x540C;&#x65F6;&#xFF0C;&#x8FD8;&#x8981;&#x5224;&#x65AD;&#x4E24;&#x4E2A;&#x52A8;&#x4F5C;&#xFF1A;</p><ol><li>&#x6B63;&#x5E38;&#x72B6;&#x6001;&#x2013;&gt;&#x5FAE;&#x6307;&#x4EE4;&#x72B6;&#x6001;&#xFF08;enter&#xFF09;</li><li>&#x5FAE;&#x6307;&#x4EE4;&#x72B6;&#x6001;&#x2013;&gt;&#x6B63;&#x5E38;&#x72B6;&#x6001;&#xFF08;exit&#xFF09;</li></ol><p>IF&#x7684;&#x72B6;&#x6001;&#x7531;State Register&#x8BB0;&#x5F55;&#xFF0C;&#x52A8;&#x4F5C;&#x7531;state&#x548C;&#x6B63;&#x5728;&#x8F93;&#x5165;&#x7684;&#x6307;&#x4EE4;&#xFF08;INS_in, uINS_in&#xFF09;&#x5224;&#x65AD;&#x3002;</p><table><thead><tr><th>&#x72B6;&#x6001;&#x8F6C;&#x6362;</th><th>State</th><th>nState</th><th>INS_in</th><th>uINS_in</th><th>wpc</th><th>wupc</th><th>enter</th><th>out_sl</th></tr></thead><tbody><tr><td>n-&gt;n</td><td>0</td><td>0</td><td>0</td><td>x</td><td>1</td><td>0</td><td>0</td><td>0</td></tr><tr><td>n-&gt;u</td><td>0</td><td>1</td><td>1</td><td>x</td><td>1</td><td>1</td><td>1</td><td>1</td></tr><tr><td>u-&gt;u</td><td>1</td><td>1</td><td>x</td><td>0</td><td>0</td><td>1</td><td>0</td><td>1</td></tr><tr><td>u-&gt;n</td><td>1</td><td>0</td><td>0</td><td>1</td><td>1</td><td>1</td><td>0</td><td>0</td></tr><tr><td>u-&gt;u</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td></tr></tbody></table><p>&#x4E0A;&#x8868;&#x4E2D;&#xFF0C;&#x8868;&#x5934;&#x5BF9;&#x5E94;&#x539F;&#x7406;&#x56FE;&#x4E2D;&#x7684;&#x4FE1;&#x53F7;&#x3002;state=0&#x8868;&#x793A;&#x6B63;&#x5E38;&#x72B6;&#x6001;&#xFF0C;state=1&#x8868;&#x793A;&#x8FDB;&#x5165;&#x5FAE;&#x6307;&#x4EE4;&#x72B6;&#x6001;&#x3002;nState&#x8868;&#x793A;&#x4E0B;&#x4E00;&#x4E2A;&#x72B6;&#x6001;&#x3002;INS_in=0 &#x8868;&#x793A;&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x4EE5;&#x786C;&#x4EF6;&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#xFF0C;INS_in=1 &#x8868;&#x793A;&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x662F;&#x4EE5;&#x5FAE;&#x6307;&#x4EE4;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;&#x3002;uINS_in=0&#x8868;&#x793A;&#x5F53;&#x524D;&#x5FAE;&#x6307;&#x4EE4;&#x4E0D;&#x662F;&#x7ED3;&#x675F;&#x7B26;&#xFF0C;uINS_in=1&#x8868;&#x793A;&#x5F53;&#x524D;&#x5FAE;&#x6307;&#x4EE4;&#x662F;&#x7ED3;&#x675F;&#x7B26;&#x3002;wpc&#x548C;wupc&#x5206;&#x522B;&#x63A7;&#x5236;pc&#x548C;upc&#x7684;&#x5199;&#x5165;&#x4F7F;&#x80FD;&#x3002;</p><p>enter&#x4E3A;&#x8FDB;&#x5165;&#x5FAE;&#x6307;&#x4EE4;&#x72B6;&#x6001;&#x65F6;&#x7684;&#x6307;&#x793A;&#x4FE1;&#x53F7;&#xFF0C;&#x4E3A;&#x4E86;&#x63D0;&#x9AD8;ipc&#xFF0C;&#x4E00;&#x65E6;&#x53D1;&#x73B0;&#x4E00;&#x6761;&#x6307;&#x4EE4;&#x65F6;&#x4F7F;&#x7528;&#x5FAE;&#x6307;&#x4EE4;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x5C31;&#x5E94;&#x5F53;&#x76F4;&#x63A5;&#x8F93;&#x51FA;&#x5BF9;&#x5E94;&#x7684;&#x5FAE;&#x6307;&#x4EE4;&#xFF0C;&#x6240;&#x4EE5;&#x8FDB;&#x5165;&#x5FAE;&#x6307;&#x4EE4;&#x72B6;&#x6001;&#x9700;&#x8981;&#x989D;&#x5916;&#x5904;&#x7406;&#xFF1A;&#x5FAE;&#x6307;&#x4EE4;&#x5B58;&#x50A8;&#x5668;&#x7684;&#x5730;&#x5740;&#x76F4;&#x63A5;&#x7531;enter&#x4FE1;&#x53F7;&#x9009;&#x62E9;&#x4E3A;&#x6307;&#x4EE4;&#x4E2D;&#x7684;&#x5730;&#x5740;&#x4F4D;&#xFF0C;&#x5FAE;&#x6307;&#x4EE4;&#x5B58;&#x50A8;&#x5668;&#x8F93;&#x51FA;head&#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#xFF0C;&#x4E0B;&#x4E2A;&#x65F6;&#x949F;&#x5468;&#x671F;&#x5230;&#x6765;&#x65F6;&#xFF0C;&#x8BE5;&#x5730;&#x5740;+4&#x653E;&#x5165;upc&#xFF0C;&#x5FAE;&#x6307;&#x4EE4;&#x72B6;&#x6001;&#x5EF6;&#x65F6;&#x69FD;&#x4ECD;&#x7136;&#x4FDD;&#x7559;&#x3002;&#x4E4B;&#x540E;&#x7684;upc&#x7531;ID&#x9636;&#x6BB5;&#x7684;upcSource&#x66F4;&#x65B0;&#x3002;</p><p>out_sl&#x6807;&#x5FD7;&#x8F93;&#x51FA;&#x662F;&#x5FAE;&#x6307;&#x4EE4;&#x5B58;&#x50A8;&#x5668;&#x5185;&#x7684;&#x5185;&#x5BB9;&#x8FD8;&#x662F;&#x6307;&#x4EE4;cache&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x3002;&#x5F53;&#x72B6;&#x6001;&#x53D1;&#x751F;&#x8F6C;&#x6362;&#x65F6;&#xFF0C;n-&gt;u&#x65F6;&#xFF0C;&#x82E5;&#x5C06;&#x6307;&#x4EE4;cache&#x4E2D;&#x7684;&#x6307;&#x4EE4;&#x76F4;&#x63A5;&#x4F20;&#x5165;ID&#xFF0C;ID&#x662F;&#x65E0;&#x6CD5;&#x8BC6;&#x522B;&#x7684;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x56E0;&#x4E3A;enter&#x4FE1;&#x53F7;&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x4F7F;&#x5F97;&#x8BE5;&#x6307;&#x4EE4;&#x5BF9;&#x5E94;&#x7684;&#x5FAE;&#x6307;&#x4EE4;&#x5DF2;&#x51C6;&#x5907;&#x597D;&#xFF0C;&#x6240;&#x4EE5;out_sl&#x4E3A;1&#xFF0C;&#x5373;&#x5F53;&#x5FAE;&#x6307;&#x4EE4;&#x5B9E;&#x73B0;&#x7684;&#x6307;&#x4EE4;&#x51FA;&#x73B0;&#x65F6;&#xFF0C;&#x76F4;&#x63A5;&#x4F20;&#x5165;&#x5176;&#x5BF9;&#x5E94;&#x7684;&#x5FAE;&#x6307;&#x4EE4;&#x3002;&#x540C;&#x7406;&#xFF0C;&#x5F53;u-&gt;n&#x65F6;&#xFF0C;&#x82E5;&#x5C06;&#x5FAE;&#x6307;&#x4EE4;&#x7ED3;&#x675F;&#x7B26;&#x4F20;&#x5165;ID&#xFF0C;ID&#x4E5F;&#x662F;&#x65E0;&#x6CD5;&#x8BC6;&#x522B;&#x7684;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x6025;&#x9700;&#x8981;&#x4F7F;out_sl=0&#x9009;&#x62E9;&#x8F93;&#x51FA;&#x4E0B;&#x4E00;&#x6761;&#x6307;&#x4EE4;&#x3002;&#x8FD9;&#x91CC;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#xFF0C;&#x5C31;&#x662F;&#x5F53;&#x4E0B;&#x4E00;&#x4E2A;&#x8F93;&#x5165;&#x7684;&#x6307;&#x4EE4;&#x4E5F;&#x662F;&#x7531;&#x5FAE;&#x6307;&#x4EE4;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x5B9E;&#x9645;&#x4E0A;IF&#x9636;&#x6BB5;&#x518D;&#x4E00;&#x6B21;&#x8FDB;&#x5165;&#x4E86;&#x5FAE;&#x6307;&#x4EE4;&#x72B6;&#x6001;&#xFF08;reenter&#xFF09;&#xFF0C;&#x8FD9;&#x65F6;enter&#x4FE1;&#x53F7;&#x9009;&#x62E9;&#x4E86;&#x65B0;&#x7684;&#x5FAE;&#x6307;&#x4EE4;&#x5730;&#x5740;&#xFF0C;&#x5411;ID&#x7EA7;&#x8F93;&#x5165;&#x6B63;&#x786E;&#x7684;&#x6307;&#x4EE4;&#x3002;</p><p>&#x5173;&#x4E8E;pc&#x548C;upc&#x7684;&#x63A7;&#x5236;&#x6709;&#x4E9B;&#x590D;&#x6742;&#xFF0C;&#x7B80;&#x5355;&#x6765;&#x8BF4;&#xFF0C;&#x5C31;&#x662F;&#x6D88;&#x8017;&#x4E00;&#x6761;&#x6307;&#x4EE4;&#xFF0C;&#x5C31;&#x8981;&#x5199;&#x4E00;&#x6B21;pc&#xFF0C;&#x6D88;&#x8017;&#x4E00;&#x6761;&#x5FAE;&#x6307;&#x4EE4;&#x5C31;&#x8981;&#x5199;&#x4E00;&#x6B21;upc&#x3002;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5F53;enter&#x548C;reenter&#x7684;&#x60C5;&#x51B5;&#x53D1;&#x751F;&#x65F6;&#xFF0C;&#x7B49;&#x4E8E;&#x8BF4;&#x65E2;&#x6D88;&#x8017;&#x4E86;&#x4E00;&#x6761;&#x6307;&#x4EE4;&#xFF0C;&#x53C8;&#x6D88;&#x8017;&#x4E86;&#x4E00;&#x6761;&#x5FAE;&#x6307;&#x4EE4;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;pc&#x548C;upc&#x5747;&#x88AB;&#x5199;&#x5165;&#x3002;</p><p>&#x7531;&#x4E8E;&#x5EF6;&#x65F6;&#x69FD;&#x548C;&#x6D41;&#x6C34;&#x7EBF;&#x7684;&#x5B58;&#x5728;&#xFF0C;&#x4F7F;&#x5F97;&#x4E0B;&#x4E00;&#x4E2A;pc&#x548C;upc&#x7684;&#x503C;&#x7684;&#x5224;&#x65AD;&#x53D8;&#x5F97;&#x590D;&#x6742;&#x3002;&#x800C;&#x6211;&#x7684;&#x8BBE;&#x8BA1;&#x53C8;&#x5E0C;&#x671B;&#x5C3D;&#x53EF;&#x80FD;&#x5730;&#x5C06;&#x4FEE;&#x6539;&#x505C;&#x7559;&#x5728;IF&#x7EA7;&#xFF0C;&#x6240;&#x4EE5;&#x624D;&#x628A;pc&#x548C;upc&#x5730;&#x5199;&#x5165;&#x9650;&#x5236;&#x52A0;&#x5728;&#x4E86;IF&#x7EA7;&#x3002;&#x7531;&#x4E8E;ID&#x7EA7;&#x8981;&#x8BA1;&#x7B97;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x7684;&#x76EE;&#x6807;&#x5730;&#x5740;&#xFF0C;&#x6240;&#x4EE5;&#x5F53;&#x524D;PC&#x6216;&#x8005;uPC&#x8981;&#x4F20;&#x5165;ID&#x7EA7;&#x3002;&#x6539;&#x8FDB;&#x7684;IF&#x7EA7;&#x4E2D;&#xFF0C;nPC&#x548C;nuPC&#x7684;&#x4E24;&#x4E2A;&#x591A;&#x8DEF;&#x590D;&#x7528;&#x5668;&#xFF0C;&#x9664;&#x4E86;+4&#x8FD9;&#x4E00;&#x9879;&#x8F93;&#x5165;&#x5206;&#x522B;&#x5BF9;&#x5E94;pc&#x548C;upc&#x81EA;&#x8EAB;&#x5916;&#xFF0C;&#x5176;&#x4F59;&#x4E09;&#x4E2A;&#x8F93;&#x5165;&#x662F;&#x76F8;&#x540C;&#x7684;&#xFF0C;&#x5747;&#x7531;ID&#x7EA7;&#x76F4;&#x63A5;&#x7ED9;&#x51FA;&#xFF0C;&#x9009;&#x62E9;&#x4FE1;&#x53F7;&#x4E5F;&#x662F;&#x76F8;&#x540C;&#x7684;&#xFF0C;&#x4E5F;&#x7531;ID&#x7EA7;&#x76F4;&#x63A5;&#x7ED9;&#x51FA;&#x3002;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x597D;&#x5904;&#x662F;&#x5BF9;&#x4E8E;ID&#x7EA7;&#x4E0D;&#x9700;&#x8981;&#x505A;&#x4EFB;&#x4F55;&#x4FEE;&#x6539;&#xFF0C;&#x5C31;&#x80FD;&#x5B9E;&#x73B0;&#x5728;&#x5FAE;&#x6307;&#x4EE4;&#x72B6;&#x6001;&#x4E2D;&#x7684;&#x8DF3;&#x8F6C;&#x4FEE;&#x6539;upc&#xFF0C;&#x800C;&#x5728;&#x6B63;&#x5E38;&#x72B6;&#x6001;&#x4E0B;&#x7684;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x4FEE;&#x6539;pc&#x3002;&#x8003;&#x8651;&#x4E0B;&#x9762;&#x51E0;&#x79CD;&#x60C5;&#x51B5;&#x4E2D;pc&#x548C;upc&#x7684;&#x53D8;&#x5316;&#x3002;</p><table><thead><tr><th>&#x5B58;&#x50A8;&#x5668;&#x4F4D;&#x7F6E;</th><th>&#x60C5;&#x51B5;&#x4E00;</th><th>&#x60C5;&#x51B5;&#x4E8C;</th><th>&#x60C5;&#x51B5;&#x4E09;</th></tr></thead><tbody><tr><td>01</td><td>&#x786C;&#x4EF6;&#x5B9E;&#x73B0;&#x6307;&#x4EE4;&#xFF08;&#x975E;&#x8DF3;&#x8F6C;&#xFF09;</td><td>&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;</td><td>&#x786C;&#x4EF6;&#x5B9E;&#x73B0;&#x6307;&#x4EE4;&#xFF08;&#x975E;&#x8DF3;&#x8F6C;&#xFF09;</td></tr><tr><td>02</td><td>&#x5FAE;&#x6307;&#x4EE4;&#x5B9E;&#x73B0;&#x6307;&#x4EE4;</td><td>&#x5FAE;&#x6307;&#x4EE4;&#x5B9E;&#x73B0;&#x6307;&#x4EE4;</td><td>&#x5FAE;&#x6307;&#x4EE4;&#x5B9E;&#x73B0;&#x6307;&#x4EE4;</td></tr><tr><td>03</td><td>&#x786C;&#x4EF6;&#x5B9E;&#x73B0;&#x6CBB;&#x6307;&#x4EE4;</td><td>&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x7684;&#x76EE;&#x6807;</td><td>&#x5FAE;&#x6307;&#x4EE4;&#x5B9E;&#x73B0;&#x6307;&#x4EE4;</td></tr></tbody></table><p>&#x60C5;&#x51B5;&#x4E00;&#x662F;&#x6BD4;&#x8F83;&#x6B63;&#x5E38;&#x7684;&#x60C5;&#x51B5;&#xFF0C;pc=01&#xFF0C;&#x8BE5;&#x6307;&#x4EE4;&#x662F;&#x4E00;&#x4E2A;&#x786C;&#x4EF6;&#x5B9E;&#x73B0;&#x6307;&#x4EE4;&#xFF0C;&#x6240;&#x4EE5;&#x76F4;&#x63A5;&#x8F93;&#x51FA;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x5411;&#x4E0B;&#x4E00;&#x7EA7;&#x8F93;&#x51FA;PC&#x3002;&#x4E0B;&#x4E00;&#x4E2A;&#x65F6;&#x949F;&#x5230;&#x6765;&#xFF0C;&#x82E5;&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x662F;&#x5EF6;&#x65F6;&#x69FD;&#x4E2D;&#x7684;&#x6307;&#x4EE4;&#xFF0C;pc&#x7B49;&#x4E8E;&#x5176;&#x76EE;&#x6807;&#xFF1B;&#x82E5;&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x4E0D;&#x5904;&#x4E8E;&#x5EF6;&#x65F6;&#x69FD;&#x4E2D;&#xFF0C;&#x5219;pc=pc+4&#x3002;&#x82E5;&#x8DF3;&#x8F6C;&#x7684;&#x76EE;&#x6807;&#x662F;&#x4E00;&#x6761;&#x666E;&#x901A;&#x6307;&#x4EE4;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x6BD4;&#x8F83;&#x6B63;&#x5E38;&#xFF0C;&#x4E0D;&#x6D89;&#x53CA;&#x5230;&#x72B6;&#x6001;&#x5207;&#x6362;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x4E0D;&#x8003;&#x8651;&#x3002;</p><p>&#x5F53;pc=pc+4 &#x6216;&#x8005;&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x662F;&#x5EF6;&#x65F6;&#x69FD;&#x4E2D;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x5E76;&#x4E14;&#x8DF3;&#x8F6C;&#x7684;&#x76EE;&#x6807;&#x521A;&#x597D;&#x662F;02&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x8981;&#x53D1;&#x751F;&#x72B6;&#x6001;&#x5207;&#x6362;&#x3002;&#x6B64;&#x65F6;01&#x6307;&#x4EE4;&#x5DF2;&#x5728;ID&#x7EA7;&#xFF0C;&#x5B83;&#x4E0D;&#x662F;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#xFF0C;&#x6240;&#x4EE5;pc_source&#x88AB;ID&#x7EA7;&#x8BBE;&#x7F6E;&#x6210;pc+4&#x3002;&#x800C;&#x6B64;&#x65F6;&#x662F;enter&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x6240;&#x4EE5;upc&#x88AB;&#x8BBE;&#x7F6E;&#x6210;&#x6307;&#x4EE4;&#x4E2D;&#x6240;&#x77E5;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x800C;upc_source&#x548C;pc_source&#x516C;&#x7528;&#x4E00;&#x4E2A;&#x4FE1;&#x53F7;&#xFF0C;&#x6240;&#x4EE5;upc_source&#x4E5F;&#x88AB;&#x8BBE;&#x7F6E;&#x6210;upc+4.&#x5F53; &#x4E0B;&#x4E00;&#x4E2A;&#x65F6;&#x949F;&#x5468;&#x671F;&#x5230;&#x6765;&#x65F6;&#xFF0C;&#x7531;&#x5FAE;&#x6307;&#x4EE4;&#x5B58;&#x50A8;&#x5668;&#x6307;&#x51FA;&#x7684;&#x5FAE;&#x6307;&#x4EE4;&#x88AB;&#x9001;&#x5165;ID&#xFF0C;&#x800C;pc&#x548C;upc&#x5206;&#x522B;&#x88AB;&#x5199;&#x5165;&#x4E3A;03&#x548C;&#x5FAE;&#x6307;&#x4EE4;&#x5934;&#x90E8;&#x5EF6;&#x65F6;&#x69FD;&#x7684;&#x5730;&#x5740;&#x3002;&#x5E76;&#x4E14;IF&#x7EA7;&#x5411;ID&#x7EA7;&#x9001;&#x5165;upc&#xFF0C;&#x4F9B;&#x5FAE;&#x6307;&#x4EE4;&#x4E2D;&#x7684;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#x53C2;&#x8003;&#x3002;</p><p>&#x5F53;&#x5FAE;&#x6307;&#x4EE4;&#x6267;&#x884C;&#x7ED3;&#x675F;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;upc&#x6307;&#x5411;&#x4E86;&#x4E00;&#x4E2A;&#x7EC8;&#x6B62;&#x7B26;&#x3002;&#x8FD9;&#x65F6;&#x4E0A;&#x4E00;&#x6761;&#x6307;&#x4EE4;&#xFF08;ID&#x7EA7;&#x4E2D;&#x7684;&#x6307;&#x4EE4;&#xFF09;&#xFF0C;&#x7531;&#x4E8E;&#x4E00;&#x5B9A;&#x4E0D;&#x662F;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x628A;pc_source&#x8BBE;&#x7F6E;&#x6210;pc+4&#xFF0C;&#x51C6;&#x5907;&#x5411;ID&#x7EA7;&#x8F93;&#x51FA;pc&#x6240;&#x6307;&#x7684;&#x6307;&#x4EE4;03&#x3002;&#x4E0B;&#x4E00;&#x4E2A;&#x65F6;&#x949F;&#x5230;&#x6765;&#xFF0C;upc+4&#xFF0C;pc+4=04&#xFF0C;&#x800C;upc&#x6307;&#x5411;&#x7ED3;&#x675F;&#x7B26;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x6307;&#x4EE4;&#xFF0C;&#x8131;&#x79BB;&#x7ED3;&#x675F;&#x7B26;&#x7684;&#x72B6;&#x6001;&#x3002;</p><p>&#x60C5;&#x51B5;&#x4E8C;&#x6BD4;&#x8F83;&#x7279;&#x6B8A;&#xFF0C;02&#x4F4D;&#x7F6E;&#x7684;&#x6307;&#x4EE4;&#x662F;&#x4E00;&#x4E2A;&#x5EF6;&#x65F6;&#x69FD;&#x3002;&#x6211;&#x4EEC;&#x8003;&#x8651;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;upc&#x548C;pc&#x5982;&#x4F55;&#x53D8;&#x5316;&#x3002;pc=01&#xFF0C;&#x8BE5;&#x6307;&#x4EE4;&#x662F;&#x4E00;&#x4E2A;&#x786C;&#x4EF6;&#x6307;&#x4EE4;&#xFF0C;&#x6240;&#x4EE5;&#x76F4;&#x63A5;&#x8F93;&#x51FA;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x5411;&#x4E0B;&#x4E00;&#x7EA7;&#x8F93;&#x51FA;pc&#xFF0C;&#x6B64;&#x65F6;&#x65F6;&#x949F;&#x5230;&#x6765;&#xFF0C;pc+4=02&#x6307;&#x5411;&#x5FAE;&#x6307;&#x4EE4;&#x5B9E;&#x73B0;&#x7684;&#x6307;&#x4EE4;&#x3002;&#x7531;&#x4E8E;ID&#x7EA7;&#x662F;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#xFF0C;&#x6240;&#x4EE5;ID&#x7EA7;&#x5C06;pc_source&#x8BBE;&#x7F6E;&#x6210;&#x54CD;&#x5E94;&#x7684;&#x8DF3;&#x8F6C;&#x76EE;&#x6807;&#xFF0C;&#x8FD9;&#x91CC;&#x662F;03&#x3002;&#x6240;&#x4EE5;&#x65F6;&#x949F;&#x5230;&#x6765;&#x540E;&#xFF0C;pc=03&#xFF0C;upc&#x4E3A;&#x6307;&#x4EE4;&#x4E2D;&#x6240;&#x6307;&#x793A;&#x7684;&#x5730;&#x5740;+4&#x3002;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x5B9E;&#x9645;&#x4E0A;&#x548C;&#x4E0A;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#x662F;&#x7B49;&#x4EF7;&#x7684;&#xFF0C;&#x53EA;&#x662F;&#x770B;&#x8D77;&#x6765;&#x6BD4;&#x8F83;&#x7279;&#x6B8A;&#x3002;&#x5728;&#x5FAE;&#x6307;&#x4EE4;&#x6267;&#x884C;&#x7ED3;&#x675F;&#x540E;&#xFF0C;exit&#x60C5;&#x51B5;&#x4E5F;&#x540C;&#x4E0A;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#x7B49;&#x4EF7;&#x3002;</p><p>&#x60C5;&#x51B5;&#x4E09;&#x8003;&#x8651;&#x91CD;&#x8FDB;&#x5165;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x3002;pc=01&#x8BE5;&#x6307;&#x4EE4;&#x662F;&#x4E00;&#x4E2A;&#x6B63;&#x5E38;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x4E0E;&#x60C5;&#x51B5;&#x4E00;&#x76F8;&#x540C;&#xFF0C;&#x5728;&#x8FD9;&#x5C31;&#x4E0D;&#x8BE6;&#x7EC6;&#x5206;&#x6790;&#x4E86;&#x3002;&#x8003;&#x8651;&#x91CD;&#x8FDB;&#x5165;&#x7684;&#x65F6;&#x523B;&#xFF0C;&#x5C06;02&#x6240;&#x4EE3;&#x8868;&#x7684;&#x5FAE;&#x6307;&#x4EE4;&#x9001;&#x5165;ID&#x65F6;&#xFF0C;pc&#x5DF2;&#x88AB;&#x8BBE;&#x7F6E;&#x4E3A;03&#xFF0C;&#x6B64;&#x65F6;02&#x4E2D;&#x7684;&#x5FAE;&#x6307;&#x4EE4;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#xFF0C;upc&#x6307;&#x5411;&#x7EC8;&#x6B62;&#x7B26;&#xFF0C;&#x7531;&#x4E8E;&#x6B64;&#x65F6;ID&#x7EA7;&#x4E00;&#x5B9A;&#x4E0D;&#x662F;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#xFF0C;&#x56E0;&#x6B64;pc_source&#x88AB;&#x8BBE;&#x7F6E;&#x6210;pc+4&#xFF0C;&#x7531;&#x4E8E;&#x662F;&#x91CD;&#x8FDB;&#x5165;&#xFF0C;&#x5F53;&#x65F6;&#x949F;&#x5230;&#x6765;&#x65F6;&#xFF0C;IF&#x4F1A;&#x9009;&#x51FA;03&#x6240;&#x6307;&#x7684;&#x5FAE;&#x6307;&#x4EE4;&#x4E2D;&#x7684;&#x8DF3;&#x8F6C;&#x6307;&#x4EE4;&#xFF0C;&#x5E76;&#x5C06;upc&#x8BBE;&#x7F6E;&#x4E3A;03&#x4E2D;&#x6307;&#x4EE4;&#x6240;&#x6307;&#x7684;&#x4F4D;&#x7F6E;+4&#xFF08;&#x5FAE;&#x6307;&#x4EE4;&#x5934;&#x90E8;&#x7684;&#x5EF6;&#x65F6;&#x69FD;&#xFF09;&#xFF0C;&#x540C;&#x65F6;&#x4F1A;&#x5C06;pc&#x8BBE;&#x7F6E;&#x4E3A;04.</p><p>&#x7531;&#x5BF9;&#x4E0A;&#x8FF0;&#x4E09;&#x79CD;&#x60C5;&#x51B5;&#x7684;&#x5206;&#x6790;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#xFF0C;&#x6211;&#x6240;&#x8BBE;&#x8BA1;&#x7684;&#x5FAE;&#x6307;&#x4EE4;&#x7CFB;&#x7EDF;&#x65F6;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x7684;&#x3002;&#x5BF9;&#x8FD9;&#x4E9B;&#x60C5;&#x51B5;&#x7684;&#x5206;&#x6790;&#x662F;&#x591A;&#x4F59;&#x7684;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;npc&#x548C;nupc&#x7684;&#x503C;&#x662F;&#x7531;ID&#x7EA7;&#x7684;&#x6307;&#x4EE4;&#x51B3;&#x5B9A;&#x7684;&#x3002;ID&#x7EA7;&#x662F;&#x786C;&#x4EF6;&#x6307;&#x4EE4;&#xFF0C;IF&#x6B63;&#x5728;&#x5904;&#x7406;&#x5FAE;&#x6307;&#x4EE4;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF08;enter&#xFF09;upc&#x662F;&#x7279;&#x6B8A;&#x5904;&#x7406;&#x7684;&#xFF0C;&#x5E76;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;pc&#x7684;&#x66F4;&#x65B0;&#x3002;&#x540C;&#x7406;ID&#x7EA7;&#x65F6;&#x5FAE;&#x6307;&#x4EE4;&#xFF0C;IF&#x7EA7;&#x6B63;&#x5728;&#x5904;&#x7406;&#x786C;&#x4EF6;&#x6307;&#x4EE4;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;upc&#x548C;pc&#x90FD;&#x76F4;&#x63A5;&#x52A0;4&#xFF0C;upc+4&#x540E;&#x8DE8;&#x8D8A;&#x4E86;&#x7EC8;&#x7ED3;&#x7B26;&#xFF0C;&#x5176;&#x503C;&#x5728;&#x4E0B;&#x4E00;&#x6B21;&#x8FDB;&#x5165;&#x65F6;&#x5728;&#x88AB;&#x66F4;&#x65B0;&#x3002;&#x5176;&#x4F59;&#x7684;&#x60C5;&#x51B5;ID&#x7EA7;&#x65F6;&#x786C;&#x4EF6;&#x6307;&#x4EE4;&#xFF0C;IF&#x7EA7;&#x4E5F;&#x662F;&#x786C;&#x4EF6;&#x6307;&#x4EE4;&#x6216;&#x8005;ID&#x7EA7;&#x662F;&#x5FAE;&#x6307;&#x4EE4;&#xFF0C;IF&#x7EA7;&#x4E5F;&#x662F;&#x5FAE;&#x6307;&#x4EE4;&#xFF0C;&#x8FD9;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#x4E0E;&#x672A;&#x52A0;&#x5165;&#x5FAE;&#x6307;&#x4EE4;&#x7CFB;&#x7EDF;&#x7684;&#x60C5;&#x51B5;&#x76F8;&#x540C;&#xFF0C;&#x53EA;&#x662F;&#x9009;&#x62E9;&#x6027;&#x7684;&#x5BF9;pc&#x548C;upc&#x7684;&#x5199;&#x5165;&#x8FDB;&#x884C;&#x4F7F;&#x80FD;&#x63A7;&#x5236;&#x3002;</p><h2 id="&#x5FAE;&#x6307;&#x4EE4;&#x7CFB;&#x7EDF;&#x5BF9;&#x7CBE;&#x786E;&#x4E2D;&#x65AD;&#x7684;&#x5F71;&#x54CD;"><a href="#&#x5FAE;&#x6307;&#x4EE4;&#x7CFB;&#x7EDF;&#x5BF9;&#x7CBE;&#x786E;&#x4E2D;&#x65AD;&#x7684;&#x5F71;&#x54CD;" class="headerlink" title="&#x5FAE;&#x6307;&#x4EE4;&#x7CFB;&#x7EDF;&#x5BF9;&#x7CBE;&#x786E;&#x4E2D;&#x65AD;&#x7684;&#x5F71;&#x54CD;"></a>&#x5FAE;&#x6307;&#x4EE4;&#x7CFB;&#x7EDF;&#x5BF9;&#x7CBE;&#x786E;&#x4E2D;&#x65AD;&#x7684;&#x5F71;&#x54CD;</h2><p>&#x5728;&#x6D41;&#x6C34;&#x7EBF;&#x4E2D;&#x5B9E;&#x73B0;&#x7CBE;&#x786E;&#x4E2D;&#x65AD;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4EF6;&#x5BB9;&#x6613;&#x7684;&#x4E8B;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5728;&#x6709;&#x5206;&#x652F;&#x3001;&#x6709;&#x5EF6;&#x65F6;&#x69FD;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x3002;&#x6240;&#x4EE5;&#x7B14;&#x8005;&#x4E0D;&#x6253;&#x7B97;&#x91C7;&#x7528;&#x5217;&#x4E3E;&#x5404;&#x79CD;&#x60C5;&#x51B5;&#x6765;&#x5206;&#x6790;&#x5F15;&#x5165;&#x5FAE;&#x6307;&#x4EE4;&#x5BF9;&#x7CBE;&#x786E;&#x4E2D;&#x65AD;&#x7684;&#x5F71;&#x54CD;&#xFF0C;&#x800C;&#x662F;&#x8BD5;&#x56FE;&#x4ECE;&#x66F4;&#x9AD8;&#x7684;&#x5C42;&#x9762;&#x53BB;&#x601D;&#x8003;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x4EE5;&#x5BF9;&#x7EC8;&#x7AEF;&#x7CFB;&#x7EDF;&#x8FDB;&#x884C;&#x9488;&#x5BF9;&#x6027;&#x7684;&#x4FEE;&#x6539;&#x3002;</p><p>&#x4E2D;&#x65AD;&#x548C;&#x5F02;&#x5E38;&#x4F1A;&#x5728;ID&#x7EA7;&#x6216;&#x8005;EXE&#x7EA7;&#x5230;&#x6765;&#x3002;ID&#x7EA7;&#x7684;&#x5F02;&#x5E38;&#xFF0C;&#x53EF;&#x4EE5;&#x662F;&#x786C;&#x4EF6;&#x4E2D;&#x65AD;&#xFF0C;&#x672A;&#x5B9E;&#x73B0;&#x7684;&#x6307;&#x4EE4;&#x6216;&#x8005;&#x662F;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;systemcall&#x3002;EXE&#x7EA7;&#x7684;&#x5F02;&#x5E38;&#x53EF;&#x4EE5;&#x662F;&#x7B97;&#x672F;&#x6307;&#x4EE4;&#x7684;&#x6EA2;&#x51FA;&#x3002;</p><h3 id="&#x8BE5;&#x5FAE;&#x6307;&#x4EE4;&#x7CFB;&#x7EDF;&#x5BF9;&#x539F;&#x6709;&#x7CBE;&#x786E;&#x4E2D;&#x65AD;&#x7684;&#x517C;&#x5BB9;&#x6027;&#x5206;&#x6790;"><a href="#&#x8BE5;&#x5FAE;&#x6307;&#x4EE4;&#x7CFB;&#x7EDF;&#x5BF9;&#x539F;&#x6709;&#x7CBE;&#x786E;&#x4E2D;&#x65AD;&#x7684;&#x517C;&#x5BB9;&#x6027;&#x5206;&#x6790;" class="headerlink" title="&#x8BE5;&#x5FAE;&#x6307;&#x4EE4;&#x7CFB;&#x7EDF;&#x5BF9;&#x539F;&#x6709;&#x7CBE;&#x786E;&#x4E2D;&#x65AD;&#x7684;&#x517C;&#x5BB9;&#x6027;&#x5206;&#x6790;"></a>&#x8BE5;&#x5FAE;&#x6307;&#x4EE4;&#x7CFB;&#x7EDF;&#x5BF9;&#x539F;&#x6709;&#x7CBE;&#x786E;&#x4E2D;&#x65AD;&#x7684;&#x517C;&#x5BB9;&#x6027;&#x5206;&#x6790;</h3><p>&#x5206;&#x6790;&#x5F15;&#x5165;&#x5FAE;&#x6307;&#x4EE4;&#x5BF9;&#x7CBE;&#x786E;&#x4E2D;&#x65AD;&#x7684;&#x5F71;&#x54CD;&#xFF0C;&#x8981;&#x5206;&#x6790;IF&#x9636;&#x6BB5;&#x7684;&#x53D6;&#x6307;&#x7ED3;&#x679C;&#xFF0C;&#x548C;&#x90A3;&#x4E9B;&#x56E0;&#x7D20;&#x6709;&#x5173;&#x3002;&#x5982;&#x679C;&#x4E2D;&#x65AD;&#x5230;&#x6765;&#xFF0C;&#x6240;&#x4FDD;&#x5B58;&#x7684;&#x73B0;&#x573A;&#x80FD;&#x591F;&#x5728;&#x6062;&#x590D;&#x65F6;&#x786E;&#x4FDD;&#x53D6;&#x51FA;&#x7684;&#x6307;&#x4EE4;&#x662F;&#x6B63;&#x786E;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x5F15;&#x5165;&#x5FAE;&#x6307;&#x4EE4;&#x5BF9;&#x4E2D;&#x65AD;&#x5C31;&#x662F;&#x517C;&#x5BB9;&#x7684;&#x3002;</p><p>&#x65F6;&#x949F;&#x5230;&#x6765;&#x65F6;&#xFF0C;&#x5B58;&#x5165;IR&#x7684;&#x6307;&#x4EE4;&#x4E0E;&#x4E0B;&#x9762;&#x56E0;&#x7D20;&#x6709;&#x5173;&#xFF1A;</p><ol><li>pc&#x7684;&#x503C;</li><li>upc&#x7684;&#x503C;</li><li>IF&#x7684;&#x72B6;&#x6001;state</li></ol><p>&#x521D;&#x770B;&#x4E0A;&#x4E00;&#x5F20;&#x7684;&#x771F;&#x503C;&#x8868;&#xFF0C;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x5B58;&#x5165;IR&#x7684;&#x6307;&#x4EE4;&#x8FD8;&#x548C;&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x662F;&#x5426;&#x662F;&#x786C;&#x4EF6;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x548C;&#x5F53;&#x524D;&#x5FAE;&#x6307;&#x4EE4;&#x662F;&#x5426;&#x662F;&#x7ED3;&#x675F;&#x7B26;&#x6709;&#x5173;&#x3002;&#x4F46;&#x5982;&#x679C;&#x8003;&#x8651;&#x5B58;&#x50A8;&#x5668;&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x5728;&#x662F;&#x56FA;&#x5B9A;&#x7684;&#xFF08;&#x5BF9;&#x4E8E;&#x6307;&#x4EE4;&#x548C;&#x5FAE;&#x6307;&#x4EE4;&#x800C;&#x8A00;&#xFF0C;&#x5B58;&#x50A8;&#x5668;&#x7684;&#x5185;&#x5BB9;&#x90FD;&#x662F;&#x56FA;&#x5B9A;&#x7684;&#xFF09;&#xFF0C;&#x90A3;&#x4E48;&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x548C;&#x5F53;&#x524D;&#x5FAE;&#x6307;&#x4EE4;&#x5747;&#x662F;&#x7531;pc&#x548C;upc&#x51B3;&#x5B9A;&#x7684;&#x3002;</p><p>&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x53EA;&#x8981;&#x4FDD;&#x5B58;pc&#x3001;upc&#x548C;state&#xFF0C;&#x5728;&#x6062;&#x590D;&#x65F6;&#x5C31;&#x53EF;&#x4EE5;&#x6062;&#x590D;&#x8FD9;&#x4E00;&#x4E2A;&#x65F6;&#x949F;&#x5230;&#x6765;&#x65F6;&#x6240;&#x53D6;&#x7684;&#x6307;&#x4EE4;&#x3002;</p><p>&#x800C;&#x7CBE;&#x786E;&#x4E2D;&#x65AD;&#x7684;&#x673A;&#x5236;&#xFF0C;&#x5C31;&#x662F;&#x6839;&#x636E;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x4FDD;&#x5B58;&#x4E2D;&#x65AD;&#x8FD4;&#x56DE;&#x5730;&#x5740;&#x53D6;&#x6307;&#x65F6;&#x7684;IF&#x72B6;&#x6001;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x5BF9;&#x539F;&#x6709;&#x7EC8;&#x7AEF;&#x7CFB;&#x7EDF;&#x7684;&#x4FEE;&#x6539;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x5C06;&#x8FC7;&#x53BB;&#x53EA;&#x4FDD;&#x5B58;PC&#xFF0C;&#x6539;&#x4E3A;&#x540C;&#x65F6;&#x4FDD;&#x5B58;PC&#x3001;uPC&#x548C;state&#x5373;&#x53EF;&#x3002;</p><h3 id="&#x4E2D;&#x65AD;&#x5230;&#x6765;&#x5BF9;&#x53D6;&#x6307;&#x7684;&#x5F71;&#x54CD;"><a href="#&#x4E2D;&#x65AD;&#x5230;&#x6765;&#x5BF9;&#x53D6;&#x6307;&#x7684;&#x5F71;&#x54CD;" class="headerlink" title="&#x4E2D;&#x65AD;&#x5230;&#x6765;&#x5BF9;&#x53D6;&#x6307;&#x7684;&#x5F71;&#x54CD;"></a>&#x4E2D;&#x65AD;&#x5230;&#x6765;&#x5BF9;&#x53D6;&#x6307;&#x7684;&#x5F71;&#x54CD;</h3><p>&#x5982;&#x679C;&#x6CA1;&#x6709;&#x4E2D;&#x65AD;&#x673A;&#x5236;&#xFF0C;IF&#x7EA7;&#x7684;&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x5982;&#x4E0A;&#x4E00;&#x8282;&#x7684;&#x8868;&#x683C;&#x6240;&#x793A;&#x3002;&#x4F46;&#x662F;&#x4E2D;&#x65AD;&#x673A;&#x5236;&#x7684;&#x5F15;&#x5165;&#x4F7F;IF&#x7EA7;&#x53D8;&#x5F97;&#x66F4;&#x52A0;&#x590D;&#x6742;&#x3002;</p><p>&#x4E2D;&#x65AD;&#x76F8;&#x5F53;&#x4E8E;&#x5F3A;&#x5236;&#x8DF3;&#x8F6C;&#x5E76;&#x4FDD;&#x5B58;&#x73B0;&#x573A;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x4E2D;&#x65AD;&#x5230;&#x6765;&#x65F6;&#x5E94;&#x5F53;&#x5F3A;&#x5236;&#x66F4;&#x65B0;pc&#x7684;&#x503C;&#x3002;&#x4F46;&#x662F;IF&#x7EA7;&#x6240;&#x53D6;&#x7684;&#x4E0B;&#x4E00;&#x6761;&#x6307;&#x4EE4;&#x662F;&#x7531;&#x4E0A;&#x6587;&#x6240;&#x8BF4;&#x7684;pc,upc&#x4EE5;&#x53CA;state&#x51B3;&#x5B9A;&#x7684;&#xFF0C;&#x800C;ID&#x7ED9;&#x51FA;&#x7684;&#x4E2D;&#x65AD;&#x4FE1;&#x53F7;&#xFF0C;&#x53EA;&#x80FD;&#x6539;&#x53D8;PC_INT&#x591A;&#x8DEF;&#x5668;&#x7684;&#x9009;&#x62E9;&#x4FE1;&#x53F7;&#x3002;&#x7531;&#x6B64;&#x53EF;&#x77E5;&#xFF0C;&#x4E0A;&#x6587;&#x4E2D;&#x7684;&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x8FC7;&#x7A0B;&#xFF0C;&#x82E5;wpc&#x662F;1&#xFF0C;&#x5219;&#x4E2D;&#x65AD;&#x6765;&#x4E34;&#x65F6;&#xFF0C;pc&#x4F1A;&#x5728;&#x65F6;&#x949F;&#x5230;&#x6765;&#x65F6;&#x66F4;&#x65B0;&#x5230;&#x4E2D;&#x65AD;&#x5411;&#x91CF;&#x6240;&#x6307;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</p><p>&#x4F46;&#x6709;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#xFF0C;&#x82E5;&#x6B64;&#x65F6;IF&#x7EA7;&#x5904;&#x4E8E;&#x5FAE;&#x6307;&#x4EE4;&#x72B6;&#x6001;&#xFF0C;state=1&#xFF0C;&#x5E76;&#x4E14;&#x4E0B;&#x4E00;&#x6761;&#x5FAE;&#x6307;&#x4EE4;&#x4E0D;&#x662F;&#x7EC8;&#x7ED3;&#x7B26;&#xFF0C;&#x90A3;&#x4E48;wpc=0&#xFF0C;&#x5219;pc&#x5728;&#x65F6;&#x949F;&#x5230;&#x6765;&#x65F6;&#x4E0D;&#x4F1A;&#x66F4;&#x65B0;&#x4E3A;&#x4E2D;&#x65AD;&#x5411;&#x91CF;&#x6240;&#x6307;&#x7684;&#x5730;&#x5740;&#x3002;&#x8FD9;&#x4F1A;&#x9020;&#x6210;&#x9519;&#x8BEF;&#x3002;</p><p>&#x518D;&#x8003;&#x8651;IF&#x7EA7;&#x7684;&#x8F93;&#x51FA;&#x3002;IF&#x7EA7;&#x8F93;&#x51FA;&#x4E5F;&#x7531;pc,upc&#x4EE5;&#x53CA;state&#x51B3;&#x5B9A;&#xFF0C;&#x5982;&#x679C;&#x53EA;&#x5BF9;pc&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#xFF0C;&#x4F7F;&#x5F97;pc&#x5728;&#x4E2D;&#x65AD;&#x6765;&#x4E34;&#x65F6;&#x5F3A;&#x5236;&#x4FEE;&#x6539;&#xFF0C;&#x4ECD;&#x7136;&#x4E0D;&#x80FD;&#x4F7F;&#x5F97;&#x4E2D;&#x65AD;&#x5411;&#x91CF;&#x6B63;&#x786E;&#x5411;ID&#x7EA7;&#x4F20;&#x9001;&#x3002;</p><p>&#x6240;&#x4EE5;&#x4F5C;&#x8005;&#x5728;&#x72B6;&#x6001;&#x5BC4;&#x5B58;&#x5668;&#x5411;IF&#x63A7;&#x5236;&#x5668;&#x7684;&#x8F93;&#x5165;&#x5904;&#x589E;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;&#x591A;&#x8DEF;&#x5668;&#xFF0C;&#x5728;&#x4E2D;&#x65AD;&#x5230;&#x6765;&#x65F6;&#x5F3A;&#x5236;&#x8BBE;&#x7F6E;state=0&#xFF0C;&#x4F46;&#x53C8;&#x4E0D;&#x4FEE;&#x6539;state&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x8BA9;&#x539F;&#x6709;&#x7684;state&#x5BC4;&#x5B58;&#x5668;&#x5185;&#x5BB9;&#x53EF;&#x4EE5;&#x5411;&#x4E0B;&#x4F20;&#x9012;&#xFF0C;&#x4F7F;&#x4E2D;&#x65AD;&#x63A7;&#x5236;&#x7535;&#x8DEF;&#x53EF;&#x4EE5;&#x6B63;&#x786E;&#x7684;&#x4FDD;&#x5B58;&#x4E2D;&#x65AD;&#x524D;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x4E0E;&#x6B64;&#x540C;&#x65F6;&#x5236;&#x9020;enter&#x6216;&#x8005;normal&#x7684;&#x5047;&#x8C61;&#xFF0C;&#x6B63;&#x786E;&#x5904;&#x7406;&#x4E2D;&#x65AD;&#x65F6;&#x7684;&#x8DF3;&#x8F6C;&#x95EE;&#x9898;&#x3002;</p><h2 id="&#x5C0F;&#x7ED3;"><a href="#&#x5C0F;&#x7ED3;" class="headerlink" title="&#x5C0F;&#x7ED3;"></a>&#x5C0F;&#x7ED3;</h2><p>&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x63CF;&#x8FF0;&#x4E86;&#x8BE5;&#x81EA;&#x5236;&#x8BA1;&#x7B97;&#x673A;&#x7CFB;&#x7EDF;&#x4E2D;&#x5904;&#x7406;&#x5668;&#x4F7F;&#x5982;&#x4F55;&#x5904;&#x7406;&#x5FAE;&#x6307;&#x4EE4;&#x7684;&#x3002;&#x672C;&#x6587;&#x6240;&#x63CF;&#x8FF0;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x53EF;&#x4EE5;&#x5145;&#x5206;&#x5229;&#x7528;&#x786C;&#x7EBF;&#x903B;&#x8F91;&#x63A7;&#x5236;&#x5668;&#x7684;&#x901F;&#x5EA6;&#x4F18;&#x52BF;&#xFF0C;&#x53C8;&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x5FAE;&#x6307;&#x4EE4;&#x73AF;&#x5883;&#x5BF9;&#x6307;&#x4EE4;&#x96C6;&#x8FDB;&#x884C;&#x6269;&#x5145;&#x3002;&#x8BE5;&#x65B9;&#x6CD5;&#x533A;&#x522B;&#x4E8E;&#x5728;&#x5F88;&#x591A;&#x4E66;&#x4E2D;&#x8BB0;&#x8F7D;&#x7684;&#x5FAE;&#x6307;&#x4EE4;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#xFF0C;&#x4E0D;&#x4F7F;&#x7528;&#x5FAE;&#x6307;&#x4EE4;&#x89E3;&#x7801;&#x6765;&#x63A7;&#x5236;&#x5404;&#x4E2A;&#x529F;&#x80FD;&#x90E8;&#x4EF6;&#x5B9E;&#x73B0;&#x4E0D;&#x540C;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x800C;&#x662F;&#x76F4;&#x63A5;&#x4EE5;&#x786C;&#x4EF6;&#x5B9E;&#x73B0;&#x7684;&#x6307;&#x4EE4;&#x4F5C;&#x4E3A;&#x5FAE;&#x6307;&#x4EE4;&#x3002;&#x4E00;&#x6761;&#x7531;&#x5FAE;&#x6307;&#x4EE4;&#x5B9E;&#x73B0;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x50CF;&#x4E00;&#x4E2A;&#x6C47;&#x7F16;&#x8BED;&#x8A00;&#x4E2D;&#x7684;&#x5B8F;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8FD9;&#x4E2A;&#x5FAE;&#x6307;&#x4EE4;&#x6A21;&#x5757;&#xFF0C;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#x81EA;&#x7136;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6C47;&#x7F16;&#x8BED;&#x8A00;&#x7684;&#x5B8F;&#x6765;&#x5B9E;&#x73B0;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5FAE;&#x6307;&#x4EE4;&#x6A21;&#x5757;&#x7684;&#x610F;&#x4E49;&#x4ECD;&#x7136;&#x5B58;&#x5728;&#xFF0C;&#x7ECF;&#x8FC7;&#x7CBE;&#x5FC3;&#x8C03;&#x8BD5;&#x7684;&#x5FAE;&#x6307;&#x4EE4;&#xFF0C;&#x53EF;&#x4EE5;&#x5145;&#x5206;&#x5229;&#x7528;&#x5EF6;&#x65F6;&#x69FD;&#x3001;&#x6D41;&#x6C34;&#x7EBF;&#x51B2;&#x7A81;&#x907F;&#x514D;&#x7B49;&#x7279;&#x6027;&#x6765;&#x83B7;&#x5F97;&#x6BD4;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5B8F;&#x66F4;&#x597D;&#x7684;&#x6027;&#x80FD;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x7CFB;&#x7EDF;&#x7F16;&#x7A0B;&#x65F6;&#x51FA;&#x9519;&#x7684;&#x6982;&#x7387;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x53EF;&#x6267;&#x884C;&#x4EE3;&#x7801;&#x7684;&#x4F53;&#x79EF;&#x3002;&#x5728;&#x67D0;&#x4E9B;&#x5FC5;&#x987B;&#x4F7F;&#x7528;&#x591A;&#x5468;&#x671F;&#x624D;&#x80FD;&#x5B9E;&#x73B0;&#x7684;&#x786C;&#x4EF6;&#x6307;&#x4EE4;&#xFF0C;&#x628A;&#x4ED6;&#x8F6C;&#x6362;&#x6210;&#x8FD9;&#x6837;&#x7684;&#x5FAE;&#x6307;&#x4EE4;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x4ED8;&#x51FA;&#x6781;&#x5C11;&#x7684;&#x786C;&#x4EF6;&#x4EE3;&#x4EF7;&#xFF0C;&#x5E76;&#x4E14;&#x5176;&#x6267;&#x884C;&#x53EF;&#x4EE5;&#x9AD8;&#x6548;&#x7684;&#x5229;&#x7528;&#x6D41;&#x6C34;&#x7EBF;&#x3002;</p><p>&#x8BE5;&#x7CFB;&#x7EDF;&#x5B9E;&#x73B0;&#x7684;&#x96BE;&#x70B9;&#x6709;&#x4E8C;&#xFF1A;</p><ol><li>IF&#x7EA7;&#x7684;&#x6307;&#x4EE4;&#x9009;&#x62E9;&#x8BBE;&#x8BA1;</li><li>IF&#x7EA7;&#x7684;&#x6307;&#x4EE4;&#x9009;&#x62E9;&#x4E0E;&#x4E2D;&#x65AD;&#x7CFB;&#x7EDF;&#x7684;&#x7ED3;&#x5408;&#x548C;&#x517C;&#x5BB9;&#x8BBE;&#x8BA1;</li></ol><p>&#x5173;&#x4E8E;&#x8BE5;&#x7CFB;&#x7EDF;&#x7684;&#x8FDB;&#x4E00;&#x6B65;&#x9A8C;&#x8BC1;&#xFF0C;&#x7B49;&#x5230;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#xFF0C;&#x4F1A;&#x7528;EDA&#x5DE5;&#x5177;&#x4EFF;&#x771F;&#x5B9E;&#x9A8C;&#xFF0C;&#x5C4A;&#x65F6;&#x7B14;&#x8005;&#x4F1A;&#x628A;&#x786C;&#x4EF6;&#x903B;&#x8F91;&#x63CF;&#x8FF0;&#x548C;&#x6D4B;&#x8BD5;&#x7528;&#x4F8B;&#x540C;&#x6B65;&#x66F4;&#x65B0;&#x5728;&#x6587;&#x7AE0;&#x4E2D;&#x3002;</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&amp;#x672C;&amp;#x9879;&amp;#x76EE;&amp;#x6240;&amp;#x8BBE;&amp;#x8BA1;&amp;#x7684;CPU&amp;#xFF0C;&amp;#x4E0E;&amp;#x674E;&amp;#x4E9A;&amp;#x6C11;&amp;#x4E66;&amp;#x4E2D;&amp;#x6240;&amp;#x63CF;&amp;#x8FF</summary>
      
    
    
    
    <category term="home brew computer system" scheme="https://gpthimble.github.io/categories/home-brew-computer-system/"/>
    
    
    <category term="development log" scheme="https://gpthimble.github.io/tags/development-log/"/>
    
    <category term="home brew computer system" scheme="https://gpthimble.github.io/tags/home-brew-computer-system/"/>
    
    <category term="cpu design" scheme="https://gpthimble.github.io/tags/cpu-design/"/>
    
    <category term="micro program" scheme="https://gpthimble.github.io/tags/micro-program/"/>
    
  </entry>
  
  <entry>
    <title>这只是一个自制计算机系统的项目</title>
    <link href="https://gpthimble.github.io/%E8%BF%99%E5%8F%AA%E6%98%AF%E4%B8%80%E4%B8%AA%E8%87%AA%E5%88%B6%E7%B3%BB%E7%AE%97%E8%AE%A1%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%A1%B9%E7%9B%AE/"/>
    <id>https://gpthimble.github.io/%E8%BF%99%E5%8F%AA%E6%98%AF%E4%B8%80%E4%B8%AA%E8%87%AA%E5%88%B6%E7%B3%BB%E7%AE%97%E8%AE%A1%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%A1%B9%E7%9B%AE/</id>
    <published>2020-05-04T01:45:52.000Z</published>
    <updated>2020-05-05T04:51:43.000Z</updated>
    
    <content type="html"><![CDATA[<p>&#x8BE5;&#x9879;&#x76EE;&#x662F;&#x4E00;&#x4E2A;&#x81EA;&#x5236;<strong>&#x8BA1;&#x7B97;&#x673A;&#x7CFB;&#x7EDF;</strong>&#x7684;&#x9879;&#x76EE;&#xFF0C;&#x5176;&#x76EE;&#x6807;&#x5305;&#x62EC;cpu&#x8BBE;&#x8BA1;&#x3001;&#x5916;&#x56F4;&#x7684;&#x63A7;&#x5236;&#x5668;&#x5982;&#x5185;&#x5B58;&#x3001;cache&#x3001;IO&#x3001;&#x4E2D;&#x65AD;&#x7B49;&#x8BBE;&#x8BA1;&#x3001;&#x5916;&#x8BBE;&#x5982;&#x6253;&#x5370;&#x673A;&#x3001;&#x5B58;&#x50A8;&#x5668;&#x7B49;&#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x548C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x79FB;&#x690D;&#x3002;&#x9879;&#x76EE;&#x672C;&#x8EAB;&#x5E76;&#x4E0D;&#x8FFD;&#x6C42;&#x6781;&#x9650;&#x6027;&#x80FD;&#xFF0C;&#x548C;&#x5B8C;&#x7F8E;&#x7684;&#x5B89;&#x5168;&#x6027;&#xFF0C;&#x53EA;&#x662F;&#x5728;&#x529B;&#x6240;&#x80FD;&#x53CA;&#x7684;&#x6761;&#x4EF6;&#x4E0B;&#x505A;&#x4E00;&#x4E9B;&#x4F18;&#x5316;&#x3002;&#x529F;&#x80FD;&#x5B8C;&#x5584;&#x3001;&#x6613;&#x4E8E;&#x6D4B;&#x8BD5;&#x548C;&#x6269;&#x5C55;&#x662F;&#x672C;&#x9879;&#x76EE;&#x7684;&#x9996;&#x8981;&#x76EE;&#x6807;&#x3002;</p><h3 id="&#x786C;&#x4EF6;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;"><a href="#&#x786C;&#x4EF6;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;" class="headerlink" title="&#x786C;&#x4EF6;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;"></a>&#x786C;&#x4EF6;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;</h3><p>&#x672C;&#x9879;&#x76EE;&#x6240;&#x4F7F;&#x7528;&#x7684;CPU&#x4E3A;&#x7C7B;MIPS&#x67B6;&#x6784;&#xFF0C;&#x786C;&#x7EBF;&#x903B;&#x8F91;&#x4EC5;&#x652F;&#x6301;&#x6574;&#x6570;&#x6307;&#x4EE4;&#xFF0C;&#x6CA1;&#x6709;&#x786C;&#x4EF6;&#x4E58;&#x6CD5;&#x5668;&#x3001;&#x9664;&#x6CD5;&#x5668;&#x3002;&#x5728;FPGA&#x4E2D;&#x7EFC;&#x5408;&#xFF0C;&#x4E0D;&#x4F7F;&#x7528;&#x4EFB;&#x4F55;&#x57FA;&#x4E8E;&#x5382;&#x5546;&#x7684;IP&#x3002;&#x91C7;&#x7528;5&#x7EA7;&#x6D41;&#x6C34;&#x7EBF;&#xFF0C;&#x7CBE;&#x786E;&#x4E2D;&#x65AD;&#xFF0C;&#x96C6;&#x6210;SDRAM&#x53CC;&#x7AEF;&#x53E3;&#x63A7;&#x5236;&#x5668;&#xFF0C;&#x5305;&#x542B;&#x4E00;&#x7EA7;&#x6307;&#x4EE4;&#x548C;&#x6570;&#x636E;cache&#x3002;</p><p>CPU&#x7684;&#x6574;&#x4F53;&#x7ED3;&#x6784;&#x4E0E;&#x674E;&#x4E9A;&#x6C11;&#x6240;&#x8457;&#x7684;&#x300A;&#x8BA1;&#x7B97;&#x673A;&#x539F;&#x7406;&#x4E0E;&#x8BBE;&#x8BA1;&#x300B;&#x4E2D;&#x7684;&#x76F8;&#x4F3C;&#xFF0C;&#x4F46;&#x8C03;&#x6574;&#x4E86;&#x4E00;&#x4E9B;&#x6307;&#x4EE4;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x5E76;&#x671F;&#x671B;&#x5F15;&#x5165;&#x5FAE;&#x4EE3;&#x7801;&#x6765;&#x589E;&#x52A0;CPU&#x7684;&#x53EF;&#x6269;&#x5C55;&#x6027;&#xFF0C;&#x964D;&#x4F4E;&#x7F16;&#x8BD1;&#x5668;&#x79FB;&#x690D;&#x548C;&#x7CFB;&#x7EDF;&#x7F16;&#x7A0B;&#x7684;&#x96BE;&#x5EA6;&#x3002;</p><h3 id="&#x7F16;&#x8BD1;&#x5668;&#x79FB;&#x690D;&#x76EE;&#x6807;"><a href="#&#x7F16;&#x8BD1;&#x5668;&#x79FB;&#x690D;&#x76EE;&#x6807;" class="headerlink" title="&#x7F16;&#x8BD1;&#x5668;&#x79FB;&#x690D;&#x76EE;&#x6807;"></a>&#x7F16;&#x8BD1;&#x5668;&#x79FB;&#x690D;&#x76EE;&#x6807;</h3><p>&#x672C;&#x9879;&#x76EE;&#x8BA1;&#x5212;&#x79FB;&#x690D;lcc&#x7F16;&#x8BD1;&#x5668;&#x5230;&#x8BE5;&#x5E73;&#x53F0;&#xFF0C;&#x4EE5;&#x5B9E;&#x73B0;&#x5DE5;&#x5177;&#x94FE;&#x8F6F;&#x4EF6;&#x3002;&#x7531;&#x4E8E;&#x672C;&#x9879;&#x76EE;&#x6240;&#x4F7F;&#x7528;&#x7684;CPU&#x4E0E;MIPS&#x7ED3;&#x6784;&#x76F8;&#x4F3C;&#xFF0C;&#x6240;&#x4EE5;&#x79FB;&#x690D;&#x57FA;&#x4E8E;lcc&#x7F16;&#x8BD1;&#x5668;&#x7684;MIPS&#x540E;&#x7AEF;md&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x3002;&#x7531;&#x4E8E;&#x672C;&#x9879;&#x76EE;&#x6240;&#x4F7F;&#x7528;&#x7684;CPU&#x4E0E;MIPS&#x7ED3;&#x6784;&#x4E0D;&#x5B8C;&#x5168;&#x76F8;&#x540C;&#xFF0C;&#x4FEE;&#x6539;lcc&#x7684;&#x540E;&#x7AEF;&#x7684;&#x5DE5;&#x4F5C;&#x53EF;&#x80FD;&#x5305;&#x62EC;&#xFF1A;</p><ul><li>&#x719F;&#x6089;lcc&#x7684;&#x6574;&#x4F53;&#x7ED3;&#x6784;,&#x5305;&#x62EC;&#x5176;&#x524D;&#x7AEF;&#x548C;&#x4E2D;&#x95F4;&#x4EE3;&#x7801;&#x751F;&#x6210;</li><li>&#x57FA;&#x4E8E;MIPS&#x540E;&#x7AEF;&#x9488;&#x5BF9;&#x8BE5;&#x5E73;&#x53F0;&#x8FDB;&#x884C;&#x79FB;&#x690D;</li><li>&#x8FDB;&#x884C;&#x4E00;&#x4E9B;&#x529B;&#x6240;&#x80FD;&#x53CA;&#x7684;&#x4F18;&#x5316;&#x548C;&#x6D4B;&#x8BD5;&#x5DE5;&#x4F5C;</li></ul><p>&#x7F16;&#x8BD1;&#x5668;&#x662F;&#x4E00;&#x4E2A;&#x5341;&#x5206;&#x590D;&#x6742;&#x7684;&#x7A0B;&#x5E8F;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x79FB;&#x690D;&#x5DE5;&#x4F5C;&#x53EF;&#x80FD;&#x662F;&#x6574;&#x4E2A;&#x9879;&#x76EE;&#x4E2D;&#x96BE;&#x5EA6;&#x6700;&#x5927;&#x7684;&#x90E8;&#x5206;&#x3002;</p><h3 id="&#x5176;&#x4ED6;&#x5DE5;&#x5177;&#x94FE;&#x8F6F;&#x4EF6;&#x7684;&#x8BBE;&#x8BA1;"><a href="#&#x5176;&#x4ED6;&#x5DE5;&#x5177;&#x94FE;&#x8F6F;&#x4EF6;&#x7684;&#x8BBE;&#x8BA1;" class="headerlink" title="&#x5176;&#x4ED6;&#x5DE5;&#x5177;&#x94FE;&#x8F6F;&#x4EF6;&#x7684;&#x8BBE;&#x8BA1;"></a>&#x5176;&#x4ED6;&#x5DE5;&#x5177;&#x94FE;&#x8F6F;&#x4EF6;&#x7684;&#x8BBE;&#x8BA1;</h3><ul><li>&#x5BF9;&#x4E8E;&#x8FDE;&#x63A5;&#x5668;&#xFF0C;&#x672C;&#x9879;&#x76EE;&#x8BA4;&#x4E3A;&#x5176;&#x5728;&#x9879;&#x76EE;&#x521D;&#x671F;&#x662F;&#x53EF;&#x9009;&#x7684;</li><li>&#x5BF9;&#x4E8E;&#x6C47;&#x7F16;&#x5668;&#xFF0C;&#x672C;&#x9879;&#x76EE;&#x62DF;&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x7EF4;&#x62A4;&#x826F;&#x597D;&#x7684;&#x5F00;&#x6E90;&#x6C47;&#x7F16;&#x5668;&#x4E3A;&#x57FA;&#x7840;&#xFF0C;&#x8FDB;&#x884C;&#x4FEE;&#x6539;</li><li>&#x5BF9;&#x4E8E;&#x9884;&#x5904;&#x7406;&#x5668;&#xFF0C;&#x672C;&#x9879;&#x76EE;&#x62DF;&#x76F4;&#x63A5;&#x4F7F;&#x7528;gcc&#x5DE5;&#x5177;&#x94FE;&#x7684;C&#x8BED;&#x8A00;&#x9884;&#x5904;&#x7406;&#x5668;</li></ul><h3 id="&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x79FB;&#x690D;&#x76EE;&#x6807;"><a href="#&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x79FB;&#x690D;&#x76EE;&#x6807;" class="headerlink" title="&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x79FB;&#x690D;&#x76EE;&#x6807;"></a>&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x79FB;&#x690D;&#x76EE;&#x6807;</h3><p>&#x9274;&#x4E8E;MINIX&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x6709;&#x8BE6;&#x7EC6;&#x7684;&#x8D44;&#x6599;&#xFF0C;&#x5E76;&#x4E14;&#x4EE3;&#x7801;&#x91CF;&#x5F88;&#x5C11;&#x53EA;&#x6709;&#x51E0;&#x4E07;&#x884C;&#xFF0C;&#x672C;&#x9879;&#x76EE;&#x6253;&#x7B97;&#x5728;&#x5DE5;&#x5177;&#x94FE;&#x8F6F;&#x4EF6;&#x8C03;&#x8BD5;&#x9002;&#x5F53;&#x65F6;&#xFF0C;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x79FB;&#x690D;&#x5DE5;&#x4F5C;&#xFF0C;&#x76EE;&#x6807;&#x662F;&#x5C06;MINIX&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x79FB;&#x690D;&#x5230;&#x8BE5;&#x81EA;&#x5236;&#x5E73;&#x53F0;&#x3002;&#x8FD9;&#x4E9B;&#x5DE5;&#x4F5C;&#x53EF;&#x80FD;&#x5305;&#x542B;&#xFF1A;</p><ul><li>Minix &#x6E90;&#x7801;&#x7684;&#x9605;&#x8BFB;</li><li>X86 &#x4FDD;&#x62A4;&#x6A21;&#x5F0F;&#x7684;&#x8003;&#x5BDF;</li><li>&#x5BF9;&#x4E8E;&#x8BE5;&#x81EA;&#x5236;&#x5E73;&#x53F0;&#x7684;&#x4FDD;&#x62A4;&#x6A21;&#x5F0F;&#x7684;&#x8BBE;&#x8BA1;&#x53D6;&#x820D;&#x7684;&#x601D;&#x8003;</li><li>&#x5728;&#x4E0D;&#x5F71;&#x54CD;&#x517C;&#x5BB9;&#x6027;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x52A0;&#x5165;&#x865A;&#x62DF;&#x5185;&#x5B58;&#xFF08;&#x6BB5;&#x5F0F;&#x6216;&#x9875;&#x5F0F;&#xFF09;</li><li>Minix &#x7684;&#x79FB;&#x690D;&#x5DE5;&#x4F5C;</li></ul><p>&#x4ECE;&#x76EE;&#x524D;&#x6765;&#x770B;&#xFF0C;minix&#x4E2D;&#x5E73;&#x53F0;&#x76F8;&#x5173;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5927;&#x91CF;&#x662F;&#x5904;&#x7406;&#x4FDD;&#x62A4;&#x6A21;&#x5F0F;&#x3001;&#x4E2D;&#x65AD;&#x5411;&#x91CF;&#x7B49;&#x5185;&#x5BB9;&#xFF0C;&#x5728;&#x786C;&#x4EF6;&#x76F8;&#x5173;&#x7684;&#x8BBE;&#x8BA1;&#x4E0A;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x53D6;&#x820D;&#xFF0C;&#x4EE5;&#x7B80;&#x5316;&#x79FB;&#x690D;&#x5DE5;&#x4F5C;&#x3002;</p><p>&#x5BF9;&#x4E8E;&#x8BE5;&#x81EA;&#x5236;&#x5E73;&#x53F0;&#x7684;&#x4FDD;&#x62A4;&#x6A21;&#x5F0F;&#x7684;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x4E3A;&#x4E86;&#x4FDD;&#x62A4;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5185;&#x6838;&#x7684;&#x5B89;&#x5168;&#xFF0C;&#x4FDD;&#x969C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x7A33;&#x5B9A;&#x8FD0;&#x884C;&#x3002;&#x5E76;&#x4E0D;&#x8FFD;&#x6C42;&#x5B8C;&#x7F8E;&#x7684;&#x8FDB;&#x7A0B;&#x95F4;&#x7684;&#x6570;&#x636E;&#x9694;&#x79BB;&#x3002;&#x56E0;&#x4E3A;Intel&#x7684;&#x5904;&#x7406;&#x5668;&#xFF0C;&#x82B1;&#x8D39;&#x4E86;&#x5DE8;&#x5927;&#x7684;&#x7CBE;&#x529B;&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x5176;&#x7CBE;&#x5999;&#x7684;&#x4FDD;&#x62A4;&#x6A21;&#x5F0F;&#xFF0C;&#x4ECD;&#x7136;&#x9003;&#x4E0D;&#x8FC7;&#x5E7D;&#x7075;&#x3001;&#x7194;&#x6BC1;&#x7B49;&#x65C1;&#x8DEF;&#x653B;&#x51FB;&#x3002;&#x6240;&#x4EE5;&#x5728;&#x4E00;&#x4E2A;&#x79D1;&#x7814;&#x6027;&#x8D28;&#x7684;&#x81EA;&#x5236;&#x5E73;&#x53F0;&#x4E0A;&#x8FFD;&#x6C42;&#x5B8C;&#x7F8E;&#x7684;&#x6570;&#x636E;&#x9694;&#x79BB;&#x662F;&#x4E0D;&#x81EA;&#x91CF;&#x529B;&#x7684;&#x884C;&#x4E3A;&#x3002;</p><p>Minix3 &#x5E76;&#x4E0D;&#x652F;&#x6301;&#x5206;&#x9875;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x6BB5;&#x5F0F;&#x5B58;&#x50A8;&#xFF0C;&#x8FD9;&#x9700;&#x8981;&#x5BF9;cpu&#x7684;&#x5185;&#x5B58;&#x63A7;&#x5236;&#x8FDB;&#x884C;&#x4E00;&#x4E9B;&#x4FEE;&#x6539;&#x3002;</p><p>&#x5E0C;&#x671B;&#x5411;CPU&#x4E2D;&#x52A0;&#x5165;&#x5FAE;&#x4EE3;&#x7801;&#xFF0C;&#x4E5F;&#x6709;&#x65B9;&#x4FBF;&#x7CFB;&#x7EDF;&#x7F16;&#x7A0B;&#x7684;&#x76EE;&#x7684;&#x3002;&#x53EF;&#x5C06;&#x5E38;&#x7528;&#x7684;&#x7CFB;&#x7EDF;&#x7F16;&#x7A0B;&#x6307;&#x4EE4;&#x5E8F;&#x5217;&#x8BBE;&#x8BA1;&#x6210;&#x82E5;&#x5E72;&#x7531;&#x5FAE;&#x6307;&#x4EE4;&#x89E3;&#x91CA;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x5982;&#x5185;&#x5B58;&#x5757;&#x7684;&#x590D;&#x5236;&#xFF0C;&#x4E2D;&#x65AD;&#x3001;&#x5F02;&#x5E38;&#x53D1;&#x751F;&#x65F6;&#x73B0;&#x573A;&#x7684;&#x4FDD;&#x5B58;&#x3001;&#x4ECE;&#x4E2D;&#x65AD;&#x3001;&#x5F02;&#x5E38;&#x8FD4;&#x56DE;&#x65F6;&#x7684;&#x73B0;&#x573A;&#x6062;&#x590D;&#x7B49;&#x3002;</p><p>&#x56E0;&#x4E3A;&#x7CFB;&#x7EDF;&#x7F16;&#x7A0B;&#x8FD9;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x5927;&#x90E8;&#x5206;&#x662F;&#x7528;&#x6C47;&#x7F16;&#x8BED;&#x8A00;&#x76F4;&#x63A5;&#x7F16;&#x5199;&#xFF0C;&#x6240;&#x4EE5;&#x7F16;&#x8BD1;&#x5668;&#x5E76;&#x4E0D;&#x80FD;&#x5E2E;&#x4E0A;&#x5FD9;&#xFF0C;&#x82E5;&#x76F4;&#x63A5;&#x5B9A;&#x4E49;&#x65B0;&#x6307;&#x4EE4;&#xFF0C;&#x53EF;&#x4EE5;&#x7B80;&#x5316;&#x8FD9;&#x90E8;&#x5206;&#x7F16;&#x7A0B;&#x7684;&#x96BE;&#x5EA6;&#xFF0C;&#x4E5F;&#x5229;&#x4E8E;&#x8C03;&#x8BD5;&#x3002;&#x800C;&#x4E14;&#x8FD9;&#x4E9B;&#x7CFB;&#x7EDF;&#x7F16;&#x7A0B;&#x6307;&#x4EE4;&#xFF0C;&#x5F80;&#x5F80;&#x4E0D;&#x662F;&#x7528;&#x6237;&#x7A0B;&#x5E8F;&#x6240;&#x4F7F;&#x7528;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x7F16;&#x8BD1;&#x5668;&#x53EF;&#x80FD;&#x6C38;&#x8FDC;&#x90FD;&#x4E0D;&#x77E5;&#x9053;&#x8FD9;&#x4E9B;&#x6307;&#x4EE4;&#x7684;&#x5B58;&#x5728;&#xFF0C;&#x6240;&#x4EE5;&#x5F15;&#x5165;&#x8FD9;&#x4E9B;&#x6307;&#x4EE4;&#x53EF;&#x80FD;&#x4E0D;&#x9700;&#x8981;&#x5BF9;&#x7F16;&#x8BD1;&#x5668;&#x7684;&#x4FEE;&#x6539;&#x3002;</p><h3 id="&#x53C2;&#x8003;&#x8D44;&#x6599;"><a href="#&#x53C2;&#x8003;&#x8D44;&#x6599;" class="headerlink" title="&#x53C2;&#x8003;&#x8D44;&#x6599;"></a>&#x53C2;&#x8003;&#x8D44;&#x6599;</h3><p>&#x8BE5;&#x9879;&#x76EE;&#x662F;&#x4E00;&#x4E2A;&#x957F;&#x671F;&#x9879;&#x76EE;&#xFF0C;&#x7B14;&#x8005;&#x5DF2;&#x7ECF;&#x4E3A;&#x5B9E;&#x65BD;&#x8BE5;&#x9879;&#x76EE;&#x6240;&#x9700;&#x8981;&#x7684;&#x77E5;&#x8BC6;&#x50A8;&#x5907;&#x51C6;&#x5907;&#x4E86;&#x591A;&#x5E74;&#xFF0C;&#x5E76;&#x641C;&#x96C6;&#x4E86;&#x4E00;&#x4E9B;&#x53C2;&#x8003;&#x8D44;&#x6599;&#x3002;</p><h4 id="&#x786C;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x8BBE;&#x8BA1;"><a href="#&#x786C;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x8BBE;&#x8BA1;" class="headerlink" title="&#x786C;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x8BBE;&#x8BA1;"></a>&#x786C;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x8BBE;&#x8BA1;</h4><ol><li>Verilog HDL &#x6570;&#x5B57;&#x8BBE;&#x8BA1;&#x4E0E;&#x7EFC;&#x5408;&#xFF0C; Samir Lalnitkar, &#x590F;&#x6587;&#x5B87;&#x7B49;&#x8BD1;&#x3002;</li><li>See MIPS Run, Dominic Sweetman. &#x8FD9;&#x672C;&#x4E66;&#x5F88;&#x597D;&#x770B;&#xFF0C;&#x89E3;&#x91CA;&#x4E86;&#x8BB8;&#x591A;&#x91CD;&#x8981;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x4F8B;&#x5982;MIPS&#x4E2D;&#x7684;&#x6307;&#x4EE4;&#x5EF6;&#x65F6;&#x69FD;&#xFF0C;&#x5185;&#x5B58;&#x7684;&#x4FDD;&#x62A4;&#x7B49;&#x3002;&#x5173;&#x4E8E;&#x8FD9;&#x672C;&#x4E66;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x5C0F;&#x6545;&#x4E8B;&#xFF0C;&#x4E4B;&#x524D;&#x6211;&#x4E00;&#x76F4;&#x5728;&#x8BFB;&#x8FD9;&#x672C;&#x4E66;&#xFF0C;&#x76F4;&#x5230;&#x6700;&#x8FD1;&#x6211;&#x624D;&#x53D1;&#x73B0;&#x8FD9;&#x672C;&#x4E66;&#x6709;&#x4E00;&#x672C;&#x4E2D;&#x6587;&#x8BD1;&#x672C;&#xFF0C;&#x800C;&#x4E14;&#x7FFB;&#x8BD1;&#x8D28;&#x91CF;&#x975E;&#x5E38;&#x597D;&#xFF0C;&#x6253;&#x5F00;&#x4E00;&#x770B;&#x7ADF;&#x7136;&#x662F;&#x6211;&#x81EA;&#x5DF1;&#x7684;&#x8001;&#x5E08;<strong>&#x5C48;&#x5EFA;&#x52E4;</strong>&#x7FFB;&#x8BD1;&#x7684;&#xFF0C;&#x76F8;&#x89C1;&#x6068;&#x665A;&#x5440;&#xFF01;<strong>&#x611F;&#x8C22;&#x5C48;&#x8001;&#x5E08;&#x80FD;&#x4E3A;&#x5927;&#x5BB6;&#x63D0;&#x4F9B;&#x8FD9;&#x4E48;&#x597D;&#x7684;&#x5B66;&#x4E60;&#x8D44;&#x6599;&#x7684;&#x7FFB;&#x8BD1;</strong>&#x3002;</li><li>Computer System Architecture, M.Morris Mano. &#x8FD9;&#x672C;&#x4E66;&#x662F;&#x5F88;&#x8001;&#x7684;&#x4E66;&#xFF0C;&#x4F46;&#x662F;&#x7B14;&#x8005;&#x662F;&#x4ECE;&#x8FD9;&#x672C;&#x4E66;&#x91CC;&#x5165;&#x95E8;&#x7684;&#x3002;&#x8FD9;&#x672C;&#x4E66;&#x662F;&#x7B14;&#x8005;&#x521A;&#x5F00;&#x59CB;&#x5B66;&#x4E60;&#x8BA1;&#x7B97;&#x673A;&#x7CFB;&#x7EDF;&#x8BBE;&#x8BA1;&#x65F6;&#xFF0C;&#x7ECF;&#x8FC7;&#x4E86;&#x5F88;&#x591A;&#x6B21;&#x8BD5;&#x9519;&#xFF0C;&#x6700;&#x7EC8;&#x9009;&#x5B9A;&#x7684;&#x4E00;&#x672C;&#x4E66;&#xFF0C;&#x5199;&#x7684;&#x975E;&#x5E38;&#x8BE6;&#x7EC6;&#x3002;&#x4E66;&#x4E2D;&#x4ECE;&#x6700;&#x57FA;&#x672C;&#x7684;&#x6570;&#x5B57;&#x903B;&#x8F91;&#x5F00;&#x59CB;&#xFF0C;&#x4E00;&#x76F4;&#x8BB2;&#x5230;&#x5916;&#x56F4;&#x7535;&#x8DEF;&#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x4EFB;&#x4F55;&#x57FA;&#x4E8E;&#x5546;&#x4E1A;&#x8F6F;&#x4EF6;&#x7684;IP&#xFF0C;&#x800C;&#x4E14;&#x6700;&#x7EC8;&#x4E66;&#x91CC;&#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x5F88;&#x7B80;&#x5355;&#x7684;CPU&#x3002;</li><li>&#x8BA1;&#x7B97;&#x673A;&#x539F;&#x7406;&#x4E0E;&#x8BBE;&#x8BA1;,&#x674E;&#x4E9A;&#x6C11;&#x3002;&#x672C;&#x9879;&#x76EE;&#x8BBE;&#x8BA1;&#x7684;CPU&#x57FA;&#x4E8E;&#x8FD9;&#x672C;&#x4E66;&#x6240;&#x8BB0;&#x8F7D;&#x7684;&#x7C7B;MIPS CPU&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#x3002;&#x7B14;&#x8005;&#x975E;&#x5E38;&#x611F;&#x8C22;&#x8FD9;&#x672C;&#x4E66;&#x7684;&#x4F5C;&#x8005;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x672C;&#x4F1F;&#x5927;&#x7684;&#x8457;&#x4F5C;&#x3002;&#x8FD9;&#x672C;&#x4E66;&#x662F;&#x6211;&#x770B;&#x5230;&#x8FC7;&#x7684;&#x5BF9;&#x5904;&#x7406;&#x5668;&#x8BBE;&#x8BA1;&#x63CF;&#x8FF0;&#x6700;&#x8BE6;&#x5C3D;&#x7684;&#x8457;&#x4F5C;&#x3002;&#x5728;&#x5DE5;&#x7A0B;&#x4E0A;&#xFF0C;&#x7406;&#x8BBA;&#x548C;&#x5B9E;&#x8DF5;&#x7684;&#x5DEE;&#x8DDD;&#x4E4B;&#x5DE8;&#x5927;&#xFF0C;&#x65E0;&#x6CD5;&#x7528;&#x8BED;&#x8A00;&#x63CF;&#x8FF0;&#x3002;&#x9605;&#x8BFB;&#x8FD9;&#x672C;&#x4E66;&#xFF0C;&#x4ECE;&#x4F5C;&#x8005;&#x7CBE;&#x5999;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x586B;&#x8865;&#x7406;&#x8BBA;&#x548C;&#x5B9E;&#x8DF5;&#x4E4B;&#x95F4;&#x5DE8;&#x5927;&#x7684;&#x9E3F;&#x6C9F;&#xFF0C;&#x8FD9;&#x5BF9;&#x4E00;&#x4E2A;&#x5DE5;&#x7A0B;&#x5E08;&#x6765;&#x8BF4;&#x4F1A;&#x4EA7;&#x751F;&#x4E00;&#x79CD;&#x5DE8;&#x5927;&#x7684;&#x6EE1;&#x8DB3;&#x611F;&#x3002;</li><li>Fpga4Fun: <a href="https://www.fpga4fun.com/">https://www.fpga4fun.com/</a>. &#x7B14;&#x8005;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x7F51;&#x7AD9;&#x5165;&#x95E8;FPGA&#x3002;</li><li>Computer Organization And Design  The Hardware/Software Interface. &#x8FD9;&#x662F;&#x4E00;&#x672C;&#x7ECF;&#x5178;&#x6559;&#x6750;&#x3002;</li></ol><h4 id="&#x8F6F;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x8BBE;&#x8BA1;"><a href="#&#x8F6F;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x8BBE;&#x8BA1;" class="headerlink" title="&#x8F6F;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x8BBE;&#x8BA1;"></a>&#x8F6F;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x8BBE;&#x8BA1;</h4><ol><li>Operating System Design and Implementation (the Minix Book), Andrew S. Tanenbaum. &#x8FD9;&#x672C;&#x4E66;&#x7B80;&#x76F4;&#x662F;&#x5B66;&#x4E60;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x5723;&#x7ECF;&#xFF0C;&#x5C31;&#x662F;&#x5982;&#x679C;&#x8BA4;&#x771F;&#x8BFB;&#x4EE3;&#x7801;&#x7684;&#x8BDD;&#xFF0C;&#x9700;&#x8981;&#x5927;&#x91CF;&#x7684;&#x7CBE;&#x529B;&#x3002;</li><li>Intel&#xAE; 64 and IA-32 Architectures Software Developer&#x2019;s Manual Volume 3A: System Programming Guide, Part 1. Minix&#x4E66;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x662F;&#x57FA;&#x4E8E;X86&#x7684;&#xFF0C;&#x8981;&#x60F3;&#x8BFB;&#x660E;&#x767D;&#x5176;&#x5E73;&#x53F0;&#x76F8;&#x5173;&#x7684;&#x90E8;&#x5206;&#xFF0C;X86&#x7684;&#x7CFB;&#x7EDF;&#x7F16;&#x7A0B;&#x624B;&#x518C;&#x662F;&#x4E0D;&#x53EF;&#x7F3A;&#x5C11;&#x7684;&#x6750;&#x6599;&#x3002;&#x5173;&#x4E8E;X86&#x7684;&#x4FDD;&#x62A4;&#x6A21;&#x5F0F;&#xFF0C;&#x624B;&#x518C;&#x91CC;&#x6709;&#x4ECB;&#x7ECD;&#xFF0C;&#x4F46;&#x662F;&#x4ED6;&#x7684;&#x4ECB;&#x7ECD;&#x975E;&#x5E38;&#x7E41;&#x7410;&#xFF0C;&#x7B14;&#x8005;&#x4E5F;&#x662F;&#x82B1;&#x4E86;&#x5F88;&#x957F;&#x65F6;&#x95F4;&#x624D;&#x5F04;&#x660E;&#x767D;&#xFF0C;&#x6709;&#x673A;&#x4F1A;&#x7B14;&#x8005;&#x4F1A;&#x5199;&#x4E00;&#x7BC7;&#x535A;&#x6587;&#xFF0C;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;minix&#x5982;&#x4F55;&#x4F7F;&#x7528;X86&#x7684;&#x4FDD;&#x62A4;&#x6A21;&#x5F0F;&#x3002;</li><li>MOP: Minix Overdocumentation Project,<a href="http://www.os-forum.com/minix/boot/index.php">http://www.os-forum.com/minix/boot/index.php</a>. &#x8FD9;&#x4E2A;&#x7F51;&#x7AD9;&#x7684;&#x4F5C;&#x8005;&#xFF0C;&#x82B1;&#x8D39;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x5BF9;minix&#x7684;&#x542F;&#x52A8;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x4E86;&#x9010;&#x884C;&#x5206;&#x6790;&#x3002;&#x53EA;&#x8981;&#x5B8C;&#x6574;&#x7684;&#x9605;&#x8BFB;&#x5B8C;&#x8FD9;&#x4E2A;&#x7F51;&#x7AD9;&#xFF0C;&#x4F60;&#x5C31;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x4E00;&#x53F0;X86 PC&#x5728;&#x6309;&#x4E0B;&#x7535;&#x6E90;&#x6309;&#x94AE;&#x540E;&#xFF0C;BIOS&#x8FD0;&#x884C;&#x7ED3;&#x675F;&#x540E;&#x5230;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x52A0;&#x8F7D;&#x4E4B;&#x95F4;&#x7684;&#x6240;&#x6709;&#x8FD0;&#x884C;&#x60C5;&#x51B5;&#x3002;&#x4F46;&#x662F;&#x8981;&#x505A;&#x597D;&#x5FC3;&#x7406;&#x51C6;&#x5907;&#xFF0C;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x5F88;&#x590D;&#x6742;&#xFF0C;&#x5E76;&#x4E14;&#x7406;&#x89E3;&#x4ED6;&#x9700;&#x8981;&#x4E86;&#x89E3;X86&#x7684;&#x4FDD;&#x62A4;&#x6A21;&#x5F0F;&#x3002;Minix&#x4E66;&#x4E2D;&#x5E76;&#x6CA1;&#x6709;&#x5BF9;&#x5176;boot monitor&#x7684;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x6CE8;&#x91CA;&#xFF0C;&#x53EA;&#x662F;&#x5728;&#x4E66;&#x4E2D;&#x63D0;&#x4E86;&#x4E00;&#x53E5;&#xFF0C;&#x8BF4;boot monitor&#x5341;&#x5206;&#x590D;&#x6742;&#xFF0C;&#x4E0D;&#x4E9A;&#x4E8E;&#x4E00;&#x4E2A;&#x5C0F;&#x578B;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#x4E5F;&#x786E;&#x5B9E;&#x5982;&#x6B64;&#xFF0C;&#x7B14;&#x8005;&#x4E0D;&#x624D;&#xFF0C;&#x5B8C;&#x6574;&#x9605;&#x8BFB;&#x8FD9;&#x4E2A;&#x7F51;&#x7AD9;&#x82B1;&#x8D39;&#x4E86;&#x4E24;&#x4E2A;&#x591A;&#x6708;&#x7684;&#x65F6;&#x95F4;&#x3002;&#x7B14;&#x8005;&#x53D1;&#x73B0;&#x8FD9;&#x4E2A;&#x7F51;&#x7AD9;&#xFF0C;&#x662F;&#x5728;&#x8BFB;minix&#x4E66;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x7531;&#x4E8E;&#x4E66;&#x4E2D;&#x5BF9;&#x5176;&#x542F;&#x52A8;&#x5668;&#x63CF;&#x8FF0;&#x7684;&#x7F3A;&#x4E4F;&#xFF0C;&#x4F7F;&#x5F97;&#x6211;&#x5BF9;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x521D;&#x59CB;&#x7684;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#x6709;&#x7591;&#x60D1;&#xFF0C;&#x8FDB;&#x800C;&#x627E;&#x5230;&#x4E86;&#x8FD9;&#x4E2A;&#x7F51;&#x7AD9;&#xFF0C;&#x5B8C;&#x7F8E;&#x5730;&#x89E3;&#x7B54;&#x4E86;&#x7591;&#x60D1;&#x3002;&#x8FD9;&#x4E2A;&#x7F51;&#x7AD9;&#x7684;&#x4F5C;&#x8005;&#xFF0C;&#x5BF9;&#x7B14;&#x8005;&#x4E5F;&#x6709;&#x5F88;&#x6DF1;&#x7684;&#x5F71;&#x54CD;&#xFF0C;&#x6709;&#x65F6;&#x5019;&#x505A;&#x4E00;&#x4EF6;&#x4E8B;&#x4E0D;&#x9700;&#x8981;&#x8003;&#x8651;&#x592A;&#x591A;&#x7ED3;&#x679C;&#x3002;&#x5B66;&#x4E60;&#x672C;&#x8EAB;&#x5C31;&#x662F;&#x4E00;&#x4EF6;&#x6709;&#x610F;&#x4E49;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x5BF9;&#x4E8E;&#x4E2A;&#x4EBA;&#x5982;&#x6B64;&#xFF0C;&#x5BF9;&#x4E8E;&#x793E;&#x4F1A;&#x66F4;&#x662F;&#x5982;&#x6B64;&#x3002;&#x8FD9;&#x4E2A;&#x7F51;&#x7AD9;&#x4E5F;&#x662F;&#x6211;&#x51C6;&#x5907;&#x8FD9;&#x4E2A;&#x535A;&#x5BA2;&#x7684;&#x539F;&#x56E0;&#x4E4B;&#x4E00;&#xFF0C;&#x8981;&#x628A;&#x81EA;&#x5DF1;&#x7684;&#x5B66;&#x4E60;&#x8FC7;&#x7A0B;&#x793E;&#x4F1A;&#x5316;&#xFF0C;&#x53EA;&#x8981;&#x80FD;&#x6709;&#x4E00;&#x4E2A;&#x4EBA;&#x4ECE;&#x6211;&#x7684;&#x7ECF;&#x5386;&#x4E2D;&#x5F97;&#x5230;&#x5E2E;&#x52A9;&#xFF0C;&#x672C;&#x8EAB;&#x5C31;&#x662F;&#x4E00;&#x4EF6;&#x5F88;&#x6709;&#x610F;&#x4E49;&#x7684;&#x4E8B;&#x60C5;&#x3002;</li><li>Lcc-A Retargetable C Compiler: Design and Implementation. lcc&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x6709;&#x540D;&#x7684;&#x7F16;&#x8BD1;&#x5668;&#xFF0C;&#x5B83;&#x672C;&#x8EAB;&#x662F;&#x4E00;&#x4E2A;&#x6587;&#x672C;&#x7A0B;&#x5E8F;&#xFF0C;&#x8FD9;&#x672C;&#x4E66;&#x8BE6;&#x7EC6;&#x7684;&#x4ECB;&#x7ECD;&#x4E86;&#x5176;&#x5B9E;&#x73B0;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x7EC6;&#x8282;&#x3002;&#x53EA;&#x662F;&#x7B14;&#x8005;&#x6C34;&#x5E73;&#x6709;&#x9650;&#xFF0C;&#x8BFB;&#x8D77;&#x6765;&#x5341;&#x5206;&#x5403;&#x529B;&#xFF0C;&#x82B1;&#x4E86;&#x5C06;&#x8FD1;&#x56DB;&#x4E2A;&#x6708;&#x65F6;&#x95F4;&#x624D;&#x8BFB;&#x5B8C;&#xFF0C;&#x638C;&#x63E1;&#x4E86;&#x5BF9;&#x5176;&#x4FEE;&#x6539;&#x7684;&#x80FD;&#x529B;&#xFF0C;&#x4E5F;&#x6DF1;&#x5165;&#x4E86;&#x89E3;&#x4E86;ANSI C&#x6807;&#x51C6;&#x7684;&#x5B9E;&#x73B0;&#x3002;&#x503C;&#x5F97;&#x4E00;&#x63D0;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x672C;&#x4E66;&#x6709;&#x4E00;&#x4E2D;&#x6587;&#x8BD1;&#x672C;&#xFF0C;&#x4F46;&#x662F;&#x5F88;&#x9057;&#x61BE;&#xFF0C;&#x4E0D;&#x540C;&#x7AE0;&#x8282;&#x7FFB;&#x8BD1;&#x7684;&#x8D28;&#x91CF;&#x6709;&#x5F88;&#x5927;&#x7684;&#x6CE2;&#x52A8;&#xFF0C;&#x800C;&#x4E14;&#x4E5F;&#x6709;&#x4E00;&#x4E9B;&#x7FFB;&#x8BD1;&#x4E0A;&#x7684;&#x9519;&#x8BEF;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x7B14;&#x8005;&#x5C31;&#x4E0D;&#x63A8;&#x8350;&#x4E86;&#x3002;</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&amp;#x8BE5;&amp;#x9879;&amp;#x76EE;&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x81EA;&amp;#x5236;&lt;strong&gt;&amp;#x8BA1;&amp;#x7B97;&amp;#x673A;&amp;#x7CFB;&amp;#x7EDF;&lt;/strong&gt;&amp;#x7684;&amp;#x9879;</summary>
      
    
    
    
    <category term="home brew computer system" scheme="https://gpthimble.github.io/categories/home-brew-computer-system/"/>
    
    
    <category term="development log" scheme="https://gpthimble.github.io/tags/development-log/"/>
    
    <category term="home brew computer system" scheme="https://gpthimble.github.io/tags/home-brew-computer-system/"/>
    
    <category term="summarize" scheme="https://gpthimble.github.io/tags/summarize/"/>
    
  </entry>
  
</feed>
